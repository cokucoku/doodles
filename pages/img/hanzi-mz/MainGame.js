var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __values = (this && this.__values) || function(o) {
    var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
    if (m) return m.call(o);
    if (o && typeof o.length === "number") return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
    throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
};
var dObject = (function () {
    function dObject() {
        this.objectId = dObject.g_objectId++;
    }
    dObject.InitStatic = function (fun) {
        dObject.s_initStatic.push(fun);
    };
    dObject.CallInitStatic = function () {
        for (var i = 0; i < dObject.s_initStatic.length; i++)
            dObject.s_initStatic[i]();
        dObject.s_initStatic.clear();
    };
    dObject.g_objectId = 1;
    dObject.s_initStatic = new Array();
    return dObject;
}());
var __dShaderUniformData = (function () {
    function __dShaderUniformData() {
        this.flag = 0;
        this.f1 = 0;
        this.f2 = 0;
        this.f3 = 0;
        this.f4 = 0;
        this.iData = 0;
        this.mat = null;
    }
    return __dShaderUniformData;
}());
var dShader = (function (_super) {
    __extends(dShader, _super);
    function dShader() {
        var _this = _super.call(this) || this;
        _this.m_attributeNameList = null;
        _this.m_vertexTypeList = null;
        _this.m_hVertexShader = null;
        _this.m_hFragmentShader = null;
        _this.m_hProgram = null;
        _this.m_vecAttributeList = new Array();
        _this.m_mapUniformLocationBuffer = new Map();
        _this.m_mapUniformData = new Map();
        for (var i = 0; i < 8; i++)
            _this.SetUniformI("sTexture" + i, i);
        dInterface.ptr.m_vecShaders.push(_this);
        return _this;
    }
    dShader.prototype.Release = function () {
        if (this.m_hVertexShader) {
            dInterface.ptr.webgl.deleteShader(this.m_hVertexShader);
            this.m_hVertexShader = null;
        }
        if (this.m_hFragmentShader) {
            dInterface.ptr.webgl.deleteShader(this.m_hFragmentShader);
            this.m_hFragmentShader = null;
        }
        if (this.m_hProgram) {
            dInterface.ptr.webgl.deleteProgram(this.m_hProgram);
            this.m_hProgram = null;
        }
        dInterface.ptr.m_vecShaders.remove(this);
    };
    dShader.GetAllShaders = function () {
        return dInterface.ptr.m_vecShaders;
    };
    dShader.prototype.Init = function (strVertex, strFragment, attributeNameList) {
        var webgl = dInterface.ptr.webgl;
        if (!webgl)
            return;
        this.m_attributeNameList = attributeNameList;
        this.m_hVertexShader = webgl.createShader(webgl.VERTEX_SHADER);
        this.m_hFragmentShader = webgl.createShader(webgl.FRAGMENT_SHADER);
        webgl.shaderSource(this.m_hVertexShader, strVertex);
        webgl.shaderSource(this.m_hFragmentShader, strFragment);
        webgl.compileShader(this.m_hVertexShader);
        webgl.compileShader(this.m_hFragmentShader);
        if (!webgl.getShaderParameter(this.m_hVertexShader, webgl.COMPILE_STATUS)) {
            console.log("getShaderParameter(this.m_hVertexShader error");
            console.log(webgl.getShaderInfoLog(this.m_hVertexShader));
            return;
        }
        if (!webgl.getShaderParameter(this.m_hFragmentShader, webgl.COMPILE_STATUS)) {
            console.log("getShaderParameter(this.m_hFragmentShader error");
            console.log(webgl.getShaderInfoLog(this.m_hFragmentShader));
            return;
        }
        this.m_hProgram = webgl.createProgram();
        webgl.attachShader(this.m_hProgram, this.m_hVertexShader);
        webgl.attachShader(this.m_hProgram, this.m_hFragmentShader);
        webgl.linkProgram(this.m_hProgram);
        if (!webgl.getProgramParameter(this.m_hProgram, webgl.LINK_STATUS)) {
            console.log("getProgramParameter(this.m_hProgram, webgl.LINK_STATUS error");
            console.log(webgl.getProgramInfoLog(this.m_hProgram));
            return;
        }
        webgl.useProgram(this.m_hProgram);
        this.m_vecAttributeList = new Array(attributeNameList.length);
        for (var i = 0; i < attributeNameList.length; i++)
            this.m_vecAttributeList[i] = this._GetAttribLocation(attributeNameList[i]);
    };
    dShader.prototype.GetAttributeNameList = function () {
        return this.m_attributeNameList;
    };
    dShader.prototype.SetUniformV2 = function (strName, v, z, w) {
        if (z === void 0) { z = 0; }
        if (w === void 0) { w = 0; }
        this.SetUniformF(strName, v.x, v.y, z, w);
    };
    dShader.prototype.SetUniformV3 = function (strName, v, w) {
        if (w === void 0) { w = 0; }
        this.SetUniformF(strName, v.x, v.y, v.z, w);
    };
    dShader.prototype.SetUniformV4 = function (strName, v) {
        this.SetUniformF(strName, v.x, v.y, v.z, v.w);
    };
    dShader.prototype.SetUniformF = function (strName, x, y, z, w) {
        var uniformData;
        if (!this.m_mapUniformData.has(strName))
            this.m_mapUniformData.set(strName, uniformData = new __dShaderUniformData());
        else
            uniformData = this.m_mapUniformData.get(strName);
        uniformData.flag = 1;
        uniformData.f1 = x;
        uniformData.f2 = y;
        uniformData.f3 = z;
        uniformData.f4 = w;
        ;
    };
    dShader.prototype.SetUniformI = function (strName, x) {
        var uniformData;
        if (!this.m_mapUniformData.has(strName))
            this.m_mapUniformData.set(strName, uniformData = new __dShaderUniformData());
        else
            uniformData = this.m_mapUniformData.get(strName);
        uniformData.flag = 2;
        uniformData.iData = x;
    };
    dShader.prototype.SetUniformMatrix = function (strName, mat, index) {
        if (index === void 0) { index = -1; }
        var uniformData;
        if (!this.m_mapUniformData.has(strName))
            this.m_mapUniformData.set(strName, uniformData = new __dShaderUniformData());
        else
            uniformData = this.m_mapUniformData.get(strName);
        uniformData.flag = 3;
        if (uniformData.mat == null)
            uniformData.mat = [];
        mat.ToArray(uniformData.mat);
        uniformData.iData = index;
    };
    dShader.prototype._Use = function () {
        dInterface.ptr.webgl.useProgram(this.m_hProgram);
        if (dInterface.ptr.m_pLastUseShader != this) {
            this._UpdateUniform();
            dInterface.ptr.m_pLastUseShader = this;
        }
    };
    dShader.prototype._Begin = function () {
        for (var i = 0; i < this.m_vecAttributeList.length; i++)
            dInterface.ptr.webgl.enableVertexAttribArray(this.m_vecAttributeList[i]);
    };
    dShader.prototype._End = function () {
        for (var i = 0; i < this.m_vecAttributeList.length; i++)
            dInterface.ptr.webgl.disableVertexAttribArray(this.m_vecAttributeList[i]);
    };
    dShader.prototype._GetAttribLocation = function (strName) {
        return dInterface.ptr.webgl.getAttribLocation(this.m_hProgram, strName);
    };
    dShader.prototype._GetUniformLocation = function (strName) {
        if (!this.m_mapUniformLocationBuffer.has(strName))
            this.m_mapUniformLocationBuffer.set(strName, dInterface.ptr.webgl.getUniformLocation(this.m_hProgram, strName));
        return this.m_mapUniformLocationBuffer.get(strName);
    };
    dShader.prototype._UpdateUniform = function () {
        var e_1, _a;
        var webgl = dInterface.ptr.webgl;
        try {
            for (var _b = __values(this.m_mapUniformData.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var name = _c.value;
                var uniformData = this.m_mapUniformData.get(name);
                var loc = this._GetUniformLocation(name);
                if (loc) {
                    if (uniformData.flag == 1) {
                        webgl.uniform4f(loc, uniformData.f1, uniformData.f2, uniformData.f3, uniformData.f4);
                    }
                    else if (uniformData.flag == 2) {
                        webgl.uniform1i(loc, uniformData.iData);
                    }
                    else if (uniformData.flag == 3) {
                        webgl.uniformMatrix4fv(loc, false, uniformData.mat);
                    }
                }
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    dShader.prototype.SetWindowSize = function (w, h) {
    };
    dShader.GetHeader = function () {
        return "#ifdef GL_ES\n" +
            "#define LOWP lowp\n" +
            "#define HIGHP highp\n" +
            "#define MEDIUMP mediump\n" +
            "precision highp float;\n" +
            "#else\n" +
            "#define LOWP\n" +
            "#define HIGHP\n" +
            "#define MEDIUMP\n" +
            "#endif\n";
    };
    dShader.prototype.GetAllShaders = function () {
        return dInterface.ptr.m_vecShaders;
    };
    dShader.prototype.isInRender = function (pSprite, matWorld) {
        return 0;
    };
    dShader.prototype.GetVertexTypeList = function () {
        return this.m_vertexTypeList;
    };
    dShader.VertexTypeListEquals = function (a, b) {
        if (a == null || b == null || a.length != b.length)
            return false;
        for (var i = 0, n = a.length; i < n; i++) {
            if ((a[i] & 0xff) != (b[i] & 0xff))
                return false;
        }
        return true;
    };
    dShader.prototype.OnBindSprite = function (p) {
    };
    return dShader;
}(dObject));
var dSprite = (function (_super) {
    __extends(dSprite, _super);
    function dSprite() {
        var _this = _super.call(this) || this;
        _this.m_fPosX = 0.0;
        _this.m_fPosY = 0.0;
        _this.m_fPosZ = 0.0;
        _this.m_fWidth = 0.0;
        _this.m_fHeight = 0.0;
        _this.m_fDepth = 0.0;
        _this.m_fAnchorU = 0.0;
        _this.m_fAnchorV = 0.0;
        _this.m_fAnchorW = 0.0;
        _this.m_fScaleX = 1.0;
        _this.m_fScaleY = 1.0;
        _this.m_fScaleZ = 1.0;
        _this.m_fRotation = 0.0;
        _this.m_fRotationX = 0.0;
        _this.m_fRotationY = 0.0;
        _this.m_bShow = true;
        _this.m_pSpriteFather = null;
        _this.m_vecChildSprite = new Array();
        _this.m_fAlpha = 1.0;
        _this.m_nColorARGB = 0xFFFFFFFF;
        _this.m_matColorTransform = new dMatrix();
        _this.m_bClipChild = false;
        _this.m_nBlendMode = dSprite.DEFAULT_BLEND_MODE;
        _this.m_nSpriteFrame = 0;
        _this.m_pBindShader = null;
        _this.m_pBindMeshData = null;
        _this.m_nEnableZReadWrite = 0;
        _this.m_nEnableCulling = 0;
        _this.m_onTouchEvent = null;
        _this.m_pSetBitmapData = new Array(8);
        _this.m_bForceRender = false;
        _this.m_mapUniformData = new Map();
        _this.m_pSetBitmapDataSourceRect = null;
        _this.m_bHandleMouse = false;
        _this.m_bTransparentMouse = false;
        _this.m_bDestroyed = false;
        _this.m_matSpriteMatrixLocal = new dMatrix();
        _this.m_nLayoutAlign = 0;
        _this.m_strSpriteName = "";
        _this.m_vecLinkSprite = null;
        _this.m_nEnableClearFlag = 0;
        _this.m_matRenderMatrixSelf = new dMatrix();
        _this.m_matRenderMatrixWorld = new dMatrix();
        _this.m_bRenderMatrixDirty = true;
        _this.m_bRenderMatrixSelfDirty = true;
        _this.m_rcRenderForClip = new dRect();
        _this.m_vecFrameData = null;
        _this.SetShader(dSpriteDefaultShader.Instance());
        _this.SetMeshData(dSpriteDefaultShader.Instance().GetMeshData());
        _this._UpdateColor();
        _this._UpdateColorTransform();
        return _this;
    }
    dSprite.prototype.Destroy = function () {
        this.RemoveParent();
        this.m_bDestroyed = true;
    };
    dSprite.prototype.isDestroyed = function () {
        return this.m_bDestroyed;
    };
    dSprite.prototype.AddChild = function (pChild, at) {
        if (at === void 0) { at = -1; }
        if (pChild == null)
            return;
        if (pChild == this)
            throw "add child error";
        if (pChild.m_pSpriteFather != this) {
            if (pChild.m_pSpriteFather != null)
                pChild.RemoveParent();
            pChild.m_pSpriteFather = this;
            pChild.m_bRenderMatrixDirty = true;
            pChild.m_bRenderMatrixSelfDirty = true;
            if (at == -1)
                this.m_vecChildSprite.push(pChild);
            else
                this.m_vecChildSprite.insert(at, pChild);
        }
        else {
            if (at == -1)
                at = this.m_vecChildSprite.length - 1;
            if (this.m_vecChildSprite.indexOf(pChild) != at) {
                this.SetChildAt(pChild, at);
            }
        }
    };
    dSprite.prototype.RemoveChild = function (pChild) {
        if (pChild)
            pChild.RemoveParent();
    };
    dSprite.prototype.RemoveAllChild = function (bDestory) {
        if (bDestory === void 0) { bDestory = false; }
        for (var i = this.m_vecChildSprite.length - 1; i >= 0; i--) {
            if (bDestory)
                this.m_vecChildSprite[i].Destroy();
            this.RemoveChild(this.m_vecChildSprite[i]);
        }
    };
    dSprite.prototype.RemoveParent = function () {
        if (this.m_pSpriteFather != null) {
            this.m_pSpriteFather.m_vecChildSprite.remove(this);
            this.m_pSpriteFather = null;
        }
    };
    dSprite.prototype.GetParent = function () {
        return this.m_pSpriteFather;
    };
    dSprite.prototype.SetChildAt = function (pChild, at) {
        var find = this.m_vecChildSprite.indexOf(pChild);
        if (find != -1) {
            this.m_vecChildSprite.erase(find);
            if (at == -1)
                this.m_vecChildSprite.push(pChild);
            else
                this.m_vecChildSprite.insert(at, pChild);
        }
    };
    dSprite.prototype.GetChildList = function () {
        return this.m_vecChildSprite;
    };
    dSprite.prototype.GetChildListAt = function (at) {
        var vec = this.GetChildList();
        if (at >= 0 && at < vec.length)
            return vec[at];
        return null;
    };
    dSprite.prototype.SortChild = function (onSortFun) {
        var pSpriteBufferForSort = new Array();
        pSpriteBufferForSort.copy(this.m_vecChildSprite);
        pSpriteBufferForSort.sort(onSortFun);
        for (var i = 0, n = pSpriteBufferForSort.length; i < n; i++) {
            this.AddChild(pSpriteBufferForSort[i], i);
        }
    };
    dSprite.prototype.isInRoot = function () {
        var pRoot = dThread.GetRootSprite();
        var pFather = this.m_pSpriteFather;
        while (pFather != null) {
            if (pFather == pRoot)
                return true;
            pFather = pFather.m_pSpriteFather;
        }
        return false;
    };
    dSprite.prototype.isShowInRoot = function () {
        if (!this.isShow())
            return false;
        var pRoot = dThread.GetRootSprite();
        var pFather = this.GetParent();
        while (pFather != null) {
            if (pFather == pRoot)
                return true;
            if (!pFather.isShow())
                return false;
            pFather = pFather.m_pSpriteFather;
        }
        return false;
    };
    dSprite.prototype._AddLinkSprite = function (pSprite) {
        if (pSprite == this)
            return;
        if (this.m_vecLinkSprite == null)
            this.m_vecLinkSprite = new Array();
        if (this.m_vecLinkSprite.indexOf(pSprite) != -1)
            this.m_vecLinkSprite.remove(pSprite);
        this.m_vecLinkSprite.push(pSprite);
    };
    dSprite.prototype.AddLinkSprite = function (pSprite) {
        this._AddLinkSprite(pSprite);
        pSprite._AddLinkSprite(this);
    };
    dSprite.prototype._RemoveLinkSprite = function (pSprite) {
        if (this.m_vecLinkSprite != null && this.m_vecLinkSprite.indexOf(pSprite) != -1) {
            this.m_vecLinkSprite.remove(pSprite);
        }
    };
    dSprite.prototype.RemoveLinkSprite = function (pSprite) {
        this._RemoveLinkSprite(pSprite);
        pSprite._RemoveLinkSprite(this);
    };
    dSprite.prototype.GetLinkList = function () {
        return this.m_vecLinkSprite;
    };
    dSprite.prototype.isLinkOther = function (pOther) {
        if (this.m_vecLinkSprite == null)
            return false;
        return this.m_vecLinkSprite.indexOf(pOther) != -1;
    };
    dSprite.prototype.SetFrameDataList = function (dataList) {
        this.m_vecFrameData = dataList;
    };
    dSprite.prototype.SetFrame = function (frame, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = true; }
        if (this.m_nSpriteFrame != frame) {
            this.m_nSpriteFrame = frame;
            if (this.m_vecFrameData != null) {
                if (frame >= 0 && frame < this.m_vecFrameData.length) {
                    var frameData = this.m_vecFrameData[dMath.ToInt(frame)];
                    this.SetPos3D(frameData.x, frameData.y, frameData.z);
                    this.SetScale3D(frameData.sx, frameData.sy, frameData.sz);
                    this.SetRotation(frameData.rz);
                    if (frameData.rx != 0 && frameData.ry != 0)
                        this.SetRotationXY(frameData.rx, frameData.ry);
                    this.SetShow(frameData.visible != 0);
                    this.SetColor(frameData.spriteColor, false);
                    this.SetAlpha(frameData.alpha, false);
                }
            }
            if (bSetToChild) {
                for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++)
                    this.m_vecChildSprite[i].SetFrame(frame, bSetToChild);
            }
        }
    };
    dSprite.prototype.GetFrame = function () {
        return this.m_nSpriteFrame;
    };
    dSprite.prototype.GetMaxFrame = function () {
        return 0;
    };
    Object.defineProperty(dSprite.prototype, "spriteFrame", {
        get: function () {
            return this.GetFrame();
        },
        set: function (value) {
            this.SetFrame(value);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "spriteName", {
        get: function () {
            return this.m_strSpriteName;
        },
        set: function (str) {
            this.m_strSpriteName = str;
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.FindChild = function (strChildName) {
        for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++)
            if (this.m_vecChildSprite[i].spriteName == strChildName)
                return this.m_vecChildSprite[i];
        return null;
    };
    dSprite.prototype.SetPos = function (x, y) {
        if (this.m_fPosX != x || this.m_fPosY != y) {
            this.m_fPosX = x;
            this.m_fPosY = y;
            this.UpdateLocal();
            if (this.m_onTouchEvent)
                this.m_onTouchEvent.SetPos(x, y);
        }
    };
    dSprite.prototype.GetPosVector2 = function () {
        return new dVector2(this.positionX, this.positionY);
    };
    dSprite.prototype.SetPosVector2 = function (v) {
        this.SetPos(v.x, v.y);
    };
    dSprite.prototype.GetPosVector3 = function () {
        return new dVector3(this.positionX, this.positionY, this.positionZ);
    };
    dSprite.prototype.SetPosVector3 = function (v) {
        this.SetPos3D(v.x, v.y, v.z);
    };
    dSprite.prototype.GetPosX = function () {
        return this.m_fPosX;
    };
    dSprite.prototype.GetPosY = function () {
        return this.m_fPosY;
    };
    dSprite.prototype.GetPosZ = function () {
        return this.m_fPosZ;
    };
    Object.defineProperty(dSprite.prototype, "positionX", {
        get: function () {
            return this.GetPosX();
        },
        set: function (data) {
            this.SetPos(data, this.GetPosY());
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "positionY", {
        get: function () {
            return this.GetPosY();
        },
        set: function (data) {
            this.SetPos(this.GetPosX(), data);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "positionZ", {
        get: function () {
            return this.GetPosZ();
        },
        set: function (data) {
            this.SetPos3D(this.GetPosX(), this.GetPosY(), data);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "width", {
        get: function () {
            return this.GetWidth();
        },
        set: function (data) {
            this.SetSize(data, this.GetHeight());
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "height", {
        get: function () {
            return this.GetHeight();
        },
        set: function (data) {
            this.SetSize(this.GetWidth(), data);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "depth", {
        get: function () {
            return this.GetDepth();
        },
        set: function (data) {
            this.SetSize3D(this.width, this.height, data);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.SetAnchor = function (u, v) {
        if (this.m_fAnchorU != u || this.m_fAnchorV != v) {
            this.m_fAnchorU = u;
            this.m_fAnchorV = v;
            this.m_bRenderMatrixSelfDirty = true;
        }
    };
    dSprite.prototype.SetAnchor3D = function (u, v, w) {
        if (this.m_fAnchorU != u || this.m_fAnchorV != v || this.m_fAnchorW != w) {
            this.m_fAnchorU = u;
            this.m_fAnchorV = v;
            this.m_fAnchorW = w;
        }
    };
    dSprite.prototype.GetAnchorU = function () {
        return this.m_fAnchorU;
    };
    dSprite.prototype.GetAnchorV = function () {
        return this.m_fAnchorV;
    };
    dSprite.prototype.GetAnchorW = function () {
        return this.m_fAnchorW;
    };
    Object.defineProperty(dSprite.prototype, "anchorU", {
        get: function () {
            return this.GetAnchorU();
        },
        set: function (value) {
            this.SetAnchor(value, this.GetAnchorV());
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "anchorV", {
        get: function () {
            return this.GetAnchorV();
        },
        set: function (value) {
            this.SetAnchor(this.GetAnchorU(), value);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "anchorW", {
        get: function () {
            return this.GetAnchorW();
        },
        set: function (value) {
            this.SetAnchor3D(this.GetAnchorU(), this.GetAnchorV(), value);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.SetScale = function (x, y) {
        if (this.m_fScaleX != x || this.m_fScaleY != y) {
            this.m_fScaleX = x;
            this.m_fScaleY = y;
            this.UpdateLocal();
            if (this.m_onTouchEvent != null)
                this.m_onTouchEvent.SetScale(x, y);
        }
    };
    dSprite.prototype.GetScaleX = function () {
        return this.m_fScaleX;
    };
    dSprite.prototype.GetScaleY = function () {
        return this.m_fScaleY;
    };
    dSprite.prototype.GetScaleZ = function () {
        return this.m_fScaleZ;
    };
    dSprite.prototype.GetScaleX_World = function (rootStop, bWithRoot) {
        if (rootStop === void 0) { rootStop = null; }
        if (bWithRoot === void 0) { bWithRoot = true; }
        var mat = this.GetMatrixWorld(rootStop, bWithRoot);
        var sca = new dVector3();
        mat.Decompose(null, sca, null);
        return sca.x;
    };
    dSprite.prototype.GetScaleY_World = function (rootStop, bWithRoot) {
        if (rootStop === void 0) { rootStop = null; }
        if (bWithRoot === void 0) { bWithRoot = true; }
        var mat = this.GetMatrixWorld(rootStop, bWithRoot);
        var sca = new dVector3();
        mat.Decompose(null, sca, null);
        return sca.y;
    };
    Object.defineProperty(dSprite.prototype, "scaleX", {
        get: function () {
            return this.GetScaleX();
        },
        set: function (data) {
            this.SetScale(data, this.GetScaleY());
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "scaleY", {
        get: function () {
            return this.GetScaleY();
        },
        set: function (data) {
            this.SetScale(this.GetScaleX(), data);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "scaleZ", {
        get: function () {
            return this.GetScaleZ();
        },
        set: function (data) {
            this.SetScale3D(this.GetScaleX(), this.GetScaleY(), data);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.SetRotation = function (angle) {
        if (this.m_fRotation != angle) {
            this.m_fRotation = angle;
            this.UpdateLocal();
        }
    };
    dSprite.prototype.GetRotation = function () {
        return this.m_fRotation;
    };
    Object.defineProperty(dSprite.prototype, "rotation", {
        get: function () {
            return this.m_fRotation;
        },
        set: function (data) {
            this.SetRotation(data);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.GetPosX_World = function (rootStop, bWithRoot) {
        if (rootStop === void 0) { rootStop = null; }
        if (bWithRoot === void 0) { bWithRoot = true; }
        return this.GetMatrixWorld(rootStop, bWithRoot)._41;
    };
    dSprite.prototype.GetPosY_World = function (rootStop, bWithRoot) {
        if (rootStop === void 0) { rootStop = null; }
        if (bWithRoot === void 0) { bWithRoot = true; }
        return this.GetMatrixWorld(rootStop, bWithRoot)._42;
    };
    dSprite.prototype.GetPosZ_World = function (rootStop, bWithRoot) {
        if (rootStop === void 0) { rootStop = null; }
        if (bWithRoot === void 0) { bWithRoot = true; }
        return this.GetMatrixWorld(rootStop, bWithRoot)._43;
    };
    dSprite.prototype.GetPos_World = function (rootStop, bWithRoot) {
        if (rootStop === void 0) { rootStop = null; }
        if (bWithRoot === void 0) { bWithRoot = true; }
        var mat = this.GetMatrixWorld(rootStop, bWithRoot);
        return new dVector3(mat._41, mat._42, mat._43);
    };
    dSprite.prototype.GetPos_World3D = function (rootStop, bWithRoot) {
        if (rootStop === void 0) { rootStop = null; }
        if (bWithRoot === void 0) { bWithRoot = true; }
        var mat = this.GetMatrixWorld(rootStop, bWithRoot);
        return new dVector3(mat._41, mat._42, mat._43);
    };
    dSprite.prototype.SetRotationXY = function (x, y) {
        if (this.GetRotationX() != x || this.GetRotationY() != y) {
            this.m_fRotationX = x;
            this.m_fRotationY = y;
            this.UpdateLocal();
        }
    };
    dSprite.prototype.GetRotationX = function () {
        return this.m_fRotationX;
    };
    dSprite.prototype.GetRotationY = function () {
        return this.m_fRotationY;
    };
    Object.defineProperty(dSprite.prototype, "rotationX", {
        get: function () {
            return this.GetRotationX();
        },
        set: function (x) {
            this.SetRotationXY(x, this.GetRotationY());
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "rotationY", {
        get: function () {
            return this.GetRotationY();
        },
        set: function (y) {
            this.SetRotationXY(this.GetRotationX(), y);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.SetMatrixLocal = function (mat) {
        if (this.m_matSpriteMatrixLocal != mat)
            this.m_matSpriteMatrixLocal.Copy(mat);
        var vPos = new dVector3();
        var vScale = new dVector3();
        var matRot = new dMatrix();
        mat.Decompose(vPos, vScale, matRot);
        this.SetPos3D(vPos.x, vPos.y, vPos.z);
        this.SetScale3D(vScale.x, vScale.y, vScale.z);
        this.SetRotationMatrix(matRot);
    };
    dSprite.prototype.GetMatrixLocal = function () {
        this.m_matSpriteMatrixLocal.Scaling(this.m_fScaleX, this.m_fScaleY, this.m_fScaleZ);
        if (this.m_fRotationX != 0 || this.m_fRotationY != 0)
            this.m_matSpriteMatrixLocal.RotationEulerAppend(this.m_fRotationX, this.m_fRotationY, this.m_fRotation);
        else if (this.m_fRotation != 0)
            this.m_matSpriteMatrixLocal.RotationZAppend(dMath.AngleToRadian(this.m_fRotation));
        this.m_matSpriteMatrixLocal._41 += this.m_fPosX;
        this.m_matSpriteMatrixLocal._42 += this.m_fPosY;
        this.m_matSpriteMatrixLocal._43 += this.m_fPosZ;
        return this.m_matSpriteMatrixLocal;
    };
    dSprite.prototype._GetMatrixWorld = function (outData, rootStop, bWithRoot) {
        var p = this;
        while (p != null) {
            if (!bWithRoot && p == rootStop)
                break;
            dMatrix.Multiply(outData, outData, p.GetMatrixLocal());
            if (p == rootStop)
                break;
            p = p.GetParent();
        }
    };
    dSprite.prototype.GetMatrixWorld = function (rootStop, bWithRoot) {
        if (rootStop === void 0) { rootStop = null; }
        if (bWithRoot === void 0) { bWithRoot = true; }
        if (rootStop == this)
            return this.GetMatrixLocal();
        var ret = new dMatrix();
        ret.Identity();
        this._GetMatrixWorld(ret, rootStop, bWithRoot);
        return ret;
    };
    dSprite.prototype.SetSize = function (w, h) {
        if (this.m_fWidth != w || this.m_fHeight != h) {
            this.m_fWidth = w;
            this.m_fHeight = h;
            this.UpdateLocal();
            if (this.m_onTouchEvent != null)
                this.m_onTouchEvent.SetSize(w, h);
        }
    };
    dSprite.prototype.SetSize3D = function (w, h, d) {
        if (this.m_fWidth != w || this.m_fHeight != h || this.m_fDepth != d) {
            this.SetSize(w, h);
            this.m_fDepth = d;
            this.UpdateLocal();
            if (this.m_onTouchEvent != null)
                this.m_onTouchEvent.SetSize3D(w, h, d);
        }
    };
    dSprite.prototype.GetWidth = function () {
        return this.m_fWidth;
    };
    dSprite.prototype.GetHeight = function () {
        return this.m_fHeight;
    };
    dSprite.prototype.GetDepth = function () {
        return this.m_fDepth;
    };
    dSprite.prototype.SetShow = function (bShow) {
        if (this.m_bShow != bShow) {
            this.m_bShow = bShow;
        }
    };
    dSprite.prototype.isShow = function () {
        return this.m_bShow;
    };
    Object.defineProperty(dSprite.prototype, "visible", {
        get: function () {
            return this.isShow();
        },
        set: function (bVisible) {
            this.SetShow(bVisible);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.SetMatrix3D = function (mat) {
        var pos = new dVector3();
        var sca = new dVector3();
        var matRot = new dMatrix();
        mat.Decompose(pos, sca, matRot);
        this.SetPos3D(pos.x, pos.y, pos.z);
        this.SetScale3D(sca.x, sca.y, sca.z);
        this.SetRotationMatrix(matRot);
    };
    dSprite.prototype.SetPos3D = function (x, y, z) {
        if (this.m_fPosX != x || this.m_fPosY != y) {
            this.m_fPosZ = z;
            this.SetPos(x, y);
        }
        else if (this.m_fPosZ != z) {
            this.m_fPosZ = z;
            this.UpdateLocal();
        }
    };
    dSprite.prototype.GetPos3D = function () {
        return new dVector3(this.m_fPosX, this.m_fPosY, this.m_fPosZ);
    };
    dSprite.prototype.SetScale3D = function (x, y, z) {
        if (this.m_fScaleX != x || this.m_fScaleY != y || this.m_fScaleZ != z) {
            this.SetScale(x, y);
            this.m_fScaleZ = z;
            this.UpdateLocal();
            if (this.m_onTouchEvent != null)
                this.m_onTouchEvent.SetScale3D(x, y, z);
        }
    };
    dSprite.prototype.GetScale3D = function () {
        return new dVector3(this.m_fScaleX, this.m_fScaleY, this.m_fScaleZ);
    };
    dSprite.prototype.GetSize3D = function () {
        return new dVector3(this.m_fWidth, this.m_fHeight, this.m_fDepth);
    };
    dSprite.prototype.SetRotationQuaternion = function (q) {
        var v = q.QuaternionToEuler();
        this.SetRotationEuler(v);
    };
    dSprite.prototype.GetRotationQuaternion = function () {
        return new dVector4().QuaternionFromEuler(this.GetRotationEuler());
    };
    dSprite.prototype.SetRotationEuler = function (v) {
        if (this.m_fRotation != v.z || this.m_fRotationX != v.x || this.m_fRotationY != v.y) {
            this.m_fRotation = v.z;
            this.m_fRotationX = v.x;
            this.m_fRotationY = v.y;
            this.UpdateLocal();
        }
    };
    dSprite.prototype.GetRotationEuler = function () {
        return new dVector3(this.m_fRotationX, this.m_fRotationY, this.m_fRotation);
    };
    dSprite.prototype.SetRotationMatrix = function (mat) {
        var v = mat.ToRotationEuler();
        this.SetRotationEuler(v);
    };
    dSprite.prototype.GetRotationMatrix = function () {
        var mat = new dMatrix();
        if (this.m_fRotationX == 0 && this.m_fRotationY == 0) {
            if (this.m_fRotation == 0)
                return dMatrix.IDENTITY;
            return mat.RotationZ(dMath.AngleToRadian(this.m_fRotation));
        }
        return mat.RotationEuler(this.m_fRotationX, this.m_fRotationY, this.m_fRotation);
    };
    dSprite.prototype.GetRotation3D = function () {
        return new dVector3(this.rotationX, this.rotationY, this.rotation);
    };
    dSprite.prototype.UpdateLocal = function () {
        this.m_bRenderMatrixDirty = true;
        this.m_bRenderMatrixSelfDirty = true;
    };
    dSprite.prototype.SetClipChild = function (bClip) {
        if (this.m_bClipChild != bClip) {
            this.m_bClipChild = bClip;
        }
    };
    dSprite.prototype.isClipChild = function () {
        return this.m_bClipChild;
    };
    Object.defineProperty(dSprite.prototype, "clipChild", {
        get: function () {
            return this.isClipChild();
        },
        set: function (bClip) {
            this.SetClipChild(bClip);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.SetHandleMouse = function (bHandle) {
        if (this.m_bHandleMouse != bHandle) {
            this.m_bHandleMouse = bHandle;
        }
    };
    dSprite.prototype.isHandleMouse = function () {
        return this.m_bHandleMouse;
    };
    Object.defineProperty(dSprite.prototype, "handleMouse", {
        get: function () {
            return this.isHandleMouse();
        },
        set: function (bHandle) {
            this.SetHandleMouse(bHandle);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.SetTransparentMouse = function (bTransparent, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        this.m_bTransparentMouse = bTransparent;
        if (bSetToChild) {
            for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++)
                this.m_vecChildSprite[i].SetTransparentMouse(bTransparent, bSetToChild);
        }
    };
    dSprite.prototype.isTransparentMouse = function () {
        return this.m_bTransparentMouse;
    };
    dSprite.prototype.SetTouchEvent = function (onCallback) {
        this.m_onTouchEvent = onCallback;
    };
    dSprite.prototype.GetTouchEvent = function () {
        return this.m_onTouchEvent;
    };
    dSprite.prototype.OnTouchDown = function (x, y, delta) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnTouchDown(x, y, delta);
    };
    dSprite.prototype.OnMultyTouchDown = function (id, x, y, delta) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnMultyTouchDown(id, x, y, delta);
    };
    dSprite.prototype.OnMButtonTouchDown = function (x, y, delta) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnMButtonTouchDown(x, y, delta);
    };
    dSprite.prototype.OnRButtonTouchDown = function (x, y, delta) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnRButtonTouchDown(x, y, delta);
    };
    dSprite.prototype.OnTouchMove = function (x, y, offx, offy, delta) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnTouchMove(x, y, offx, offy, delta);
    };
    dSprite.prototype.OnMultyTouchMove = function (id, x, y, offx, offy, delta) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnMultyTouchMove(id, x, y, offx, offy, delta);
    };
    dSprite.prototype.OnMButtonTouchMove = function (x, y, offx, offy, delta) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnMButtonTouchMove(x, y, offx, offy, delta);
    };
    dSprite.prototype.OnRButtonTouchMove = function (x, y, offx, offy, delta) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnRButtonTouchMove(x, y, offx, offy, delta);
    };
    dSprite.prototype.OnTouchUp = function (x, y) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnTouchUp(x, y);
    };
    dSprite.prototype.OnMultyTouchUp = function (id, x, y) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnMultyTouchUp(id, x, y);
    };
    dSprite.prototype.OnMButtonTouchUp = function (x, y) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnMButtonTouchUp(x, y);
    };
    dSprite.prototype.OnRButtonTouchUp = function (x, y) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnRButtonTouchUp(x, y);
    };
    dSprite.prototype.OnMouseWheel = function (x, y, delta) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnMouseWheel(x, y, delta);
    };
    dSprite.prototype._FireKeyDownEvent = function (keyCode) {
        var vecChild = this.m_vecChildSprite;
        for (var i = vecChild.length - 1; i >= 0; i--) {
            var p = vecChild[i]._FireKeyDownEvent(keyCode);
            if (p)
                return p;
        }
        if (this.OnKeyDown(keyCode))
            return this;
        return null;
    };
    dSprite.prototype.OnKeyDown = function (keyCode) {
        if (this.m_onTouchEvent != null)
            return this.m_onTouchEvent.OnKeyDown(keyCode);
        return false;
    };
    dSprite.prototype.OnKeyUp = function (keyCode) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnKeyUp(keyCode);
    };
    dSprite.prototype.SetLayoutAlign = function (alignH, alignV) {
        this.m_nLayoutAlign = alignV << 16 | alignH;
    };
    Object.defineProperty(dSprite.prototype, "layoutAlignH", {
        get: function () {
            return this.m_nLayoutAlign & 0xFFFF;
        },
        set: function (value) {
            this.m_nLayoutAlign = (this.m_nLayoutAlign & 0xFFFF0000) | value;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "layoutAlignV", {
        get: function () {
            return this.m_nLayoutAlign >>> 16;
        },
        set: function (value) {
            this.m_nLayoutAlign = (this.m_nLayoutAlign & 0xFFFF) | (value << 16);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.LayoutToSize = function (width, height) {
        var oldWidth = this.GetWidth();
        var oldHeight = this.GetHeight();
        var fatherAnchorU = this.anchorU;
        var fatherAnchorV = this.anchorV;
        for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++) {
            var p = this.m_vecChildSprite[i];
            var newWidth = p.width;
            var newHeight = p.height;
            var off_x = 0;
            if (p.layoutAlignH == dSprite.LAYOUT_ALIGN_LEFT_TOP)
                off_x = (oldWidth - width) * (fatherAnchorU);
            else if (p.layoutAlignH == dSprite.LAYOUT_ALIGN_RIGHT_BOTTOM)
                off_x = (width - oldWidth) * (1 - fatherAnchorU);
            else if (p.layoutAlignH == dSprite.LAYOUT_ALIGN_DEFAULT)
                off_x = (width - oldWidth) * (0.5 - fatherAnchorU);
            var off_y = 0;
            if (p.layoutAlignV == dSprite.LAYOUT_ALIGN_LEFT_TOP)
                off_y = (oldHeight - height) * (fatherAnchorV);
            else if (p.layoutAlignV == dSprite.LAYOUT_ALIGN_RIGHT_BOTTOM)
                off_y = (height - oldHeight) * (1 - fatherAnchorV);
            else if (p.layoutAlignV == dSprite.LAYOUT_ALIGN_DEFAULT)
                off_y = (height - oldHeight) * (0.5 - fatherAnchorV);
            if (p.layoutAlignH == dSprite.LAYOUT_ALIGN_SCALE) {
                p.scaleX *= width / oldWidth;
                off_x = (oldWidth - width) * (fatherAnchorU) + (width - oldWidth) * (p.anchorU - fatherAnchorU);
            }
            if (p.layoutAlignV == dSprite.LAYOUT_ALIGN_SCALE) {
                p.scaleY *= height / oldHeight;
                off_y = (oldHeight - height) * (fatherAnchorV) + (height - oldHeight) * (p.anchorV - fatherAnchorV);
            }
            if (p.layoutAlignH == dSprite.LAYOUT_ALIGN_RESIZE) {
                newWidth = p.width + width - oldWidth;
                off_x = (width - oldWidth) * (p.anchorU - fatherAnchorU);
            }
            if (p.layoutAlignV == dSprite.LAYOUT_ALIGN_RESIZE) {
                newHeight = p.height + height - oldHeight;
                off_y = (height - oldHeight) * (p.anchorV - fatherAnchorV);
            }
            if (p.layoutAlignH == dSprite.LAYOUT_ALIGN_FIXED) {
                p.scaleX *= height / oldHeight;
                off_x = (oldWidth - width) * (fatherAnchorU);
            }
            if (p.layoutAlignV == dSprite.LAYOUT_ALIGN_FIXED) {
                p.scaleY *= width / oldWidth;
                off_y = (oldHeight - height) * (fatherAnchorV);
            }
            if (off_x != 0 || off_y != 0)
                p.SetPos(p.GetPosX() + off_x, p.GetPosY() + off_y);
            if (newWidth != p.width || newHeight != p.height)
                p.LayoutToSize(newWidth, newHeight);
        }
        this.SetSize(width, height);
    };
    Object.defineProperty(dSprite.prototype, "alpha", {
        get: function () {
            return this.GetAlpha();
        },
        set: function (v) {
            this.SetAlpha(v);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.SetAlpha = function (alpha, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        if (alpha < 0)
            alpha = 0;
        else if (alpha > 1)
            alpha = 1;
        if (this.m_fAlpha != alpha) {
            this.m_fAlpha = alpha;
            this._UpdateColor();
        }
        if (bSetToChild) {
            for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++)
                this.m_vecChildSprite[i].SetAlpha(alpha, true);
        }
    };
    dSprite.prototype.GetAlpha = function () {
        return this.m_fAlpha;
    };
    Object.defineProperty(dSprite.prototype, "spriteColor", {
        get: function () {
            return this.GetColor();
        },
        set: function (color) {
            this.SetColor(color);
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.SetColor = function (colorARGB, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        colorARGB = (colorARGB & 0x7fffffff) + ((colorARGB & 0x80000000) ? 0x80000000 : 0);
        if (this.m_nColorARGB != colorARGB) {
            this.m_nColorARGB = colorARGB;
            this._UpdateColor();
        }
        if (bSetToChild) {
            for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++)
                this.m_vecChildSprite[i].SetColor(colorARGB, bSetToChild);
        }
    };
    dSprite.prototype.GetColor = function () {
        return this.m_nColorARGB;
    };
    dSprite.prototype.SetBlendMode = function (mode, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        if (this.m_nBlendMode != mode) {
            this.m_nBlendMode = mode;
        }
        if (bSetToChild) {
            for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++)
                this.m_vecChildSprite[i].SetBlendMode(mode, bSetToChild);
        }
    };
    dSprite.prototype.GetBlendMode = function () {
        return this.m_nBlendMode;
    };
    Object.defineProperty(dSprite.prototype, "blendMode", {
        get: function () {
            return this.GetBlendMode();
        },
        set: function (mode) {
            this.SetBlendMode(mode);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dSprite.prototype, "wireframe", {
        get: function () {
            return (this.GetBlendMode() & dSprite.BLEND_MODE_WIREFRAME) != 0;
        },
        set: function (bWireframe) {
            if (bWireframe)
                this.SetBlendMode(this.GetBlendMode() | dSprite.BLEND_MODE_WIREFRAME);
            else
                this.SetBlendMode(this.GetBlendMode() & (~dSprite.BLEND_MODE_WIREFRAME));
        },
        enumerable: false,
        configurable: true
    });
    dSprite.prototype.SetEnableCulling = function (disable_front_back) {
        this.m_nEnableCulling = disable_front_back;
    };
    dSprite.prototype.SetColorTransform = function (mat, bWithChild) {
        if (bWithChild === void 0) { bWithChild = false; }
        if (mat == null)
            mat = dMatrix.IDENTITY;
        this.m_matColorTransform = mat;
        this._UpdateColorTransform();
        if (bWithChild) {
            for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++)
                this.m_vecChildSprite[i].SetColorTransform(mat, bWithChild);
        }
    };
    dSprite.prototype.GetColorTransform = function () {
        if (this.m_matColorTransform == null)
            return dMatrix.IDENTITY;
        return this.m_matColorTransform;
    };
    dSprite.prototype.SetBrightness = function (value, bWithChild) {
        if (bWithChild === void 0) { bWithChild = false; }
        this.SetColorTransform(new dMatrix().Translation(value, value, value), bWithChild);
    };
    dSprite.prototype.GetBrightness = function () {
        var mat = this.GetColorTransform();
        return (mat._41 + mat._42 + mat._43) / 3.0;
    };
    dSprite.prototype.SetContrast = function (value, bWithChild) {
        if (bWithChild === void 0) { bWithChild = false; }
        var mat = new dMatrix();
        mat.Scaling(value, value, value);
        this.SetColorTransform(mat, bWithChild);
    };
    dSprite.prototype.GetContrast = function () {
        var mat = this.GetColorTransform();
        return (mat._11 + mat._22 + mat._33) / 3.0;
    };
    dSprite.prototype.SetGray = function (bGray, bWithChild) {
        if (bGray === void 0) { bGray = true; }
        if (bWithChild === void 0) { bWithChild = false; }
        var mat = new dMatrix();
        if (bGray) {
            mat._11 = 0.333333;
            mat._12 = 0.333333;
            mat._13 = 0.333333;
            mat._14 = 0;
            mat._21 = 0.333333;
            mat._22 = 0.333333;
            mat._23 = 0.333333;
            mat._24 = 0;
            mat._31 = 0.333333;
            mat._32 = 0.333333;
            mat._33 = 0.333333;
            mat._34 = 0;
            mat._41 = 0;
            mat._42 = 0;
            mat._43 = 0;
            mat._44 = 1;
        }
        else
            mat.Identity();
        this.SetColorTransform(mat, bWithChild);
    };
    dSprite.HueToMatrix = function (value) {
        if (value < -180)
            value = -180;
        else if (value > 180)
            value = 180;
        value = value / 180 * dMath.dPI;
        if (value == 0)
            return dMatrix.IDENTITY;
        var cosVal = dMath.Cos(value);
        var sinVal = dMath.Sin(value);
        var lumR = 0.213;
        var lumG = 0.715;
        var lumB = 0.072;
        var mat = new dMatrix();
        mat._11 = lumR + cosVal * (1 - lumR) + sinVal * (-lumR);
        mat._21 = lumG + cosVal * (-lumG) + sinVal * (-lumG);
        mat._31 = lumB + cosVal * (-lumB) + sinVal * (1 - lumB);
        mat._41 = 0;
        mat._12 = lumR + cosVal * (-lumR) + sinVal * (0.143);
        mat._22 = lumG + cosVal * (1 - lumG) + sinVal * (0.140);
        mat._32 = lumB + cosVal * (-lumB) + sinVal * (-0.283);
        mat._42 = 0;
        mat._13 = lumR + cosVal * (-lumR) + sinVal * (-(1 - lumR));
        mat._23 = lumG + cosVal * (-lumG) + sinVal * (lumG);
        mat._33 = lumB + cosVal * (1 - lumB) + sinVal * (lumB);
        mat._43 = 0;
        mat._44 = 1;
        return mat;
    };
    dSprite.prototype.AdjustHue = function (value, bWithChild) {
        if (bWithChild === void 0) { bWithChild = false; }
        var mat = dSprite.HueToMatrix(value);
        this.SetColorTransform(mat.Mul(this.GetColorTransform()), bWithChild);
    };
    dSprite.prototype.AdjustSaturation = function (value, bWithChild) {
        if (bWithChild === void 0) { bWithChild = false; }
        if (value < -100)
            value = -100;
        else if (value > 100)
            value = 100;
        if (value == 0)
            return;
        var x = 1 + ((value > 0) ? 3 * value / 100 : value / 100);
        var lumR = 0.3086;
        var lumG = 0.6094;
        var lumB = 0.0820;
        var mat = new dMatrix();
        mat._11 = lumR * (1 - x) + x, lumG * (1 - x);
        mat._12 = lumB * (1 - x);
        mat._21 = lumR * (1 - x);
        mat._22 = lumG * (1 - x) + x, lumB * (1 - x);
        mat._31 = lumR * (1 - x);
        mat._32 = lumG * (1 - x), lumB * (1 - x) + x;
        mat._44 = 1;
        this.SetColorTransform(mat.Mul(this.GetColorTransform()), bWithChild);
    };
    dSprite.prototype._UpdateColor = function () {
        var color = this.m_nColorARGB;
        if (color == 0xffffffff)
            this.SetUniformF("color", 1, 1, 1, this.m_fAlpha);
        else {
            var a = ((color & 0xFF000000) >>> 24) / 255.0;
            var r = ((color & 0x00FF0000) >> 16) / 255.0;
            var g = ((color & 0x0000FF00) >> 8) / 255.0;
            var b = ((color & 0x000000FF)) / 255.0;
            this.SetUniformF("color", r, g, b, a * this.m_fAlpha);
        }
    };
    dSprite.prototype._UpdateColorTransform = function () {
        if (this.m_matColorTransform != null)
            this.SetUniformMatrix("colorMatrix", this.m_matColorTransform);
        else
            this.SetUniformMatrix("colorMatrix", dMatrix.IDENTITY);
    };
    dSprite.prototype.SetBitmapData = function (bmp, pSourceRect, at, sampleType) {
        if (pSourceRect === void 0) { pSourceRect = null; }
        if (at === void 0) { at = 0; }
        if (sampleType === void 0) { sampleType = 0; }
        this.m_pSetBitmapData[at] = bmp;
        if (at == 0)
            this.m_pSetBitmapDataSourceRect = pSourceRect;
    };
    dSprite.prototype.GetBitmapData = function (at) {
        if (at === void 0) { at = 0; }
        return this.m_pSetBitmapData[at];
    };
    dSprite.prototype.GetBitmapSourceRect = function () {
        if (!this.m_pSetBitmapDataSourceRect)
            this.m_pSetBitmapDataSourceRect = new dRect(0, 0, 1, 1);
        return this.m_pSetBitmapDataSourceRect;
    };
    dSprite.prototype.SetShader = function (pShader, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        if (this.m_pBindShader != pShader) {
            this.m_pBindShader = pShader;
            if (this.m_pBindShader != null)
                this.m_pBindShader.OnBindSprite(this);
            if (bSetToChild) {
                for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++)
                    this.m_vecChildSprite[i].SetShader(pShader, bSetToChild);
            }
        }
    };
    dSprite.prototype.GetShader = function () {
        return this.m_pBindShader;
    };
    dSprite.prototype.SetMeshData = function (pMeshData) {
        this.m_pBindMeshData = pMeshData;
        return this;
    };
    dSprite.prototype.GetMeshData = function () {
        return this.m_pBindMeshData;
    };
    dSprite.prototype.DrawToBitmapData = function (bitmapData) {
        var webgl = dInterface.ptr.webgl;
        dSprite.EnableScissorTest(true, 0, 0, bitmapData.GetWidth(), bitmapData.GetHeight(), bitmapData.GetWidth(), bitmapData.GetHeight(), null, false);
        var oldFBO = webgl.getParameter(webgl.FRAMEBUFFER_BINDING);
        var oldRBO = webgl.getParameter(webgl.RENDERBUFFER_BINDING);
        if (bitmapData.m_pBufferData.m_pTexture == null) {
            bitmapData.m_pBufferData.m_pTexture = webgl.createTexture();
            webgl.bindTexture(webgl.TEXTURE_2D, bitmapData.m_pBufferData.m_pTexture);
            webgl.texImage2D(webgl.TEXTURE_2D, 0, webgl.RGBA, bitmapData.GetWidth(), bitmapData.GetHeight(), 0, webgl.RGBA, webgl.UNSIGNED_BYTE, null);
            webgl.texParameteri(webgl.TEXTURE_2D, webgl.TEXTURE_MIN_FILTER, webgl.NEAREST);
            webgl.texParameteri(webgl.TEXTURE_2D, webgl.TEXTURE_MAG_FILTER, webgl.NEAREST);
            webgl.texParameteri(webgl.TEXTURE_2D, webgl.TEXTURE_WRAP_S, webgl.CLAMP_TO_EDGE);
            webgl.texParameteri(webgl.TEXTURE_2D, webgl.TEXTURE_WRAP_T, webgl.CLAMP_TO_EDGE);
            bitmapData.m_pBufferData.m_pRenderToTextureRboDepth = webgl.createRenderbuffer();
            webgl.bindRenderbuffer(webgl.RENDERBUFFER, bitmapData.m_pBufferData.m_pRenderToTextureRboDepth);
            webgl.renderbufferStorage(webgl.RENDERBUFFER, webgl.DEPTH_COMPONENT16, bitmapData.GetWidth(), bitmapData.GetHeight());
            bitmapData.m_pBufferData.m_pRenderToTextureFbo = webgl.createFramebuffer();
            webgl.bindFramebuffer(webgl.FRAMEBUFFER, bitmapData.m_pBufferData.m_pRenderToTextureFbo);
            webgl.framebufferTexture2D(webgl.FRAMEBUFFER, webgl.COLOR_ATTACHMENT0, webgl.TEXTURE_2D, bitmapData.m_pBufferData.m_pTexture, 0);
            webgl.framebufferRenderbuffer(webgl.FRAMEBUFFER, webgl.DEPTH_ATTACHMENT, webgl.RENDERBUFFER, bitmapData.m_pBufferData.m_pRenderToTextureRboDepth);
        }
        else
            webgl.bindFramebuffer(webgl.FRAMEBUFFER, bitmapData.m_pBufferData.m_pRenderToTextureFbo);
        webgl.viewport(0, 0, bitmapData.GetWidth(), bitmapData.GetHeight());
        webgl.clearDepth(1.0);
        webgl.clearStencil(0);
        webgl.clearColor(0, 0, 0, 0);
        this._EnableDepthTest(2);
        webgl.clear(webgl.COLOR_BUFFER_BIT | webgl.DEPTH_BUFFER_BIT | webgl.STENCIL_BUFFER_BIT);
        this.Render(bitmapData.GetWidth(), bitmapData.GetHeight());
        webgl.viewport(0, 0, dInterface.ptr.GetWindowWidth(), dInterface.ptr.GetWindowHeight());
        webgl.bindFramebuffer(webgl.FRAMEBUFFER, oldFBO);
        webgl.bindRenderbuffer(webgl.RENDERBUFFER, oldRBO);
    };
    dSprite.prototype.SetEnableClear = function (flag) {
        this.m_nEnableClearFlag = flag;
    };
    dSprite.prototype.isInRender = function (matWorld) {
        if (this.m_pBindShader == null)
            return 0;
        return this.m_pBindShader.isInRender(this, matWorld);
    };
    dSprite.prototype.SetEnableZReadWrite = function (disable_r_rw, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        this.m_nEnableZReadWrite = disable_r_rw;
        if (bSetToChild) {
            for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++)
                this.m_vecChildSprite[i].SetEnableZReadWrite(disable_r_rw, bSetToChild);
        }
    };
    dSprite.prototype.SetUniformF = function (name, f1, f2, f3, f4) {
        var p = this;
        var uniformData;
        if (!p.m_mapUniformData.has(name))
            p.m_mapUniformData.set(name, uniformData = new __dSpriteUniformData());
        else
            uniformData = p.m_mapUniformData.get(name);
        uniformData.flag = 1;
        uniformData.f1 = f1;
        uniformData.f2 = f2;
        uniformData.f3 = f3;
        uniformData.f4 = f4;
    };
    dSprite.prototype.SetUniformI = function (name, iData) {
        var p = this;
        var uniformData;
        if (!p.m_mapUniformData.has(name))
            p.m_mapUniformData.set(name, uniformData = new __dSpriteUniformData());
        else
            uniformData = p.m_mapUniformData.get(name);
        uniformData.flag = 2;
        uniformData.iData = iData;
    };
    dSprite.prototype.SetUniformMatrix = function (name, mat, index) {
        if (index === void 0) { index = -1; }
        var p = this;
        var uniformData;
        if (!p.m_mapUniformData.has(name))
            p.m_mapUniformData.set(name, uniformData = new __dSpriteUniformData());
        else
            uniformData = p.m_mapUniformData.get(name);
        uniformData.flag = 3;
        if (uniformData.mat == null)
            uniformData.mat = [];
        mat.ToArray(uniformData.mat);
    };
    dSprite.prototype.RemoveUniform = function (name) {
        if (this.m_mapUniformData.has(name))
            this.m_mapUniformData.remove(name);
    };
    dSprite.prototype.ComputeMatrixSelf = function (matWorld) {
        if (this.m_bRenderMatrixSelfDirty) {
            var mat2 = this.m_matRenderMatrixSelf;
            mat2.Scaling(this.m_fWidth, this.m_fHeight, this.m_fDepth);
            mat2.TranslationFast(this.m_fWidth * (-this.m_fAnchorU), this.m_fHeight * (-this.m_fAnchorV), this.m_fDepth * (-this.m_fAnchorW));
            mat2.MulAppend(matWorld);
            this.m_bRenderMatrixSelfDirty = false;
            this.SetUniformMatrix("mWorld", mat2);
        }
    };
    dSprite.prototype.Render = function (windowWidth, windowHeight) {
        this._Render(dMatrix.IDENTITY, windowWidth, windowHeight, false);
    };
    dSprite.prototype._Render = function (mat, windowWidth, windowHeight, bFatherMatrixDirty) {
        if (this.m_bShow) {
            this.PrepareRender();
            var matWorld = this.m_matRenderMatrixWorld;
            if (bFatherMatrixDirty) {
                this.m_bRenderMatrixDirty = true;
                this.m_bRenderMatrixSelfDirty = true;
            }
            if (this.m_bRenderMatrixDirty) {
                matWorld.Scaling(this.m_fScaleX, this.m_fScaleY, this.m_fScaleZ);
                if (this.m_fRotation != 0.0 || this.m_fRotationX != 0.0 || this.m_fRotationY != 0.0) {
                    if (this.m_fRotationX != 0 || this.m_fRotationY != 0)
                        matWorld.RotationEulerAppend(this.m_fRotationX, this.m_fRotationY, this.m_fRotation);
                    else
                        matWorld.RotationZAppend(dMath.AngleToRadian(this.m_fRotation));
                    matWorld.TranslationAppend(this.m_fPosX, this.m_fPosY, this.m_fPosZ);
                }
                else
                    matWorld.TranslationFast(this.m_fPosX, this.m_fPosY, this.m_fPosZ);
                matWorld.MulAppend(mat);
                bFatherMatrixDirty = true;
            }
            var clipRect;
            if (this.m_bClipChild) {
                this.ComputeMatrixSelf(matWorld);
                var orthoMatrix = new dMatrix();
                orthoMatrix.OrthoRH(windowWidth, windowHeight, 0, 99999);
                dMatrix.Multiply(orthoMatrix, this.m_matRenderMatrixSelf, orthoMatrix);
                var matWVP = orthoMatrix;
                matWVP.TranslationAppend(-1, -1, 0);
                matWVP.ScalingAppend(1, -1, 1);
                this.m_rcRenderForClip.Copy(dSprite.GetScissorTest());
                if (dSprite.EnableScissorTest(true, 0, 0, 0, 0, windowWidth, windowHeight, matWVP, true)) {
                    clipRect = this.m_rcRenderForClip;
                    var curScissorTest = dSprite.GetScissorTest();
                    if (curScissorTest.Width() == 0 || curScissorTest.Height() == 0) {
                        dSprite.EnableScissorTest(true, clipRect.left, clipRect.top, clipRect.Width(), clipRect.Height(), windowWidth, windowHeight, null, false);
                        return;
                    }
                }
            }
            var inRender;
            if (this.m_fAlpha > 0) {
                inRender = this.isInRender(matWorld);
                if ((this.m_pSetBitmapData[0] || this.m_bForceRender) && inRender == 1) {
                    this.ComputeMatrixSelf(matWorld);
                    this.SetUniformF("isAlphaPremultiplied", this.isAlphaPremultiplied(), 0, 0, 0);
                    this.SpriteRender();
                }
            }
            this.m_bRenderMatrixDirty = false;
            if (inRender != -1) {
                this._RenderChild(matWorld, windowWidth, windowHeight, bFatherMatrixDirty);
            }
            if (clipRect != null)
                dSprite.EnableScissorTest(true, clipRect.left, clipRect.top, clipRect.Width(), clipRect.Height(), windowWidth, windowHeight, null, false);
        }
        else {
            this.m_bRenderMatrixDirty = true;
            this.m_bRenderMatrixSelfDirty = true;
        }
    };
    dSprite.prototype._RenderChild = function (matWorld, windowWidth, windowHeight, bFatherMatrixDirty) {
        for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++)
            this.m_vecChildSprite[i]._Render(matWorld, windowWidth, windowHeight, bFatherMatrixDirty);
    };
    dSprite.prototype.isAlphaPremultiplied = function () {
        return 1;
    };
    dSprite.prototype.PrepareRender = function () {
    };
    dSprite.prototype.SpriteRender = function () {
        var p = this;
        p._EnableDepthTest(p.m_nEnableZReadWrite);
        p._EnableCulling(p.m_nEnableCulling);
        p._EnableBlend(p.m_nBlendMode & 3, p.isAlphaPremultiplied() != 0);
        if (p.m_nEnableClearFlag & 1)
            p._ClearZBuffer();
        var shader = p.m_pBindShader;
        var meshData = p.m_pBindMeshData;
        if (shader != null && meshData != null) {
            shader._Use();
            var bSetTextureOk = true;
            for (var i = 0; i < 8; i++) {
                if (!p.m_pSetBitmapData[i])
                    break;
                if (!p.m_pSetBitmapData[i]._SetTexture(i))
                    bSetTextureOk = false;
                else if (i == 0) {
                    var rcSource = this.m_pSetBitmapDataSourceRect;
                    if (rcSource) {
                        var bmpWidth = 1;
                        var bmpHeight = 1;
                        var vUV_x = rcSource.left / bmpWidth;
                        var vUV_y = rcSource.top / bmpHeight;
                        var vUV_z = rcSource.Width() / bmpWidth;
                        var vUV_w = rcSource.Height() / bmpHeight;
                        this.SetUniformF("uvTrans", vUV_x, vUV_y + vUV_w, vUV_z, -vUV_w);
                    }
                    else
                        this.SetUniformF("uvTrans", 0, 1, 1, -1);
                }
            }
            this._UpdateUniform(shader);
            if (bSetTextureOk) {
                shader._Begin();
                meshData._Draw(shader);
                shader._End();
            }
            for (var i = 0; i < 8; i++) {
                if (!p.m_pSetBitmapData[i])
                    break;
                p.m_pSetBitmapData[i]._UnSetTexture(i);
            }
        }
    };
    dSprite.prototype._UpdateUniform = function (shader) {
        var e_2, _a;
        var webgl = dInterface.ptr.webgl;
        try {
            for (var _b = __values(this.m_mapUniformData.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var name = _c.value;
                var uniformData = this.m_mapUniformData.get(name);
                var loc = shader._GetUniformLocation(name);
                if (loc) {
                    if (uniformData.flag == 1) {
                        webgl.uniform4f(loc, uniformData.f1, uniformData.f2, uniformData.f3, uniformData.f4);
                    }
                    else if (uniformData.flag == 2) {
                        webgl.uniform1i(loc, uniformData.iData);
                    }
                    else if (uniformData.flag == 3) {
                        webgl.uniformMatrix4fv(loc, false, uniformData.mat);
                    }
                }
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
    };
    dSprite.prototype.CollectionChildWithoutThis = function (x, y, bHandleMouseOnly) {
        if (bHandleMouseOnly === void 0) { bHandleMouseOnly = true; }
        var vecChild = this.m_vecChildSprite;
        for (var i = vecChild.length - 1; i >= 0; i--) {
            var clip_left = this.GetAnchorU() * this.GetWidth();
            var clip_top = this.GetAnchorV() * this.GetHeight();
            var ret = vecChild[i]._CollectSprite(x, y, 1, 1, 0, 0, clip_left, clip_top, dMath.Abs(this.GetWidth() * this.GetScaleX()) + clip_left, dMath.Abs(this.GetHeight() * this.GetScaleY()) + clip_top, bHandleMouseOnly, this.isHandleMouse());
            if (bHandleMouseOnly) {
                while (ret != null && ret != this) {
                    if (ret.isHandleMouse())
                        break;
                    ret = ret.GetParent();
                }
            }
            if (ret != null && ret != this)
                return ret;
        }
        return null;
    };
    dSprite.prototype.CollectionChild = function (x, y, bHandleMouseOnly) {
        if (bHandleMouseOnly === void 0) { bHandleMouseOnly = true; }
        var pos_x = this.GetPosX();
        var pos_y = this.GetPosY();
        var clip_left = pos_x - this.GetAnchorU() * this.GetWidth();
        var clip_top = pos_y - this.GetAnchorV() * this.GetHeight();
        var ret = this._CollectSprite(x, y, 1, 1, 0, 0, clip_left, clip_top, dMath.Abs(this.GetWidth() * this.GetScaleX()) + clip_left, dMath.Abs(this.GetHeight() * this.GetScaleY()) + clip_top, bHandleMouseOnly, this.isHandleMouse());
        if (ret != null) {
            if (bHandleMouseOnly) {
                while (ret != null) {
                    if (ret.isHandleMouse())
                        break;
                    ret = ret.GetParent();
                }
            }
        }
        return ret;
    };
    dSprite.prototype._CollectSprite = function (mousex, mousey, scalex, scaley, x, y, clip_left, clip_top, clip_right, clip_bottom, bHandleMouseCheck, bRootHandleMouse) {
        if (this.isShow()) {
            if (this.GetScaleX() < 0 || this.GetScaleY() < 0 || this.GetRotation() != 0.0) {
                var mat = new dMatrix();
                mat.Scaling(scalex, scaley, 1);
                mat.TranslationAppend(x, y, 0);
                return dSprite._CollectSpriteRot(mousex, mousey, this, mat, bHandleMouseCheck, bRootHandleMouse || this.isHandleMouse());
            }
            var vecChild = this.m_vecChildSprite;
            x += this.GetPosX() * scalex;
            y += this.GetPosY() * scaley;
            scalex *= this.GetScaleX();
            scaley *= this.GetScaleY();
            var width = dMath.Abs(this.GetWidth() * scalex);
            var height = dMath.Abs(this.GetHeight() * scaley);
            x -= (this.GetAnchorU() * width);
            y -= (this.GetAnchorV() * height);
            if (this.isClipChild()) {
                if (clip_left < x)
                    clip_left = x;
                if (clip_top < y)
                    clip_top = y;
                if (clip_right > (x + width))
                    clip_right = (x + width);
                if (clip_bottom > (y + height))
                    clip_bottom = (y + height);
            }
            var clip_width = clip_right - clip_left;
            var clip_height = clip_bottom - clip_top;
            if (clip_width <= 0 || clip_height <= 0)
                return null;
            for (var i = vecChild.length - 1; i >= 0; i--) {
                var img = vecChild[i];
                var ret = img._CollectSprite(mousex, mousey, scalex, scaley, x + this.GetAnchorU() * width, y + this.GetAnchorV() * height, clip_left, clip_top, clip_right, clip_bottom, bHandleMouseCheck, bRootHandleMouse || img.isHandleMouse());
                if (ret != null)
                    return ret;
            }
            if (bRootHandleMouse && !this.isTransparentMouse() || !bHandleMouseCheck) {
                if (mousex >= clip_left && mousex <= clip_right && mousey >= clip_top && mousey <= clip_bottom &&
                    mousex >= x && mousey >= y && mousex < x + width && mousey < y + height) {
                    return this;
                }
            }
        }
        return null;
    };
    dSprite._CollectSpriteRot = function (x, y, pObj, mat, bHandleMouseCheck, bRootHandleMouse) {
        if (pObj.isShow() && !dMath.EqualsZero(pObj.GetScaleX()) && !dMath.EqualsZero(pObj.GetScaleY())) {
            var matTemp1 = pObj.GetMatrixLocal().Mul(mat);
            var vecChild = pObj.m_vecChildSprite;
            for (var i = vecChild.length - 1; i >= 0; i--) {
                if (!dMath.EqualsZero(vecChild[i].GetScaleX()) && !dMath.EqualsZero(vecChild[i].GetScaleY())) {
                    var ret = this._CollectSpriteRot(x, y, vecChild[i], matTemp1, bHandleMouseCheck, bRootHandleMouse || vecChild[i].isHandleMouse());
                    if (ret != null)
                        return ret;
                }
            }
            if (bRootHandleMouse && !pObj.isTransparentMouse() || !bHandleMouseCheck) {
                if (!dMath.EqualsZero(pObj.GetWidth()) && !dMath.EqualsZero(pObj.GetHeight())) {
                    if (!dSprite.s_pCheckCollectionData)
                        dSprite.s_pCheckCollectionData = new CheckCollectionData();
                    var data = dSprite.s_pCheckCollectionData;
                    var matWorld = data.matWorld.Scaling(pObj.GetWidth(), pObj.GetHeight(), 1).TranslationAppend(-pObj.GetWidth() * pObj.GetAnchorU(), -pObj.GetHeight() * pObj.GetAnchorV(), 0).MulAppend(matTemp1);
                    var points = data.ResetPoints();
                    for (var i = 0; i < 4; i++) {
                        points[i].Transform(matWorld);
                    }
                    data.P.SetValue(x, y, 0);
                    if (pObj._CheckCollectionWithData(pObj, data)) {
                        return pObj;
                    }
                }
            }
        }
        return null;
    };
    dSprite.prototype._CheckCollectionWithData = function (p, data) {
        return data.CheckPointInTriangle();
    };
    dSprite.prototype._EnableDepthTest = function (disable_r_rw) {
        var webgl = dInterface.ptr.webgl;
        if (disable_r_rw == 0)
            webgl.disable(webgl.DEPTH_TEST);
        else if (disable_r_rw == 1) {
            webgl.enable(webgl.DEPTH_TEST);
            webgl.depthFunc(webgl.LEQUAL);
            webgl.depthMask(false);
        }
        else if (disable_r_rw == 2) {
            webgl.enable(webgl.DEPTH_TEST);
            webgl.depthFunc(webgl.LEQUAL);
            webgl.depthMask(true);
        }
    };
    dSprite.prototype._EnableCulling = function (disable_front_back) {
        var webgl = dInterface.ptr.webgl;
        if (disable_front_back == 0)
            webgl.disable(webgl.CULL_FACE);
        else if (disable_front_back == 1) {
            webgl.enable(webgl.CULL_FACE);
            webgl.cullFace(webgl.FRONT);
        }
        else if (disable_front_back == 2) {
            webgl.enable(webgl.CULL_FACE);
            webgl.cullFace(webgl.BACK);
        }
    };
    dSprite.prototype._EnableWireFrame = function (bEnable) {
    };
    dSprite.prototype._EnableBlend = function (nType, bSrcAlphaBlended) {
        var webgl = dInterface.ptr.webgl;
        if (nType == dSprite.BLEND_MODE_NORMAL) {
            webgl.enable(webgl.BLEND);
            webgl.blendEquation(webgl.FUNC_ADD);
            if (bSrcAlphaBlended)
                webgl.blendFunc(webgl.ONE, webgl.ONE_MINUS_SRC_ALPHA);
            else
                webgl.blendFunc(webgl.SRC_ALPHA, webgl.ONE_MINUS_SRC_ALPHA);
        }
        else if (nType == dSprite.BLEND_MODE_ADD) {
            webgl.enable(webgl.BLEND);
            webgl.blendEquation(webgl.FUNC_ADD);
            webgl.blendFunc(webgl.SRC_ALPHA, webgl.ONE);
        }
        else if (nType == dSprite.BLEND_MODE_SUB) {
            webgl.enable(webgl.BLEND);
            webgl.blendEquation(webgl.FUNC_REVERSE_SUBTRACT);
            webgl.blendFunc(webgl.SRC_ALPHA, webgl.ONE);
        }
    };
    dSprite.prototype._ClearZBuffer = function () {
        dInterface.ptr.webgl.clear(dInterface.ptr.webgl.DEPTH_BUFFER_BIT);
    };
    dSprite.GetScissorTest = function () {
        if (!dSprite.m_rcCurScissorTestRect)
            dSprite.m_rcCurScissorTestRect = new dRect();
        return dSprite.m_rcCurScissorTestRect;
    };
    dSprite._dglScissor = function (left, top, width, height, windowWidth, windowHeight, bMergeRect) {
        if (left < 0) {
            width += left;
            left = 0;
        }
        if (top < 0) {
            height += top;
            top = 0;
        }
        var rc = new dRect();
        var scissorTest = this.GetScissorTest();
        if (bMergeRect) {
            rc.SetPosSize(left, top, width, height);
            if (rc.left < scissorTest.left)
                rc.left = scissorTest.left;
            if (rc.top < scissorTest.top)
                rc.top = scissorTest.top;
            if (rc.right > scissorTest.right)
                rc.right = scissorTest.right;
            if (rc.bottom > scissorTest.bottom)
                rc.bottom = scissorTest.bottom;
            left = rc.left;
            top = rc.top;
            width = rc.Width();
            height = rc.Height();
        }
        if (left + width > windowWidth)
            width = windowWidth - left;
        if (top + height > windowHeight)
            height = windowHeight - top;
        if (width < 0)
            width = 0;
        if (height < 0)
            height = 0;
        scissorTest.SetPosSize(left, top, width, height);
        dInterface.ptr.webgl.enable(dInterface.ptr.webgl.SCISSOR_TEST);
        dInterface.ptr.webgl.scissor(left, windowHeight - height - top, width, height);
        return true;
    };
    dSprite.EnableScissorTest = function (bEnable, x, y, width, height, windowWidth, windowHeight, matWorld, bMergeRect) {
        if (bEnable) {
            if (matWorld != null) {
                var vRect = [new dVector3(), new dVector3(), new dVector3(), new dVector3()];
                vRect[0].SetValue(0, 0, 0);
                vRect[1].SetValue(0, 1, 0);
                vRect[2].SetValue(1, 0, 0);
                vRect[3].SetValue(1, 1, 0);
                for (var i = 0; i < 4; i++) {
                    vRect[i].Transform(matWorld);
                    vRect[i].x = (vRect[i].x + 1.0) / 2.0 * dThread.GetRootBackgroudSprite().width;
                    vRect[i].y = (-vRect[i].y + 1.0) / 2.0 * dThread.GetRootBackgroudSprite().height;
                }
                if (dMath.FloatEquals(vRect[0].x, vRect[1].x, 0.001) && dMath.FloatEquals(vRect[2].x, vRect[3].x, 0.001) &&
                    dMath.FloatEquals(vRect[0].y, vRect[2].y, 0.001) && dMath.FloatEquals(vRect[1].y, vRect[3].y, 0.001)) {
                    x = dMath.Min(vRect[0].x, vRect[2].x);
                    width = dMath.Abs(vRect[2].x - vRect[0].x);
                    y = dMath.Min(vRect[0].y, vRect[1].y);
                    height = dMath.Abs(vRect[1].y - vRect[0].y);
                }
                else if (dMath.FloatEquals(vRect[0].x, vRect[2].x, 0.001) && dMath.FloatEquals(vRect[1].x, vRect[3].x, 0.001) &&
                    dMath.FloatEquals(vRect[0].y, vRect[1].y, 0.001) && dMath.FloatEquals(vRect[2].y, vRect[3].y, 0.001)) {
                    x = dMath.Min(vRect[0].x, vRect[1].x);
                    width = dMath.Abs(vRect[1].x - vRect[0].x);
                    y = dMath.Min(vRect[0].y, vRect[2].y);
                    height = dMath.Abs(vRect[2].y - vRect[0].y);
                }
                else {
                    return false;
                }
                var left = x;
                var top = y;
                var right = width + left;
                var bottom = height + top;
                return dSprite._dglScissor(dMath.ToInt(left), dMath.ToInt(top), dMath.Ceil(right) - dMath.ToInt(left), dMath.Ceil(bottom) - dMath.ToInt(top), windowWidth, windowHeight, bMergeRect);
            }
            else {
                var left = x;
                var top = y;
                var right = width + left;
                var bottom = height + top;
                return dSprite._dglScissor(dMath.ToInt(left), dMath.ToInt(top), dMath.Ceil(right) - dMath.ToInt(left), dMath.Ceil(bottom) - dMath.ToInt(top), windowWidth, windowHeight, bMergeRect);
            }
        }
        else {
            dInterface.ptr.webgl.disable(dInterface.ptr.webgl.SCISSOR_TEST);
        }
        return true;
    };
    dSprite.prototype._dSpriteGetBoundRectRot = function (rc, mat, bWithHideSprite) {
        var mat2 = new dMatrix();
        mat2.Scaling(this.GetWidth(), this.GetHeight(), 1.0);
        mat2.TranslationAppend(this.GetWidth() * (-this.GetAnchorU()), this.GetHeight() * (-this.GetAnchorV()), 0);
        mat2.MulAppend(mat);
        var vec = new Array(4);
        vec[0] = new dVector3(0, 0);
        vec[1] = new dVector3(0, 1);
        vec[2] = new dVector3(1, 0);
        vec[3] = new dVector3(1, 1);
        for (var i = 0; i < 4; i++) {
            vec[i].Transform(mat2);
            if (rc.left > vec[i].x)
                rc.left = vec[i].x;
            if (rc.top > vec[i].y)
                rc.top = vec[i].y;
            if (rc.right < vec[i].x)
                rc.right = vec[i].x;
            if (rc.bottom < vec[i].y)
                rc.bottom = vec[i].y;
        }
        for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++) {
            var p = this.m_vecChildSprite[i];
            if (bWithHideSprite || !bWithHideSprite && p.isShow()) {
                p._dSpriteGetBoundRectRot(rc, p.GetMatrixLocal().Mul(mat), bWithHideSprite);
            }
        }
    };
    dSprite.prototype._dSpriteGetBoundRect = function (x, y, rc, fScaleX, fScaleY, bWithHideSprite, clip) {
        if (this.rotation == 0 || this.scaleX < 0 || this.scaleY < 0) {
            var xx = x - this.GetWidth() * this.GetAnchorU() * this.GetScaleX() * fScaleX;
            var yy = y - this.GetHeight() * this.GetAnchorV() * this.GetScaleY() * fScaleY;
            if (rc.left > xx)
                rc.left = xx;
            if (rc.top > yy)
                rc.top = yy;
            if (rc.right < xx + this.GetWidth() * fScaleX * this.GetScaleX())
                rc.right = xx + this.GetWidth() * fScaleX * this.GetScaleX();
            if (rc.bottom < yy + this.GetHeight() * fScaleY * this.GetScaleY())
                rc.bottom = yy + this.GetHeight() * fScaleY * this.GetScaleY();
            if (clip != null) {
                if (rc.left < clip.left)
                    rc.left = clip.left;
                if (rc.right > clip.right)
                    rc.right = clip.right;
                if (rc.top < clip.top)
                    rc.top = clip.top;
                if (rc.bottom > clip.bottom)
                    rc.bottom = clip.bottom;
            }
        }
        else {
            return this._dSpriteGetBoundRectRot(rc, this.GetMatrixLocal(), bWithHideSprite);
        }
        if (this.clipChild) {
            if (clip == null)
                clip = new dRect().Copy(rc);
            else {
                clip = new dRect().Copy(clip);
                clip.Clip(rc);
            }
        }
        for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++) {
            var p = this.m_vecChildSprite[i];
            if (bWithHideSprite || !bWithHideSprite && p.isShow()) {
                p._dSpriteGetBoundRect(p.GetPosX() * fScaleX * this.GetScaleX() + x, p.GetPosY() * fScaleY * this.GetScaleY() + y, rc, fScaleX * this.GetScaleX(), fScaleY * this.GetScaleY(), bWithHideSprite, clip);
            }
        }
    };
    dSprite.prototype.GetBoundRect = function (bWithHideSprite, bWithSelf, bCheckClipChild) {
        if (bWithHideSprite === void 0) { bWithHideSprite = true; }
        if (bWithSelf === void 0) { bWithSelf = true; }
        if (bCheckClipChild === void 0) { bCheckClipChild = false; }
        var rc = new dRect();
        if (bWithSelf) {
            rc.SetPosSize(-this.width * this.anchorU, -this.height * this.anchorV, this.width, this.height);
        }
        for (var i = 0, n = this.m_vecChildSprite.length; i < n; i++) {
            var p = this.m_vecChildSprite[i];
            if (bWithHideSprite || !bWithHideSprite && p.isShow()) {
                p._dSpriteGetBoundRect(p.GetPosX() * this.GetScaleX(), p.GetPosY() * this.GetScaleY(), rc, this.GetScaleX(), this.GetScaleY(), bWithHideSprite, this.clipChild ? rc : null);
            }
        }
        return rc;
    };
    dSprite.prototype.LoadFromJson = function (j) {
        if (j.hasOwnProperty("x") && j.hasOwnProperty("y"))
            this.SetPos(dMath.ParseFloat(j.x), dMath.ParseFloat(j.y));
        if (j.hasOwnProperty("z"))
            this.positionZ = dMath.ParseFloat(j.z);
        if (j.hasOwnProperty("width") && j.hasOwnProperty("height"))
            this.SetSize(dMath.ParseFloat(j.width), dMath.ParseFloat(j.height));
        if (j.hasOwnProperty("depth"))
            this.depth = dMath.ParseFloat(j.depth);
        if (j.hasOwnProperty("scaleX") && j.hasOwnProperty("scaleY"))
            this.SetScale(dMath.ParseFloat(j.scaleX), dMath.ParseFloat(j.scaleY));
        if (j.hasOwnProperty("scaleZ"))
            this.scaleZ = dMath.ParseFloat(j.scaleZ);
        if (j.hasOwnProperty("anchorU") && j.hasOwnProperty("anchorV"))
            this.SetAnchor(dMath.ParseFloat(j.anchorU), dMath.ParseFloat(j.anchorV));
        if (j.hasOwnProperty("rotation"))
            this.SetRotation(dMath.ParseFloat(j.rotation));
        if (j.hasOwnProperty("spriteColor")) {
            var colorARGB = dMath.ParseInt(j.spriteColor);
            colorARGB = (colorARGB & 0x7fffffff) + ((colorARGB & 0x80000000) ? 0x80000000 : 0);
            this.SetColor(colorARGB);
        }
        if (j.hasOwnProperty("alpha"))
            this.SetAlpha(dMath.ParseFloat(j.alpha));
        if (j.hasOwnProperty("visible"))
            this.SetShow(Boolean(dMath.ParseInt(j.visible)));
        if (j.hasOwnProperty("rotationX"))
            this.rotationX = dMath.ParseFloat(j.rotationX);
        if (j.hasOwnProperty("rotationY"))
            this.rotationY = dMath.ParseFloat(j.rotationY);
        if (j.hasOwnProperty("clipChild"))
            this.clipChild = Boolean(dMath.ParseInt(j.clipChild));
        if (j.hasOwnProperty("layoutAlignH"))
            this.layoutAlignH = dMath.ParseInt(j.layoutAlignH);
        if (j.hasOwnProperty("layoutAlignV"))
            this.layoutAlignV = dMath.ParseInt(j.layoutAlignV);
        if (j.hasOwnProperty("blendMode"))
            this.SetBlendMode(dMath.ParseInt(j.blendMode));
    };
    dSprite.s_pCheckCollectionData = null;
    dSprite.s_pCurrentInputingBox = null;
    dSprite.MOUSE_LBUTTONDOWN = 1;
    dSprite.MOUSE_LBUTTONUP = 2;
    dSprite.MOUSE_MBUTTONDOWN = 3;
    dSprite.MOUSE_MBUTTONUP = 4;
    dSprite.MOUSE_RBUTTONDOWN = 5;
    dSprite.MOUSE_RBUTTONUP = 6;
    dSprite.MOUSE_IN = 7;
    dSprite.MOUSE_OUT = 8;
    dSprite.MOUSE_WHEEL = 9;
    dSprite.KEY_DOWN = 10;
    dSprite.KEY_UP = 11;
    dSprite.TEXT_INPUT = 14;
    dSprite.TEXT_INPUT_CANCEL = 15;
    dSprite.TEXT_FOCUS_IN = 16;
    dSprite.TEXT_FOCUS_LOST = 17;
    dSprite.MOUSE_MOVE = 18;
    dSprite.MOUSE_GESTURE = 19;
    dSprite.MOUSE_LDRAG_BEGIN = 20;
    dSprite.MOUSE_LDRAG = 21;
    dSprite.MOUSE_LDRAG_END = 22;
    dSprite.ERROR_EVENT = 23;
    dSprite.MOUSE_STYLE_ARROW = 0;
    dSprite.MOUSE_STYLE_HAND = 1;
    dSprite.MOUSE_STYLE_EDIT = 2;
    dSprite.INPUTBOX_STYLE_HSCROLL = 1;
    dSprite.INPUTBOX_STYLE_VSCROLL = 2;
    dSprite.INPUTBOX_STYLE_CANENTERLINE = 4;
    dSprite.INPUBBOX_STYPE_AUTOENTERLINE = 8;
    dSprite.INPUTBOX_STYLE_PASSWORD = 16;
    dSprite.BLEND_MODE_NORMAL = 0;
    dSprite.BLEND_MODE_ADD = 1;
    dSprite.BLEND_MODE_SUB = 2;
    dSprite.BLEND_MODE_TEX_FILTER_POINT = 4;
    dSprite.BLEND_MODE_ZWRITE_DISABLE = 8;
    dSprite.BLEND_MODE_ZREAD_DISABLE = 16;
    dSprite.BLEND_MODE_FRUSTUM_TEST_DISABLE = 32;
    dSprite.BLEND_MODE_TOON_RENDER = 64;
    dSprite.BLEND_MODE_BLUR = 128;
    dSprite.BLEND_MODE_WIREFRAME = 256;
    dSprite.BLEND_MODE_BLEND_TEXTURE = 512;
    dSprite.BLEND_MODE_ONLY_WIREFRAME = 1024;
    dSprite.BLEND_MODE_CLEAR_ZBUFFER = 2048;
    dSprite.DEFAULT_BLEND_MODE = dSprite.BLEND_MODE_NORMAL;
    dSprite.CULL_NONE = 0;
    dSprite.CULL_FRONT = 1;
    dSprite.CULL_BACK = 2;
    dSprite.DEPTHTEST_DISABLE = 0;
    dSprite.DEPTHTEST_READ = 1;
    dSprite.DEPTHTEST_READWRITE = 2;
    dSprite.LAYOUT_ALIGN_DEFAULT = 0;
    dSprite.LAYOUT_ALIGN_LEFT_TOP = 1;
    dSprite.LAYOUT_ALIGN_RIGHT_BOTTOM = 2;
    dSprite.LAYOUT_ALIGN_SCALE = 3;
    dSprite.LAYOUT_ALIGN_RATIO = 4;
    dSprite.LAYOUT_ALIGN_RESIZE = 5;
    dSprite.LAYOUT_ALIGN_FIXED = 6;
    dSprite.SAMPLE_TYPE_CLAMP = 0;
    dSprite.SAMPLE_TYPE_REPEAT = 1;
    dSprite.SAMPLE_TYPE_MIRROR = 2;
    dSprite.m_rcCurScissorTestRect = null;
    return dSprite;
}(dObject));
var __dSpriteUniformData = (function () {
    function __dSpriteUniformData() {
        this.flag = 0;
        this.f1 = 0;
        this.f2 = 0;
        this.f3 = 0;
        this.f4 = 0;
        this.iData = 0;
        this.mat = null;
    }
    return __dSpriteUniformData;
}());
var dSpriteDefaultShader = (function (_super) {
    __extends(dSpriteDefaultShader, _super);
    function dSpriteDefaultShader() {
        var _this = _super.call(this) || this;
        _this.m_pMeshData = null;
        _this.m_orthoMatrix = new dMatrix();
        _this.m_pStreamMeshData = new dMeshData();
        _this.m_vertexDecl = [dMeshData.Vertex_Type_Pos3, dMeshData.Vertex_Type_UV2];
        var strVertex = dShader.GetHeader() +
            "uniform mat4 mWorld;\n" +
            "uniform mat4 mOrtho;\n" +
            "uniform mat4 mTransScreen;\n" +
            "uniform vec4 color;\n" +
            "uniform vec4 uvTrans;\n" +
            "varying vec2 textureCoordinate;\n" +
            "varying vec4 diffuse;\n" +
            "attribute vec4 Position0;\n" +
            "attribute vec2 TextureUV0;\n" +
            "void main(void) \n" +
            "{\n" +
            "gl_Position = mTransScreen * mOrtho * mWorld * Position0;\n" +
            "textureCoordinate.x = TextureUV0.x * uvTrans.z + uvTrans.x;\n" +
            "textureCoordinate.y = TextureUV0.y * uvTrans.w + uvTrans.y;\n" +
            "diffuse = color;\n" +
            "}";
        var strFragment = dShader.GetHeader() +
            "varying vec2 textureCoordinate;\n" +
            "varying vec4 diffuse;\n" +
            "uniform mat4 colorMatrix;\n" +
            "uniform sampler2D sTexture0;\n" +
            "uniform vec4 isAlphaPremultiplied;\n" +
            "void main(void) \n" +
            "{\n" +
            "vec4 finalColor = texture2D(sTexture0, textureCoordinate);\n" +
            "finalColor = colorMatrix * finalColor;\n" +
            "finalColor = clamp(finalColor, 0.0, 1.0);\n" +
            "finalColor *= diffuse;\n" +
            "float preAlpha = max(1.0 - isAlphaPremultiplied.x, diffuse.w);\n" +
            "finalColor.xyz *= preAlpha;\n" +
            "gl_FragColor = finalColor;\n" +
            "}";
        _this.Init(strVertex, strFragment, ["Position0", "TextureUV0"]);
        var vertices = [
            0.0, 0.0, 0.0, 0.0, 1.0,
            1.0, 0.0, 0.0, 1.0, 1.0,
            0.0, 1.0, 0.0, 0.0, 0.0,
            1.0, 1.0, 0.0, 1.0, 0.0
        ];
        var indices = [
            1, 0, 2,
            1, 2, 3
        ];
        var arr = new dByteArray();
        arr.SetEndian(dByteArray.LITTLE_ENDIAN);
        for (var i = 0; i < 4 * 5; i += 5) {
            arr.WriteFloat(vertices[i]);
            arr.WriteFloat(vertices[i + 1]);
            arr.WriteFloat(vertices[i + 2]);
            arr.WriteFloat(vertices[i + 3]);
            arr.WriteFloat(vertices[i + 4]);
        }
        arr.SetPosition(0);
        _this.m_pMeshData = new dMeshData();
        _this.m_pMeshData.SetData(null, 4, indices, _this.m_vertexDecl, dMeshData.ACCESS_WRITE_TYPE_STATIC_DRAW, vertices);
        var mat = new dMatrix();
        mat.Scaling(1, -1, 1);
        mat.TranslationAppend(-1, 1, 0);
        _this.SetUniformMatrix("mTransScreen", mat);
        _this.SetUniformF("isAlphaPremultiplied", 1, 1, 1, 1);
        _this.m_vertexTypeList = [dMeshData.Vertex_Type_Pos3, dMeshData.Vertex_Type_UV2];
        _this.SetWindowSize(dInterface.ptr.GetWindowWidth(), dInterface.ptr.GetWindowHeight());
        return _this;
    }
    dSpriteDefaultShader.Instance = function () {
        if (!dSpriteDefaultShader.s_pInstance)
            dSpriteDefaultShader.s_pInstance = new dSpriteDefaultShader();
        return dSpriteDefaultShader.s_pInstance;
    };
    dSpriteDefaultShader.prototype.GetMeshData = function () {
        return this.m_pMeshData;
    };
    dSpriteDefaultShader.prototype.SetWindowSize = function (width, height) {
        this.m_orthoMatrix.OrthoRH(width, height, 0.0, 99999.0);
        this.SetUniformMatrix("mOrtho", this.m_orthoMatrix);
    };
    dSpriteDefaultShader.prototype.isInRender = function (pSprite, matWorld) {
        if (pSprite.GetScaleX() == 0 || pSprite.GetScaleY() == 0 || pSprite.GetScaleZ() == 0 || pSprite.GetWidth() == 0 || pSprite.GetHeight() == 0)
            return 0;
        pSprite.ComputeMatrixSelf(matWorld);
        matWorld = pSprite.m_matRenderMatrixSelf;
        if (matWorld._12 == 0 && matWorld._13 == 0 && matWorld._14 == 0 &&
            matWorld._21 == 0 && matWorld._23 == 0 && matWorld._24 == 0) {
            var w = dMath.Abs(matWorld._11);
            var h = dMath.Abs(matWorld._22);
            var left = matWorld._41;
            var top = matWorld._42;
            if (matWorld._11 < 0)
                left -= w;
            if (matWorld._22 < 0)
                top -= h;
            var rc = dSprite.GetScissorTest();
            if (left + w < rc.left || left > rc.right || top + h < rc.top || top > rc.bottom)
                return 0;
        }
        return 1;
    };
    dSpriteDefaultShader.prototype.OnBindSprite = function (p) {
        p.SetEnableZReadWrite(dSprite.DEPTHTEST_DISABLE);
    };
    dSpriteDefaultShader.s_pInstance = null;
    return dSpriteDefaultShader;
}(dShader));
var dSpriteDefault3DShader = (function (_super) {
    __extends(dSpriteDefault3DShader, _super);
    function dSpriteDefault3DShader() {
        var _this = _super.call(this) || this;
        var strVertex = dShader.GetHeader() +
            "uniform mat4 mWorld;\n" +
            "uniform mat4 mView;\n" +
            "uniform mat4 mProjection;\n" +
            "uniform mat4 mTransScreen;\n" +
            "uniform vec4 color;\n" +
            "uniform vec4 uvTrans;\n" +
            "varying vec2 textureCoordinate;\n" +
            "varying vec4 diffuse;\n" +
            "attribute vec4 Position0;\n" +
            "attribute vec2 TextureUV0;\n" +
            "void main(void) \n" +
            "{\n" +
            "gl_Position = mProjection * mView * mWorld * mTransScreen * Position0;\n" +
            "textureCoordinate.x = TextureUV0.x * uvTrans.z + uvTrans.x;\n" +
            "textureCoordinate.y = TextureUV0.y * uvTrans.w + uvTrans.y;\n" +
            "diffuse = color;\n" +
            "}";
        var strFragment = dShader.GetHeader() +
            "varying vec2 textureCoordinate;\n" +
            "varying vec4 diffuse;\n" +
            "uniform mat4 colorMatrix;\n" +
            "uniform sampler2D sTexture0;\n" +
            "uniform vec4 isAlphaPremultiplied;\n" +
            "uniform vec4 fogColor;\n" +
            "uniform vec4 fogStartEnd;\n" +
            "float fog_linear(float dist, float start, const float end) {return 1.0 - clamp((end - dist) / (end - start), 0.0, 1.0);}\n" +
            "void main(void) \n" +
            "{\n" +
            "vec4 finalColor = texture2D(sTexture0, textureCoordinate);\n" +
            "finalColor = colorMatrix * finalColor;\n" +
            "finalColor = clamp(finalColor, 0.0, 1.0);\n" +
            "finalColor *= diffuse;\n" +
            "float preAlpha = max(1.0 - isAlphaPremultiplied.x, diffuse.w);\n" +
            "finalColor.xyz *= preAlpha;\n" +
            "if ( finalColor.w == 0.0 ) discard;\n" +
            "float fogFactor = fog_linear(gl_FragCoord.z / gl_FragCoord.w, fogStartEnd.x, fogStartEnd.y);\n" +
            "gl_FragColor = mix(finalColor, fogColor, fogFactor);\n" +
            "}";
        _this.Init(strVertex, strFragment, ["Position0", "TextureUV0"]);
        _this.SetUniformMatrix("mTransScreen", new dMatrix().Translation(-0.5, -0.5, 0).Mul(new dMatrix().RotationX(dMath.AngleToRadian(180))).Mul(new dMatrix().Translation(0.5, 0.5, 0)));
        _this.SetUniformF("isAlphaPremultiplied", 1, 1, 1, 1);
        _this.m_vertexTypeList = [dMeshData.Vertex_Type_Pos3, dMeshData.Vertex_Type_UV2];
        return _this;
    }
    dSpriteDefault3DShader.Instance = function () {
        if (dSpriteDefault3DShader.s_pInstance == null)
            dSpriteDefault3DShader.s_pInstance = new dSpriteDefault3DShader();
        return dSpriteDefault3DShader.s_pInstance;
    };
    dSpriteDefault3DShader.prototype.isInRender = function (pSprite, matWorld) {
        return 1;
    };
    dSpriteDefault3DShader.prototype.OnBindSprite = function (p) {
        p.SetEnableZReadWrite(dSprite.DEPTHTEST_READWRITE);
    };
    dSpriteDefault3DShader.s_pInstance = null;
    return dSpriteDefault3DShader;
}(dShader));
var CheckCollectionData = (function () {
    function CheckCollectionData() {
        this.matWorld = new dMatrix();
        this.P = new dVector3();
        this.points = [new dVector3(), new dVector3(), new dVector3(), new dVector3()];
    }
    CheckCollectionData.prototype.ResetPoints = function () {
        this.points[0].SetValue(0, 0, 0);
        this.points[1].SetValue(1, 0, 0);
        this.points[2].SetValue(1, 1, 0);
        this.points[3].SetValue(0, 1, 0);
        return this.points;
    };
    CheckCollectionData.prototype.CheckPointInTriangle = function () {
        return dMath.PointInTriangle(this.points[0], this.points[1], this.points[2], this.P) ||
            dMath.PointInTriangle(this.points[0], this.points[2], this.points[3], this.P);
    };
    return CheckCollectionData;
}());
var dBaseControl = (function (_super) {
    __extends(dBaseControl, _super);
    function dBaseControl() {
        var _this = _super.call(this) || this;
        _this.m_pEvent = null;
        _this.m_bEnabled = true;
        _this.m_bSelection = false;
        _this.m_bBeginDsc = false;
        _this.SetAnchor(0.5, 0.5);
        return _this;
    }
    dBaseControl.prototype.BeginDsc = function () {
        this.m_bBeginDsc = true;
    };
    dBaseControl.prototype.EndDsc = function () {
        this.m_bBeginDsc = false;
    };
    dBaseControl.prototype.SetEvent = function (evt) {
        this.m_pEvent = evt;
    };
    dBaseControl.prototype.GetEvent = function () {
        return this.m_pEvent;
    };
    dBaseControl.prototype.GetTypeName = function () {
        return "";
    };
    dBaseControl.prototype.GetView = function () {
        return this;
    };
    dBaseControl.prototype.isEnable = function () {
        return this.m_bEnabled;
    };
    dBaseControl.prototype.SetEnable = function (b) {
        this.m_bEnabled = b;
    };
    Object.defineProperty(dBaseControl.prototype, "renderAs3D", {
        get: function () {
            return false;
        },
        set: function (b3d) {
            if (b3d) {
                this.SetEnableZReadWrite(dSprite.DEPTHTEST_READWRITE);
            }
            else {
                this.SetShader(dSpriteDefaultShader.Instance());
                this.SetEnableZReadWrite(dSprite.DEPTHTEST_DISABLE);
            }
            var vec = this.GetChildList();
            for (var i = 0, n = vec.length; i < n; i++)
                if (vec[i] instanceof dBaseControl)
                    vec[i].renderAs3D = b3d;
        },
        enumerable: false,
        configurable: true
    });
    dBaseControl.prototype.SetSelection = function (bSelect, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        this.m_bSelection = bSelect;
        if (bSetToChild) {
            var child = this.GetChildList();
            for (var i = 0, n = child.length; i < n; i++)
                if (child[i] instanceof dBaseControl)
                    child[i].SetSelection(bSelect, bSetToChild);
        }
    };
    dBaseControl.prototype.SpriteRender = function () {
        if (this.m_bSelection) {
            var bmp = this.GetBitmapData();
            this.SetBitmapData(dBitmapData.WHITE_BITMAPDATA);
            var color = this.spriteColor;
            this.spriteColor = (~color) | 0xff000000;
            this.SetBlendMode(this.GetBlendMode());
            _super.prototype.SpriteRender.call(this);
            this.SetBitmapData(bmp);
            this.spriteColor = color;
            this.SetBlendMode(this.GetBlendMode());
            _super.prototype.SpriteRender.call(this);
        }
        else
            _super.prototype.SpriteRender.call(this);
    };
    dBaseControl.prototype.CollectionRay = function (_orig, _dir, ptOut, bBoundingBoxOnly, mat) {
        if (ptOut === void 0) { ptOut = null; }
        if (bBoundingBoxOnly === void 0) { bBoundingBoxOnly = false; }
        if (mat === void 0) { mat = null; }
        var matLocal = mat;
        if (matLocal == null)
            matLocal = this.GetMatrixLocal();
        var matLocalInverse = new dMatrix().Copy(matLocal).Inverse();
        var orig = new dVector3().Copy(_orig);
        var dir = new dVector3().Copy(_dir);
        orig.Transform(matLocalInverse);
        dir.TransformNormal(matLocalInverse);
        var pBoundingBox = this.GetBoundingBox();
        if (pBoundingBox.isCollectionRay(orig, dir)) {
            if (bBoundingBoxOnly)
                return true;
            var vertices = [
                new dVector3(pBoundingBox.x1, pBoundingBox.y1, pBoundingBox.z1),
                new dVector3(pBoundingBox.x1, pBoundingBox.y2, pBoundingBox.z1),
                new dVector3(pBoundingBox.x2, pBoundingBox.y1, pBoundingBox.z1),
                new dVector3(pBoundingBox.x2, pBoundingBox.y2, pBoundingBox.z1)
            ];
            var ib = [0, 1, 2, 1, 2, 3];
            var tuvOut = new dVector3();
            var pt = new dVector3();
            var colLength;
            var bColed;
            for (var j = 0, n2 = ib.length; j < n2; j += 3) {
                var p1 = vertices[ib[j]];
                var p2 = vertices[ib[j + 1]];
                var p3 = vertices[ib[j + 2]];
                if (dMath.RayTriangleIntersection(orig, dir, p1, p2, p3, tuvOut)) {
                    if (ptOut == null)
                        return true;
                    var u = tuvOut.x;
                    var v = tuvOut.y;
                    pt.x = (1.0 - u - v) * p1.x + u * p2.x + v * p3.x;
                    pt.y = (1.0 - u - v) * p1.y + u * p2.y + v * p3.y;
                    pt.z = (1.0 - u - v) * p1.z + u * p2.z + v * p3.z;
                    var len = pt.LengthTo(orig);
                    if (!bColed || colLength > len) {
                        bColed = true;
                        ptOut.Copy(pt);
                        colLength = len;
                    }
                }
            }
            if (bColed) {
                if (ptOut != null)
                    ptOut.Transform(matLocal);
                return true;
            }
        }
        return false;
    };
    dBaseControl.prototype.GetBoundingBox = function () {
        var ret = new dBoundingBox();
        ret.x1 = -this.width * this.anchorU;
        ret.y1 = -this.height * this.anchorV;
        ret.z1 = -this.depth * this.anchorW;
        ret.x2 = ret.x1 + this.width;
        ret.y2 = ret.y1 + this.height;
        ret.z2 = ret.z1 + this.depth;
        return ret;
    };
    return dBaseControl;
}(dSprite));
var BasePage = (function (_super) {
    __extends(BasePage, _super);
    function BasePage() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    BasePage.prototype.Update = function () {
        if (this.GetEnergyBar())
            this.GetEnergyBar().Update();
    };
    BasePage.prototype.OnBack = function () {
    };
    BasePage.prototype.OnPerSecond = function () {
    };
    BasePage.prototype.OnFadeFinish = function () {
    };
    BasePage.prototype.isFadeOutRemove = function () {
        return false;
    };
    BasePage.prototype.GetEnergyBar = function () {
        return null;
    };
    BasePage.prototype.FadeInOut = function (isIn, onComplete, isTurnBack) {
        if (isIn) {
            if (isTurnBack) {
                var whiteImageList = new Array();
                for (var i = 0; i < 4; i++) {
                    var whiteImage = new dImage();
                    whiteImage.pureColor = true;
                    whiteImage.SetAnchor(0, 0);
                    if (i == 0) {
                        whiteImage.SetSize(dThread.GetWindowWidth() + 400, 200);
                        whiteImage.SetPos(-200, -whiteImage.height);
                    }
                    else if (i == 1) {
                        whiteImage.SetSize(dThread.GetWindowWidth() + 400, 200);
                        whiteImage.SetPos(-200, dThread.GetWindowHeight());
                    }
                    else if (i == 2) {
                        whiteImage.SetSize(200, dThread.GetWindowHeight());
                        whiteImage.SetPos(-whiteImage.width, 0);
                    }
                    else if (i == 3) {
                        whiteImage.SetSize(200, dThread.GetWindowHeight());
                        whiteImage.SetPos(dThread.GetWindowWidth(), 0);
                    }
                    this.AddChild(whiteImage);
                    whiteImageList.push(whiteImage);
                }
                this.SetScale(0.9, 0.9);
                this.positionX += dThread.GetWindowWidth() / 2 * 0.1;
                this.positionY += dThread.GetWindowHeight() / 2 * 0.1;
                CCActionManager.Instance().AddAction(new CCSequence([
                    new CCSpawn([
                        new CCScaleTo(0.5, 1, 1),
                        new CCMoveBy(0.5, -dThread.GetWindowWidth() / 2 * 0.1, -dThread.GetWindowHeight() / 2 * 0.1)
                    ]),
                    new CCCallFunc(function () {
                        for (var i = 0; i < whiteImageList.length; i++)
                            whiteImageList[i].RemoveParent();
                    })
                ]), this);
                if (onComplete != null)
                    onComplete(this);
            }
            else {
                this.positionX += dThread.GetWindowWidth();
                CCActionManager.Instance().AddAction(new CCSequence([
                    new CCMoveBy(0.5, -dThread.GetWindowWidth(), 0),
                    new CCCallFunc(onComplete)
                ]), this);
            }
        }
        else {
            if (isTurnBack) {
                CCActionManager.Instance().AddAction(new CCSequence([
                    new CCMoveBy(0.5, dThread.GetWindowWidth(), 0),
                    new CCRemoveSelf()
                ]), this);
                if (onComplete != null)
                    onComplete(this);
            }
            else {
                var whiteImageList = new Array();
                for (var i = 0; i < 4; i++) {
                    var whiteImage = new dImage();
                    whiteImage.pureColor = true;
                    whiteImage.SetAnchor(0, 0);
                    if (i == 0) {
                        whiteImage.SetSize(dThread.GetWindowWidth() + 400, 200);
                        whiteImage.SetPos(-200, -whiteImage.height);
                    }
                    else if (i == 1) {
                        whiteImage.SetSize(dThread.GetWindowWidth() + 400, 200);
                        whiteImage.SetPos(-200, dThread.GetWindowHeight());
                    }
                    else if (i == 2) {
                        whiteImage.SetSize(200, dThread.GetWindowHeight());
                        whiteImage.SetPos(-whiteImage.width, 0);
                    }
                    else if (i == 3) {
                        whiteImage.SetSize(200, dThread.GetWindowHeight());
                        whiteImage.SetPos(dThread.GetWindowWidth(), 0);
                    }
                    this.AddChild(whiteImage);
                    whiteImageList.push(whiteImage);
                }
                CCActionManager.Instance().AddAction(new CCSequence([
                    new CCSpawn([
                        new CCScaleTo(0.5, 0.9, 0.9),
                        new CCMoveBy(0.5, dThread.GetWindowWidth() / 2 * 0.1, dThread.GetWindowHeight() / 2 * 0.1)
                    ]),
                    new CCCallFunc(function () {
                        for (var i = 0; i < whiteImageList.length; i++)
                            whiteImageList[i].RemoveParent();
                    }),
                    new CCRemoveSelf()
                ]), this);
                if (onComplete != null)
                    onComplete(this);
            }
        }
    };
    BasePage.prototype.MoveInOut = function (isIn, onComplete, bAniInverse) {
        var _this = this;
        var dir = bAniInverse ? -1 : 1;
        if (isIn) {
            this.positionX = dThread.GetWindowWidth() * 1.0 * dir;
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCMoveTo(0.5, 0, 0),
                new CCCallFunc(onComplete)
            ]), this);
        }
        else {
            onComplete(this);
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCDelayTime(0.05),
                new CCMoveTo(0.5, -dThread.GetWindowWidth() * 1.0 * dir, 0),
                new CCCallFunc(function () {
                    if (_this != null) {
                        _this.Destroy();
                        _this.RemoveParent();
                    }
                })
            ]), this);
        }
    };
    BasePage.prototype.ScaleInOut = function (isIn, p, delay, onComplete) {
        if (isIn) {
            p.SetScale(0, 0);
            dBitmapData.SetGlobalImageLoadComplete(function () {
                CCActionManager.Instance().AddAction(new CCSequence([
                    new CCDelayTime(delay),
                    new CCScaleTo(0.1, 1.2, 1.2),
                    new CCScaleTo(0.1, 1, 1),
                    new CCCallFunc(onComplete)
                ]), p);
            });
        }
        else {
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCDelayTime(delay),
                new CCScaleTo(0.1, 1.2, 1.2),
                new CCScaleTo(0.1, 0, 0),
                new CCCallFunc(onComplete)
            ]), p);
        }
    };
    BasePage.prototype.ScaleInOutList = function (isIn, list, onComplete, delay) {
        if (delay === void 0) { delay = 0; }
        var callback = new dCompleteCallback(this);
        for (var i = 0; i < list.length; i++) {
            this.ScaleInOut(isIn, list[i], i * 0.1 + delay, callback.CreateCompleteFun_Normal());
        }
        callback.SetCompleteFun(onComplete);
    };
    BasePage.prototype.GetSpriteGoundRect = function (p) {
        var rc = new dRect();
        rc.SetPosSize(-p.width * p.anchorU, -p.height * p.anchorV, p.width, p.height);
        return rc;
    };
    BasePage.prototype.FlyInOut = function (isIn, p, delay, up, onComplete) {
        if (isIn) {
            var rc = this.GetSpriteGoundRect(p);
            var srcPosY;
            if (up) {
                srcPosY = -rc.Height() * (1 - p.anchorV);
            }
            else {
                srcPosY = dThread.GetWindowHeight() + rc.Height() * p.anchorV;
            }
            var destPosY = p.positionY;
            var destPosX = p.positionX;
            p.positionY = srcPosY;
            p.positionX = (p.positionX - dThread.GetWindowWidth() * p.anchorU) * 2 + dThread.GetWindowWidth() * p.anchorU;
            dBitmapData.SetGlobalImageLoadComplete(function () {
                CCActionManager.Instance().AddAction(new CCSequence([
                    new CCDelayTime(delay),
                    new CCEaseBackOut(new CCMoveTo(0.3, destPosX, destPosY)),
                    new CCCallFunc(onComplete)
                ]), p);
            });
        }
        else {
            var rc = this.GetSpriteGoundRect(p);
            var destPosY;
            if (up) {
                destPosY = -rc.Height() * (1 - p.anchorV);
            }
            else {
                destPosY = dThread.GetWindowHeight() + rc.Height() * p.anchorV;
            }
            var destPosX = (p.positionX - dThread.GetWindowWidth() * p.anchorU) * 2 + dThread.GetWindowWidth() * p.anchorU;
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCDelayTime(delay),
                new CCEaseBackIn(new CCMoveTo(0.3, destPosX, destPosY)),
                new CCCallFunc(onComplete)
            ]), p);
        }
    };
    BasePage.prototype.FlyInOutList = function (isIn, upList, downList, onComplete) {
        var _this = this;
        var vecOldPosUp = new Array();
        var vecOldPosDown = new Array();
        if (upList != null && !isIn) {
            vecOldPosUp.resize(upList.length);
            for (var i = 0; i < upList.length; i++)
                vecOldPosUp[i] = new dVector2(upList[i].positionX, upList[i].positionY);
        }
        if (downList != null && !isIn) {
            vecOldPosDown.resize(downList.length);
            for (var i = 0; i < downList.length; i++)
                vecOldPosDown[i] = new dVector2(downList[i].positionX, downList[i].positionY);
        }
        var callback = new dCompleteCallback(this);
        if (upList != null) {
            for (var i = 0; i < upList.length; i++) {
                this.FlyInOut(isIn, upList[i], i * (0.1 / upList.length), 1, callback.CreateCompleteFun_Normal());
            }
        }
        if (downList != null) {
            for (var i = 0; i < downList.length; i++) {
                this.FlyInOut(isIn, downList[i], i * (0.1 / downList.length), 0, callback.CreateCompleteFun_Normal());
            }
        }
        callback.SetCompleteFun(function () {
            if (!isIn) {
                for (var i = 0; i < vecOldPosUp.length; i++)
                    upList[i].SetPos(vecOldPosUp[i].x, vecOldPosUp[i].y);
                for (var i = 0; i < vecOldPosDown.length; i++)
                    downList[i].SetPos(vecOldPosDown[i].x, vecOldPosDown[i].y);
            }
            if (onComplete != null)
                onComplete(_this);
        });
    };
    BasePage.prototype.OpenPanel = function (HandleMousePanel, panel, onComplete, bAni) {
        var _this = this;
        if (onComplete === void 0) { onComplete = null; }
        if (bAni === void 0) { bAni = true; }
        panel.LayoutToSize(this.width, this.height);
        HandleMousePanel.visible = true;
        panel.visible = true;
        var vec = panel.GetChildList();
        var vecUp = new Array();
        var vecDown = new Array();
        for (var i = 0; i < vec.length; i++) {
            if (vec[i].positionY < dThread.GetWindowHeight() / 2)
                vecUp.push(vec[i]);
            else
                vecDown.push(vec[i]);
        }
        this.FlyInOutList(true, vecUp, vecDown, function () {
            HandleMousePanel.visible = false;
            if (onComplete != null)
                onComplete(_this);
        });
    };
    BasePage.prototype.ClosePanel = function (HandleMousePanel, panel, onComplete, bAni) {
        var _this = this;
        if (onComplete === void 0) { onComplete = null; }
        if (bAni === void 0) { bAni = true; }
        HandleMousePanel.visible = true;
        var vec = panel.GetChildList();
        var vecUp = new Array();
        var vecDown = new Array();
        for (var i = 0; i < vec.length; i++) {
            if (vec[i].positionY < dThread.GetWindowHeight() / 2)
                vecUp.push(vec[i]);
            else
                vecDown.push(vec[i]);
        }
        this.FlyInOutList(false, vecUp, vecDown, function () {
            panel.visible = false;
            HandleMousePanel.visible = false;
            if (onComplete != null)
                onComplete(_this);
        });
    };
    return BasePage;
}(dBaseControl));
var dImage = (function (_super) {
    __extends(dImage, _super);
    function dImage() {
        var _this = _super.call(this) || this;
        _this.m_pImageBitmapData = null;
        return _this;
    }
    Object.defineProperty(dImage.prototype, "pureColor", {
        get: function () {
            return this.GetBitmapData() == dBitmapData.WHITE_BITMAPDATA;
        },
        set: function (bSet) {
            if (bSet)
                _super.prototype.SetBitmapData.call(this, dBitmapData.WHITE_BITMAPDATA);
            else
                this.SetBitmapData(this.m_pImageBitmapData);
        },
        enumerable: false,
        configurable: true
    });
    dImage.prototype.LoadFromFile = function (strImage, onLoadComplete, bAutoResize, rcSource) {
        var _this = this;
        if (onLoadComplete === void 0) { onLoadComplete = null; }
        if (bAutoResize === void 0) { bAutoResize = true; }
        if (rcSource === void 0) { rcSource = null; }
        if (strImage != null && this.GetFileName() != strImage) {
            if (strImage != "") {
                if (bAutoResize)
                    this.SetSize(0, 0);
                var bmp = new dBitmapData();
                this.SetBitmapData(bmp, rcSource);
                bmp.LoadFromFile(strImage, function () {
                    if (bAutoResize && _this.GetWidth() == 0 && _this.GetHeight() == 0) {
                        if (rcSource == null)
                            _this.SetSize(bmp.GetWidth(), bmp.GetHeight());
                        else
                            _this.SetSize(bmp.GetWidth() * rcSource.Width(), bmp.GetHeight() * rcSource.Height());
                    }
                    if (onLoadComplete)
                        onLoadComplete(_this);
                });
            }
            else if (this.GetBitmapData() != null) {
                this.SetBitmapData(null);
                if (onLoadComplete)
                    onLoadComplete(this);
            }
        }
        else {
            if (onLoadComplete)
                onLoadComplete(this);
        }
        return this;
    };
    dImage.prototype.SetLoadCompleteCallback = function (onComplete) {
        var _this = this;
        if (this.GetBitmapData() == null || !this.GetBitmapData().isLoading())
            onComplete(this);
        else {
            new dTimer(this).Create(100, 0, function (sender) {
                if (_this.GetBitmapData() == null || !_this.GetBitmapData().isLoading()) {
                    onComplete(_this);
                    sender.Stop();
                }
            });
        }
    };
    dImage.prototype.SetBitmapData = function (bmp, pSourceRect, at, sampleType) {
        if (pSourceRect === void 0) { pSourceRect = null; }
        if (at === void 0) { at = 0; }
        if (sampleType === void 0) { sampleType = 0; }
        if (at == 0)
            this.m_pImageBitmapData = bmp;
        _super.prototype.SetBitmapData.call(this, bmp, pSourceRect, at, sampleType);
    };
    dImage.prototype.SetSizeAsBitmapData = function () {
        if (this.m_pImageBitmapData != null)
            this.SetSize(this.m_pImageBitmapData.GetWidth(), this.m_pImageBitmapData.GetHeight());
    };
    dImage.prototype.GetFileName = function () {
        if (this.GetBitmapData() == null)
            return "";
        return this.GetBitmapData().GetResourceFileName();
    };
    Object.defineProperty(dImage.prototype, "resourceFileName", {
        get: function () {
            return this.GetFileName();
        },
        set: function (fileName) {
            this.LoadFromFile(fileName, null, false);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dImage.prototype, "resourceFileNameWithAutoResize", {
        set: function (fileName) {
            this.LoadFromFile(fileName, null, true);
        },
        enumerable: false,
        configurable: true
    });
    dImage.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("resourceFileName"))
            this.resourceFileName = json.resourceFileName;
        if (json.hasOwnProperty("pureColor"))
            this.pureColor = json.pureColor;
    };
    dImage.prototype.isLoading = function () {
        if (this.GetBitmapData() != null)
            return this.GetBitmapData().isLoading();
        return true;
    };
    return dImage;
}(dBaseControl));
var ColorfulEffect = (function (_super) {
    __extends(ColorfulEffect, _super);
    function ColorfulEffect(type) {
        if (type === void 0) { type = 0; }
        var _this = _super.call(this) || this;
        _this.m_vecImages = new Array();
        _this.m_fAddImageTime = 0;
        _this.SetLayoutAlign(dSprite.LAYOUT_ALIGN_LEFT_TOP, dSprite.LAYOUT_ALIGN_LEFT_TOP);
        if (type == 0) {
            for (var i = 0; i < 60; i++) {
                var p = _this.CreateImage();
                p.SetPos(dMath.Random() * dThread.GetWindowWidth(), dMath.Random() * dThread.GetWindowHeight());
                _this.AddChild(p);
                _this.m_vecImages.push(p);
            }
            new dTimer(_this).Create(0, 0, function (sender, iTimer, fTimer) {
                if (_this.GetParent() != null && _this.visible) {
                    _this.SetPos(-_this.GetParent().GetPosX_World(PageManager.Instance()), -_this.GetParent().GetPosY_World(PageManager.Instance()));
                    _this.m_fAddImageTime += fTimer;
                    if (_this.m_fAddImageTime > 0.15) {
                        _this.m_fAddImageTime = 0;
                        var p = _this.CreateImage();
                        p.SetPos(dMath.Random() * dThread.GetWindowWidth(), -50);
                        _this.AddChild(p);
                        _this.m_vecImages.push(p);
                    }
                    for (var i = 0; i < _this.m_vecImages.length; i++) {
                        var p = _this.m_vecImages[i];
                        p.rotation += p.rotSpeed * fTimer;
                        p.positionX += p.moveSpeedX * fTimer;
                        p.positionY += p.moveSpeedY * fTimer;
                        if (p.positionY > dThread.GetWindowHeight() + 50) {
                            p.RemoveParent();
                            _this.m_vecImages.erase(i);
                            i--;
                        }
                    }
                }
            });
        }
        else {
            var v = new dVector2();
            for (var i = 0; i < 60; i++) {
                var p = _this.CreateImage();
                _this.AddChild(p);
                p.moveSpeedX = dMath.RandomRange(-1, 1) * 1500;
                p.moveSpeedY = -dMath.Random() * 2800;
                _this.m_vecImages.push(p);
            }
            new dTimer(_this).Create(0, 0, function (sender, iTimer, fTimer) {
                if (_this.GetParent() != null && _this.visible) {
                    for (var i = 0; i < _this.m_vecImages.length; i++) {
                        var p = _this.m_vecImages[i];
                        p.rotation += p.rotSpeed * fTimer;
                        p.positionX += p.moveSpeedX * fTimer;
                        p.positionY += p.moveSpeedY * fTimer;
                        p.moveSpeedY += fTimer * 5500;
                        if (p.positionY + _this.positionY > dThread.GetWindowHeight() + 50) {
                            p.RemoveParent();
                            _this.m_vecImages.erase(i);
                            i--;
                        }
                    }
                }
            });
        }
        return _this;
    }
    ColorfulEffect.prototype.CreateImage = function () {
        var p = new ColorfulImage();
        p.pureColor = true;
        p.SetTransparentMouse(true);
        p.SetSize(dMath.RandomRange(20, 50), dMath.RandomRange(20, 50));
        var rnd = dMath.RandomI() % 5;
        var color = -1;
        switch (rnd) {
            case 0:
                color = 0xffd961ff;
                break;
            case 1:
                color = 0xffffd85d;
                break;
            case 2:
                color = 0xffec453e;
                break;
            case 3:
                color = 0xff5dc441;
                break;
            case 4:
                color = 0xff2cc3ef;
                break;
        }
        p.spriteColor = color;
        p.rotation = dMath.Random() * 360;
        p.rotSpeed = dMath.RandomRange(-200, 200);
        p.moveSpeedY = dMath.RandomRange(200, 500);
        p.moveSpeedX = dMath.RandomRange(-50, 50);
        return p;
    };
    return ColorfulEffect;
}(dSprite));
var ColorfulImage = (function (_super) {
    __extends(ColorfulImage, _super);
    function ColorfulImage() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.moveSpeedX = 0;
        _this.moveSpeedY = 0;
        _this.rotSpeed = 0;
        return _this;
    }
    return ColorfulImage;
}(dImage));
var ConnectingPage = (function (_super) {
    __extends(ConnectingPage, _super);
    function ConnectingPage() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.Text.text = "...";
        _this.LayoutToSize(dThread.GetWindowWidth(), dThread.GetWindowHeight());
        _this.SetHandleMouse(true);
        var ani = [_this.dImage2, _this.dImage3, _this.dImage4];
        new dTimer(_this).Create(500, 0, function (sender, iTimer, fTimer) {
            var frame = iTimer % 4;
            for (var i = 0; i < ani.length; i++)
                ani[i].visible = i < frame;
        });
        new dTimer(_this).Create(5000, 1, function () {
            if (_this.GetParent() != null)
                _this.OnClose();
        });
        return _this;
    }
    ConnectingPage.prototype._dscData = function () { return { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "Back", "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": 1677721600, "width": 1080, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 230, "resourceFileName": "data/lianjiewifi0.png", "width": 230, "x": 540, "y": 943 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 135, "resourceFileName": "data/lianjiewifi1.png", "width": 143, "x": 668, "y": 790 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 135, "resourceFileName": "data/lianjiewifi2.png", "width": 143, "x": 668, "y": 790 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage4", "classType": "dImage", "height": 135, "resourceFileName": "data/lianjiewifi3.png", "width": 143, "x": 668, "y": 790 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 78, "resourceFileName": "data/font64.json", "text": "Connecting...", "width": 361, "x": 540, "y": 1117 }], "anchorU": 0, "anchorV": 0, "classType": "dSprite", "height": 1920, "width": 1080, "x": 0, "y": 0 }; };
    ConnectingPage.prototype.OnClose = function () {
    };
    return ConnectingPage;
}(dSprite));
var EnergyBar = (function (_super) {
    __extends(EnergyBar, _super);
    function EnergyBar() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        new dTimer(_this).Create(1000, 0, function () {
            _this.Update();
        }).Apply();
        _this.AddButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().OpenPanel(null, new AddEnergyPanel());
        }));
        return _this;
    }
    EnergyBar.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dScale9", "height": 84, "resourceFileName": "data/goldback.png", "width": 225, "x": 6, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Icon", "classType": "dImage", "height": 120, "resourceFileName": "data/energyicon.png", "scaleX": 0.866667, "scaleY": 0.866667, "width": 72, "x": -90.199951, "y": -1 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 48, "height": 48.75, "resourceFileName": "data/fontNumber.json", "spriteColor": -4622029, "text": "0", "width": 27, "x": 1, "y": -7 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Time", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "00:00", "width": 80.5, "x": 4, "y": 56 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "AddButton", "classType": "dButton", "height": 103, "resourceFileName": "data/addbutton.png", "scaleX": 0.92233, "scaleY": 0.92233, "width": 92, "x": 112.427185, "y": 1 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dSprite", "height": 90, "width": 350, "x": 0, "y": 0 }; };
    EnergyBar.prototype.Update = function () {
        if (SaveData.Instance().passStage < EnergyBar.FREE_ENERGY_STAGE) {
            this.Number.text = "";
        }
        else
            this.Number.text = String(SaveData.Instance().energy);
        if (SaveData.Instance().energy >= GDefine.MAX_ENERGY || SaveData.Instance().passStage < EnergyBar.FREE_ENERGY_STAGE)
            this.Time.visible = false;
        else {
            this.Time.visible = true;
            var timeRemain = GDefine.ADD_ENERGY_TIME - SaveData.Instance().energyAddTime;
            if (timeRemain < 0)
                timeRemain = 0;
            var second = timeRemain % 60;
            var minute = timeRemain / 60;
            this.Time.text = dStringUtils.FormatInt(minute, 2) + ":" + dStringUtils.FormatInt(second, 2);
        }
    };
    EnergyBar.prototype.FlashEnergy = function () {
        CCActionManager.Instance().RemoveAllActionsFromTarget(this.Number);
        var color = dMath.ColorToValue(0xffffffff);
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCTintTo(0.1, 1, 0, 0, 1, false, false),
            new CCTintTo(0.1, color.x, color.y, color.z, color.w, false, false),
            new CCTintTo(0.1, 1, 0, 0, 1, false, false),
            new CCTintTo(0.1, color.x, color.y, color.z, color.w, false, false)
        ]), this.Number);
    };
    EnergyBar.FREE_ENERGY_STAGE = 0;
    return EnergyBar;
}(dSprite));
var GDefine = (function () {
    function GDefine() {
    }
    GDefine.ToMinuteSecondTime = function (fTime) {
        var time = fTime * 1000;
        var minute = dMath.ToInt(time / 60000);
        var second = (time % 60000) / 1000;
        return dStringUtils.FormatInt(minute, 2) + ":" + dStringUtils.FormatInt(second, 2);
    };
    GDefine.MyAppName = "HanziMatrix";
    GDefine.MAX_ENERGY = 5;
    GDefine.ADD_ENERGY_TIME = 1800;
    GDefine.EnableEnergy = false;
    GDefine.MAX_STAGE = 80;
    return GDefine;
}());
var GamePage = (function (_super) {
    __extends(GamePage, _super);
    function GamePage(stagedata) {
        var _this = _super.call(this) || this;
        _this.m_pGameWorld = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.m_pGameWorld = new GameWorld(stagedata);
        _this.GameLayer.AddChild(_this.m_pGameWorld);
        _this.m_pGameWorld.SetPos(-_this.m_pGameWorld.width * _this.anchorU, -_this.m_pGameWorld.height * _this.anchorV);
        _this.Update();
        return _this;
    }
    GamePage.prototype._dscData = function () { return { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "GameLayer", "classType": "dSprite", "height": 1920, "layoutAlignH": 1, "layoutAlignV": 1, "width": 1080, "x": 0, "y": 0 }], "anchorU": 0, "anchorV": 0, "classType": "dSprite", "height": 1920, "width": 1080, "x": 0, "y": 0 }; };
    GamePage.prototype.Update = function () {
        _super.prototype.Update.call(this);
    };
    GamePage.prototype.LayoutToSize = function (width, height) {
        _super.prototype.LayoutToSize.call(this, width, height);
        this.m_pGameWorld.LayoutToSize(width, height);
    };
    GamePage.prototype.GetEnergyBar = function () {
        return this.m_pGameWorld.TitleBack_EnergeBar;
    };
    return GamePage;
}(BasePage));
var HandIcon = (function (_super) {
    __extends(HandIcon, _super);
    function HandIcon() {
        var _this = _super.call(this) || this;
        _this.imgX = 0;
        _this.imgY = 0;
        _this.m_vecDot = new Array();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.imgX = _this.TabView_Image2.positionX;
        _this.imgY = _this.TabView_Image2.positionY;
        return _this;
    }
    HandIcon.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image1", "classType": "dImage", "height": 247, "resourceFileName": "data/hand.png", "width": 245, "x": 63, "y": 48 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Image2", "classType": "dImage", "height": 247, "resourceFileName": "data/hand.png", "rotation": -17.18874, "scaleX": 0.95, "scaleY": 0.95, "visible": 0, "width": 245, "x": 68, "y": 22 }], "anchorU": 0.5, "anchorV": 0.5, "className": "TabView", "classType": "dTabView", "height": 0, "width": 0, "x": 0, "y": 0 }], "anchorU": 0, "anchorV": 0, "classType": "dSprite", "height": 0, "width": 0, "x": 0, "y": 0 }; };
    HandIcon.prototype.PlayTouchMove = function (vecPoints, repeatCount) {
        var _this = this;
        if (repeatCount === void 0) { repeatCount = 1; }
        if (vecPoints.length == 0)
            return;
        this.TabView.spriteFrame = 0;
        this.TabView_Image2.visible = this.TabView_Image1.visible = false;
        var actions = new Array();
        actions.push(new CCMoveTo(0, this.imgX, this.imgY));
        actions.push(new CCShow());
        actions.push(new CCCallFunc(function () {
            _this.TabView.spriteFrame = 0;
        }));
        actions.push(new CCDelayTime(0.5));
        actions.push(new CCCallFunc(function () {
            _this.TabView.spriteFrame = 1;
        }));
        actions.push(new CCDelayTime(0.2));
        this.SetPos(vecPoints[0].x, vecPoints[0].y);
        for (var i = 1; i < vecPoints.length; i++)
            actions.push(new CCMoveTo(1, vecPoints[i].x - this.positionX + this.imgX, vecPoints[i].y - this.positionY + this.imgY));
        actions.push(new CCDelayTime(0.5));
        actions.push(new CCHide());
        actions.push(new CCCallFunc(function () {
            for (var i = 0; i < _this.m_vecDot.length; i++)
                _this.m_vecDot[i].RemoveParent();
            _this.m_vecDot.clear();
        }));
        actions.push(new CCDelayTime(0.5));
        if (repeatCount == 1)
            actions.push(new CCRemoveTarget(this));
        CCActionManager.Instance().AddAction(new CCRepeat(new CCSequence(actions), repeatCount), this.TabView_Image2);
        this.PlayAddDot();
    };
    HandIcon.prototype.PlayAddDot = function () {
        var _this = this;
        new dTimer(this).Create(100, 0, function () {
            if (_this.TabView_Image2.visible || _this.TabView_Image1.visible) {
                var dot = new dImage();
                dot.LoadFromFile("data/dot.png");
                dot.spriteColor = 0xff000000;
                dot.SetSize(20, 20);
                dot.SetPos(_this.TabView_Image2.positionX - _this.imgX, _this.TabView_Image2.positionY - _this.imgY);
                _this.AddChild(dot, 0);
                _this.m_vecDot.push(dot);
            }
        }).Apply();
    };
    HandIcon.prototype.PlayClick = function () {
        var _this = this;
        CCActionManager.Instance().AddAction(new CCRepeatForever(new CCSequence([
            new CCDelayTime(0.3),
            new CCCallFunc(function () {
                _this.TabView.spriteFrame = 1;
            }),
            new CCDelayTime(0.3),
            new CCCallFunc(function () {
                _this.TabView.spriteFrame = 0;
            })
        ])), this);
    };
    HandIcon.prototype.PlayDragFood = function (targetX, targetY) {
        var _this = this;
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCDelayTime(0.5),
            new CCCallFunc(function () {
                _this.TabView.spriteFrame = 1;
            }),
            new CCDelayTime(0.2),
            new CCMoveTo(1, targetX, targetY),
            new CCDelayTime(0.2),
            new CCRemoveSelf()
        ]), this);
    };
    return HandIcon;
}(dSprite));
var LoginPage = (function (_super) {
    __extends(LoginPage, _super);
    function LoginPage() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        var safeAreaTop = dThread.GetSafeAreaTop();
        if (safeAreaTop > 0) {
            _this.TitleBack.positionY += safeAreaTop;
        }
        _this.SetHandleMouse(true);
        _this.TitleBack_MoreButton.visible = MyAd.hasMoreGame();
        _this.TitleBack_MoreButton_Text.text = MyAd.GetMoreGameText();
        _this.TitleBack_MoreButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            MoreGamePanel.ShowAdMoreGame();
        }));
        _this.TitleBack_SettingButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().OpenPanel(null, new SettingPanel());
        }));
        _this.TitleBack_MenuButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().OpenPanel(null, new SelectLevelPanel());
        }));
        _this.StartButton.repeatType = true;
        _this.StartButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/window.mp3");
            PageManager.Instance().SubEnergy(function () {
                var stageData = new StageData();
                stageData.stage = SaveData.Instance().passStage + 1;
                PageManager.Instance().ChangePage(GamePage, stageData, null, true, null, false);
            });
        }));
        _this.TitleBack_EnergeBar.visible = GDefine.EnableEnergy;
        return _this;
    }
    LoginPage.prototype._dscData = function () { return { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "Back", "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "resourceFileName": "img/hanzi-mz/loading/loadingback.png", "width": 1080, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Logo", "classType": "dImage", "height": 262, "resourceFileName": "img/hanzi-mz/loading/loading_logo.png", "width": 944, "x": 540, "y": 563 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "JianKang", "classType": "dImage", "height": 118, "layoutAlignV": 2, "resourceFileName": "img/hanzi-mz/loading/loading_jiankang.png", "width": 955, "x": 540, "y": 1757 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dWindowRefrance1", "classType": "ShiLingButton", "layoutAlignV": 2, "x": 961, "y": 1612 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "SettingButton", "classType": "dButtonScale9", "height": 86, "layoutAlignH": 2, "resourceFileName": "data/setting.png", "spriteColor": -4868683, "width": 88, "x": 458, "y": 114 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "MenuButton", "classType": "dButtonScale9", "height": 69, "layoutAlignH": 2, "resourceFileName": "data/menubutton.png", "spriteColor": -4868683, "width": 83, "x": 336, "y": 114 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 30, "height": 41.25, "resourceFileName": "data/fontmore.json", "text": "", "width": 127.5, "wordSpace": -10, "x": 0, "y": 43 }], "anchorU": 0.5, "anchorV": 0.5, "className": "MoreButton", "classType": "dButton", "height": 135, "layoutAlignH": 2, "resourceFileName": "data/morebutton.png", "scaleX": 0.777777, "scaleY": 0.777778, "width": 127, "x": 464.111023, "y": 237 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "EnergeBar", "classType": "EnergyBar", "layoutAlignH": 1, "x": -357, "y": 111 }], "alpha": 0.392157, "anchorU": 0.5, "anchorV": 0, "className": "TitleBack", "classType": "dImage", "height": 209, "layoutAlignH": 5, "layoutAlignV": 1, "resourceFileName": "", "width": 1080, "x": 540, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 60, "height": 72.1875, "resourceFileName": "data/font64.json", "spriteColor": -12237499, "text": "", "width": 240, "x": 0, "y": -16 }], "anchorU": 0.5, "anchorV": 0.5, "className": "StartButton", "classType": "dButtonScale9", "height": 128, "resourceFileName": "data/button1.png", "width": 350, "x": 545, "y": 1327 }], "anchorU": 0, "anchorV": 0, "classType": "dSprite", "height": 1920, "width": 1080, "x": 0, "y": 0 }; };
    LoginPage.prototype.GetEnergyBar = function () {
        return this.TitleBack_EnergeBar;
    };
    return LoginPage;
}(BasePage));
var dThread = (function (_super) {
    __extends(dThread, _super);
    function dThread() {
        var _this = _super.call(this) || this;
        _this.m_nFixedRenderWidth = 0;
        _this.m_nFixedRenderHeight = 0;
        _this.m_fTopOffset = 0;
        _this.m_fBottomOffset = 0;
        _this.m_nFixedRanderWidthLimit = 0;
        _this.m_nFixedRanderHeightLimit = 0;
        dInterface.ptr.m_pMainThread = _this;
        _this.m_pRootBackgroudSprite = new dSprite();
        _this.m_pRootSprite = new dSprite();
        _this.m_pRootBackgroudSprite.AddChild(_this.m_pRootSprite);
        return _this;
    }
    dThread.prototype.AddChild = function (pSprite, at) {
        if (at === void 0) { at = -1; }
        this.m_pRootSprite.AddChild(pSprite, at);
    };
    dThread.prototype.SetFixedRenderSize = function (width, height) {
        this.m_nFixedRenderWidth = width;
        this.m_nFixedRenderHeight = height;
        if (this.m_pRootSprite != null && this.m_nFixedRenderWidth != 0 && this.m_nFixedRenderHeight != 0) {
            this.m_pRootSprite.SetSize(this.m_nFixedRenderWidth, this.m_nFixedRenderHeight);
        }
    };
    dThread.GetRootBackgroudSprite = function () {
        if (dInterface.ptr.m_pMainThread)
            return dInterface.ptr.m_pMainThread.m_pRootBackgroudSprite;
        return null;
    };
    dThread.GetRootSprite = function () {
        if (dInterface.ptr.m_pMainThread)
            return dInterface.ptr.m_pMainThread.m_pRootSprite;
        return null;
    };
    dThread.GetWindowWidth = function () {
        if (dThread.GetRootSprite())
            return dThread.GetRootSprite().width;
        return 0;
    };
    dThread.GetWindowHeight = function () {
        if (dThread.GetRootSprite())
            return dThread.GetRootSprite().height;
        return 0;
    };
    dThread.prototype.FrameWindowResize = function (width, height) {
        this._FrameUpdateSize(width, height);
        if (this.m_pRootSprite != null)
            this.OnFrameWindowResize(this.m_pRootSprite.GetWidth(), this.m_pRootSprite.GetHeight());
        else
            this.OnFrameWindowResize(width, height);
    };
    dThread.prototype._FrameUpdateSize = function (width, height) {
        if (this.m_pRootBackgroudSprite != null)
            this.m_pRootBackgroudSprite.SetSize(width, height);
        var root = this.m_pRootSprite;
        var fixedRenderWidth = this.m_nFixedRenderWidth;
        var fixedRenderHeight = this.m_nFixedRenderHeight;
        if (root != null) {
            height -= this.m_fTopOffset + this.m_fBottomOffset;
            root.positionY = this.m_fTopOffset;
            if (fixedRenderWidth == 0 && fixedRenderHeight == 0) {
                root.SetSize(width, height);
                root.SetScale3D(1, 1, 1);
            }
            else if (fixedRenderWidth != 0 && fixedRenderHeight != 0) {
                var fp = width / height;
                if (fp > fixedRenderWidth / fixedRenderHeight) {
                    root.SetSize(fp * fixedRenderHeight, fixedRenderHeight);
                    root.SetScale3D(width / root.width, width / root.width, width / root.width);
                }
                else {
                    root.SetSize(fixedRenderWidth, height / width * fixedRenderWidth);
                    root.SetScale3D(height / root.height, height / root.height, height / root.height);
                }
            }
            else if (fixedRenderWidth != 0) {
                var height2 = height / width * fixedRenderWidth;
                if (this.m_nFixedRanderHeightLimit != 0 && height2 < this.m_nFixedRanderHeightLimit) {
                    var width2 = height / this.m_nFixedRanderHeightLimit * fixedRenderWidth;
                    root.SetSize(fixedRenderWidth, this.m_nFixedRanderHeightLimit);
                    root.SetScale3D(width2 / fixedRenderWidth, width2 / fixedRenderWidth, width2 / fixedRenderWidth);
                    root.positionX = (width - width2) / 2;
                }
                else {
                    root.SetSize(fixedRenderWidth, height2);
                    root.SetScale3D(width / fixedRenderWidth, width / fixedRenderWidth, width / fixedRenderWidth);
                    root.positionX = 0;
                }
            }
            else if (fixedRenderHeight != 0) {
                root.SetSize(width / height * fixedRenderHeight, fixedRenderHeight);
                root.SetScale3D(height / fixedRenderHeight, height / fixedRenderHeight, height / fixedRenderHeight);
            }
        }
    };
    dThread.prototype.OnFrameWindowResize = function (width, height) {
    };
    dThread.prototype.OnFrameTouchEvent = function (type, id, x, y, delta) {
    };
    dThread.prototype.OnFrameActive = function (bActive) {
    };
    dThread.SetAdRewardedLoadingCallback = function (callback) {
    };
    dThread.isWindowActive = function () {
        return dInterface.ptr.m_bWindowActive;
    };
    dThread.OpenWebPage = function (url) {
        dInterface.ptr.OpenWebPage(url);
    };
    dThread.ShowHtmlDialog = function (fileName) {
        dInterface.ptr.ShowHtmlDialog(fileName);
    };
    dThread.ShowMarketplaceDetailTask = function () {
    };
    dThread.GetDeviceInfo = function (arg) {
        return "";
    };
    dThread.GetSdkName = function () {
        return dInterface.ptr.GetSdkName();
    };
    dThread.GetChannelName = function () {
        return dInterface.ptr.GetChannelName();
    };
    dThread.GetUserDeviceId = function () {
        return dInterface.ptr.GetUserDeviceId();
    };
    dThread.GetSafeAreaTop = function () {
        return dInterface.ptr.GetSafeAreaTop() / dThread.GetRootSprite().scaleY;
    };
    dThread.GetSafeAreaBottom = function () {
        return dInterface.ptr.GetSafeAreaBottom() / dThread.GetRootSprite().scaleY;
    };
    dThread.GetPackageVersionCode = function () {
        return dInterface.ptr.GetPackageVersionCode();
    };
    dThread.GetPackageName = function () {
        return dInterface.ptr.GetPackageName();
    };
    dThread.MarketplaceReviewTask = function () {
    };
    return dThread;
}(dObject));
var Main = (function (_super) {
    __extends(Main, _super);
    function Main() {
        var _this = _super.call(this) || this;
        console.log("Main Start");
        dLabel.s_globalFontOffsetY = 0.2;
        dInterface.ptr.SetMultiTouchPointCount(0);
        _this.SetFixedRenderSize(1080, 1920);
        _this.InitUi();
        _this.InitGame();
        return _this;
    }
    Main.prototype.OnFrameActive = function (bActive) {
        _super.prototype.OnFrameActive.call(this, bActive);
    };
    Main.prototype.InitGame = function () {
        var _this = this;
        var pUpdatePanel = new UpdatePanel();
        this.AddChild(pUpdatePanel);
        pUpdatePanel.LayoutToSize(dThread.GetWindowWidth(), dThread.GetWindowHeight());
        pUpdatePanel.OnPrivacyAgree(function () {
            MyAd.InitMyAd(GDefine.MyAppName);
            dInterface.ptr.LoadSubPackage(["data", "level"], function () {
                SaveData.Instance().Load(function () {
                    GameWorld.Perload(function () {
                        pUpdatePanel.OnProgressComplete(function () {
                            var pPageManager = new PageManager();
                            _this.AddChild(pPageManager);
                            PageManager.Instance().SetSize(dThread.GetWindowWidth(), dThread.GetWindowHeight());
                            PageManager.Instance().Init();
                            pUpdatePanel.RemoveParent();
                            SaveData.Instance().UpdateSound();
                            dSound.PlaySound("data/sound/window.mp3");
                            pPageManager.ChangePage(LoginPage, null, null, true, null, false);
                        });
                    });
                });
            });
        });
    };
    Main.prototype.OnFrameWindowResize = function (width, height) {
        if (PageManager.Instance() != null)
            PageManager.Instance().SetSize(width, height);
    };
    Main.prototype.InitUi = function () {
        dControlLoader.SetOnCreateConsole(function (className) {
            switch (className) {
                case "AddKeyPanel": return new AddKeyPanel();
                case "ShiLingButton": return new ShiLingButton();
                case "MyAdBanner": return new MyAdBanner();
                case "LightEff": return new LightEff();
                case "StageBar": return new StageBar();
                case "EnergyBar": return new EnergyBar();
            }
            return null;
        });
    };
    return Main;
}(dThread));
setTimeout(function () {
    dObject.CallInitStatic();
    dInterface.ptr.InitUserDeviceId(function () {
        new Main();
    });
});
var MessageBoxPanel = (function (_super) {
    __extends(MessageBoxPanel, _super);
    function MessageBoxPanel(id, bHasClose, onOk, onClose) {
        if (bHasClose === void 0) { bHasClose = false; }
        if (onOk === void 0) { onOk = null; }
        if (onClose === void 0) { onClose = null; }
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.SetHandleMouse(true);
        if (!bHasClose)
            _this.Panel_CloseButton.visible = false;
        _this.Panel_Title_TitleText.text = "";
        _this.Panel_OkButton_Text.text = "";
        if (id == MessageBoxPanel.Type_NotEnouphGold) {
            _this.Panel_Text.text = "";
        }
        else if (id == MessageBoxPanel.Type_NotEnouphGem) {
            _this.Panel_Text.text = "";
        }
        else if (id == MessageBoxPanel.Type_NotEnouphNut) {
            _this.Panel_Text.text = "";
        }
        else if (id == MessageBoxPanel.Type_NotEnouphDiamond) {
            _this.Panel_Text.text = "";
        }
        _this.Panel_OkButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/window.mp3");
            PageManager.Instance().ClosePanel(null, _this);
            if (onOk != null)
                onOk(_this);
        }));
        _this.Panel_CloseButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/window.mp3");
            PageManager.Instance().ClosePanel(null, _this);
            if (onClose != null)
                onClose(_this);
        }));
        return _this;
    }
    MessageBoxPanel.prototype._dscData = function () { return { "_child": [{ "_child": [{ "align": 0, "anchorU": 0.5, "anchorV": 0.5, "autoWrap": 1, "className": "Text", "classType": "dBitmapFont", "fontSize": 48, "height": 48.75, "resourceFileName": "data/font64.json", "spriteColor": -10592674, "text": "aaa", "width": 762, "x": 0, "y": -62 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 40, "height": 40.625, "resourceFileName": "data/font64.json", "spriteColor": -12632257, "text": "OK", "width": 53.125, "x": 0, "y": -5 }], "anchorU": 0.5, "anchorV": 0.5, "className": "OkButton", "classType": "dButtonScale9", "height": 106, "resourceFileName": "data/button1.png", "width": 279, "x": 0, "y": 217.5 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "TitleText", "classType": "dBitmapFont", "fontSize": 64, "height": 78, "resourceFileName": "data/font64.json", "text": "Tip", "width": 80, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Title", "classType": "dImage", "height": 144, "resourceFileName": "data/title.png", "width": 590, "x": 0, "y": -372.5 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "MyAdPanel", "classType": "MyAdBanner", "height": 300, "width": 944, "x": 0, "y": 742 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton", "classType": "dButton", "height": 98, "resourceFileName": "data/closebutton.png", "width": 98, "x": 441, "y": -371 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Panel", "classType": "dScale9", "height": 800, "resourceFileName": "data/window.png", "width": 944, "x": 540, "y": 936.5 }], "anchorU": 0, "anchorV": 0, "className": "StageClearPanel", "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": 1124073472, "width": 1080, "x": 0, "y": 0 }; };
    MessageBoxPanel.Type_Need2Animals = 1;
    MessageBoxPanel.Type_UnlockWorldMap = 2;
    MessageBoxPanel.Type_NotEnouphGold = 3;
    MessageBoxPanel.Type_NotEnouphGem = 4;
    MessageBoxPanel.Type_NotEnouphNut = 5;
    MessageBoxPanel.Type_NotEnouphDiamond = 6;
    return MessageBoxPanel;
}(dImage));
var MyAdBanner = (function (_super) {
    __extends(MyAdBanner, _super);
    function MyAdBanner() {
        var _this = _super.call(this) || this;
        _this.visible = false;
        if (MyAdBanner.lastCloseBannerTime == -123)
            MyAdBanner.lastCloseBannerTime = -MyAd.GetBannerStepTime();
        new dTimer().Create(50, 0, function (sender) {
            var curTime = dTimer.GetTickCount();
            if (_this.GetParent() != null && _this.GetParent().isShowInRoot()) {
                if (!MyAd.isShowAdBanner() && curTime >= MyAdBanner.lastCloseBannerTime + MyAd.GetBannerStepTime()) {
                    MyAd.ShowAdBanner(true);
                }
            }
            else {
                if (MyAd.isShowAdBanner()) {
                    sender.Stop();
                    MyAdBanner.lastCloseBannerTime = curTime;
                    MyAd.ShowAdBanner(false);
                }
            }
        });
        return _this;
    }
    MyAdBanner.prototype._dscData = function () { return { "anchorU": 0, "anchorV": 0, "classType": "dSprite", "height": 270, "width": 1080, "x": 0, "y": 0 }; };
    MyAdBanner.lastCloseBannerTime = -123;
    return MyAdBanner;
}(dSprite));
var PageManager = (function (_super) {
    __extends(PageManager, _super);
    function PageManager() {
        var _this = _super.call(this) || this;
        _this.m_pCurrentPage = null;
        _this.m_pChangeCover = new dImage();
        _this.m_pBallonLayer = new dSprite();
        _this.m_pHandleMousePanel = null;
        _this.m_pTopLayer = new dSprite();
        _this.m_fAddBallonTime = 60;
        _this.m_pConnectingPage = null;
        PageManager.s_pInstance = _this;
        _this.m_pChangeCover.SetAnchor(0, 0);
        _this.m_pChangeCover.pureColor = true;
        _this.m_pChangeCover.spriteColor = 0;
        _this.m_pChangeCover.alpha = 1;
        _this.m_pChangeCover.SetHandleMouse(true);
        _this.m_pChangeCover.visible = false;
        _this.AddChild(_this.m_pChangeCover);
        _this.m_pHandleMousePanel = new dImage();
        _this.m_pHandleMousePanel.SetAnchor(0, 0);
        _this.m_pHandleMousePanel.pureColor = true;
        _this.m_pHandleMousePanel.spriteColor = 0;
        _this.m_pHandleMousePanel.alpha = 1;
        _this.m_pHandleMousePanel.SetHandleMouse(true);
        _this.m_pHandleMousePanel.visible = false;
        _this.AddChild(_this.m_pBallonLayer);
        _this.AddChild(_this.m_pTopLayer);
        _this.AddChild(_this.m_pHandleMousePanel);
        return _this;
    }
    PageManager.prototype.Init = function () {
        var _this = this;
        var nowLongTime = dDateTime.NowTime().ToLongTime();
        if (SaveData.Instance().saveTime != 0) {
            var subTime = nowLongTime - SaveData.Instance().saveTime;
            if (subTime > 0) {
                var offlineTime = subTime / 1000;
                this.PassTime(offlineTime);
            }
        }
        new dTimer(this).Create(0, 0, function (sender, iTimer, fTimer) {
            _this.PassTime(fTimer);
        });
        new dTimer(this).Create(1000, 0, function () {
            SaveData.Instance().saveTime = dDateTime.NowTime().ToLongTime();
        }).Apply();
        new dTimer(this).Create(60000, 0, function () {
            SaveData.Instance().WriteToDisk();
        });
        dThread.SetAdRewardedLoadingCallback(function (sender) {
            var isShow = sender;
            if (isShow) {
                if (_this.m_pConnectingPage == null) {
                    _this.m_pConnectingPage = new ConnectingPage();
                    _this.AddChild(_this.m_pConnectingPage);
                }
            }
            else {
                if (_this.m_pConnectingPage != null) {
                    _this.m_pConnectingPage.RemoveParent();
                    _this.m_pConnectingPage = null;
                }
            }
        });
        PrivacyDialog.ShowPrivacyDialog();
    };
    PageManager.prototype.PassTime = function (fTimer) {
        if (SaveData.Instance().energy < GDefine.MAX_ENERGY) {
            SaveData.Instance().energyAddTime += fTimer;
            while (SaveData.Instance().energyAddTime > GDefine.ADD_ENERGY_TIME && SaveData.Instance().energy < GDefine.MAX_ENERGY) {
                SaveData.Instance().energyAddTime -= GDefine.ADD_ENERGY_TIME;
                SaveData.Instance().energy++;
                PageManager.Instance().UpdateCurPage();
                SaveData.Instance().WriteToDisk();
            }
        }
        else {
            SaveData.Instance().energyAddTime = 0;
        }
    };
    PageManager.prototype.SubEnergy = function (onComplete, bCheckOnly) {
        if (bCheckOnly === void 0) { bCheckOnly = false; }
        if (!GDefine.EnableEnergy) {
            if (onComplete != null)
                onComplete(this);
        }
        else {
            if (SaveData.Instance().energy <= 0) {
                PageManager.Instance().OpenPanel(null, new AddEnergyPanel());
            }
            else {
                if (!bCheckOnly) {
                    SaveData.Instance().energy--;
                    SaveData.Instance().WriteToDisk();
                    this.UpdateCurPage();
                }
                if (onComplete != null)
                    onComplete(this);
            }
        }
    };
    PageManager.prototype.GetTopLayer = function () {
        return this.m_pTopLayer;
    };
    PageManager.prototype.isInTop = function (p) {
        var vec = this.m_pTopLayer.GetChildList();
        if (vec.length > 0 && vec.last() == p && this.m_pConnectingPage == null)
            return true;
        return false;
    };
    PageManager.Instance = function () {
        return PageManager.s_pInstance;
    };
    PageManager.prototype.ShowTip = function (text) {
        dSound.PlaySound("data/sound/button.mp3");
        var tipBar = new TipBar(text);
        this.m_pTopLayer.AddChild(tipBar);
    };
    PageManager.prototype.OpenPanel = function (HandleMousePanel, panel, onComplete, bAni) {
        if (onComplete === void 0) { onComplete = null; }
        if (bAni === void 0) { bAni = true; }
        if (bAni) {
            _super.prototype.OpenPanel.call(this, this.m_pHandleMousePanel, panel, onComplete);
            this.m_pTopLayer.AddChild(panel);
        }
        else {
            panel.LayoutToSize(this.width, this.height);
            this.m_pTopLayer.AddChild(panel);
        }
    };
    PageManager.prototype.ClosePanel = function (HandleMousePanel, panel, onComplete, bAni) {
        var _this = this;
        if (onComplete === void 0) { onComplete = null; }
        if (bAni === void 0) { bAni = true; }
        if (bAni) {
            _super.prototype.ClosePanel.call(this, this.m_pHandleMousePanel, panel, function () {
                panel.RemoveParent();
                if (onComplete != null)
                    onComplete(_this);
            });
        }
        else {
            panel.RemoveParent();
            panel.Destroy();
            if (onComplete != null)
                onComplete(this);
        }
    };
    PageManager.prototype.ChangeScreenFadeIn = function (onComplete, bPlayAni, isTurnBack) {
        this.m_pChangeCover.SetSize(dThread.GetWindowWidth(), dThread.GetWindowHeight());
        this.m_pChangeCover.visible = true;
        if (bPlayAni && this.m_pCurrentPage != null)
            this.m_pCurrentPage.FadeInOut(false, onComplete, isTurnBack);
        else if (onComplete != null)
            onComplete(this);
    };
    PageManager.prototype.ChangeScreenFadeOut = function (onComplete, bPlayAni, isTurnBack) {
        this.m_pChangeCover.SetSize(dThread.GetWindowWidth(), dThread.GetWindowHeight());
        if (bPlayAni && this.m_pCurrentPage != null)
            this.m_pCurrentPage.FadeInOut(true, onComplete, isTurnBack);
        else if (onComplete != null)
            onComplete(this);
    };
    PageManager.prototype.ChangePage = function (className, arg, onRemove, bPlaySound, onComplete, bPlayAni, bTurnBack) {
        var _this = this;
        if (arg === void 0) { arg = null; }
        if (onRemove === void 0) { onRemove = null; }
        if (bPlaySound === void 0) { bPlaySound = true; }
        if (onComplete === void 0) { onComplete = null; }
        if (bPlayAni === void 0) { bPlayAni = true; }
        if (bTurnBack === void 0) { bTurnBack = false; }
        SaveData.Instance().WriteToDisk();
        this.ChangeScreenFadeIn(function () {
            if (_this.m_pCurrentPage != null && (_this.m_pCurrentPage.isFadeOutRemove() || !bPlayAni)) {
                _this.m_pCurrentPage.Destroy();
                _this.m_pCurrentPage.RemoveParent();
            }
            if (onRemove != null)
                onRemove(_this);
            var pCurrentPage = new className(arg);
            _this.AddChild(pCurrentPage);
            if (_this.m_pCurrentPage != null && !_this.m_pCurrentPage.isFadeOutRemove() && bTurnBack) {
                _this.AddChild(_this.m_pCurrentPage);
            }
            _this.m_pCurrentPage = pCurrentPage;
            _this.AddChild(_this.m_pChangeCover);
            _this.AddChild(_this.m_pBallonLayer);
            _this.AddChild(_this.m_pTopLayer);
            if (_this.m_pConnectingPage != null)
                _this.AddChild(_this.m_pConnectingPage);
            _this.AddChild(_this.m_pHandleMousePanel);
            var width = dThread.GetWindowWidth();
            var height = dThread.GetWindowHeight();
            _this.m_pCurrentPage.LayoutToSize(width, height);
            _this.ChangeScreenFadeOut(function () {
                _this.m_pChangeCover.visible = false;
                _this.m_pCurrentPage.OnFadeFinish();
            }, bPlayAni, bTurnBack);
            if (onComplete != null)
                onComplete(_this.m_pCurrentPage);
        }, bPlayAni, bTurnBack);
    };
    PageManager.prototype.GetCurrentPage = function () {
        return this.m_pCurrentPage;
    };
    PageManager.prototype.UpdateCurPage = function () {
        if (this.m_pCurrentPage != null)
            this.m_pCurrentPage.Update();
    };
    PageManager.prototype.SetSize = function (w, h) {
        _super.prototype.SetSize.call(this, w, h);
        if (this.m_pCurrentPage != null)
            this.m_pCurrentPage.LayoutToSize(w, h);
        if (this.m_pHandleMousePanel != null)
            this.m_pHandleMousePanel.SetSize(w, h);
        if (this.m_pTopLayer != null)
            this.m_pTopLayer.LayoutToSize(w, h);
    };
    PageManager.s_pInstance = null;
    return PageManager;
}(BasePage));
var PrivacyDialog = (function (_super) {
    __extends(PrivacyDialog, _super);
    function PrivacyDialog(showYinSi, showYongHu) {
        if (showYinSi === void 0) { showYinSi = false; }
        if (showYongHu === void 0) { showYongHu = false; }
        var _this = _super.call(this) || this;
        _this.m_bShowYongHu = false;
        _this.m_PrivacyLines = null;
        _this.m_YongHuLines = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.SetHandleMouse(true);
        _this.Panel2.SetHandleMouse(true);
        _this.Panel2.visible = false;
        _this.Panel_Window_YinSiButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.ShowYinSi();
        }));
        _this.Panel_Window_yongHuButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.ShowYongHu();
        }));
        _this.Panel2_BackButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            if (showYinSi || showYongHu)
                PageManager.Instance().ClosePanel(null, _this, null, false);
            else
                _this.Panel2.visible = false;
        }));
        _this.Panel_Window_YesButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dByteArray.WriteStorage(GDefine.MyAppName + "_privacy_agree_", "1");
            _this.RemoveParent();
        }));
        _this.Panel_Window_NoButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dInterface.ptr.ExitApp();
        }));
        _this.m_PrivacyLines = _this.TextToLines(_this.PrivacyText());
        _this.m_YongHuLines = _this.TextToLines(_this.YongHuText());
        for (var i = 0; i < 40; i++) {
            var bar = new dSprite();
            bar.SetSize(_this.Panel2_ListBox.width, 60);
            var label = new dLabel();
            label.SetAnchor(0, 0);
            label.spriteColor = 0xff000000;
            label.fontSize = 40;
            bar.AddChild(label);
            bar.userData = label;
            _this.Panel2_ListBox.AddChild(bar);
        }
        _this.Panel2_ListBox.SetEvent(new dEvent().SetOnListShowVirtualChild(function (sender, childIndex, virtualIndex) {
            var label = _this.Panel2_ListBox.GetChildListAt(childIndex).userData;
            if (_this.m_bShowYongHu)
                label.text = virtualIndex < _this.m_YongHuLines.length ? _this.m_YongHuLines[virtualIndex] : "";
            else
                label.text = virtualIndex < _this.m_PrivacyLines.length ? _this.m_PrivacyLines[virtualIndex] : "";
        }));
        if (showYinSi)
            _this.ShowYinSi();
        else if (showYongHu)
            _this.ShowYongHu();
        return _this;
    }
    PrivacyDialog.prototype._dscData = function () { return { "_child": [{ "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "autoWrap": 1, "className": "Text", "classType": "dLabel", "fontSize": 36, "height": 432, "spriteColor": -6589434, "text": "\n\n\n\n", "width": 755, "x": 6.5, "y": -2 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 52, "height": 52, "spriteColor": -14716416, "text": "", "width": 106, "x": 0, "y": -17 }], "anchorU": 0.5, "anchorV": 0.5, "className": "YesButton", "classType": "dButtonScale9", "height": 128, "resourceFileName": "data/button1.png", "width": 300, "x": 185, "y": 530.210266 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 40, "height": 40, "spriteColor": -16777216, "text": "", "width": 82, "x": 0, "y": -13 }], "anchorU": 0.5, "anchorV": 0.5, "className": "NoButton", "classType": "dButtonScale9", "height": 128, "resourceFileName": "data/button1.png", "width": 300, "x": -185.360535, "y": 532.157654 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Title", "classType": "dLabel", "fontSize": 64, "height": 64, "spriteColor": -6927597, "text": "", "width": 260, "x": 0, "y": -361 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -12434878, "text": "", "width": 132, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Line", "classType": "dImage", "height": 3, "pureColor": 1, "spriteColor": -12434878, "width": 150, "x": 0, "y": 21 }], "anchorU": 0.5, "anchorV": 0.5, "className": "YinSiButton", "classType": "dButton", "height": 80, "resourceFileName": "", "width": 220, "x": -142.5, "y": 317 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -12434878, "text": "", "width": 132, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Line", "classType": "dImage", "height": 3, "pureColor": 1, "spriteColor": -12434878, "width": 150, "x": 0, "y": 21 }], "anchorU": 0.5, "anchorV": 0.5, "className": "yongHuButton", "classType": "dButton", "height": 80, "resourceFileName": "", "width": 220, "x": 142, "y": 317 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Window", "classType": "dScale9", "height": 884, "resourceFileName": "data/window.png", "width": 956, "x": 540, "y": 902 }], "anchorU": 0, "anchorV": 0, "className": "Panel", "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": -2147483648, "width": 1080, "x": 0, "y": 0 }, { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 10, "pureColor": 1, "rotation": -40, "spriteColor": -16777216, "width": 60, "x": -6, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 10, "pureColor": 1, "rotation": 40, "spriteColor": -16777216, "width": 60, "x": -6, "y": 20 }], "anchorU": 0.5, "anchorV": 0.5, "className": "BackButton", "classType": "dButton", "height": 150, "layoutAlignH": 1, "layoutAlignV": 1, "resourceFileName": "", "width": 150, "x": 113, "y": 148, "z": 3.87344 }, { "anchorU": 0, "anchorV": 0, "canDragH": 0, "canDragV": 1, "className": "ListBox", "classType": "dListBox", "clipChild": 1, "height": 1676, "layoutAlignV": 5, "vertical": 1, "viewPosX": 0, "viewPosY": 0, "width": 1000, "x": 39, "y": 248 }], "anchorU": 0, "anchorV": 0, "className": "Panel2", "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "visible": 0, "width": 1080, "x": 0, "y": 0 }], "anchorU": 0, "anchorV": 0, "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": 2113929216, "width": 1080, "x": 0, "y": 0 }; };
    PrivacyDialog.prototype.ShowYinSi = function () {
        this.Panel2.visible = true;
        this.m_bShowYongHu = false;
        this.Panel2_ListBox.SetVirtualChildCount(this.m_PrivacyLines.length);
        this.Panel2_ListBox.ScrollToTop(false);
        this.Panel2_ListBox.UpdateVirtualChild();
    };
    PrivacyDialog.prototype.ShowYongHu = function () {
        this.Panel2.visible = true;
        this.m_bShowYongHu = true;
        this.Panel2_ListBox.SetVirtualChildCount(this.m_YongHuLines.length);
        this.Panel2_ListBox.ScrollToTop(false);
        this.Panel2_ListBox.UpdateVirtualChild();
    };
    PrivacyDialog.ShowPrivacyDialog = function () {
        if (MyAd.isNeedShowPrivacyDialog()) {
            dByteArray.ReadStorage(GDefine.MyAppName + "_privacy_agree_", function (res) {
                if (res != "1") {
                    PageManager.Instance().OpenPanel(null, new PrivacyDialog(), null, false);
                }
            });
        }
    };
    PrivacyDialog.prototype.TextToLines = function (str) {
        var ret = new Array();
        var split = str.split("\n");
        var textCountPerLine = 25;
        for (var i = 0; i < split.length; i++) {
            var str2 = split[i];
            if (str2.length > textCountPerLine) {
                for (var j = 0; j < str2.length; j += textCountPerLine)
                    ret.push(str2.substring(j, j + textCountPerLine));
            }
            else
                ret.push(str2);
        }
        return ret;
    };
    PrivacyDialog.prototype.PrivacyText = function () {
        var str = "\n" +
            "20211215\n" +
            "20211215\n" +
            "\n" +
            "\"\"\"\"\"\")\n" +
            "\n" +
            "\n" +
            ":\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            ":\n" +
            "1.\n" +
            "2.\n" +
            "3.\n" +
            "4.\n" +
            "\n" +
            ":\n" +
            "1.\n" +
            "IMEIWLAN\n" +
            "2.\n" +
            "\n" +
            "3.\n" +
            "\n" +
            "4.\n" +
            "SDK\n" +
            "APP\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "1.;\n" +
            "2.\n" +
            "3.\n" +
            "4.\n" +
            "5.\n" +
            "6.\n" +
            "7.\n" +
            "8.\n" +
            "9.\n" +
            "10.\n" +
            "11.\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "1.\n" +
            "\n" +
            "\n" +
            "2.\n" +
            "1\n" +
            "2\n" +
            "3.\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "1.\n" +
            "2.\n" +
            "3.\n" +
            "4.\n" +
            "5.\n" +
            "6.\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "createmaster@hotmail.com30\n" +
            "createmaster@hotmail.com\n" +
            "\n" +
            "\n" +
            "18\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\n" +
            "\ncreatemaster@hotmail.com\n";
        if (dThread.GetSdkName() == "qq")
            str += "16-1315\n";
        return str;
    };
    PrivacyDialog.prototype.YongHuText = function () {
        return "\n" +
            "\n" +
            "1.\n" +
            "1.1.1818\n" +
            "1.2.\n" +
            "1.3.\n" +
            "1.4.\n" +
            "1.5.\n" +
            "(1)\n" +
            "(2)\n" +
            "(3)\n" +
            "(4)\n" +
            "(5)\n" +
            "(6)\n" +
            "(7)\n" +
            "(8)\n" +
            "(9)\n" +
            "1.6.\n" +
            "1.7.\n" +
            "1.8.\n" +
            "1.9.\n" +
            "1.10.\n" +
            "1.11.\n" +
            "2.\n" +
            "2.1.\n" +
            "2.2.\n" +
            "2.3.\n" +
            "3.\n" +
            "3.1.\n" +
            "3.2.\n" +
            "4.\n" +
            "4.1.\n" +
            "4.2.\n" +
            "1()/();URL;\n" +
            "2;\n" +
            "3()/();\n" +
            "4\n" +
            "5\n" +
            "5.\n" +
            "5.1.\n" +
            "5.2.\n" +
            "5.3.\n" +
            "6.\n" +
            "6.1.\n" +
            "6.2.\n" +
            "7.\n" +
            "7.1.\n" +
            "7.2.60\n" +
            "7.3.\n";
    };
    return PrivacyDialog;
}(dImage));
var SaveData = (function () {
    function SaveData() {
        this.m_nVersion = 0;
        this.enableSound = true;
        this.enableMusic = true;
        this.m_nGold = 0;
        this.passStage = 0;
        this.vip = 0;
        this.energy = 9;
        this.energyAddTime = 0;
        this.saveTime = 0;
        this.gem = 0;
    }
    SaveData.prototype._LoadJson = function (onComplete) {
        dByteArray.ReadStorage(GDefine.MyAppName + "_savedata", onComplete);
    };
    SaveData.prototype.Load = function (onComplete) {
        var _this = this;
        this._LoadJson(function (res) {
            if (res) {
                var json = JSON.parse(res);
                for (var key in _this) {
                    if (json.hasOwnProperty(key)) {
                        var type = typeof (_this[key]);
                        if (type == "string") {
                            _this[key] = String(json[key]);
                        }
                        else if (type == "boolean") {
                            _this[key] = Boolean(json[key]);
                        }
                        else if (type == "number") {
                            _this[key] = dMath.ParseFloat(json[key]);
                        }
                        else
                            _this[key] = json[key];
                    }
                }
                onComplete();
            }
            else
                onComplete();
        });
    };
    SaveData.Instance = function () {
        if (!SaveData.s_pInstance)
            SaveData.s_pInstance = new SaveData();
        return SaveData.s_pInstance;
    };
    SaveData.prototype.UpdateSound = function () {
        if (this.enableSound) {
            dSound.SetGlobalSoundVolume(1);
        }
        else {
            dSound.SetGlobalSoundVolume(0);
        }
        if (this.enableMusic) {
            dSound.SetGlobalMusicVolume(1);
        }
        else {
            dSound.SetGlobalMusicVolume(0);
        }
    };
    SaveData.prototype.WriteToDisk = function () {
        var _this = this;
        if (!SaveData.s_saveTimer) {
            SaveData.s_saveTimer = new dTimer().Create(1000, 1, function () {
                SaveData.s_saveTimer = null;
                var str = JSON.stringify(_this);
                dByteArray.WriteStorage(GDefine.MyAppName + "_savedata", str);
            });
        }
    };
    Object.defineProperty(SaveData.prototype, "gold", {
        get: function () {
            return this.m_nGold;
        },
        set: function (value) {
            this.m_nGold = value;
        },
        enumerable: false,
        configurable: true
    });
    SaveData.s_pInstance = null;
    SaveData.s_saveTimer = null;
    return SaveData;
}());
var dButton = (function (_super) {
    __extends(dButton, _super);
    function dButton() {
        var _this = _super.call(this) || this;
        _this.m_bCheckPixel = false;
        _this.m_bButtonDown = false;
        _this.m_pNormal = null;
        _this.m_pTouchDown = null;
        _this.m_pDisable = null;
        _this.m_fTouchDownX = 0;
        _this.m_fTouchDownY = 0;
        _this.m_bToggle = false;
        _this.m_bToggleDowned = false;
        _this.touchDownScaleMode = true;
        _this.m_bTouchDownScaled = false;
        _this.SetHandleMouse(true);
        return _this;
    }
    dButton.prototype.SetTouchDownScaleMode = function (bScaleMode) {
        this.touchDownScaleMode = bScaleMode;
    };
    Object.defineProperty(dButton.prototype, "resourceFileName", {
        get: function () {
            return this.GetFileName();
        },
        set: function (fileName) {
            this.LoadFromFile(fileName, false);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dButton.prototype, "downImage", {
        get: function () {
            return this.GetTouchDownFileName();
        },
        set: function (fileName) {
            this.LoadTouchDownFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dButton.prototype, "disableImage", {
        get: function () {
            return this.GetDisableFileName();
        },
        set: function (fileName) {
            this.LoadDisableFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dButton.prototype, "toggleMode", {
        get: function () {
            return this.m_bToggle;
        },
        set: function (bSet) {
            this.m_bToggle = bSet;
        },
        enumerable: false,
        configurable: true
    });
    dButton.prototype.SetSize = function (w, h) {
        _super.prototype.SetSize.call(this, w, h);
        if (this.m_pNormal != null)
            this.m_pNormal.SetSize(w, h);
        if (this.m_pTouchDown != null)
            this.m_pTouchDown.SetSize(w, h);
        if (this.m_pDisable != null)
            this.m_pDisable.SetSize(w, h);
    };
    dButton.prototype.SetColor = function (colorARGB, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetColor.call(this, colorARGB, bSetToChild);
        if (!bSetToChild) {
            if (this.m_pNormal != null)
                this.m_pNormal.SetColor(colorARGB);
            if (this.m_pTouchDown != null)
                this.m_pTouchDown.SetColor(colorARGB);
            if (this.m_pDisable != null)
                this.m_pDisable.SetColor(colorARGB);
        }
    };
    dButton.prototype.SetAlpha = function (alpha, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetAlpha.call(this, alpha, bSetToChild);
        if (!bSetToChild) {
            if (this.m_pNormal != null)
                this.m_pNormal.SetAlpha(alpha, false);
            if (this.m_pTouchDown != null)
                this.m_pTouchDown.SetAlpha(alpha, false);
            if (this.m_pDisable != null)
                this.m_pDisable.SetAlpha(alpha, false);
        }
    };
    dButton.prototype.SetGray = function (bGray, bWithChild) {
        if (bGray === void 0) { bGray = true; }
        if (bWithChild === void 0) { bWithChild = false; }
        _super.prototype.SetGray.call(this, bGray, bWithChild);
        if (!bWithChild) {
            if (this.m_pNormal != null)
                this.m_pNormal.SetGray(bGray, bWithChild);
            if (this.m_pTouchDown != null)
                this.m_pTouchDown.SetGray(bGray, bWithChild);
            if (this.m_pDisable != null)
                this.m_pDisable.SetGray(bGray, bWithChild);
        }
    };
    dButton.prototype.CreateImage = function () {
        return new dImage();
    };
    dButton.prototype.SetSizeAsImage = function () {
        if (this.m_pNormal != null && this.m_pNormal.GetBitmapData() != null)
            this.SetSize(this.m_pNormal.GetBitmapData().GetWidth(), this.m_pNormal.GetBitmapData().GetHeight());
    };
    dButton.prototype.LoadFromFile = function (strImage, bAutoResize, onComplete) {
        if (bAutoResize === void 0) { bAutoResize = true; }
        if (onComplete === void 0) { onComplete = null; }
        var a = this;
        if (strImage == null)
            strImage = "";
        if (strImage != null && a.GetFileName() != strImage) {
            if (strImage != "") {
                if (a.m_pNormal == null) {
                    a.m_pNormal = a.CreateImage();
                    a.m_pNormal.spriteColor = a.spriteColor;
                    a.m_pNormal.SetAnchor(a.GetAnchorU(), a.GetAnchorV());
                    a.AddChild(a.m_pNormal, 0);
                }
                var bmp = new dBitmapData();
                bmp.LoadFromFile(strImage, function () {
                    a.m_pNormal.SetBitmapData(bmp);
                    if (bAutoResize) {
                        if (bmp != null && a.GetWidth() == 0 && a.GetHeight() == 0) {
                            a.m_pNormal.SetSize(bmp.GetWidth(), bmp.GetHeight());
                            a.SetSize(a.GetMaxWidth(), a.GetMaxHeight());
                        }
                    }
                    if (onComplete)
                        onComplete(a);
                });
                a.m_pNormal.SetBitmapData(bmp);
                if (!bAutoResize) {
                    a.m_pNormal.SetSize(a.width, a.height);
                }
            }
            else if (a.m_pNormal != null) {
                a.m_pNormal.RemoveParent();
                a.m_pNormal = null;
            }
        }
    };
    dButton.prototype.GetBitmapData = function (at) {
        if (at === void 0) { at = 0; }
        if (this.m_pNormal != null)
            return this.m_pNormal.GetBitmapData(at);
        return _super.prototype.GetBitmapData.call(this, at);
    };
    dButton.prototype.LoadTouchDownFromFile = function (strImage, bAutoResize, onComplete) {
        if (bAutoResize === void 0) { bAutoResize = true; }
        if (onComplete === void 0) { onComplete = null; }
        var a = this;
        if (strImage == null)
            strImage = "";
        if (strImage != null && a.GetTouchDownFileName() != strImage) {
            if (strImage != "") {
                if (a.m_pTouchDown == null) {
                    a.m_pTouchDown = a.CreateImage();
                    a.m_pTouchDown.spriteColor = a.spriteColor;
                    a.m_pTouchDown.SetAnchor(a.GetAnchorU(), a.GetAnchorV());
                    a.AddChild(a.m_pTouchDown, 0);
                }
                var bmp = new dBitmapData();
                bmp.LoadFromFile(strImage, function () {
                    a.m_pTouchDown.SetBitmapData(bmp);
                    if (bAutoResize) {
                        if (bmp != null) {
                            a.m_pTouchDown.SetSize(bmp.GetWidth(), bmp.GetHeight());
                            a.SetSize(a.GetMaxWidth(), a.GetMaxHeight());
                        }
                    }
                    if (onComplete)
                        onComplete(a);
                });
                a.m_pTouchDown.SetBitmapData(bmp);
                if (!bAutoResize) {
                    a.m_pTouchDown.SetSize(this.width, this.height);
                }
                a.m_pTouchDown.visible = false;
            }
            else if (a.m_pTouchDown != null) {
                a.m_pTouchDown.RemoveParent();
                a.m_pTouchDown = null;
            }
        }
    };
    dButton.prototype.LoadDisableFromFile = function (strImage, bAutoResize, onComplete) {
        if (bAutoResize === void 0) { bAutoResize = true; }
        if (onComplete === void 0) { onComplete = null; }
        var a = this;
        if (strImage == null)
            strImage = "";
        if (strImage != null && a.GetDisableFileName() != strImage) {
            if (strImage != "") {
                if (a.m_pDisable == null) {
                    a.m_pDisable = a.CreateImage();
                    a.m_pDisable.spriteColor = a.spriteColor;
                    a.m_pDisable.SetAnchor(a.GetAnchorU(), a.GetAnchorV());
                    a.AddChild(a.m_pDisable, 0);
                }
                var bmp = new dBitmapData();
                bmp.LoadFromFile(strImage, function () {
                    a.m_pDisable.SetBitmapData(bmp);
                    if (bAutoResize) {
                        if (bmp != null) {
                            a.m_pDisable.SetSize(bmp.GetWidth(), bmp.GetHeight());
                            a.SetSize(a.GetMaxWidth(), a.GetMaxHeight());
                        }
                    }
                    if (onComplete)
                        onComplete(a);
                });
                a.m_pDisable.SetBitmapData(bmp);
                if (!bAutoResize) {
                    a.m_pDisable.SetSize(this.width, this.height);
                }
            }
            else if (a.m_pDisable != null) {
                a.m_pDisable.RemoveParent();
                a.m_pDisable = null;
            }
        }
    };
    dButton.prototype.GetMaxWidth = function () {
        var a = this;
        var width = 0;
        if (a.m_pNormal != null && width < a.m_pNormal.width)
            width = a.m_pNormal.width;
        if (a.m_pTouchDown != null && width < a.m_pTouchDown.width)
            width = a.m_pTouchDown.width;
        if (a.m_pDisable != null && width < a.m_pDisable.width)
            width = a.m_pDisable.width;
        return width;
    };
    dButton.prototype.GetMaxHeight = function () {
        var a = this;
        var height = 0;
        if (a.m_pNormal != null && height < a.m_pNormal.height)
            height = a.m_pNormal.height;
        if (a.m_pTouchDown != null && height < a.m_pTouchDown.height)
            height = a.m_pTouchDown.height;
        if (a.m_pDisable != null && height < a.m_pDisable.height)
            height = a.m_pDisable.height;
        return height;
    };
    dButton.prototype.SetAnchor = function (u, v) {
        _super.prototype.SetAnchor.call(this, u, v);
        if (this.m_pNormal != null)
            this.m_pNormal.SetAnchor(u, v);
        if (this.m_pTouchDown != null)
            this.m_pTouchDown.SetAnchor(u, v);
        if (this.m_pDisable != null)
            this.m_pDisable.SetAnchor(u, v);
    };
    dButton.prototype.GetFileName = function () {
        if (this.m_pNormal && this.m_pNormal.GetBitmapData())
            return this.m_pNormal.GetBitmapData().GetResourceFileName();
        return "";
    };
    dButton.prototype.GetTouchDownFileName = function () {
        if (this.m_pTouchDown && this.m_pTouchDown.GetBitmapData())
            return this.m_pTouchDown.GetBitmapData().GetResourceFileName();
        return "";
    };
    dButton.prototype.GetDisableFileName = function () {
        if (this.m_pDisable && this.m_pDisable.GetBitmapData())
            return this.m_pDisable.GetBitmapData().GetResourceFileName();
        return "";
    };
    dButton.prototype.OnTouchDown = function (x, y, delta) {
        var a = this;
        if (a.isEnable()) {
            a.m_fTouchDownX = x;
            a.m_fTouchDownY = y;
            a.m_bButtonDown = true;
            if (a.m_pTouchDown == null) {
                if (a.touchDownScaleMode) {
                    if (!a.m_bTouchDownScaled) {
                        a.m_bTouchDownScaled = true;
                        a.SetScale(a.scaleX * 0.95, a.scaleY * 0.95);
                    }
                }
            }
            else {
                if (a.m_bToggle) {
                    a.m_bToggleDowned = !a.m_bToggleDowned;
                    a.m_pTouchDown.SetShow(a.m_bToggleDowned);
                }
                else {
                    a.m_pTouchDown.SetShow(true);
                    a.m_pNormal.SetShow(false);
                }
            }
            if (a.m_pEvent != null)
                a.m_pEvent.OnButtonDown(this);
        }
    };
    dButton.prototype.OnTouchUp = function (x, y) {
        var a = this;
        a.m_bButtonDown = false;
        if (a.m_pTouchDown != null && !a.m_bToggle) {
            this.m_pTouchDown.SetShow(false);
            this.m_pNormal.SetShow(true);
        }
        else {
            if (a.touchDownScaleMode) {
                if (a.m_bTouchDownScaled) {
                    a.m_bTouchDownScaled = false;
                    a.SetScale(a.scaleX / 0.95, a.scaleY / 0.95);
                }
            }
        }
        if (a.isEnable() && a.m_pEvent != null) {
            a.m_pEvent.OnButtonUp(this);
        }
    };
    dButton.prototype.SetButtonDown = function (bDown) {
        var a = this;
        if (a.m_bToggle) {
            a.m_bToggleDowned = bDown;
            if (a.m_pTouchDown != null)
                a.m_pTouchDown.SetShow(a.m_bToggleDowned);
        }
    };
    dButton.prototype.isButtonDown = function () {
        var a = this;
        if (a.m_bToggle)
            return a.m_bToggleDowned;
        return a.m_bButtonDown;
    };
    dButton.prototype.SetColorTransform = function (mat, bWithChild) {
        if (bWithChild === void 0) { bWithChild = false; }
        _super.prototype.SetColorTransform.call(this, mat, bWithChild);
        if (!bWithChild) {
            if (this.m_pDisable != null)
                this.m_pDisable.SetColorTransform(mat);
            if (this.m_pNormal != null)
                this.m_pNormal.SetColorTransform(mat);
            if (this.m_pTouchDown != null)
                this.m_pTouchDown.SetColorTransform(mat);
        }
    };
    dButton.prototype.SetEnable = function (b) {
        _super.prototype.SetEnable.call(this, b);
        if (this.m_pDisable != null)
            this.m_pDisable.SetShow(!b);
        if (this.m_pNormal != null)
            this.m_pNormal.SetShow(b || this.m_pDisable == null);
        if (this.m_pTouchDown != null)
            this.m_pTouchDown.SetShow(false);
    };
    dButton.prototype.LoadFromJson = function (j) {
        _super.prototype.LoadFromJson.call(this, j);
        if (j.hasOwnProperty("resourceFileName"))
            this.resourceFileName = j.resourceFileName;
        if (j.hasOwnProperty("downImage"))
            this.downImage = j.downImage;
        if (j.hasOwnProperty("disableImage"))
            this.disableImage = j.disableImage;
    };
    dButton.prototype.GetNormalImage = function () {
        return this.m_pNormal;
    };
    return dButton;
}(dBaseControl));
var ShiLingButton = (function (_super) {
    __extends(ShiLingButton, _super);
    function ShiLingButton() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.visible = MyAd.isNeedShowShiLing();
        _this.SetEvent(new dEvent().SetOnButtonDown(function () {
            var panel = new dImage();
            panel.SetAnchor(0, 0);
            panel.SetHandleMouse(true);
            panel.SetSize(1080, 1920);
            panel.pureColor = true;
            panel.spriteColor = 0x80000000;
            var image2 = new dImage();
            image2.LoadFromFile("img/hanzi-mz/loading/loading_8plustext.png");
            image2.SetPos(540, 955);
            panel.AddChild(image2);
            var pTouchEvent = new dSprite();
            pTouchEvent.OnTouchDown = function (x, y, delta) {
                panel.RemoveParent();
            };
            panel.SetTouchEvent(pTouchEvent);
            new dTimer(panel).Create(0, 0, function () {
                if (panel.GetParent() != null)
                    dThread.GetRootSprite().AddChild(panel);
            });
            dThread.GetRootSprite().AddChild(panel);
            panel.LayoutToSize(dThread.GetWindowWidth(), dThread.GetWindowHeight());
        }));
        return _this;
    }
    ShiLingButton.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 552, "resourceFileName": "img/hanzi-mz/loading/loading_8plus.png", "scaleX": 0.3, "scaleY": 0.3, "width": 432, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dButton", "height": 165, "resourceFileName": "", "width": 129, "x": 0, "y": 0 }; };
    return ShiLingButton;
}(dButton));
var TipBar = (function (_super) {
    __extends(TipBar, _super);
    function TipBar(text) {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.Text.text = text;
        _this.SetPos(PageManager.Instance().width / 2, PageManager.Instance().height / 2);
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCEaseBackOut(new CCMoveBy(0.5, 0, -150)),
            new CCDelayTime(0.8),
            new CCSpawn([
                new CCMoveBy(0.5, 0, -100),
                new CCFadeOut(0.5)
            ]),
            new CCRemoveSelf()
        ]), _this);
        return _this;
    }
    TipBar.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontFace": "", "fontSize": 40, "height": 40, "text": "", "width": 1, "x": 1, "y": -3 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 90, "resourceFileName": "data/tip.png", "width": 985, "x": 0, "y": 0 }; };
    return TipBar;
}(dImage));
var UpdatePanel = (function (_super) {
    __extends(UpdatePanel, _super);
    function UpdatePanel() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        dSound.StopMusic();
        _this.m_complateCallback = new dCompleteCallback(_this);
        _this.JianKang_Zhuzuo.visible = MyAd.isNeedShowZhuZuo();
        _this.JianKang_Zhuzuo_Text1.text = MyAd.GetZhuZuoName(GDefine.MyAppName);
        new dTimer(_this).Create(0, 0, function () {
            if (dThread.GetWindowWidth() != _this.width || dThread.GetWindowHeight() != _this.height) {
                _this.LayoutToSize(dThread.GetWindowWidth(), dThread.GetWindowHeight());
            }
        });
        _this.visible = false;
        dBitmapData.SetGlobalImageLoadComplete(function () {
            _this.visible = true;
        });
        return _this;
    }
    UpdatePanel.prototype._dscData = function () { return { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "Back", "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "resourceFileName": "img/hanzi-mz/loading/loadingback.png", "width": 1080, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Logo", "classType": "dImage", "height": 262, "resourceFileName": "img/hanzi-mz/loading/loading_logo.png", "width": 944, "x": 540, "y": 563 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "ProBk", "classType": "dScale9", "height": 37, "resourceFileName": "img/hanzi-mz/loading/loading_progress2.png", "spriteColor": -16777216, "width": 702, "x": 540, "y": 1426 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Progress", "classType": "dProgress", "height": 28, "resourceFileName": "img/hanzi-mz/loading/loading_progress1.png", "scale9Type": 1, "spriteColor": -18631, "width": 694, "x": 540, "y": 1426 }, { "_child": [{ "_child": [{ "anchorU": 0, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 32, "height": 33.333336, "resourceFileName": "img/hanzi-mz/loading/loadingfont64.json", "text": "2022SR1477047", "width": 226, "x": 216, "y": -5 }, { "anchorU": 0, "anchorV": 0.5, "className": "Text1", "classType": "dBitmapFont", "fontSize": 28, "height": 32.083332, "resourceFileName": "img/hanzi-mz/loading/loadingfont64.json", "text": "", "width": 280, "x": -286, "y": -1 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Zhuzuo", "classType": "dImage", "height": 29, "resourceFileName": "img/hanzi-mz/loading/loading_zhuzuo.png", "width": 847, "x": 0, "y": 104 }], "anchorU": 0.5, "anchorV": 0.5, "className": "JianKang", "classType": "dImage", "height": 118, "layoutAlignV": 2, "resourceFileName": "img/hanzi-mz/loading/loading_jiankang.png", "width": 955, "x": 540, "y": 1757 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Percent", "classType": "dBitmapFont", "fontSize": 48, "height": 49, "resourceFileName": "img/hanzi-mz/loading/loadingfont64.json", "text": "0%", "width": 63, "x": 540, "y": 1472 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dWindowRefrance1", "classType": "ShiLingButton", "layoutAlignV": 2, "x": 961, "y": 1612 }], "anchorU": 0, "anchorV": 0, "classType": "dSprite", "height": 1920, "width": 1080, "x": 0, "y": 0 }; };
    UpdatePanel.prototype.Start = function () {
        var _this = this;
        this.m_complateCallback.Add();
        new dTimer(this).Create(10, 101, function (sender, iTimer, fTimer) {
            _this.Progress.SetValueAndMax(iTimer, 100);
            _this.Percent.text = iTimer + "%";
            if (sender.isLastRepeat()) {
                new dTimer(_this).Create(500, 1, function () {
                    _this.m_complateCallback.DoComplete();
                });
            }
        }).Apply();
    };
    UpdatePanel.prototype.OnPrivacyAgree = function (onComplete) {
        var _this = this;
        this.Progress.SetValueAndMax(0, 100);
        this.Percent.text = "0%";
        new dTimer().Create(0, 0, function (sender) {
            if (dInterface.ptr.isPrivacyAgree()) {
                _this.Start();
                sender.Stop();
                onComplete(_this);
            }
        });
    };
    UpdatePanel.prototype.OnProgressComplete = function (onComplete) {
        this.m_complateCallback.SetCompleteFun(onComplete);
    };
    return UpdatePanel;
}(dImage));
var XmlLoader = (function () {
    function XmlLoader() {
        this.m_strName = "";
        this.m_mapAttribute = new Map();
        this.m_strData = "";
        this.m_vecChild = new Array();
        this.m_pFather = null;
        this.m_vecComment = null;
        this.m_mapHeader = null;
    }
    Object.defineProperty(XmlLoader.prototype, "child", {
        get: function () {
            return this.m_vecChild;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(XmlLoader.prototype, "name", {
        get: function () {
            return this.m_strName;
        },
        enumerable: false,
        configurable: true
    });
    XmlLoader.prototype.PaserToWord = function (str) {
        var ret = new Array();
        var start = -1;
        var end = -1;
        var bYinHaoSingle = false;
        var bYinHaoDouble = false;
        var nArrowBrance = 0;
        var bInComment = false;
        for (var i = 0, n = str.length; i < n; i++) {
            var s2 = str.charCodeAt(i);
            if (s2 == '<'.charCodeAt(0)) {
                if (str.charCodeAt(i + 1) == '!'.charCodeAt(0) && str.charCodeAt(i + 2) == '['.charCodeAt(0) &&
                    str.charCodeAt(i + 3) == 'C'.charCodeAt(0) &&
                    str.charCodeAt(i + 4) == 'D'.charCodeAt(0) &&
                    str.charCodeAt(i + 5) == 'A'.charCodeAt(0) &&
                    str.charCodeAt(i + 6) == 'T'.charCodeAt(0) &&
                    str.charCodeAt(i + 7) == 'A'.charCodeAt(0) &&
                    str.charCodeAt(i + 8) == '['.charCodeAt(0)) {
                    var s = "";
                    for (var j = i + 9; j < n; j++) {
                        var s3 = str.charAt(j);
                        if (s3 == "]" && str.charCodeAt(j + 1) == ']'.charCodeAt(0) && str.charCodeAt(j + 2) == '>'.charCodeAt(0)) {
                            i = j + 2;
                            break;
                        }
                        else
                            s += s3;
                    }
                    ret.push(s);
                    continue;
                }
                else
                    nArrowBrance++;
            }
            if (!bYinHaoSingle && !bYinHaoDouble && !bInComment && nArrowBrance != 0) {
                if (s2 == '\''.charCodeAt(0))
                    bYinHaoSingle = true;
                else if (s2 == '"'.charCodeAt(0))
                    bYinHaoDouble = true;
                else if (s2 == '<'.charCodeAt(0) || s2 == '>'.charCodeAt(0) || s2 == '='.charCodeAt(0) || s2 == ' '.charCodeAt(0) || s2 == '\t'.charCodeAt(0) || s2 == '?'.charCodeAt(0) || s2 == '\r'.charCodeAt(0) || s2 == '\n'.charCodeAt(0) ||
                    s2 == ','.charCodeAt(0) || s2 == '['.charCodeAt(0) || s2 == ']'.charCodeAt(0) || s2 == '{'.charCodeAt(0) || s2 == '}'.charCodeAt(0) ||
                    s2 == '/'.charCodeAt(0) && str.charCodeAt(i + 1) == '>'.charCodeAt(0)) {
                    var s3 = str.charAt(i);
                    var s = null;
                    if (start != -1 && end != -1)
                        ret.push(s = str.substring(start, end));
                    if (s2 != ' '.charCodeAt(0) && s2 != '\t'.charCodeAt(0) && s2 != '\n'.charCodeAt(0) && s2 != '\r'.charCodeAt(0))
                        ret.push(s3);
                    if (s == "!--")
                        bInComment = true;
                    start = end = -1;
                }
                else {
                    if (start == -1)
                        start = i;
                    end = i + 1;
                }
            }
            else {
                if (bYinHaoSingle && s2 == '\''.charCodeAt(0)) {
                    bYinHaoSingle = false;
                    ret.push(str.substring(start, end));
                    start = end = -1;
                }
                else if (bYinHaoDouble && s2 == '"'.charCodeAt(0)) {
                    bYinHaoDouble = false;
                    ret.push(str.substring(start, end));
                    start = end = -1;
                }
                else if (bInComment && s2 == ' '.charCodeAt(0) && str.charCodeAt(i + 1) == '-'.charCodeAt(0) && str.charCodeAt(i + 2) == '-'.charCodeAt(0) && str.charCodeAt(i + 3) == '>'.charCodeAt(0)) {
                    ret.push(str.substring(start, end));
                    start = end = -1;
                    bInComment = false;
                }
                else if (s2 != '\n'.charCodeAt(0) && s2 != '\r'.charCodeAt(0)) {
                    if (start == -1)
                        start = i;
                    end = i + 1;
                }
            }
            if (s2 == '>'.charCodeAt(0))
                nArrowBrance--;
        }
        return ret;
    };
    XmlLoader.prototype.PaserFromWord = function (pDest, vecWord, start, strEndName) {
        var nextnext = null;
        while (start < vecWord.length && vecWord[start++] == "<") {
            var next = vecWord[start++];
            if (strEndName != null && strEndName == next) {
                start -= 2;
                break;
            }
            var xml = new XmlLoader();
            xml.m_strName = next;
            next = vecWord[start++];
            var strEnd = null;
            if (xml.m_strName == "?")
                strEnd = "?";
            else if (xml.m_strName == "!--")
                strEnd = "--";
            else
                strEnd = "/" + xml.m_strName;
            if (next == ">") {
                while (start < vecWord.length) {
                    next = vecWord[start++];
                    if (next == "<") {
                        if (vecWord[start] == strEnd) {
                            start += 2;
                            break;
                        }
                        else {
                            start = this.PaserFromWord(xml, vecWord, start - 1, strEnd);
                        }
                    }
                    else if (vecWord[start] == "=") {
                        xml.m_mapAttribute.set(next, this.TransFromXmlValue(vecWord[start + 1]));
                        start += 2;
                    }
                    else
                        xml.m_strData = next;
                }
            }
            else {
                start--;
                while (start < vecWord.length) {
                    next = vecWord[start++];
                    if (start < vecWord.length)
                        nextnext = vecWord[start];
                    else
                        nextnext = "";
                    if (xml.m_strName == "!--") {
                        if (next == "--" && next == strEnd && nextnext == ">") {
                            start++;
                            break;
                        }
                        else
                            xml.m_strData = next;
                    }
                    else {
                        if (next == "<") {
                            if (vecWord[start] == strEnd) {
                                start += 2;
                                break;
                            }
                            else {
                                start = this.PaserFromWord(xml, vecWord, start - 1, strEnd);
                            }
                        }
                        else if ((next == "/" || next == "?" && next == strEnd) && nextnext == ">") {
                            start++;
                            break;
                        }
                        else if (next != ">") {
                            if (vecWord[start] == "=") {
                                xml.m_mapAttribute.set(next, this.TransFromXmlValue(vecWord[start + 1]));
                                start += 2;
                            }
                            else
                                xml.m_strData = next;
                        }
                        else if (start < vecWord.length - 1 && vecWord[start] == "<")
                            xml.m_strData = "";
                    }
                }
            }
            if (xml.m_strName == "?")
                this.m_mapHeader = xml.m_mapAttribute;
            else if (xml.m_strName == "!--") {
                if (pDest.m_vecComment == null)
                    pDest.m_vecComment = new Array();
                pDest.m_vecComment.push(xml.m_strData);
            }
            else
                pDest.AddChild(xml);
        }
        return start;
    };
    XmlLoader.prototype.TransFromXmlValue = function (str) {
        str = dStringUtils.ReplaceAll(str, "\\n", "\n");
        str = dStringUtils.ReplaceAll(str, "\\r", "\r");
        str = dStringUtils.ReplaceAll(str, "&amp;", "&");
        str = dStringUtils.ReplaceAll(str, "&quot;", "\"");
        str = dStringUtils.ReplaceAll(str, "&lt;", "<");
        str = dStringUtils.ReplaceAll(str, "&gt;", ">");
        return str;
    };
    XmlLoader.prototype.AddChild = function (data) {
        if (data != null) {
            data.m_pFather = this;
            this.m_vecChild.push(data);
        }
        return data;
    };
    XmlLoader.prototype.FromString = function (str) {
        var vecWord = this.PaserToWord(str);
        this.PaserFromWord(this, vecWord, 0, null);
        return this;
    };
    return XmlLoader;
}());
var GameWorld = (function (_super) {
    __extends(GameWorld, _super);
    function GameWorld(stageData) {
        var _this = _super.call(this) || this;
        _this.m_stageData = null;
        _this.m_bGameClear = false;
        _this.m_bGameOver = false;
        _this.m_pLevel = null;
        _this.m_vecSubRights = new Array();
        _this.m_bHinted = false;
        _this.m_blankShowSmoke = true;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        MyShareRecording.Instance().StartRecord();
        _this.m_stageData = stageData;
        var safeAreaTop = dThread.GetSafeAreaTop();
        if (safeAreaTop > 0) {
            _this.TitleBack.positionY += safeAreaTop;
        }
        _this.SetHandleMouse(true);
        _this.GameLayer.SetTransparentMouse(true);
        _this.ClearHandleMouse.SetHandleMouse(true);
        _this.ClearHandleMouse.visible = false;
        _this.TitleBack_MoreButton.visible = MyAd.hasMoreGame();
        _this.TitleBack_MoreButton_Text.text = MyAd.GetMoreGameText();
        _this.TitleBack_MoreButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            MoreGamePanel.ShowAdMoreGame();
        }));
        _this.TitleBack_SettingButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().OpenPanel(null, new SettingPanel());
        }));
        _this.TitleBack_MenuButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().OpenPanel(null, new SelectLevelPanel());
        }));
        _this.HintButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/window.mp3");
            PageManager.Instance().UpdateCurPage();
            PageManager.Instance().OpenPanel(null, new HintPanel(_this.m_pLevel.GetHintText(), _this.m_pLevel.GetHintImageName(), _this));
        }));
        _this.TitleBack_BackButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/window.mp3");
            PageManager.Instance().ChangePage(LoginPage);
        }));
        _this.TitleBack_EnergeBar.visible = GDefine.EnableEnergy;
        _this.LoadStageLevel(stageData.stage);
        return _this;
    }
    GameWorld.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0, "anchorV": 0, "className": "Back", "classType": "dImage", "clipChild": 1, "height": 1884, "layoutAlignH": 5, "layoutAlignV": 5, "resourceFileName": "data/gameback.png", "width": 1080, "x": 0, "y": 0 }], "anchorU": 0, "anchorV": 0, "className": "Back", "classType": "dImage", "clipChild": 1, "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": -16777216, "width": 1080, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dScale9", "height": 1600, "resourceFileName": "", "width": 1080, "x": 540, "y": 1076 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "SettingButton", "classType": "dButtonScale9", "height": 86, "layoutAlignH": 2, "resourceFileName": "data/setting.png", "spriteColor": -4868683, "width": 88, "x": 458, "y": 114 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "MenuButton", "classType": "dButtonScale9", "height": 69, "layoutAlignH": 2, "resourceFileName": "data/menubutton.png", "spriteColor": -4868683, "width": 83, "x": 336, "y": 114 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "StageText", "classType": "dBitmapFont", "fontSize": 50, "height": 59.375, "resourceFileName": "data/font64.json", "spriteColor": -8801605, "text": "100", "width": 175, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "StargeBar", "classType": "dImage", "height": 85, "resourceFileName": "", "width": 246, "x": 0, "y": 118 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 30, "height": 41.25, "resourceFileName": "data/fontmore.json", "text": "", "width": 127.5, "wordSpace": -10, "x": 0, "y": 43 }], "anchorU": 0.5, "anchorV": 0.5, "className": "MoreButton", "classType": "dButton", "height": 135, "layoutAlignH": 2, "resourceFileName": "data/morebutton.png", "scaleX": 0.777777, "scaleY": 0.777778, "width": 127, "x": 464.111023, "y": 237 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "EnergeBar", "classType": "EnergyBar", "layoutAlignH": 1, "x": -279, "y": 111 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "BackButton", "classType": "dButtonScale9", "height": 73, "layoutAlignH": 1, "resourceFileName": "data/backbutton.png", "spriteColor": -4868683, "width": 55, "x": -459, "y": 114 }], "alpha": 0.392157, "anchorU": 0.5, "anchorV": 0, "className": "TitleBack", "classType": "dImage", "height": 209, "layoutAlignH": 5, "layoutAlignV": 1, "resourceFileName": "", "width": 1080, "x": 540, "y": 0 }, { "anchorU": 0, "anchorV": 0, "className": "ClearHandleMouse", "classType": "dSprite", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "visible": 0, "width": 1080, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 50, "height": 58.59375, "resourceFileName": "data/font64.json", "spriteColor": -5066062, "text": "", "width": 100, "x": -7, "y": -31 }], "anchorU": 0.5, "anchorV": 0.5, "className": "HintButton", "classType": "dButtonScale9", "height": 186, "layoutAlignH": 2, "layoutAlignV": 2, "resourceFileName": "", "width": 172, "x": 965.5, "y": 1782.604248 }], "anchorU": 0, "anchorV": 0, "classType": "dSprite", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "width": 1080, "x": 0, "y": 0 }; };
    GameWorld.prototype.GetStageData = function () {
        return this.m_stageData;
    };
    GameWorld.prototype.OnTouchDown = function (x, y, delta) {
        if (this.m_blankShowSmoke && !this.m_bGameClear)
            this.ShowSmoke(x, y);
    };
    GameWorld.prototype.OnMultyTouchDown = function (id, x, y, delta) {
        if (this.m_blankShowSmoke && !this.m_bGameClear)
            this.ShowSmoke(x, y);
    };
    GameWorld.prototype.ShowSmoke = function (x, y) {
        for (var i = 0; i < 5; i++) {
            var image = new dImage();
            image.LoadFromFile("data/smoke.png");
            image.SetScale(0.5, 0.5);
            image.SetPos(dMath.RandomRange(-30, 30) + x, dMath.RandomRange(-30, 30) + y);
            image.SetTransparentMouse(true);
            var dir = new dVector2(dMath.RandomRange(-1, 1), dMath.RandomRange(-1, 1));
            dir.Normalize();
            dir.MulAppendF(50);
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCSpawn([
                    new CCScaleTo(0.3, 1.2, 1.2),
                    new CCMoveBy(0.3, dir.x, dir.y),
                    new CCFadeOut(0.3)
                ]),
                new CCRemoveSelf()
            ]), image);
            this.AddChild(image);
        }
    };
    GameWorld.prototype.ShowWrong = function (pos, target, bPlaySound) {
        if (target === void 0) { target = null; }
        if (bPlaySound === void 0) { bPlaySound = true; }
        if (this.isGameClear())
            return;
        if (target) {
            pos = new dVector2(target.GetPosX_World(this, false), target.GetPosY_World(this, false));
        }
        if (bPlaySound)
            dSound.PlaySound("data/sound/wrong.mp3");
        var image = new dImage();
        image.LoadFromFile("data/wrong.png");
        image.SetScale(0, 0);
        image.SetPos(pos.x, pos.y);
        image.SetTransparentMouse(true);
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCScaleTo(0.2, 1, 1),
            new CCScaleTo(0.2, 0.8, 0.8),
            new CCDelayTime(0.05),
            new CCRemoveSelf()
        ]), image);
        this.AddChild(image);
    };
    GameWorld.prototype.ShowRight = function (pos, target) {
        if (target === void 0) { target = null; }
        if (this.isGameClear())
            return;
        if (target) {
            pos = new dVector2(target.GetPosX_World(this, false), target.GetPosY_World(this, false));
        }
        dSound.PlaySound("data/sound/right.mp3");
        var image = new dImage();
        image.LoadFromFile("data/right.png");
        image.SetScale(0, 0);
        image.SetPos(pos.x, pos.y);
        image.SetTransparentMouse(true);
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCScaleTo(0.2, 1, 1),
            new CCScaleTo(0.2, 0.8, 0.8),
        ]), image);
        this.AddChild(image);
        this.OnStageClear();
    };
    GameWorld.prototype.ShowRightSub = function (pos, target) {
        if (target === void 0) { target = null; }
        if (target) {
            pos = new dVector2(target.GetPosX_World(this, false), target.GetPosY_World(this, false));
        }
        dSound.PlaySound("data/sound/right.mp3");
        var image = new dImage();
        image.LoadFromFile("data/right.png");
        image.SetScale(0, 0);
        image.SetPos(pos.x, pos.y);
        image.SetTransparentMouse(true);
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCScaleTo(0.2, 0.7, 0.7),
            new CCScaleTo(0.2, 0.5, 0.5),
        ]), image);
        this.AddChild(image);
        this.m_vecSubRights.push(image);
    };
    GameWorld.prototype.ShowClear = function () {
        var _this = this;
        this.ClearHandleMouse.visible = true;
        this.m_bGameClear = true;
        dSound.PlaySound("data/sound/right.mp3");
        var pStageClearEff = new StageClearEff(function () {
            _this.OnStageClear(500);
        });
        pStageClearEff.LayoutToSize(this.width, this.height);
        var pColorfulEffect = new ColorfulEffect(1);
        this.AddChild(pColorfulEffect);
        pColorfulEffect.SetPos(pStageClearEff.ClearText.positionX, pStageClearEff.ClearText.positionY);
        this.AddChild(pStageClearEff);
    };
    GameWorld.prototype.GetRightSubCount = function () {
        return this.m_vecSubRights.length;
    };
    GameWorld.prototype.ClearSubRights = function () {
        for (var i = 0; i < this.m_vecSubRights.length; i++)
            this.m_vecSubRights[i].RemoveParent();
        this.m_vecSubRights.clear();
    };
    GameWorld.prototype.GetSubRights = function () {
        return this.m_vecSubRights;
    };
    GameWorld.prototype.SetBlockMouse = function (bBlock) {
        if (bBlock === void 0) { bBlock = true; }
        this.ClearHandleMouse.visible = bBlock;
    };
    GameWorld.prototype.isBlockMouse = function () {
        return this.ClearHandleMouse.visible;
    };
    GameWorld.prototype.Restart = function () {
        this.GameLayer.RemoveAllChild();
        this.LoadStageLevel(this.m_stageData.stage);
    };
    GameWorld.prototype.LoadStageLevel = function (level) {
        level--;
        this.TitleBack_StargeBar_StageText.text = "" + ((level % GDefine.MAX_STAGE) + 1) + "";
        var p = null;
        switch ((level % GDefine.MAX_STAGE) + 1) {
            case 1:
                p = new Level1();
                break;
            case 2:
                p = new Level2();
                break;
            case 3:
                p = new Level3();
                break;
            case 4:
                p = new Level4();
                break;
            case 5:
                p = new Level5();
                break;
            case 6:
                p = new Level6();
                break;
            case 7:
                p = new Level13();
                break;
            case 8:
                p = new Level8();
                break;
            case 9:
                p = new Level9();
                break;
            case 10:
                p = new Level10();
                break;
            case 11:
                p = new Level11();
                break;
            case 12:
                p = new Level12();
                break;
            case 13:
                p = new Level7();
                break;
            case 14:
                p = new Level14();
                break;
            case 15:
                p = new Level15();
                break;
            case 16:
                p = new Level16();
                break;
            case 17:
                p = new Level17();
                break;
            case 18:
                p = new Level18();
                break;
            case 19:
                p = new Level19();
                break;
            case 20:
                p = new Level20();
                break;
            case 21:
                p = new Level21();
                break;
            case 22:
                p = new Level22();
                break;
            case 23:
                p = new Level23();
                break;
            case 24:
                p = new Level24();
                break;
            case 25:
                p = new Level25();
                break;
            case 26:
                p = new Level26();
                break;
            case 27:
                p = new Level27();
                break;
            case 28:
                p = new Level28();
                break;
            case 29:
                p = new Level29();
                break;
            case 30:
                p = new Level30();
                break;
            case 20:
                p = new Level20();
                break;
            case 21:
                p = new Level21();
                break;
            case 22:
                p = new Level22();
                break;
            case 23:
                p = new Level23();
                break;
            case 24:
                p = new Level24();
                break;
            case 25:
                p = new Level25();
                break;
            case 26:
                p = new Level26();
                break;
            case 27:
                p = new Level27();
                break;
            case 28:
                p = new Level28();
                break;
            case 29:
                p = new Level29();
                break;
            case 30:
                p = new Level30();
                break;
            case 20:
                p = new Level20();
                break;
            case 21:
                p = new Level21();
                break;
            case 22:
                p = new Level22();
                break;
            case 23:
                p = new Level23();
                break;
            case 24:
                p = new Level24();
                break;
            case 25:
                p = new Level25();
                break;
            case 26:
                p = new Level26();
                break;
            case 27:
                p = new Level27();
                break;
            case 28:
                p = new Level28();
                break;
            case 29:
                p = new Level29();
                break;
            case 30:
                p = new Level30();
                break;
            case 20:
                p = new Level20();
                break;
            case 21:
                p = new Level21();
                break;
            case 22:
                p = new Level22();
                break;
            case 23:
                p = new Level23();
                break;
            case 24:
                p = new Level24();
                break;
            case 25:
                p = new Level25();
                break;
            case 26:
                p = new Level26();
                break;
            case 27:
                p = new Level27();
                break;
            case 28:
                p = new Level28();
                break;
            case 29:
                p = new Level29();
                break;
            case 30:
                p = new Level30();
                break;
            case 31:
                p = new Level31();
                break;
            case 32:
                p = new Level32();
                break;
            case 33:
                p = new Level33();
                break;
            case 34:
                p = new Level34();
                break;
            case 35:
                p = new Level35();
                break;
            case 36:
                p = new Level36();
                break;
            case 37:
                p = new Level37();
                break;
            case 38:
                p = new Level38();
                break;
            case 39:
                p = new Level39();
                break;
            case 40:
                p = new Level40();
                break;
            case 41:
                p = new Level41();
                break;
            case 42:
                p = new Level42();
                break;
            case 43:
                p = new Level43();
                break;
            case 44:
                p = new Level44();
                break;
            case 45:
                p = new Level45();
                break;
            case 46:
                p = new Level46();
                break;
            case 47:
                p = new Level47();
                break;
            case 48:
                p = new Level48();
                break;
            case 49:
                p = new Level49();
                break;
            case 50:
                p = new Level50();
                break;
            case 51:
                p = new Level51();
                break;
            case 52:
                p = new Level52();
                break;
            case 53:
                p = new Level53();
                break;
            case 54:
                p = new Level54();
                break;
            case 55:
                p = new Level55();
                break;
            case 56:
                p = new Level56();
                break;
            case 57:
                p = new Level57();
                break;
            case 58:
                p = new Level58();
                break;
            case 59:
                p = new Level59();
                break;
            case 60:
                p = new Level60();
                break;
            case 61:
                p = new Level61();
                break;
            case 62:
                p = new Level62();
                break;
            case 63:
                p = new Level63();
                break;
            case 64:
                p = new Level64();
                break;
            case 65:
                p = new Level65();
                break;
            case 66:
                p = new Level66();
                break;
            case 67:
                p = new Level67();
                break;
            case 68:
                p = new Level68();
                break;
            case 69:
                p = new Level69();
                break;
            case 70:
                p = new Level70();
                break;
            case 71:
                p = new Level71();
                break;
            case 72:
                p = new Level72();
                break;
            case 73:
                p = new Level73();
                break;
            case 74:
                p = new Level74();
                break;
            case 75:
                p = new Level75();
                break;
            case 76:
                p = new Level76();
                break;
            case 77:
                p = new Level77();
                break;
            case 78:
                p = new Level78();
                break;
            case 79:
                p = new Level79();
                break;
            case 80:
                p = new Level80();
                break;
        }
        this.m_pLevel = p;
        this.m_pLevel.Init(this);
        this.m_pLevel.pureColor = false;
        this.GameLayer.AddChild(this.m_pLevel);
    };
    GameWorld.prototype.OnStageClear = function (delay) {
        var _this = this;
        if (delay === void 0) { delay = 1000; }
        this.ClearHandleMouse.visible = true;
        this.m_bGameClear = true;
        new dTimer(this).Create(delay, 1, function () {
            dSound.PlaySound("data/sound/window.mp3");
            PageManager.Instance().OpenPanel(null, new StageClearPanel(_this.m_stageData));
        });
    };
    GameWorld.prototype.isGameClear = function () {
        return this.m_bGameClear;
    };
    GameWorld.Perload = function (onComplete) {
        var callback = new dCompleteCallback(null);
        dBitmapFont.PreLoadBuffer("data/font64.json", callback.CreateCompleteFun_Normal());
        dBitmapFont.PreLoadBuffer("data/fontmore.json", callback.CreateCompleteFun_Normal());
        dBitmapFont.PreLoadBuffer("data/fontNumber.json", callback.CreateCompleteFun_Normal());
        dBitmapFont.PreLoadBuffer("data/zi.json", callback.CreateCompleteFun_Normal());
        callback.SetCompleteFun(onComplete);
    };
    return GameWorld;
}(dSprite));
var StageData = (function () {
    function StageData() {
        this.stage = 0;
    }
    return StageData;
}());
var StageClearEff = (function (_super) {
    __extends(StageClearEff, _super);
    function StageClearEff(onComplete) {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCDelayTime(1.5),
            new CCCallFunc(onComplete),
            new CCRemoveSelf()
        ]), _this);
        return _this;
    }
    StageClearEff.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "ClearText", "classType": "dBitmapFont", "fontEdgeColor": -16777216, "fontSize": 128, "height": 144, "resourceFileName": "data/font64.json", "spriteColor": -40379, "text": "", "width": 256, "x": 540, "y": 693 }], "anchorU": 0, "anchorV": 0, "classType": "dSprite", "height": 1920, "width": 1080, "x": 0, "y": 0 }; };
    return StageClearEff;
}(dSprite));
var CanBreak = (function () {
    function CanBreak(gameWorld, target) {
        var _this = this;
        this.m_pGameWorld = null;
        this.m_target = null;
        this.m_startPos = new dVector2();
        this.m_dragHeight = false;
        this.m_breaked = false;
        this.onBreak = null;
        this.isTouchUpSetOrgPos = false;
        this.canDragOutsideScreen = false;
        this.m_pGameWorld = gameWorld;
        this.m_target = target;
        this.m_startPos.SetValue(this.m_target.positionX, this.m_target.positionY);
        target.SetHandleMouse(true);
        target.OnTouchMove = function (x, y, offx, offy, delta) {
            if (!_this.m_breaked) {
                offx *= target.scaleX;
                offy *= target.scaleY;
                target.positionX += offx;
                target.positionY += offy;
                if (!_this.canDragOutsideScreen) {
                    if (target.positionX < -_this.m_pGameWorld.width / 2 + target.width * target.anchorU)
                        target.positionX = -_this.m_pGameWorld.width / 2 + target.width * target.anchorU;
                    else if (target.positionX > _this.m_pGameWorld.width / 2 - target.width * target.anchorU)
                        target.positionX = _this.m_pGameWorld.width / 2 - target.width * target.anchorU;
                    var yOff = _this.m_pGameWorld.GameLayer.positionY - _this.m_pGameWorld.height / 2;
                    if (target.positionY < -_this.m_pGameWorld.height / 2 - yOff + target.height * target.anchorV)
                        target.positionY = -_this.m_pGameWorld.height / 2 - yOff + target.height * target.anchorV;
                    else if (target.positionY > _this.m_pGameWorld.height / 2 - yOff - target.height * target.anchorV)
                        target.positionY = _this.m_pGameWorld.height / 2 - yOff - target.height * target.anchorV;
                }
                if (target.positionY < _this.m_startPos.y - 10) {
                    _this.m_dragHeight = true;
                }
                if (target.positionY > _this.m_startPos.y && _this.m_dragHeight) {
                    target.SetPos(_this.m_startPos.x, _this.m_startPos.y);
                    if (_this.onBreak)
                        _this.onBreak(_this);
                    _this.m_breaked = true;
                }
            }
        };
        target.OnTouchUp = function (x, y) {
            if (_this.isTouchUpSetOrgPos)
                target.SetPos(_this.m_startPos.x, _this.m_startPos.y);
            else
                _this.m_startPos.SetValue(target.positionX, target.positionY);
        };
    }
    CanBreak.prototype.isBreaked = function () {
        return this.m_breaked;
    };
    return CanBreak;
}());
var CanDoubleClick = (function () {
    function CanDoubleClick(gameWorld, target) {
        var _this = this;
        this.m_target = null;
        this.onTouchDown = null;
        this.onTouchUp = null;
        this.touchDownShowWrong = false;
        this.touchDownShowRight = false;
        this.canTouchDown = true;
        this.isTouchingDown = false;
        this.touchDownScaleMode = true;
        this.isTouchDowned = false;
        this.lastClickTime = -10000;
        this.onDoubleClick = null;
        this.m_target = target;
        target.SetHandleMouse(true);
        var startScale = new dVector2(target.scaleX, target.scaleY);
        target.OnTouchDown = function (x, y, delta) {
            if (!_this.canTouchDown)
                return;
            _this.isTouchingDown = true;
            _this.isTouchDowned = true;
            if (_this.touchDownShowWrong)
                gameWorld.ShowWrong(null, target);
            else if (_this.touchDownShowRight)
                gameWorld.ShowRight(null, target);
            if (_this.touchDownScaleMode) {
                CCActionManager.Instance().AddAction(new CCSequence([
                    new CCScaleTo(0.2, startScale.x + (0.1 * dMath.Signum(startScale.x)), startScale.y + (0.1 * dMath.Signum(startScale.y))),
                    new CCScaleTo(0.2, startScale.x, startScale.y)
                ]), target);
            }
            if (_this.onTouchDown)
                _this.onTouchDown(_this);
            var time = dTimer.GetTickCount();
            if (time - _this.lastClickTime < 500) {
                if (_this.onDoubleClick)
                    _this.onDoubleClick(_this);
            }
            _this.lastClickTime = time;
        };
        target.OnTouchUp = function (x, y) {
            _this.isTouchingDown = false;
            if (_this.onTouchUp)
                _this.onTouchUp(_this);
        };
        target.OnMultyTouchUp = function (id, x, y) {
            _this.isTouchDowned = false;
        };
    }
    return CanDoubleClick;
}());
var CanDrag = (function () {
    function CanDrag(gameWorld, target) {
        var _this = this;
        this.m_pGameWorld = null;
        this.m_target = null;
        this.m_dragStartPos = new dVector2();
        this.m_startPos = new dVector2();
        this.isTouchUpSetOrgPos = false;
        this.canDragOutsideScreen = false;
        this.touchUpShowWrong = false;
        this.onTouchUp = null;
        this.onTouchUps = new Array();
        this.onTouchDown = null;
        this.onDrag = null;
        this.canDragH = true;
        this.canDragV = true;
        this.isTouchMoved = false;
        this.dragLimitLengthH = null;
        this.dragLimitLengthV = null;
        this.curTouchMovePos = new dVector2();
        this.onLongTouch = null;
        this.m_longTouchTimer = null;
        this.m_touchMoveAdd = new dVector2();
        this.enable = true;
        this.onDoubleClick = null;
        this.lastClickTime = -10000;
        this.m_pGameWorld = gameWorld;
        this.m_target = target;
        this.m_startPos.SetValue(this.m_target.positionX, this.m_target.positionY);
        target.SetHandleMouse(true);
        target.OnTouchMove = function (x, y, offx, offy, delta) {
            if (!_this.enable)
                return;
            if (_this.m_longTouchTimer && _this.m_touchMoveAdd.Length() > 10) {
                _this.m_longTouchTimer.Restart();
            }
            _this.curTouchMovePos.SetValue(x, y);
            offx *= target.scaleX;
            offy *= target.scaleY;
            _this.m_touchMoveAdd.x += offx;
            _this.m_touchMoveAdd.y += offy;
            _this.isTouchMoved = true;
            if (_this.canDragH)
                target.positionX += offx;
            if (_this.canDragV)
                target.positionY += offy;
            var offx2 = -(target.GetParent().GetPosX_World(gameWorld, false) - gameWorld.width / 2);
            var offy2 = -(target.GetParent().GetPosY_World(gameWorld, false) - gameWorld.height / 2);
            if (_this.dragLimitLengthH) {
                if (target.positionX < _this.m_startPos.x + _this.dragLimitLengthH.x)
                    target.positionX = _this.m_startPos.x + _this.dragLimitLengthH.x;
                else if (target.positionX > _this.m_startPos.x + _this.dragLimitLengthH.y)
                    target.positionX = _this.m_startPos.x + _this.dragLimitLengthH.y;
            }
            if (_this.dragLimitLengthV) {
                if (target.positionY < _this.m_startPos.y + _this.dragLimitLengthV.x)
                    target.positionY = _this.m_startPos.y + _this.dragLimitLengthV.x;
                else if (target.positionY > _this.m_startPos.y + _this.dragLimitLengthV.y)
                    target.positionY = _this.m_startPos.y + _this.dragLimitLengthV.y;
            }
            if (!_this.canDragOutsideScreen) {
                if (target.positionX < -_this.m_pGameWorld.width / 2 + target.width * target.anchorU + offx2)
                    target.positionX = -_this.m_pGameWorld.width / 2 + target.width * target.anchorU + offx2;
                else if (target.positionX > _this.m_pGameWorld.width / 2 - target.width * target.anchorU + offx2)
                    target.positionX = _this.m_pGameWorld.width / 2 - target.width * target.anchorU + offx2;
                var yOff = 0;
                if (target.positionY < -_this.m_pGameWorld.height / 2 - yOff + target.height * target.anchorV + offy2)
                    target.positionY = -_this.m_pGameWorld.height / 2 - yOff + target.height * target.anchorV + offy2;
                else if (target.positionY > _this.m_pGameWorld.height / 2 - yOff - target.height * target.anchorV + offy2)
                    target.positionY = _this.m_pGameWorld.height / 2 - yOff - target.height * target.anchorV + offy2;
            }
            if (_this.onDrag)
                _this.onDrag(_this);
        };
        if (target instanceof dButton) {
            target.SetEvent(new dEvent().SetOnButtonUp(function () {
                if (_this.onTouchUp)
                    _this.onTouchUp(_this);
                for (var i = 0; i < _this.onTouchUps.length; i++)
                    _this.onTouchUps[i](_this);
                if (_this.isTouchUpSetOrgPos)
                    target.SetPos(_this.m_startPos.x, _this.m_startPos.y);
                if (_this.touchUpShowWrong)
                    _this.m_pGameWorld.ShowWrong(null, target);
                _this.isTouchMoved = false;
            }));
        }
        else {
            target.OnTouchDown = function (x, y) {
                if (_this.onTouchDown)
                    _this.onTouchDown(_this);
                _this.m_touchMoveAdd.SetValue(0, 0);
                _this.m_dragStartPos.SetValue(target.positionX, target.positionY);
                if (_this.onLongTouch) {
                    _this.m_longTouchTimer = new dTimer(target).Create(500, 1, function () {
                        if (_this.onLongTouch)
                            _this.onLongTouch(_this);
                        _this.m_longTouchTimer = null;
                    });
                }
                var time = dTimer.GetTickCount();
                if (time - _this.lastClickTime < 500) {
                    if (_this.onDoubleClick)
                        _this.onDoubleClick(_this);
                }
                _this.lastClickTime = time;
            };
            target.OnTouchUp = function (x, y) {
                if (_this.m_longTouchTimer) {
                    _this.m_longTouchTimer.Stop();
                    _this.m_longTouchTimer = null;
                }
                if (_this.onTouchUp)
                    _this.onTouchUp(_this);
                for (var i = 0; i < _this.onTouchUps.length; i++)
                    _this.onTouchUps[i](_this);
                if (_this.isTouchUpSetOrgPos)
                    target.SetPos(_this.m_startPos.x, _this.m_startPos.y);
                if (_this.touchUpShowWrong)
                    _this.m_pGameWorld.ShowWrong(null, target);
                _this.isTouchMoved = false;
            };
        }
    }
    CanDrag.prototype.GetDragOffset = function () {
        return new dVector2(this.m_target.positionX - this.m_startPos.x, this.m_target.positionY - this.m_startPos.y);
    };
    return CanDrag;
}());
var CanFriction = (function () {
    function CanFriction(gameWorld, target) {
        var _this = this;
        this.m_pGameWorld = null;
        this.m_target = null;
        this.onFriction = null;
        this.power = 1;
        this.isFrictionAlpha = false;
        this.onFrictionClear = null;
        this.m_bOnFrictionClearCalled = false;
        this.touchUpShowWrong = false;
        this.onTouchUp = null;
        this.m_pGameWorld = gameWorld;
        this.m_target = target;
        target.SetHandleMouse(true);
        target.OnTouchMove = function (x, y, offx, offy, delta) {
            if (x < -target.width * target.scaleX * target.anchorU * 2 ||
                x > target.width * target.scaleX * target.anchorU * 2 ||
                y < -target.height * target.scaleY * target.anchorV * 2 ||
                y > target.height * target.scaleY * target.anchorV * 2)
                return;
            _this.power -= (dMath.Abs(offx) + dMath.Abs(offy)) * 0.002;
            if (_this.power < 0)
                _this.power = 0;
            if (_this.isFrictionAlpha) {
                target.SetAlpha(_this.power, true);
                if (_this.onFrictionClear && target.alpha <= 0 && !_this.m_bOnFrictionClearCalled) {
                    _this.m_bOnFrictionClearCalled = true;
                    _this.onFrictionClear(_this);
                }
            }
            if (_this.onFriction)
                _this.onFriction(_this);
        };
        target.OnTouchUp = function (x, y) {
            if (_this.onTouchUp)
                _this.onTouchUp(_this);
            if (_this.touchUpShowWrong)
                _this.m_pGameWorld.ShowWrong(null, target);
        };
    }
    return CanFriction;
}());
var CanLink = (function () {
    function CanLink(gameWorld, target) {
        var _this = this;
        this.m_pGameWorld = null;
        this.m_target = null;
        this.m_pLine = new dLine();
        this.enable = true;
        this.m_linkOtherList = [];
        this.m_linked = false;
        this.onLink = null;
        this.m_linkedOther = null;
        this.m_pGameWorld = gameWorld;
        this.m_target = target;
        this.m_target.AddChild(this.m_pLine, 0);
        this.m_pLine.lineWidth = 30;
        this.m_pLine.spriteColor = 0xfffddb3c;
        this.m_pLine.SetTransparentMouse(true, true);
        target.SetHandleMouse(true);
        target.OnTouchDown = function (x, y, delta) {
            _this.ClearLink();
        };
        target.OnTouchMove = function (x, y, offx, offy, delta) {
            if (!_this.enable || _this.m_linked)
                return;
            if (!_this.m_pLine.hasMoveTo()) {
                _this.m_pLine.MoveTo(0, 0);
                _this.m_pLine.LineTo(x, y);
            }
            _this.m_pLine.SetLastPos(x, y);
            var rc = new dRect();
            var x1 = target.GetPosX_World(gameWorld, false) + x;
            var y1 = target.GetPosY_World(gameWorld, false) + y;
            for (var i = 0; i < _this.m_linkOtherList.length; i++) {
                var other = _this.m_linkOtherList[i];
                if (other == _this.m_target || !_this.canLinkOther(other))
                    continue;
                rc.SetPosSize(other.GetPosX_World(gameWorld, false) - other.width * other.anchorU * other.scaleX, other.GetPosY_World(gameWorld, false) - other.height * other.anchorV * other.scaleY, other.width * other.scaleX, other.height * other.scaleY);
                if (rc.CollectPoint(x1, y1)) {
                    _this.m_linked = true;
                    _this.m_pLine.SetLastPos(other.GetPosX_World(gameWorld, false) - target.GetPosX_World(gameWorld, false), other.GetPosY_World(gameWorld, false) - target.GetPosY_World(gameWorld, false));
                    if (other.userData["CanLink"]) {
                        other.userData["CanLink"].m_linked = true;
                        other.userData["CanLink"].m_linkedOther = target;
                    }
                    _this.m_linkedOther = other;
                    if (_this.onLink)
                        _this.onLink(_this);
                }
            }
        };
        target.OnTouchUp = function (x, y) {
            if (!_this.enable || _this.m_linked)
                return;
            _this.m_pLine.Clear();
        };
    }
    CanLink.prototype.canLinkOther = function (p) {
        if (p.userData["CanLink"] && p.userData["CanLink"].m_linked)
            return false;
        return true;
    };
    CanLink.prototype.GetLinkOther = function () {
        return this.m_linkedOther;
    };
    CanLink.prototype.ClearLink = function () {
        this.m_pLine.Clear();
        this.m_linked = false;
        var other = this.m_linkedOther;
        this.m_linkedOther = null;
        if (other && other.userData["CanLink"])
            other.userData["CanLink"].ClearLink();
    };
    CanLink.prototype.AddLinkOther = function (p) {
        this.m_linkOtherList.push(p);
    };
    CanLink.prototype.SetLinkOther = function (p) {
        this.m_linkOtherList = p;
    };
    return CanLink;
}());
var CanRotation = (function () {
    function CanRotation(gameWorld, target) {
        var _this = this;
        this.m_pGameWorld = null;
        this.m_target = null;
        this.enable = true;
        this.onDrag = null;
        this.onTouchUp = null;
        this.isTouchUpSetOrgPos = false;
        this.touchUpShowWrong = false;
        this.isTouchMoved = false;
        this.onTouchDown = null;
        this.m_touchDownAngle = 0;
        this.m_touchDownAngle2 = 0;
        this.m_angleStep = 0;
        this.m_pGameWorld = gameWorld;
        this.m_target = target;
        target.SetHandleMouse(true);
        target.OnTouchMove = function (x, y, offx, offy, delta) {
            if (!_this.enable)
                return;
            _this.isTouchMoved = true;
            var dir = new dVector2(x, y);
            dir.Normalize();
            target.rotation = dir.ToAngle() + _this.m_touchDownAngle - _this.m_touchDownAngle2;
            target.rotation %= 360;
            while (target.rotation < 0)
                target.rotation += 360;
            if (_this.onDrag)
                _this.onDrag(_this);
        };
        if (target instanceof dButton) {
            target.SetEvent(new dEvent().SetOnButtonUp(function () {
                if (!_this.enable)
                    return;
                if (_this.onTouchUp)
                    _this.onTouchUp(_this);
                if (_this.isTouchUpSetOrgPos)
                    target.SetRotation(0);
                if (_this.touchUpShowWrong)
                    _this.m_pGameWorld.ShowWrong(null, target);
                _this.isTouchMoved = false;
            }));
        }
        else {
            target.OnTouchDown = function (x, y) {
                if (!_this.enable)
                    return;
                _this.m_touchDownAngle = target.rotation;
                var dir = new dVector2(x, y);
                dir.Normalize();
                _this.m_touchDownAngle2 = dir.ToAngle();
                if (_this.onTouchDown)
                    _this.onTouchDown(_this);
            };
            target.OnTouchUp = function (x, y) {
                if (!_this.enable)
                    return;
                if (_this.m_angleStep != 0) {
                    var angle = target.rotation;
                    while (angle < 0)
                        angle += 360;
                    if (angle > 180)
                        angle = angle - 360;
                    angle = dMath.Floor((angle + _this.m_angleStep / 2) / _this.m_angleStep);
                    angle *= _this.m_angleStep;
                    angle += 360;
                    angle %= 360;
                    target.rotation = angle;
                }
                if (_this.onTouchUp)
                    _this.onTouchUp(_this);
                if (_this.isTouchUpSetOrgPos)
                    target.SetRotation(0);
                if (_this.touchUpShowWrong)
                    _this.m_pGameWorld.ShowWrong(null, target);
                _this.isTouchMoved = false;
            };
        }
    }
    return CanRotation;
}());
var CanScale = (function () {
    function CanScale(gameWorld, target) {
        var _this = this;
        this.m_pGameWorld = null;
        this.m_target = null;
        this.m_startPos = new dVector2();
        this.m_dragHeight = false;
        this.onTouchUp = null;
        this.isTouchUpSetOrgPos = false;
        this.canDragOutsideScreen = false;
        this.m_arrTouchPoints = new Map();
        this.m_scaleStartLength = 0;
        this.m_scaleStartScale = 1;
        this.m_vTouchMoved = new dVector2();
        this.enable = true;
        this.m_fMinScale = 0.5;
        this.m_fMaxScale = 3;
        this.isTouchMoved = false;
        this.canScaleH = true;
        this.canScaleV = true;
        this.onScale = null;
        this.m_pGameWorld = gameWorld;
        this.m_target = target;
        this.m_startPos.SetValue(this.m_target.positionX, this.m_target.positionY);
        target.SetHandleMouse(true);
        target.OnTouchDown = function (x, y, delta) {
            return target.OnMultyTouchDown(-1, x, y, delta);
        };
        target.OnTouchMove = function (x, y, offx, offy, delta) {
            return target.OnMultyTouchMove(-1, x, y, offx, offy, delta);
        };
        target.OnTouchUp = function (x, y) {
            return target.OnMultyTouchUp(-1, x, y);
        };
        target.OnMultyTouchDown = function (id, x, y, delta) {
            _this.m_arrTouchPoints.set(id, new dVector2(x, y));
        };
        target.OnMultyTouchMove = function (id, x, y, offx, offy, delta) {
            var e_3, _a;
            if (!_this.enable)
                return;
            offx *= target.scaleX;
            offy *= target.scaleY;
            _this.m_vTouchMoved.AddAppend(new dVector2(offx, offy));
            if (_this.m_arrTouchPoints.has(id))
                _this.m_arrTouchPoints.get(id).SetValue(x, y);
            if (_this.m_arrTouchPoints.size > 0) {
                if (_this.canScaleH)
                    _this.m_target.positionX += offx / _this.m_arrTouchPoints.size;
                if (_this.canScaleV)
                    _this.m_target.positionY += offy / _this.m_arrTouchPoints.size;
            }
            if (_this.m_arrTouchPoints.size > 1) {
                var point = new dVector2();
                try {
                    for (var _b = __values(_this.m_arrTouchPoints.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var key = _c.value;
                        if (key != id) {
                            point.AddAppend(_this.m_arrTouchPoints.get(key));
                        }
                    }
                }
                catch (e_3_1) { e_3 = { error: e_3_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_3) throw e_3.error; }
                }
                point.DivAppendF(_this.m_arrTouchPoints.size - 1);
                if (_this.m_scaleStartLength == 0) {
                    _this.m_scaleStartLength = point.LengthTo(new dVector2(x, y));
                    _this.m_scaleStartScale = _this.m_target.scaleX;
                }
                else {
                    var scale = point.LengthTo(new dVector2(x, y)) / _this.m_scaleStartLength * _this.m_scaleStartScale;
                    scale = dMath.Clamp(scale, _this.m_fMinScale, _this.m_fMaxScale);
                    if (_this.canScaleH)
                        _this.m_target.scaleX = scale;
                    if (_this.canScaleV)
                        _this.m_target.scaleY = scale;
                    if (_this.onScale)
                        _this.onScale(_this, scale);
                }
            }
            if (!_this.canDragOutsideScreen) {
                var offx2 = -(target.GetParent().GetPosX_World(gameWorld, false) - gameWorld.width / 2);
                var offy2 = -(target.GetParent().GetPosY_World(gameWorld, false) - gameWorld.height / 2);
                if (target.positionX < -_this.m_pGameWorld.width / 2 + target.width * target.anchorU + offx2)
                    target.positionX = -_this.m_pGameWorld.width / 2 + target.width * target.anchorU + offx2;
                else if (target.positionX > _this.m_pGameWorld.width / 2 - target.width * target.anchorU + offx2)
                    target.positionX = _this.m_pGameWorld.width / 2 - target.width * target.anchorU + offx2;
                var yOff = 0;
                if (target.positionY < -_this.m_pGameWorld.height / 2 - yOff + target.height * target.anchorV + offy2)
                    target.positionY = -_this.m_pGameWorld.height / 2 - yOff + target.height * target.anchorV + offy2;
                else if (target.positionY > _this.m_pGameWorld.height / 2 - yOff - target.height * target.anchorV + offy2)
                    target.positionY = _this.m_pGameWorld.height / 2 - yOff - target.height * target.anchorV + offy2;
            }
        };
        target.OnMultyTouchUp = function (id, x, y) {
            _this.m_arrTouchPoints.remove(id);
            if (_this.m_vTouchMoved.Length() < 5) {
                _this.isTouchMoved = false;
            }
            else
                _this.isTouchMoved = true;
            if (_this.m_arrTouchPoints.size == 0) {
                _this.m_scaleStartLength = 0;
                _this.m_vTouchMoved.SetValue(0, 0);
            }
            if (_this.onTouchUp)
                _this.onTouchUp(_this);
        };
    }
    CanScale.prototype.SetLimit = function (min, max) {
        if (min === void 0) { min = 0.5; }
        if (max === void 0) { max = 3; }
        this.m_fMinScale = min;
        this.m_fMaxScale = max;
    };
    return CanScale;
}());
var CanShake = (function () {
    function CanShake(gameWorld, target) {
        var _this = this;
        this.m_pGameWorld = null;
        this.m_target = null;
        this.m_startPos = new dVector2();
        this.m_dragLeft = 0;
        this.m_dragRight = 0;
        this.m_breaked = false;
        this.onShake = null;
        this.isTouchUpSetOrgPos = false;
        this.canDragOutsideScreen = false;
        this.m_leftAdded = false;
        this.m_rightAdded = false;
        this.m_offAdd = 0;
        this.onTouchUp = null;
        this.onTouchDown = null;
        this.touchUpShowWrong = false;
        this.canShake = true;
        this.canDragH = true;
        this.canDragV = true;
        this.isTouchMoved = false;
        this.canDragOutsideScreenOffset = new dRect();
        this.m_pGameWorld = gameWorld;
        this.m_target = target;
        this.m_startPos.SetValue(this.m_target.positionX, this.m_target.positionY);
        target.SetHandleMouse(true);
        target.OnTouchDown = function (x, y, delta) {
            if (_this.onTouchDown)
                _this.onTouchDown(_this);
            _this.isTouchMoved = false;
        };
        target.OnTouchMove = function (x, y, offx, offy, delta) {
            if (!_this.canShake)
                return;
            offx *= target.scaleX;
            offy *= target.scaleY;
            _this.isTouchMoved = true;
            if (_this.canDragH)
                target.positionX += offx;
            if (_this.canDragV)
                target.positionY += offy;
            if (!_this.canDragOutsideScreen) {
                if (target.positionX < -_this.m_pGameWorld.width / 2 + target.width * target.anchorU + _this.canDragOutsideScreenOffset.left)
                    target.positionX = -_this.m_pGameWorld.width / 2 + target.width * target.anchorU + _this.canDragOutsideScreenOffset.left;
                else if (target.positionX > _this.m_pGameWorld.width / 2 - target.width * target.anchorU - _this.canDragOutsideScreenOffset.right)
                    target.positionX = _this.m_pGameWorld.width / 2 - target.width * target.anchorU - _this.canDragOutsideScreenOffset.right;
                var yOff = _this.m_pGameWorld.GameLayer.positionY - _this.m_pGameWorld.height / 2;
                if (target.positionY < -_this.m_pGameWorld.height / 2 - yOff + target.height * target.anchorV + _this.canDragOutsideScreenOffset.top)
                    target.positionY = -_this.m_pGameWorld.height / 2 - yOff + target.height * target.anchorV + _this.canDragOutsideScreenOffset.top;
                else if (target.positionY > _this.m_pGameWorld.height / 2 - yOff - target.height * target.anchorV - _this.canDragOutsideScreenOffset.bottom)
                    target.positionY = _this.m_pGameWorld.height / 2 - yOff - target.height * target.anchorV - _this.canDragOutsideScreenOffset.bottom;
            }
            if (!_this.m_leftAdded) {
                if (offx < 0)
                    _this.m_offAdd += offx;
                if (_this.m_offAdd < -5) {
                    _this.m_offAdd = 0;
                    _this.m_leftAdded = true;
                    _this.m_rightAdded = false;
                    _this.m_dragLeft++;
                }
            }
            if (!_this.m_rightAdded) {
                if (offx > 0)
                    _this.m_offAdd += offx;
                if (_this.m_offAdd > 5) {
                    _this.m_offAdd = 0;
                    _this.m_leftAdded = false;
                    _this.m_rightAdded = true;
                    _this.m_dragRight++;
                }
            }
            if (_this.m_dragLeft + _this.m_dragRight >= 5 && !_this.m_breaked) {
                if (_this.onShake)
                    _this.onShake(_this);
                _this.m_breaked = true;
            }
        };
        target.OnTouchUp = function (x, y) {
            if (_this.onTouchUp)
                _this.onTouchUp(_this);
            _this.m_dragLeft = 0;
            _this.m_dragRight = 0;
            _this.m_offAdd = 0;
            _this.m_leftAdded = false;
            _this.m_rightAdded = false;
            if (_this.isTouchUpSetOrgPos)
                target.SetPos(_this.m_startPos.x, _this.m_startPos.y);
            else
                _this.m_startPos.SetValue(target.positionX, target.positionY);
            if (_this.touchUpShowWrong)
                gameWorld.ShowWrong(null, target);
        };
    }
    CanShake.prototype.isBreaked = function () {
        return this.m_breaked;
    };
    return CanShake;
}());
var CanTouchDown = (function () {
    function CanTouchDown(gameWorld, target) {
        var _this = this;
        this.m_target = null;
        this.onTouchDown = null;
        this.onTouchUp = null;
        this.touchDownShowWrong = false;
        this.touchDownShowRight = false;
        this.canTouchDown = true;
        this.isTouchingDown = false;
        this.touchDownScaleMode = true;
        this.isTouchDowned = false;
        this.m_target = target;
        target.SetHandleMouse(true);
        var startScale = new dVector2(target.scaleX, target.scaleY);
        target.OnTouchDown = function (x, y, delta) {
            if (!_this.canTouchDown)
                return;
            _this.isTouchingDown = true;
            _this.isTouchDowned = true;
            if (_this.touchDownShowWrong)
                gameWorld.ShowWrong(null, target);
            else if (_this.touchDownShowRight)
                gameWorld.ShowRight(null, target);
            if (_this.touchDownScaleMode) {
                CCActionManager.Instance().AddAction(new CCSequence([
                    new CCScaleTo(0.2, startScale.x + (0.1 * dMath.Signum(startScale.x)), startScale.y + (0.1 * dMath.Signum(startScale.y))),
                    new CCScaleTo(0.2, startScale.x, startScale.y)
                ]), target);
            }
            if (_this.onTouchDown)
                _this.onTouchDown(_this);
        };
        target.OnTouchUp = function (x, y) {
            _this.isTouchingDown = false;
            if (_this.onTouchUp)
                _this.onTouchUp(_this);
        };
        target.OnMultyTouchUp = function (id, x, y) {
            _this.isTouchDowned = false;
        };
    }
    return CanTouchDown;
}());
var LevelBase = (function (_super) {
    __extends(LevelBase, _super);
    function LevelBase() {
        var _this = _super.call(this) || this;
        _this.m_pGameWorld = null;
        _this.m_vecAllCanDrag = new Array();
        _this.m_vecAllCanTouchDown = new Array();
        _this.m_vecAllCanLinks = new Array();
        _this.m_vecAllFrictions = new Array();
        _this.m_lastPlayFrictionSound = 0;
        return _this;
    }
    LevelBase.prototype.Init = function (gameWorld) {
        this.m_pGameWorld = gameWorld;
        this.InitSprites(this);
    };
    LevelBase.prototype.InitSprites = function (pSprite) {
        var vec = pSprite.GetChildList();
        for (var i = 0; i < vec.length; i++) {
            vec[i].userData = {};
            if (vec[i].spriteName.indexOf("CanDrag") != -1) {
                vec[i].userData["CanDrag"] = new CanDrag(this.m_pGameWorld, vec[i]);
                this.m_vecAllCanDrag.push(vec[i].userData["CanDrag"]);
            }
            if (vec[i].spriteName.indexOf("CanBreak") != -1) {
                vec[i].userData["CanBreak"] = new CanBreak(this.m_pGameWorld, vec[i]);
            }
            if (vec[i].spriteName.indexOf("CanTouchDown") != -1) {
                vec[i].userData["CanTouchDown"] = new CanTouchDown(this.m_pGameWorld, vec[i]);
                this.m_vecAllCanTouchDown.push(vec[i].userData["CanTouchDown"]);
            }
            if (vec[i].spriteName.indexOf("CanShake") != -1) {
                vec[i].userData["CanShake"] = new CanShake(this.m_pGameWorld, vec[i]);
            }
            if (vec[i].spriteName.indexOf("CanFriction") != -1) {
                vec[i].userData["CanFriction"] = new CanFriction(this.m_pGameWorld, vec[i]);
                this.m_vecAllFrictions.push(vec[i].userData["CanFriction"]);
            }
            if (vec[i].spriteName.indexOf("CanLink") != -1) {
                vec[i].userData["CanLink"] = new CanLink(this.m_pGameWorld, vec[i]);
                this.m_vecAllCanLinks.push(vec[i].userData["CanLink"]);
            }
            if (vec[i].spriteName.indexOf("CanRotation") != -1) {
                vec[i].userData["CanRotation"] = new CanRotation(this.m_pGameWorld, vec[i]);
            }
            if (vec[i].spriteName.indexOf("CanScale") != -1) {
                vec[i].userData["CanScale"] = new CanScale(this.m_pGameWorld, vec[i]);
            }
            if (vec[i].spriteName.indexOf("CanDoubleClick") != -1) {
                vec[i].userData["CanDoubleClick"] = new CanDoubleClick(this.m_pGameWorld, vec[i]);
            }
            if (vec[i].spriteName.indexOf("TransMouse") != -1) {
                vec[i].SetTransparentMouse(true);
            }
            this.InitSprites(vec[i]);
        }
    };
    LevelBase.prototype.GetHintText = function () {
        return "";
    };
    LevelBase.prototype.GetHintImageName = function () {
        return null;
    };
    LevelBase.prototype.isCollectSprite = function (p1, p2) {
        var rc1 = new dRect().SetPosSize(p1.GetPosX_World(this.m_pGameWorld, false) - p1.width * p1.scaleX * p1.anchorU, p1.GetPosY_World(this.m_pGameWorld, false) - p1.height * p1.scaleY * p1.anchorV, p1.width * p1.scaleX, p1.height * p1.scaleY);
        var rc2 = new dRect().SetPosSize(p2.GetPosX_World(this.m_pGameWorld, false) - p2.width * p2.scaleX * p2.anchorU, p2.GetPosY_World(this.m_pGameWorld, false) - p2.height * p2.scaleY * p2.anchorV, p2.width * p2.scaleX, p2.height * p2.scaleY);
        var ret = rc1.Collect(rc2);
        return ret;
    };
    LevelBase.prototype.isCollectCircle = function (p1, circle, radio) {
        var rc1 = new dRect().SetPosSize(p1.GetPosX_World(this.m_pGameWorld, false) - p1.width * p1.scaleX * p1.anchorU, p1.GetPosY_World(this.m_pGameWorld, false) - p1.height * p1.scaleY * p1.anchorV, p1.width * p1.scaleX, p1.height * p1.scaleY);
        var x = circle.GetPosX_World(this.m_pGameWorld, false);
        var y = circle.GetPosY_World(this.m_pGameWorld, false);
        var ret = rc1.CollectCircle(x, y, radio);
        return ret;
    };
    LevelBase.prototype.isCollectCircleCircle = function (p1, p2) {
        var radio = p1.width * 0.5 + p2.width * 0.5;
        if (p1.GetPosVector2().LengthTo(p2.GetPosVector2()) < radio)
            return true;
        return false;
    };
    LevelBase.prototype.SetCanMerge = function (p2, p2col, pList, onMerge, onCanMerge) {
        var _this = this;
        if (onMerge === void 0) { onMerge = null; }
        if (onCanMerge === void 0) { onCanMerge = null; }
        for (var i = 0; i < pList.length; i++) {
            var fun = function (i) {
                var p1 = pList[i];
                if (p1.userData["CanDrag"]) {
                    p1.userData["CanDrag"].onTouchUps.push(function () {
                        if (_this.isCollectSprite(p1, p2col) && !p2col.visible && p1.visible) {
                            if (!onCanMerge || onCanMerge(p1)) {
                                p2col.visible = true;
                                p1.visible = false;
                                dSound.PlaySound("data/sound/button.mp3");
                                if (onMerge)
                                    onMerge(p1);
                            }
                        }
                    });
                }
            };
            fun(i);
        }
        if (p2 && p2.userData["CanDrag"]) {
            p2.userData["CanDrag"].onTouchUps.push(function () {
                for (var i = 0; i < pList.length; i++) {
                    var p1 = pList[i];
                    if (p1.visible && _this.isCollectSprite(p1, p2col) && !p2col.visible) {
                        if (!onCanMerge || onCanMerge(p1)) {
                            p2col.visible = true;
                            p1.visible = false;
                            dSound.PlaySound("data/sound/button.mp3");
                            if (onMerge)
                                onMerge(p1);
                            break;
                        }
                    }
                }
            });
        }
    };
    LevelBase.prototype.RemoveCanMerge = function (p) {
        if (p.userData["CanDrag"])
            p.userData["CanDrag"].onTouchUps.clear();
    };
    LevelBase.prototype.PlayFrictionSound = function () {
        var tick = dTimer.GetTickCount();
        if (tick > this.m_lastPlayFrictionSound + 200) {
            dSound.PlaySound("data/sound/friction.mp3");
            this.m_lastPlayFrictionSound = tick;
        }
    };
    LevelBase.prototype.PlayDrawSound = function () {
        var tick = dTimer.GetTickCount();
        if (tick > this.m_lastPlayFrictionSound + 200) {
            dSound.PlaySound("data/sound/draw.mp3");
            this.m_lastPlayFrictionSound = tick;
        }
    };
    return LevelBase;
}(dImage));
var Level1 = (function (_super) {
    __extends(Level1, _super);
    function Level1() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level1.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 75, "resourceFileName": "data/font64.json", "text": "", "width": 128, "x": 0, "y": -721 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 537, "resourceFileName": "level/16.png", "width": 186, "x": 0, "y": -306 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanRotation1", "classType": "dImage", "height": 1066, "resourceFileName": "level/11.png", "width": 1064, "x": 0, "y": 26 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanRotation2", "classType": "dImage", "height": 810, "resourceFileName": "level/13.png", "width": 810, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanRotation3", "classType": "dImage", "height": 562, "resourceFileName": "level/14.png", "width": 560, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanRotation4", "classType": "dImage", "height": 326, "resourceFileName": "level/15.png", "width": 324, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level1.prototype.GetHintImageName = function () {
        return "level/12.png";
    };
    Level1.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var imgs = [this.CanRotation1, this.CanRotation2, this.CanRotation3, this.CanRotation4];
        for (var i = 0; i < imgs.length; i++) {
            var fun = function (i) {
                imgs[i]._CheckCollectionWithData = function (p, data) {
                    data.P.Transform(p.GetMatrixWorld().Inverse());
                    return data.P.Length() < p.width / 2;
                };
                imgs[i].userData["CanRotation"].onDrag = function () {
                    _this.PlayFrictionSound();
                };
                imgs[i].userData["CanRotation"].onTouchUp = function () {
                    dSound.PlaySound("data/sound/click.mp3");
                    var rot = imgs[i].rotation;
                    while (rot < 0)
                        rot += 360;
                    rot %= 360;
                    var per = 360 / 8;
                    if (i == 2)
                        per = 360 / 16;
                    else if (i == 1)
                        per = 360 / 24;
                    else if (i == 0)
                        per = 360 / 24;
                    rot += per / 2;
                    rot = dMath.ToInt(rot / per);
                    rot *= per;
                    imgs[i].rotation = rot;
                    _this.CheckClear(imgs);
                };
            };
            fun(i);
        }
    };
    Level1.prototype.CheckClear = function (imgs) {
        if (imgs[0].rotation == 330 && imgs[1].rotation == 30 && imgs[2].rotation == 315 && imgs[3].rotation == 315)
            this.m_pGameWorld.ShowClear();
    };
    return Level1;
}(LevelBase));
var Level10 = (function (_super) {
    __extends(Level10, _super);
    function Level10() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 15;
        _this.m_heightCount = 4;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        _this.m_moving = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level10.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "BlockLayer", "classType": "dSprite", "height": 50, "width": 50, "x": -758, "y": -260 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 843, "resourceFileName": "level/101.png", "width": 764, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 924, "resourceFileName": "level/102.png", "width": 96, "x": 42, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "height": 924, "resourceFileName": "", "width": 764, "x": 0, "y": -21 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Left1", "classType": "dButton", "height": 95, "resourceFileName": "level/105.png", "width": 109, "x": -455, "y": -290 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Left2", "classType": "dButton", "height": 95, "resourceFileName": "level/105.png", "width": 109, "x": -455, "y": -108 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Left3", "classType": "dButton", "height": 95, "resourceFileName": "level/105.png", "width": 109, "x": -455, "y": 74 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Left4", "classType": "dButton", "height": 95, "resourceFileName": "level/105.png", "width": 109, "x": -455, "y": 256 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Right1", "classType": "dButton", "height": 95, "resourceFileName": "level/106.png", "width": 109, "x": 452, "y": -290 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Right2", "classType": "dButton", "height": 95, "resourceFileName": "level/106.png", "width": 109, "x": 452, "y": -108 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Right3", "classType": "dButton", "height": 95, "resourceFileName": "level/106.png", "width": 109, "x": 452, "y": 74 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Right4", "classType": "dButton", "height": 95, "resourceFileName": "level/106.png", "width": 109, "x": 452, "y": 256 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level10.prototype.GetHintImageName = function () {
        return "level/107.png";
    };
    Level10.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.GameLayer_dImage2.SetTransparentMouse(true);
        this.GameLayer_dImage1.SetTransparentMouse(true);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new TextBlock2();
                    pBlock.SetPos(i * TextBlock2.BlockWidthWithSpace, j * TextBlock2.BlockHeightWithSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.GameLayer_BlockLayer.AddChild(pBlock);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        this.Left1.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.MoveBlock(_this.m_vecBlocks[0][0], -1);
        }));
        this.Left2.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.MoveBlock(_this.m_vecBlocks[1][0], -1);
        }));
        this.Left3.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.MoveBlock(_this.m_vecBlocks[2][0], -1);
        }));
        this.Left4.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.MoveBlock(_this.m_vecBlocks[3][0], -1);
        }));
        this.Right1.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.MoveBlock(_this.m_vecBlocks[0][0], 1);
        }));
        this.Right2.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.MoveBlock(_this.m_vecBlocks[1][0], 1);
        }));
        this.Right3.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.MoveBlock(_this.m_vecBlocks[2][0], 1);
        }));
        this.Right4.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.MoveBlock(_this.m_vecBlocks[3][0], 1);
        }));
        var a1 = ["", "", "", ""];
        for (var i = 0; i < this.m_heightCount; i++) {
            for (var j = 0; j < this.m_widthCount; j++)
                this.m_vecBlocks[i][j].SetText(a1[i].charAt(j));
        }
        this.GameLayer.clipChild = true;
    };
    Level10.prototype.MoveBlock = function (pBlock, dirX) {
        var _this = this;
        if (this.m_moving)
            return;
        this.m_moving = true;
        dSound.PlaySound("data/sound/button.mp3");
        new dTimer(this).Create(10, TextBlock2.BlockWidthWithSpace / 4, function (sender) {
            _this.OnMove(pBlock, 20 * dirX, 0);
            if (sender.isLastRepeat()) {
                _this.OnUp(pBlock);
                _this.m_moving = false;
            }
        });
    };
    Level10.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var canHor = true;
        var canVer = false;
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * TextBlock2.BlockWidthWithSpace) % (this.m_widthCount * TextBlock2.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * TextBlock2.BlockHeightWithSpace) % (this.m_heightCount * TextBlock2.BlockHeightWithSpace);
            }
        }
    };
    Level10.prototype.GetText = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetText();
    };
    Level10.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + TextBlock2.BlockWidthWithSpace / 2) / TextBlock2.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + TextBlock2.BlockHeightWithSpace / 2) / TextBlock2.BlockHeightWithSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * TextBlock2.BlockWidthWithSpace, blockY * TextBlock2.BlockHeightWithSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetText(8, 0) == "" && this.GetText(8, 1) == "" && this.GetText(8, 2) == "" && this.GetText(8, 3) == "")
            this.m_pGameWorld.ShowClear();
    };
    return Level10;
}(LevelBase));
var TextBlock2 = (function (_super) {
    __extends(TextBlock2, _super);
    function TextBlock2() {
        var _this = _super.call(this) || this;
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.Text = new dBitmapFont();
        _this.SetAnchor(0, 0);
        var p = new dSprite();
        p.SetSize(TextBlock2.BlockWidthWithSpace, TextBlock2.BlockHeightWithSpace);
        p.SetPos(-(TextBlock2.BlockWidthWithSpace - _this.width) / 2, -(TextBlock2.BlockHeightWithSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.Text.positionY = -10;
        _this.Text.fontSize = 80;
        _this.Text.spriteColor = 0xffffffff;
        _this.Text.LoadFromFile("data/zi.json");
        _this.AddChild(_this.Text);
        return _this;
    }
    TextBlock2.prototype.SetText = function (str) {
        this.Text.text = str;
    };
    TextBlock2.prototype.GetText = function () {
        return this.Text.text;
    };
    TextBlock2.BlockWidth = 126;
    TextBlock2.BlockHeight = 126;
    TextBlock2.BlockWidthWithSpace = 100;
    TextBlock2.BlockHeightWithSpace = 180;
    return TextBlock2;
}(dSprite));
var Level11 = (function (_super) {
    __extends(Level11, _super);
    function Level11() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        _this.m_numAdd = new Array(8);
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level11.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Num1", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 28.125, "x": 431, "y": -290 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num2", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 28.125, "x": 431, "y": -40 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num3", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 28.125, "x": 431, "y": 217 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num4", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 28.125, "x": -274, "y": 435 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num5", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 28.125, "x": -24, "y": 435 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num6", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 28.125, "x": 237, "y": 435 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num7", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 28.125, "x": -431, "y": -450 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num8", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 28.125, "x": -431, "y": 378 }], "alpha": 0.505882, "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dImage", "height": 973, "resourceFileName": "level/112.png", "width": 951, "x": -3, "y": -174.003723, "z": 9.372692 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 273, "resourceFileName": "level/113.png", "scaleX": 0.620359, "scaleY": 0.620358, "width": 782, "x": 0, "y": -696 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 177, "resourceFileName": "level/111.png", "width": 177, "x": -277, "y": -457, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 177, "resourceFileName": "level/111.png", "width": 177, "x": -26, "y": -457, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 177, "resourceFileName": "level/111.png", "width": 177, "x": 234, "y": -457, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 177, "resourceFileName": "level/111.png", "width": 177, "x": -277, "y": -207, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 177, "resourceFileName": "level/111.png", "width": 177, "x": -26, "y": -207, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block6", "classType": "dImage", "height": 177, "resourceFileName": "level/111.png", "width": 177, "x": 234, "y": -207, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block7", "classType": "dImage", "height": 177, "resourceFileName": "level/111.png", "width": 177, "x": -277, "y": 52, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block8", "classType": "dImage", "height": 177, "resourceFileName": "level/111.png", "width": 177, "x": -26, "y": 52, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block9", "classType": "dImage", "height": 177, "resourceFileName": "level/111.png", "width": 177, "x": 234, "y": 52, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 72, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -26 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 144, "x": -361.997192, "y": 416, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 92, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -13 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 144, "x": -192.997192, "y": 416, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 98, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -13 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 144, "x": -27.997192, "y": 416, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 99, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -13 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 144, "x": 152.002808, "y": 416, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -13 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 144, "x": 348.002808, "y": 416, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 102, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -13 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 144, "x": -264.997192, "y": 581, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 97, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -13 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag7", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 144, "x": -95.997192, "y": 581, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 95, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -13 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag8", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 144, "x": 69.002808, "y": 581, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -13 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag9", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 144, "x": 249.002808, "y": 581, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level11.prototype.GetHintImageName = function () {
        return "level/114.png";
    };
    Level11.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5, this.CanDrag6, this.CanDrag7, this.CanDrag8, this.CanDrag9];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5, this.Block6, this.Block7, this.Block8, this.Block9];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = (i + 1);
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.UpdateNum();
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
        this.UpdateNum();
    };
    Level11.prototype.CheckClear = function (p) {
        for (var i = 0; i < this.m_cards.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (!card)
                return;
        }
        for (var i = 0; i < 8; i++) {
            if (this.m_numAdd[i] != 15)
                return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level11.prototype.UpdateNum = function () {
        var num = new Array();
        for (var i = 0; i < this.m_cards.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card)
                num.push(card.userData["Num"]);
            else
                num.push(0);
        }
        this.Back_Num1.text = String(this.m_numAdd[0] = num[0] + num[1] + num[2]);
        this.Back_Num2.text = String(this.m_numAdd[1] = num[3] + num[4] + num[5]);
        this.Back_Num3.text = String(this.m_numAdd[2] = num[6] + num[7] + num[8]);
        this.Back_Num4.text = String(this.m_numAdd[3] = num[0] + num[3] + num[6]);
        this.Back_Num5.text = String(this.m_numAdd[4] = num[1] + num[4] + num[7]);
        this.Back_Num6.text = String(this.m_numAdd[5] = num[2] + num[5] + num[8]);
        this.Back_Num7.text = String(this.m_numAdd[6] = num[0] + num[4] + num[8]);
        this.Back_Num8.text = String(this.m_numAdd[7] = num[2] + num[4] + num[6]);
    };
    Level11.prototype.hasSame = function (arr, start) {
        for (var i = 0; i < arr.length; i++) {
            if (i == start)
                continue;
            if (arr[i] == arr[start])
                return true;
        }
        return false;
    };
    Level11.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level11.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level11;
}(LevelBase));
var Level12 = (function (_super) {
    __extends(Level12, _super);
    function Level12() {
        var _this = _super.call(this) || this;
        _this.m_vecBoxes = new Array();
        _this.m_rightTexts = ["", ""];
        _this.m_questTexts = ["", ""];
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level12.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text1", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 63 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text2", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 171 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text3", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 279 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text4", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 387 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text5", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -89 }], "anchorU": 0.5, "anchorV": 0, "className": "CanTouchDown1", "classType": "dImage", "height": 538, "resourceFileName": "level/121.png", "width": 175, "x": -342, "y": -220 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text1", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 63 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text2", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 171 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text3", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 279 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text4", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 387 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text5", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -89 }], "anchorU": 0.5, "anchorV": 0, "className": "CanTouchDown2", "classType": "dImage", "height": 538, "resourceFileName": "level/121.png", "width": 175, "x": -114, "y": -220 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text1", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 63 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text2", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 171 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text3", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 279 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text4", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 387 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text5", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -89 }], "anchorU": 0.5, "anchorV": 0, "className": "CanTouchDown3", "classType": "dImage", "height": 538, "resourceFileName": "level/121.png", "width": 175, "x": 114, "y": -220 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text1", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 63 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text2", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 171 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text3", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 279 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text4", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": 387 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text5", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -89 }], "anchorU": 0.5, "anchorV": 0, "className": "CanTouchDown4", "classType": "dImage", "height": 538, "resourceFileName": "level/121.png", "width": 175, "x": 342, "y": -220 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level12.prototype.GetHintImageName = function () {
        return "level/122.png";
    };
    Level12.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var box1 = new LevelOrderBox();
        box1.box = this.CanTouchDown1;
        box1.upText = this.CanTouchDown1_Text5;
        box1.vecTexts.push(this.CanTouchDown1_Text1);
        box1.vecTexts.push(this.CanTouchDown1_Text2);
        box1.vecTexts.push(this.CanTouchDown1_Text3);
        box1.vecTexts.push(this.CanTouchDown1_Text4);
        var box2 = new LevelOrderBox();
        box2.box = this.CanTouchDown2;
        box2.upText = this.CanTouchDown2_Text5;
        box2.vecTexts.push(this.CanTouchDown2_Text1);
        box2.vecTexts.push(this.CanTouchDown2_Text2);
        box2.vecTexts.push(this.CanTouchDown2_Text3);
        box2.vecTexts.push(this.CanTouchDown2_Text4);
        var box3 = new LevelOrderBox();
        box3.box = this.CanTouchDown3;
        box3.upText = this.CanTouchDown3_Text5;
        box3.vecTexts.push(this.CanTouchDown3_Text1);
        box3.vecTexts.push(this.CanTouchDown3_Text2);
        box3.vecTexts.push(this.CanTouchDown3_Text3);
        box3.vecTexts.push(this.CanTouchDown3_Text4);
        var box4 = new LevelOrderBox();
        box4.box = this.CanTouchDown4;
        box4.upText = this.CanTouchDown4_Text5;
        box4.vecTexts.push(this.CanTouchDown4_Text1);
        box4.vecTexts.push(this.CanTouchDown4_Text2);
        box4.vecTexts.push(this.CanTouchDown4_Text3);
        box4.vecTexts.push(this.CanTouchDown4_Text4);
        this.m_vecBoxes.push(box1);
        this.m_vecBoxes.push(box2);
        this.m_vecBoxes.push(box3);
        this.m_vecBoxes.push(box4);
        for (var i = 0; i < this.m_vecBoxes.length; i++) {
            for (var j = 0; j < this.m_vecBoxes[i].vecTexts.length; j++)
                this.m_vecBoxes[i].vecTexts[j].text = "";
            this.m_vecBoxes[i].upText.text = "";
        }
        for (var i = 0; i < this.m_questTexts.length; i++) {
            for (var j = 0; j < this.m_questTexts[i].length; j++) {
                this.m_vecBoxes[i].vecTexts[j].text = this.m_questTexts[i].charAt(j);
            }
        }
        for (var i = 0; i < this.m_vecBoxes.length; i++) {
            var fun = function (i) {
                _this.m_vecBoxes[i].box.userData["CanTouchDown"].touchDownScaleMode = false;
                _this.m_vecBoxes[i].box.userData["CanTouchDown"].onTouchDown = function () {
                    var curUp = _this.GetCurUpBox();
                    if (curUp == null || curUp == _this.m_vecBoxes[i]) {
                        _this.m_vecBoxes[i].SwitchToUp();
                        dSound.PlaySound("data/sound/button.mp3");
                    }
                    else {
                        if (_this.m_vecBoxes[i].GetTexts().length >= 4) {
                            curUp.SwitchToUp();
                            _this.m_vecBoxes[i].SwitchToUp();
                            dSound.PlaySound("data/sound/button.mp3");
                        }
                        else {
                            _this.m_vecBoxes[i].AddText(curUp.upText.text);
                            curUp.upText.text = "";
                            _this.CheckClear();
                            dSound.PlaySound("data/sound/button.mp3");
                        }
                    }
                };
            };
            fun(i);
        }
    };
    Level12.prototype.GetCurUpBox = function () {
        for (var i = 0; i < this.m_vecBoxes.length; i++)
            if (this.m_vecBoxes[i].isUp())
                return this.m_vecBoxes[i];
        return null;
    };
    Level12.prototype.CheckClear = function () {
        for (var i = 0; i < this.m_vecBoxes.length; i++) {
            if (!this.isRightText(this.m_vecBoxes[i].GetTexts()))
                return false;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level12.prototype.isRightText = function (str) {
        if (str == "")
            return true;
        for (var i = 0; i < this.m_rightTexts.length; i++)
            if (str == this.m_rightTexts[i])
                return true;
        return false;
    };
    return Level12;
}(LevelBase));
var LevelOrderBox = (function () {
    function LevelOrderBox() {
        this.box = null;
        this.vecTexts = new Array();
        this.upText = null;
    }
    LevelOrderBox.prototype.SwitchToUp = function () {
        if (this.isUp()) {
            this.AddText(this.upText.text);
            this.upText.text = "";
        }
        else {
            for (var i = 0; i < this.vecTexts.length; i++) {
                if (this.vecTexts[i].text != "") {
                    this.upText.text = this.vecTexts[i].text;
                    this.vecTexts[i].text = "";
                    break;
                }
            }
        }
    };
    LevelOrderBox.prototype.isUp = function () {
        return this.upText.text != "";
    };
    LevelOrderBox.prototype.GetTexts = function () {
        var ret = this.upText.text;
        for (var i = 0; i < this.vecTexts.length; i++)
            ret += this.vecTexts[i].text;
        return ret;
    };
    LevelOrderBox.prototype.AddText = function (str) {
        for (var i = this.vecTexts.length - 1; i >= 0; i--) {
            if (this.vecTexts[i].text == "") {
                this.vecTexts[i].text = str;
                break;
            }
        }
    };
    return LevelOrderBox;
}());
var Level13 = (function (_super) {
    __extends(Level13, _super);
    function Level13() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 7;
        _this.m_heightCount = 7;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        _this.m_nTouchMoveDir = 0;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level13.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "BlockLayer", "classType": "dSprite", "height": 50, "width": 50, "x": -355, "y": -355 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "height": 560, "resourceFileName": "", "width": 560, "x": -138, "y": 80 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 817, "resourceFileName": "level/131.png", "width": 844, "x": 0, "y": -44 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level13.prototype.GetHintImageName = function () {
        return "level/132.png";
    };
    Level13.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.dImage2.SetTransparentMouse(true);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new TextBlock3();
                    pBlock.SetPos(i * TextBlock3.BlockWidthWithSpace, j * TextBlock3.BlockHeightWithSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.GameLayer_BlockLayer.AddChild(pBlock);
                    var pTouchEvent = new dSprite();
                    pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                        _this.OnMove(pBlock, offx, offy);
                    };
                    pTouchEvent.OnTouchUp = function (x, y) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.OnUp(pBlock);
                    };
                    pBlock.SetTouchEvent(pTouchEvent);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        var a1 = ["", "", "", "", "", "", ""];
        for (var i = 0; i < this.m_heightCount; i++) {
            this.m_vecBlocks[i][0].SetText(a1[i]);
            this.m_vecBlocks[i][1].SetText(a1[i]);
            this.m_vecBlocks[i][2].SetText(a1[i]);
            this.m_vecBlocks[i][3].SetText(a1[i]);
            this.m_vecBlocks[i][4].SetText(a1[i]);
            this.m_vecBlocks[i][5].SetText(a1[i]);
            this.m_vecBlocks[i][6].SetText(a1[i]);
        }
        this.GameLayer.clipChild = true;
    };
    Level13.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var canHor = true;
        var canVer = true;
        if (canHor && canVer) {
            if (this.m_nTouchMoveDir == 0) {
                this.m_vTouchMoveAdd.x += offx;
                this.m_vTouchMoveAdd.y += offy;
                if (dMath.Abs(this.m_vTouchMoveAdd.x) > 10)
                    this.m_nTouchMoveDir = 1;
                else if (dMath.Abs(this.m_vTouchMoveAdd.y) > 10)
                    this.m_nTouchMoveDir = 2;
            }
            if (this.m_nTouchMoveDir == 1)
                canVer = false;
            else if (this.m_nTouchMoveDir == 2)
                canHor = false;
        }
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * TextBlock3.BlockWidthWithSpace) % (this.m_widthCount * TextBlock3.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * TextBlock3.BlockHeightWithSpace) % (this.m_heightCount * TextBlock3.BlockHeightWithSpace);
            }
        }
        this.PlayFrictionSound();
    };
    Level13.prototype.GetText = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetText();
    };
    Level13.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        this.m_nTouchMoveDir = 0;
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + TextBlock3.BlockWidthWithSpace / 2) / TextBlock3.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + TextBlock3.BlockHeightWithSpace / 2) / TextBlock3.BlockHeightWithSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * TextBlock3.BlockWidthWithSpace, blockY * TextBlock3.BlockHeightWithSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetText(1, 1) == "" && this.GetText(2, 1) == "" && this.GetText(3, 1) == "" && this.GetText(4, 1) == "" &&
            this.GetText(4, 2) == "" && this.GetText(4, 3) == "")
            this.m_pGameWorld.ShowClear();
    };
    return Level13;
}(LevelBase));
var TextBlock3 = (function (_super) {
    __extends(TextBlock3, _super);
    function TextBlock3() {
        var _this = _super.call(this) || this;
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.Text = new dBitmapFont();
        _this.SetAnchor(0, 0);
        var p = new dSprite();
        p.SetSize(TextBlock3.BlockWidthWithSpace, TextBlock3.BlockHeightWithSpace);
        p.SetPos(-(TextBlock3.BlockWidthWithSpace - _this.width) / 2, -(TextBlock3.BlockHeightWithSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.Text.positionY = -10;
        _this.Text.fontSize = 80;
        _this.Text.spriteColor = 0xffffffff;
        _this.Text.LoadFromFile("data/zi.json");
        _this.AddChild(_this.Text);
        return _this;
    }
    TextBlock3.prototype.SetText = function (str) {
        this.Text.text = str;
    };
    TextBlock3.prototype.GetText = function () {
        return this.Text.text;
    };
    TextBlock3.BlockWidth = 126;
    TextBlock3.BlockHeight = 126;
    TextBlock3.BlockWidthWithSpace = 140;
    TextBlock3.BlockHeightWithSpace = 140;
    return TextBlock3;
}(dSprite));
var Level14 = (function (_super) {
    __extends(Level14, _super);
    function Level14() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        _this.m_numAdd = new Array(4);
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level14.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 282, "resourceFileName": "level/141.png", "scaleX": 0.737588, "scaleY": 0.737589, "width": 895, "x": 0, "y": -749, "z": -35.57291 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 777, "resourceFileName": "level/142.png", "width": 778, "x": 0, "y": -125, "z": -35.57291 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text1", "classType": "dBitmapFont", "fontSize": 100, "height": 92, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": -196, "y": -337 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text2", "classType": "dBitmapFont", "fontSize": 100, "height": 92, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 189, "y": -337 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text3", "classType": "dBitmapFont", "fontSize": 100, "height": 92, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": -196, "y": 55 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text4", "classType": "dBitmapFont", "fontSize": 100, "height": 92, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 197, "y": 55 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": -374, "y": -512, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": 2, "y": -512, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": 387, "y": -512, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": -388, "y": -126, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": -185, "y": -126, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block6", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": 2, "y": -307, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block7", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": 177, "y": -125, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block8", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": 387, "y": -126, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block9", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": -388, "y": 261, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block10", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": 0, "y": 261, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block11", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": 0, "y": 65, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block12", "classType": "dImage", "height": 148, "resourceFileName": "level/143.png", "width": 148, "x": 388, "y": 260, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/fontNumber.json", "text": "1", "width": 35.9375, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": -354.997192, "y": 440, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/fontNumber.json", "text": "2", "width": 56.25, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": -202.997192, "y": 440, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 101.5625, "resourceFileName": "data/fontNumber.json", "text": "3", "width": 56.25, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": -50.997192, "y": 440, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/fontNumber.json", "text": "4", "width": 56.25, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": 101.002808, "y": 440, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 101.5625, "resourceFileName": "data/fontNumber.json", "text": "5", "width": 56.25, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": 253.002808, "y": 440, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 101.5625, "resourceFileName": "data/fontNumber.json", "text": "6", "width": 56.25, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": 405.002808, "y": 440, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/fontNumber.json", "text": "7", "width": 53.125, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag7", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": -426.997192, "y": 574, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 101.5625, "resourceFileName": "data/fontNumber.json", "text": "8", "width": 56.25, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag8", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": -274.997192, "y": 574, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 101.5625, "resourceFileName": "data/fontNumber.json", "text": "9", "width": 56.25, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag9", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": -122.997192, "y": 574, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/fontNumber.json", "text": "11", "width": 71.875, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag10", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": 29.002808, "y": 574, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/fontNumber.json", "text": "12", "width": 92.1875, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag11", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": 181.002808, "y": 574, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 101.5625, "resourceFileName": "data/fontNumber.json", "text": "13", "width": 92.1875, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag12", "classType": "dImage", "height": 120, "resourceFileName": "", "width": 120, "x": 333.002808, "y": 574, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 73 }; };
    Level14.prototype.GetHintImageName = function () {
        return "level/144.png";
    };
    Level14.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5, this.CanDrag6, this.CanDrag7, this.CanDrag8, this.CanDrag9, this.CanDrag10, this.CanDrag11, this.CanDrag12];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5, this.Block6, this.Block7, this.Block8, this.Block9, this.Block10, this.Block11, this.Block12];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = Number(this.m_cards[i].FindChild("Text").text);
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.UpdateNum();
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
        this.UpdateNum();
    };
    Level14.prototype.CheckClear = function (p) {
        for (var i = 0; i < this.m_cards.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (!card)
                return;
        }
        for (var i = 1; i < this.m_numAdd.length; i++) {
            if (this.m_numAdd[i] != this.m_numAdd[0])
                return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level14.prototype.UpdateNum = function () {
        var num = new Array();
        for (var i = 0; i < this.m_cards.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card)
                num.push(card.userData["Num"]);
            else
                num.push(0);
        }
        this.m_numAdd[0] = num[0] + num[1] + num[3] + num[4] + num[5];
        this.m_numAdd[1] = num[1] + num[2] + num[5] + num[6] + num[7];
        this.m_numAdd[2] = num[3] + num[4] + num[8] + num[9] + num[10];
        this.m_numAdd[3] = num[9] + num[10] + num[6] + num[7] + num[11];
        this.Text1.text = this.ToUpNum(this.m_numAdd[0]);
        this.Text2.text = this.ToUpNum(this.m_numAdd[1]);
        this.Text3.text = this.ToUpNum(this.m_numAdd[2]);
        this.Text4.text = this.ToUpNum(this.m_numAdd[3]);
    };
    Level14.prototype.ToUpNum = function (num) {
        var s = String(num);
        var ret = "";
        for (var i = 0; i < s.length; i++) {
            switch (s.charAt(i)) {
                case "0":
                    ret += "";
                    break;
                case "1":
                    ret += "";
                    break;
                case "2":
                    ret += "";
                    break;
                case "3":
                    ret += "";
                    break;
                case "4":
                    ret += "";
                    break;
                case "5":
                    ret += "";
                    break;
                case "6":
                    ret += "";
                    break;
                case "7":
                    ret += "";
                    break;
                case "8":
                    ret += "";
                    break;
                case "9":
                    ret += "";
                    break;
            }
        }
        return ret;
    };
    Level14.prototype.hasSame = function (arr, start) {
        for (var i = 0; i < arr.length; i++) {
            if (i == start)
                continue;
            if (arr[i] == arr[start])
                return true;
        }
        return false;
    };
    Level14.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level14.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level14;
}(LevelBase));
var Level15 = (function (_super) {
    __extends(Level15, _super);
    function Level15() {
        var _this = _super.call(this) || this;
        _this.m_blocks = null;
        _this.m_nums = null;
        _this.m_crossed = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level15.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text1", "classType": "dBitmapFont", "fontSize": 50, "height": 50, "resourceFileName": "data/fontNumber.json", "text": "7", "width": 26.5625, "x": 437, "y": -432 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text2", "classType": "dBitmapFont", "fontSize": 50, "height": 50, "resourceFileName": "data/fontNumber.json", "text": "7", "width": 26.5625, "x": 437, "y": -292 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text3", "classType": "dBitmapFont", "fontSize": 50, "height": 50, "resourceFileName": "data/fontNumber.json", "text": "4", "width": 28.125, "x": 437, "y": -152 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text4", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "9", "width": 28.125, "x": 437, "y": -12 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text5", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "6", "width": 28.125, "x": 437, "y": 128 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text6", "classType": "dBitmapFont", "fontSize": 50, "height": 50, "resourceFileName": "data/fontNumber.json", "text": "2", "width": 28.125, "x": 437, "y": 268 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text7", "classType": "dBitmapFont", "fontSize": 50, "height": 50, "resourceFileName": "data/fontNumber.json", "text": "11", "width": 35.9375, "x": -423, "y": 431 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text8", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "9", "width": 28.125, "x": -283, "y": 431 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text9", "classType": "dBitmapFont", "fontSize": 50, "height": 50.78125, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 28.125, "x": -143, "y": 431 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text10", "classType": "dBitmapFont", "fontSize": 50, "height": 50, "resourceFileName": "data/fontNumber.json", "text": "4", "width": 28.125, "x": -3, "y": 431 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text11", "classType": "dBitmapFont", "fontSize": 50, "height": 50, "resourceFileName": "data/fontNumber.json", "text": "7", "width": 26.5625, "x": 137, "y": 431 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text12", "classType": "dBitmapFont", "fontSize": 50, "height": 50, "resourceFileName": "data/fontNumber.json", "text": "4", "width": 28.125, "x": 277, "y": 431 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dImage", "height": 988, "resourceFileName": "level/151.png", "width": 983, "x": 0, "y": -291 }, { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "CanDrag1", "classType": "dImage", "height": 144, "resourceFileName": "level/152.png", "width": 565, "x": -24, "y": 1006 }, { "anchorU": 0, "anchorV": 0, "className": "CanDrag2", "classType": "dImage", "height": 564, "resourceFileName": "level/153.png", "width": 145, "x": 844, "y": 810 }, { "anchorU": 0, "anchorV": 0, "className": "CanDrag3", "classType": "dImage", "height": 564, "resourceFileName": "level/154.png", "width": 145, "x": 604, "y": 1031 }, { "anchorU": 0, "anchorV": 0, "className": "CanDrag4", "classType": "dImage", "height": 284, "resourceFileName": "level/155.png", "width": 285, "x": 15, "y": 1208 }, { "anchorU": 0, "anchorV": 0, "className": "CanDrag5", "classType": "dImage", "height": 284, "resourceFileName": "level/156.png", "width": 285, "x": 248, "y": 1068 }, { "anchorU": 0, "anchorV": 0, "className": "CanDrag6", "classType": "dImage", "height": 144, "resourceFileName": "level/157.png", "width": 565, "x": 318, "y": 1297 }], "anchorU": 0, "anchorV": 0, "className": "Gamelayer", "classType": "dSprite", "height": 840, "width": 840, "x": -492, "y": -785 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level15.prototype.GetHintImageName = function () {
        return "level/158.png";
    };
    Level15.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var imgs = [this.Gamelayer_CanDrag1, this.Gamelayer_CanDrag2, this.Gamelayer_CanDrag3, this.Gamelayer_CanDrag4, this.Gamelayer_CanDrag5, this.Gamelayer_CanDrag6];
        this.m_blocks = imgs;
        this.Gamelayer_CanDrag1.userData["BlockWidth"] = 4;
        this.Gamelayer_CanDrag1.userData["BlockHeight"] = 1;
        this.Gamelayer_CanDrag1.userData["BlockNumber"] = [0, 3, 0, 4];
        this.Gamelayer_CanDrag2.userData["BlockWidth"] = 1;
        this.Gamelayer_CanDrag2.userData["BlockHeight"] = 4;
        this.Gamelayer_CanDrag2.userData["BlockNumber"] = [5, 0, 6, 0];
        this.Gamelayer_CanDrag3.userData["BlockWidth"] = 1;
        this.Gamelayer_CanDrag3.userData["BlockHeight"] = 4;
        this.Gamelayer_CanDrag3.userData["BlockNumber"] = [1, 0, 3, 0];
        this.Gamelayer_CanDrag4.userData["BlockWidth"] = 2;
        this.Gamelayer_CanDrag4.userData["BlockHeight"] = 2;
        this.Gamelayer_CanDrag4.userData["BlockNumber"] = [0, 2, 0, 3];
        this.Gamelayer_CanDrag5.userData["BlockWidth"] = 2;
        this.Gamelayer_CanDrag5.userData["BlockHeight"] = 2;
        this.Gamelayer_CanDrag5.userData["BlockNumber"] = [3, 0, 2, 0];
        this.Gamelayer_CanDrag6.userData["BlockWidth"] = 4;
        this.Gamelayer_CanDrag6.userData["BlockHeight"] = 1;
        this.Gamelayer_CanDrag6.userData["BlockNumber"] = [1, 0, 0, 2];
        for (var i = 0; i < imgs.length; i++) {
            imgs[i].userData["BlockX"] = -1;
            imgs[i].userData["BlockY"] = -1;
            imgs[i].userData["CanDrag"].onTouchDown = function (canDrag) {
                _this.Gamelayer.AddChild(canDrag.m_target);
            };
            imgs[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                dSound.PlaySound("data/sound/button.mp3");
                var image = canDrag.m_target;
                var rc = new dRect().SetPosSize(0, 0, _this.Gamelayer.width, _this.Gamelayer.height);
                if (rc.CollectPoint(image.positionX + 140 / 2, image.positionY + 140 / 2)) {
                    image.positionX += 140 / 2;
                    image.positionY += 140 / 2;
                    image.userData["BlockX"] = dMath.ToInt(image.positionX / 140);
                    image.userData["BlockY"] = dMath.ToInt(image.positionY / 140);
                    image.positionX = image.userData["BlockX"] * 140;
                    image.positionY = image.userData["BlockY"] * 140;
                }
                else {
                    image.userData["BlockX"] = -1;
                    image.userData["BlockY"] = -1;
                }
                _this.CheckBlockCross();
                _this.UpdateNumber();
                _this.CheckClear();
            };
        }
        this.UpdateNumber();
    };
    Level15.prototype.CheckBlockCross = function () {
        this.m_crossed = false;
        for (var i = 0; i < this.m_blocks.length; i++) {
            this.m_blocks[i].spriteColor = 0xffffffff;
            if (this.m_blocks[i].userData["BlockX"] != -1 && this.m_blocks[i].userData["BlockY"] != -1) {
                var rc1 = new dRect().SetPosSize(this.m_blocks[i].userData["BlockX"], this.m_blocks[i].userData["BlockY"], this.m_blocks[i].userData["BlockWidth"] - 1, this.m_blocks[i].userData["BlockHeight"] - 1);
                for (var j = 0; j < this.m_blocks.length; j++) {
                    if (this.m_blocks[j] == this.m_blocks[i])
                        continue;
                    var rc2 = new dRect().SetPosSize(this.m_blocks[j].userData["BlockX"], this.m_blocks[j].userData["BlockY"], this.m_blocks[j].userData["BlockWidth"] - 1, this.m_blocks[j].userData["BlockHeight"] - 1);
                    if (rc2.left != -1 && rc2.top != -1 && rc1.Collect(rc2)) {
                        this.m_blocks[i].spriteColor = 0xffff0000;
                        this.m_crossed = true;
                    }
                }
            }
        }
    };
    Level15.prototype.UpdateNumber = function () {
        var num = new Array(6);
        for (var i = 0; i < 6; i++) {
            num[i] = new Array(6);
            for (var j = 0; j < 6; j++)
                num[i][j] = 0;
        }
        for (var i = 0; i < this.m_blocks.length; i++) {
            var rc1 = new dRect().SetPosSize(this.m_blocks[i].userData["BlockX"], this.m_blocks[i].userData["BlockY"], this.m_blocks[i].userData["BlockWidth"], this.m_blocks[i].userData["BlockHeight"]);
            if (rc1.left != -1 && rc1.top != -1) {
                var k = 0;
                for (var y = rc1.top; y < rc1.bottom; y++) {
                    for (var x = rc1.left; x < rc1.right; x++) {
                        if (x >= 0 && y >= 0 && y < num.length && x < num[0].length)
                            num[y][x] += this.m_blocks[i].userData["BlockNumber"][k];
                        k++;
                    }
                }
            }
        }
        this.m_nums = num;
        this.Back_Text1.alpha = this.GetRowNum(0) == Number(this.Back_Text1.text) ? 1 : 0.5;
        this.Back_Text2.alpha = this.GetRowNum(1) == Number(this.Back_Text2.text) ? 1 : 0.5;
        this.Back_Text3.alpha = this.GetRowNum(2) == Number(this.Back_Text3.text) ? 1 : 0.5;
        this.Back_Text4.alpha = this.GetRowNum(3) == Number(this.Back_Text4.text) ? 1 : 0.5;
        this.Back_Text5.alpha = this.GetRowNum(4) == Number(this.Back_Text5.text) ? 1 : 0.5;
        this.Back_Text6.alpha = this.GetRowNum(5) == Number(this.Back_Text6.text) ? 1 : 0.5;
        this.Back_Text7.alpha = this.GetColNum(0) == Number(this.Back_Text7.text) ? 1 : 0.5;
        this.Back_Text8.alpha = this.GetColNum(1) == Number(this.Back_Text8.text) ? 1 : 0.5;
        this.Back_Text9.alpha = this.GetColNum(2) == Number(this.Back_Text9.text) ? 1 : 0.5;
        this.Back_Text10.alpha = this.GetColNum(3) == Number(this.Back_Text10.text) ? 1 : 0.5;
        this.Back_Text11.alpha = this.GetColNum(4) == Number(this.Back_Text11.text) ? 1 : 0.5;
        this.Back_Text12.alpha = this.GetColNum(5) == Number(this.Back_Text12.text) ? 1 : 0.5;
    };
    Level15.prototype.GetRowNum = function (line) {
        var ret = 0;
        for (var i = 0; i < this.m_nums[0].length; i++)
            ret += this.m_nums[line][i];
        return ret;
    };
    Level15.prototype.GetColNum = function (col) {
        var ret = 0;
        for (var i = 0; i < this.m_nums.length; i++)
            ret += this.m_nums[i][col];
        return ret;
    };
    Level15.prototype.CheckClear = function () {
        if (this.m_crossed)
            return;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var rc1 = new dRect().SetPosSize(this.m_blocks[i].userData["BlockX"], this.m_blocks[i].userData["BlockY"], this.m_blocks[i].userData["BlockWidth"], this.m_blocks[i].userData["BlockHeight"]);
            if (rc1.left < 0 || rc1.top < 0 || rc1.right > 6 || rc1.bottom > 6)
                return;
        }
        if (this.GetRowNum(0) != Number(this.Back_Text1.text))
            return;
        if (this.GetRowNum(1) != Number(this.Back_Text2.text))
            return;
        if (this.GetRowNum(2) != Number(this.Back_Text3.text))
            return;
        if (this.GetRowNum(3) != Number(this.Back_Text4.text))
            return;
        if (this.GetRowNum(4) != Number(this.Back_Text5.text))
            return;
        if (this.GetRowNum(5) != Number(this.Back_Text6.text))
            return;
        if (this.GetColNum(0) != Number(this.Back_Text7.text))
            return;
        if (this.GetColNum(1) != Number(this.Back_Text8.text))
            return;
        if (this.GetColNum(2) != Number(this.Back_Text9.text))
            return;
        if (this.GetColNum(3) != Number(this.Back_Text10.text))
            return;
        if (this.GetColNum(4) != Number(this.Back_Text11.text))
            return;
        if (this.GetColNum(5) != Number(this.Back_Text12.text))
            return;
        this.m_pGameWorld.ShowClear();
    };
    return Level15;
}(LevelBase));
var Level16 = (function (_super) {
    __extends(Level16, _super);
    function Level16() {
        var _this = _super.call(this) || this;
        _this.m_block = null;
        _this.m_moving = false;
        _this.m_text = "";
        _this.m_backBlocks = null;
        _this.m_location = 0;
        _this.m_touchMoveAdd = new dVector2();
        _this.m_touchMoved = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level16.prototype._dscData = function () { return { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "GameLayer", "classType": "dSprite", "height": 680, "width": 816, "x": -408, "y": -621 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 684, "resourceFileName": "level/161.png", "width": 819, "x": 0, "y": -281 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "TouchMoveLayer", "classType": "dSprite", "height": 1600, "width": 1080, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 74, "resourceFileName": "data/font64.json", "text": "", "width": 128, "x": 0, "y": -16 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ClearButton", "classType": "dButton", "height": 107, "resourceFileName": "data/button2.png", "width": 171, "x": -365, "y": 563 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 110, "resourceFileName": "level/103.png", "width": 96, "x": 0, "y": 249 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 110, "resourceFileName": "level/104.png", "width": 96, "x": 0, "y": 517 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "LeftButton", "classType": "dButton", "height": 95, "resourceFileName": "level/105.png", "width": 109, "x": -136, "y": 385 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "RightButton", "classType": "dButton", "height": 95, "resourceFileName": "level/106.png", "width": 109, "x": 131, "y": 385 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level16.prototype.GetHintImageName = function () {
        return "level/162.png";
    };
    Level16.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_backBlocks = new Array(5);
        for (var j = 0; j < this.m_backBlocks.length; j++) {
            this.m_backBlocks[j] = new Array(6);
            for (var i = 0; i < this.m_backBlocks[j].length; i++) {
                this.m_backBlocks[j][i] = new TextBlock4();
                this.GameLayer.AddChild(this.m_backBlocks[j][i]);
                this.m_backBlocks[j][i].SetBlockPos(i, j, false, this);
                this.m_backBlocks[j][i].spriteColor = 0;
                this.m_backBlocks[j][i].m_label.text = "";
            }
        }
        this.m_block = new TextBlock4();
        this.GameLayer.AddChild(this.m_block);
        this.UpButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            if (_this.m_moving)
                return;
            if (_this.CanMove(_this.m_block.m_blockX, _this.m_block.m_blockY - 1)) {
                dSound.PlaySound("data/sound/button.mp3");
                _this.m_backBlocks[_this.m_block.m_blockY][_this.m_block.m_blockX].m_label.text = _this.m_block.m_label.text;
                _this.m_backBlocks[_this.m_block.m_blockY][_this.m_block.m_blockX].m_label.alpha = 1;
                _this.m_block.m_blockY--;
                _this.m_block.SetBlockPos(_this.m_block.m_blockX, _this.m_block.m_blockY, true, _this);
                _this.m_location++;
                _this.m_block.m_label.text = _this.m_text.charAt(_this.m_location);
            }
            else
                _this.PlayCannotMove(0, -1);
        }));
        this.DownButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            if (_this.m_moving)
                return;
            if (_this.CanMove(_this.m_block.m_blockX, _this.m_block.m_blockY + 1)) {
                dSound.PlaySound("data/sound/button.mp3");
                _this.m_backBlocks[_this.m_block.m_blockY][_this.m_block.m_blockX].m_label.text = _this.m_block.m_label.text;
                _this.m_backBlocks[_this.m_block.m_blockY][_this.m_block.m_blockX].m_label.alpha = 1;
                _this.m_block.m_blockY++;
                _this.m_block.SetBlockPos(_this.m_block.m_blockX, _this.m_block.m_blockY, true, _this);
                _this.m_location++;
                _this.m_block.m_label.text = _this.m_text.charAt(_this.m_location);
            }
            else
                _this.PlayCannotMove(0, 1);
        }));
        this.LeftButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            if (_this.m_moving)
                return;
            if (_this.CanMove(_this.m_block.m_blockX - 1, _this.m_block.m_blockY)) {
                dSound.PlaySound("data/sound/button.mp3");
                _this.m_backBlocks[_this.m_block.m_blockY][_this.m_block.m_blockX].m_label.text = _this.m_block.m_label.text;
                _this.m_backBlocks[_this.m_block.m_blockY][_this.m_block.m_blockX].m_label.alpha = 1;
                _this.m_block.m_blockX--;
                _this.m_block.SetBlockPos(_this.m_block.m_blockX, _this.m_block.m_blockY, true, _this);
                _this.m_location++;
                _this.m_block.m_label.text = _this.m_text.charAt(_this.m_location);
            }
            else
                _this.PlayCannotMove(-1, 0);
        }));
        this.RightButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            if (_this.m_moving)
                return;
            if (_this.CanMove(_this.m_block.m_blockX + 1, _this.m_block.m_blockY)) {
                dSound.PlaySound("data/sound/button.mp3");
                _this.m_backBlocks[_this.m_block.m_blockY][_this.m_block.m_blockX].m_label.text = _this.m_block.m_label.text;
                _this.m_backBlocks[_this.m_block.m_blockY][_this.m_block.m_blockX].m_label.alpha = 1;
                _this.m_block.m_blockX++;
                _this.m_block.SetBlockPos(_this.m_block.m_blockX, _this.m_block.m_blockY, true, _this);
                _this.m_location++;
                _this.m_block.m_label.text = _this.m_text.charAt(_this.m_location);
            }
            else
                _this.PlayCannotMove(1, 0);
        }));
        this.ClearButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.ClearGame();
        }));
        this.ClearGame();
        var pTouchEvent = new dSprite();
        pTouchEvent.OnTouchDown = function (x, y, delta) {
            _this.m_touchMoved = false;
            _this.m_touchMoveAdd.SetValue(0, 0);
        };
        pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
            _this.m_touchMoveAdd.x += offx;
            _this.m_touchMoveAdd.y += offy;
            if (!_this.m_touchMoved && _this.m_touchMoveAdd.Length() > 10) {
                _this.m_touchMoved = true;
                if (dMath.Abs(_this.m_touchMoveAdd.x) > dMath.Abs(_this.m_touchMoveAdd.y)) {
                    if (_this.m_touchMoveAdd.x < 0)
                        _this.LeftButton.GetEvent().OnButtonDown(_this.LeftButton);
                    else
                        _this.RightButton.GetEvent().OnButtonDown(_this.RightButton);
                }
                else {
                    if (_this.m_touchMoveAdd.y < 0)
                        _this.UpButton.GetEvent().OnButtonDown(_this.UpButton);
                    else
                        _this.DownButton.GetEvent().OnButtonDown(_this.DownButton);
                }
            }
        };
        this.TouchMoveLayer.SetTouchEvent(pTouchEvent);
        this.TouchMoveLayer.SetHandleMouse(true);
    };
    Level16.prototype.PlayCannotMove = function (x, y) {
        var _this = this;
        dSound.PlaySound("data/sound/button.mp3");
        this.m_moving = true;
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCMoveBy(0.1, 20 * x, 20 * y),
            new CCMoveBy(0.1, -20 * x, -20 * y),
            new CCCallFunc(function () {
                _this.m_moving = false;
            })
        ]), this.m_block);
    };
    Level16.prototype.ClearGame = function () {
        this.m_location = 0;
        this.m_block.SetBlockPos(3, 4, false, this);
        this.m_block.m_label.text = this.m_text.charAt(this.m_location);
        for (var j = 0; j < this.m_backBlocks.length; j++) {
            for (var i = 0; i < this.m_backBlocks[j].length; i++) {
                this.m_backBlocks[j][i].m_label.text = "";
            }
        }
        this.m_backBlocks[3][1].m_label.text = "";
        this.m_backBlocks[0][3].m_label.text = "";
        this.m_backBlocks[0][4].m_label.text = "";
        this.m_backBlocks[3][1].m_label.alpha = 0.5;
        this.m_backBlocks[0][3].m_label.alpha = 0.5;
        this.m_backBlocks[0][4].m_label.alpha = 0.5;
    };
    Level16.prototype.CanMove = function (x, y) {
        if (x < 0 || y < 0 || y >= this.m_backBlocks.length || x >= this.m_backBlocks[y].length)
            return false;
        if (x == 0 && y == 0 || x == 5 && y == 4)
            return false;
        var curText = this.m_text.charAt(this.m_location + 1);
        var backBlock = this.m_backBlocks[y][x];
        if (backBlock.m_label.text != "" && backBlock.m_label.text != curText)
            return false;
        return true;
    };
    Level16.prototype.CheckClear = function () {
        if (this.m_location == 27)
            this.m_pGameWorld.ShowClear();
    };
    return Level16;
}(LevelBase));
var TextBlock4 = (function (_super) {
    __extends(TextBlock4, _super);
    function TextBlock4() {
        var _this = _super.call(this) || this;
        _this.m_label = new dBitmapFont();
        _this.m_blockX = 0;
        _this.m_blockY = 0;
        _this.SetSize(TextBlock4.BlockWidth, TextBlock4.BlockHeight);
        _this.pureColor = true;
        _this.spriteColor = 0xff1c4686;
        _this.m_label.LoadFromFile("data/zi.json");
        _this.m_label.fontSize = 100;
        _this.m_label.text = "";
        _this.m_label.positionY = -10;
        _this.AddChild(_this.m_label);
        return _this;
    }
    TextBlock4.prototype.SetBlockPos = function (x, y, ani, p) {
        this.m_blockX = x;
        this.m_blockY = y;
        var targetX = x * TextBlock4.BlockWidth + TextBlock4.BlockWidth * this.anchorU;
        var targetY = y * TextBlock4.BlockHeight + TextBlock4.BlockHeight * this.anchorV;
        if (ani) {
            p.m_moving = true;
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCMoveTo(0.2, targetX, targetY),
                new CCCallFunc(function () {
                    p.m_moving = false;
                    p.CheckClear();
                })
            ]), this);
        }
        else
            this.SetPos(targetX, targetY);
    };
    TextBlock4.BlockWidth = 136;
    TextBlock4.BlockHeight = 136;
    return TextBlock4;
}(dImage));
var Level17 = (function (_super) {
    __extends(Level17, _super);
    function Level17() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 4;
        _this.m_heightCount = 9;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level17.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 835, "resourceFileName": "level/171.png", "width": 818, "x": 0, "y": -262 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "BlockLayer", "classType": "dSprite", "height": 50, "width": 50, "x": -308, "y": -272 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 128, "resourceFileName": "level/172.png", "width": 745, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "height": 128, "resourceFileName": "", "width": 745, "x": 0, "y": 477 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 48, "resourceFileName": "level/173.png", "width": 664, "x": 0, "y": 359 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level17.prototype.GetHintImageName = function () {
        return "level/174.png";
    };
    Level17.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.GameLayer_dImage2.SetTransparentMouse(true);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new TextBlock5();
                    pBlock.SetPos(i * TextBlock5.BlockWidthWithSpace, j * TextBlock5.BlockHeightWithSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.GameLayer_BlockLayer.AddChild(pBlock);
                    var pTouchEvent = new dSprite();
                    pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                        _this.OnMove(pBlock, offx, offy);
                    };
                    pTouchEvent.OnTouchUp = function (x, y) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.OnUp(pBlock);
                    };
                    pBlock.SetTouchEvent(pTouchEvent);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        var a1 = ["", "", "", "", "", "", "", "", ""];
        for (var i = 0; i < this.m_heightCount; i++) {
            this.m_vecBlocks[i][0].SetText(a1[i]);
            this.m_vecBlocks[i][1].SetText(a1[i]);
            this.m_vecBlocks[i][2].SetText(a1[i]);
            this.m_vecBlocks[i][3].SetText(a1[i]);
        }
        this.GameLayer.clipChild = true;
    };
    Level17.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var canHor = false;
        var canVer = true;
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * TextBlock5.BlockWidthWithSpace) % (this.m_widthCount * TextBlock5.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * TextBlock5.BlockHeightWithSpace) % (this.m_heightCount * TextBlock5.BlockHeightWithSpace);
            }
        }
        this.PlayFrictionSound();
    };
    Level17.prototype.GetText = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetText();
    };
    Level17.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + TextBlock5.BlockWidthWithSpace / 2) / TextBlock5.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + TextBlock5.BlockHeightWithSpace / 2) / TextBlock5.BlockHeightWithSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * TextBlock5.BlockWidthWithSpace, blockY * TextBlock5.BlockHeightWithSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetText(0, 2) == "" && this.GetText(1, 2) == "" && this.GetText(2, 2) == "" && this.GetText(3, 2) == "")
            this.m_pGameWorld.ShowClear();
    };
    return Level17;
}(LevelBase));
var TextBlock5 = (function (_super) {
    __extends(TextBlock5, _super);
    function TextBlock5() {
        var _this = _super.call(this) || this;
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.Text = new dBitmapFont();
        _this.SetAnchor(0, 0);
        var p = new dSprite();
        p.SetSize(TextBlock5.BlockWidthWithSpace, TextBlock5.BlockHeightWithSpace);
        p.SetPos(-(TextBlock5.BlockWidthWithSpace - _this.width) / 2, -(TextBlock5.BlockHeightWithSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.Text.positionY = -10;
        _this.Text.fontSize = 80;
        _this.Text.spriteColor = 0xffffffff;
        _this.Text.LoadFromFile("data/zi.json");
        _this.AddChild(_this.Text);
        return _this;
    }
    TextBlock5.prototype.SetText = function (str) {
        this.Text.text = str;
    };
    TextBlock5.prototype.GetText = function () {
        return this.Text.text;
    };
    TextBlock5.BlockWidth = 126;
    TextBlock5.BlockHeight = 126;
    TextBlock5.BlockWidthWithSpace = 206;
    TextBlock5.BlockHeightWithSpace = 136;
    return TextBlock5;
}(dSprite));
var Level18 = (function (_super) {
    __extends(Level18, _super);
    function Level18() {
        var _this = _super.call(this) || this;
        _this.m_imgs = null;
        _this.m_texts = null;
        _this.m_touchList = [];
        _this.m_line = new dLine();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level18.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 77, "resourceFileName": "data/font64.json", "text": "", "width": 320, "x": 0, "y": -721 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 1242, "resourceFileName": "level/182.png", "width": 861, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 133.200012, "resourceFileName": "data/zi.json", "text": "", "width": 120.000008, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img1", "classType": "dAnimationImage", "height": 198, "resourceFileName": "level/181.png|level/183.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 199, "x": -271, "y": -208 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 133.200012, "resourceFileName": "data/zi.json", "text": "", "width": 120.000008, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img2", "classType": "dAnimationImage", "height": 198, "resourceFileName": "level/181.png|level/183.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 199, "x": 0, "y": -208 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 133.200012, "resourceFileName": "data/zi.json", "text": "", "width": 120.000008, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img3", "classType": "dAnimationImage", "height": 198, "resourceFileName": "level/181.png|level/183.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 199, "x": 271, "y": -208 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 133.200012, "resourceFileName": "data/zi.json", "text": "", "width": 120.000008, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img4", "classType": "dAnimationImage", "height": 198, "resourceFileName": "level/181.png|level/183.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 199, "x": -271, "y": 83 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 133.200012, "resourceFileName": "data/zi.json", "text": "", "width": 120.000008, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img5", "classType": "dAnimationImage", "height": 198, "resourceFileName": "level/181.png|level/183.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 199, "x": 0, "y": 83 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 133.200012, "resourceFileName": "data/zi.json", "text": "", "width": 120.000008, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img6", "classType": "dAnimationImage", "height": 198, "resourceFileName": "level/181.png|level/183.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 199, "x": 271, "y": 83 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 133.200012, "resourceFileName": "data/zi.json", "text": "", "width": 120.000008, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img7", "classType": "dAnimationImage", "height": 198, "resourceFileName": "level/181.png|level/183.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 199, "x": -271, "y": 374 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 133.200012, "resourceFileName": "data/zi.json", "text": "", "width": 120.000008, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img8", "classType": "dAnimationImage", "height": 198, "resourceFileName": "level/181.png|level/183.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 199, "x": 0, "y": 374 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 133.200012, "resourceFileName": "data/zi.json", "text": "", "width": 120.000008, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img9", "classType": "dAnimationImage", "height": 198, "resourceFileName": "level/181.png|level/183.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 199, "x": 271, "y": 374 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level18.prototype.GetHintImageName = function () {
        return "level/184.png";
    };
    Level18.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.SetHandleMouse(true);
        this.AddChild(this.m_line, 0);
        this.m_line.lineWidth = 30;
        this.m_line.spriteColor = 0xfffddb3c;
        this.m_imgs = [this.Img1, this.Img2, this.Img3, this.Img4, this.Img5, this.Img6, this.Img7, this.Img8, this.Img9];
        this.m_texts = [this.Img1_Text, this.Img2_Text, this.Img3_Text, this.Img4_Text, this.Img5_Text, this.Img6_Text, this.Img7_Text, this.Img8_Text, this.Img9_Text];
        var text = "*#";
        for (var i = 0; i < this.m_texts.length; i++)
            this.m_texts[i].text = text.charAt(i);
        var pTouchEvent = new dSprite();
        pTouchEvent.OnTouchDown = function (x, y, delta) {
            if (gameWorld.isGameClear())
                return;
            var col = _this.CollectImage(x, y);
            if (col != null && col.spriteFrame == 0) {
                col.spriteFrame = 1;
                _this.m_touchList.push(col);
                if (!_this.m_line.hasMoveTo()) {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_line.MoveTo(col.positionX, col.positionY);
                    _this.m_line.LineTo(col.positionX, col.positionY);
                }
                else {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_line.SetLastPos(col.positionX, col.positionY);
                    _this.m_line.LineTo(col.positionX, col.positionY);
                }
            }
        };
        pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
            if (gameWorld.isGameClear())
                return;
            var col = _this.CollectImage(x, y);
            if (col != null && col.spriteFrame == 0) {
                col.spriteFrame = 1;
                _this.m_touchList.push(col);
                if (!_this.m_line.hasMoveTo()) {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_line.MoveTo(col.positionX, col.positionY);
                    _this.m_line.LineTo(col.positionX, col.positionY);
                }
                else {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_line.SetLastPos(col.positionX, col.positionY);
                    _this.m_line.LineTo(col.positionX, col.positionY);
                }
                _this.CheckClear(col);
            }
            if (_this.m_line.GetLineCount() > 0) {
                _this.m_line.SetLastPos(x, y);
            }
        };
        pTouchEvent.OnTouchUp = function (x, y) {
            if (gameWorld.isGameClear())
                return;
            for (var i = 0; i < _this.m_imgs.length; i++)
                _this.m_imgs[i].spriteFrame = 0;
            _this.m_touchList.clear();
            _this.m_line.Clear();
        };
        this.SetTouchEvent(pTouchEvent);
    };
    Level18.prototype.CheckClear = function (p) {
        if (this.m_touchList.length == 7) {
            var str = "";
            for (var i = 0; i < this.m_touchList.length; i++) {
                str += this.m_touchList[i].FindChild("Text").text;
            }
            if (str == "") {
                this.m_pGameWorld.ShowClear();
            }
        }
    };
    Level18.prototype.CollectImage = function (x, y) {
        var v = new dVector2();
        for (var i = 0; i < this.m_imgs.length; i++) {
            v.SetValue(this.m_imgs[i].positionX - x, this.m_imgs[i].positionY - y);
            if (v.Length() < this.m_imgs[i].width / 2)
                return this.m_imgs[i];
        }
        return null;
    };
    return Level18;
}(LevelBase));
var Level19 = (function (_super) {
    __extends(Level19, _super);
    function Level19() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 8;
        _this.m_heightCount = 10;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        _this.m_nTouchMoveDir = 0;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level19.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 77, "resourceFileName": "data/font64.json", "text": "", "width": 256, "x": 0, "y": -721 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 119, "resourceFileName": "level/192.png", "width": 130, "x": -283, "y": -209 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 105, "resourceFileName": "level/194.png", "width": 106, "x": -8, "y": 191 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 111, "resourceFileName": "level/195.png", "width": 117, "x": 289, "y": 191 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage4", "classType": "dImage", "height": 121, "resourceFileName": "level/193.png", "width": 125, "x": -18, "y": -209 }, { "anchorU": 0, "anchorV": 0, "className": "GameLayer", "classType": "dSprite", "height": 1088, "width": 1088, "x": -491, "y": -409 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dImage", "height": 648, "resourceFileName": "level/191.png", "width": 806, "x": 0, "y": 60 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level19.prototype.GetHintImageName = function () {
        return "level/199e.png";
    };
    Level19.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new NumBlock();
                    pBlock.SetNum(0);
                    pBlock.SetPos(i * NumBlock.BlockWidthWithSpace, j * NumBlock.BlockHeightWidthSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.Back_GameLayer.AddChild(pBlock);
                    var pTouchEvent = new dSprite();
                    pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                        _this.OnMove(pBlock, offx, offy);
                    };
                    pTouchEvent.OnTouchUp = function (x, y) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.OnUp(pBlock);
                    };
                    pBlock.SetTouchEvent(pTouchEvent);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        var a1 = [6, 1, 1, 2, 1, 2, 1, 2, 7, 8];
        var a2 = [6, 5, 6, 1, 1, 5, 4, 4, 7, 8];
        var a3 = [2, 1, 1, 3, 6, 2, 2, 5, 2, 3];
        for (var i = 0; i < this.m_heightCount; i++) {
            this.m_vecBlocks[i][2].SetNum(a1[i]);
            this.m_vecBlocks[i][4].SetNum(a2[i]);
        }
        for (var i = 0; i < this.m_widthCount; i++) {
            this.m_vecBlocks[2][i].SetNum(a3[i]);
        }
        this.Back.clipChild = true;
    };
    Level19.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        if (pBlock.GetNum() == 0)
            return;
        var canHor = false;
        var canVer = false;
        if (this.GetNum(i, j - 1) != 0 || this.GetNum(i, j + 1) != 0)
            canVer = true;
        if (this.GetNum(i - 1, j) != 0 || this.GetNum(i + 1, j) != 0)
            canHor = true;
        if (canHor && canVer) {
            if (this.m_nTouchMoveDir == 0) {
                this.m_vTouchMoveAdd.x += offx;
                this.m_vTouchMoveAdd.y += offy;
                if (dMath.Abs(this.m_vTouchMoveAdd.x) > 10)
                    this.m_nTouchMoveDir = 1;
                else if (dMath.Abs(this.m_vTouchMoveAdd.y) > 10)
                    this.m_nTouchMoveDir = 2;
            }
            if (this.m_nTouchMoveDir == 1)
                canVer = false;
            else if (this.m_nTouchMoveDir == 2)
                canHor = false;
        }
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * NumBlock.BlockWidthWithSpace) % (this.m_widthCount * NumBlock.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * NumBlock.BlockWidthWithSpace) % (this.m_heightCount * NumBlock.BlockWidthWithSpace);
            }
        }
        this.PlayFrictionSound();
    };
    Level19.prototype.GetNum = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetNum();
    };
    Level19.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        this.m_nTouchMoveDir = 0;
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + NumBlock.BlockWidthWithSpace / 2) / NumBlock.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + NumBlock.BlockHeightWidthSpace / 2) / NumBlock.BlockHeightWidthSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * NumBlock.BlockWidthWithSpace, blockY * NumBlock.BlockHeightWidthSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetNum(2, 1) == 2 && this.GetNum(4, 1) == 3 && this.GetNum(2, 4) == 4 && this.GetNum(4, 4) == 8)
            this.m_pGameWorld.ShowClear();
    };
    return Level19;
}(LevelBase));
var NumBlock = (function (_super) {
    __extends(NumBlock, _super);
    function NumBlock() {
        var _this = _super.call(this) || this;
        _this.m_image = new dAnimationImage();
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.SetSize(NumBlock.BlockWidth, NumBlock.BlockHeight);
        _this.SetAnchor(0, 0);
        _this.m_image.SetPos(_this.width / 2, _this.height / 2);
        _this.m_image.AddFrameWithFileName("level/196.png");
        _this.m_image.AddFrameWithFileName("level/197.png");
        _this.m_image.AddFrameWithFileName("level/198.png");
        _this.m_image.AddFrameWithFileName("level/199.png");
        _this.m_image.AddFrameWithFileName("level/199a.png");
        _this.m_image.AddFrameWithFileName("level/199b.png");
        _this.m_image.AddFrameWithFileName("level/199c.png");
        _this.m_image.AddFrameWithFileName("level/199d.png");
        var p = new dSprite();
        p.SetSize(NumBlock.BlockWidthWithSpace, NumBlock.BlockHeightWidthSpace);
        p.SetPos(-(NumBlock.BlockWidthWithSpace - _this.width) / 2, -(NumBlock.BlockHeightWidthSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.AddChild(_this.m_image);
        return _this;
    }
    NumBlock.prototype.SetNum = function (num) {
        this.m_nNum = num;
        if (num <= 0)
            this.m_image.visible = false;
        else {
            this.m_image.visible = true;
            this.m_image.spriteFrame = (num - 1) % 8;
        }
    };
    NumBlock.prototype.GetNum = function () {
        return this.m_nNum;
    };
    NumBlock.BlockWidth = 126;
    NumBlock.BlockHeight = 126;
    NumBlock.BlockWidthWithSpace = 136;
    NumBlock.BlockHeightWidthSpace = 136;
    return NumBlock;
}(dSprite));
var Level2 = (function (_super) {
    __extends(Level2, _super);
    function Level2() {
        var _this = _super.call(this) || this;
        _this.m_imgs = null;
        _this.m_texts = null;
        _this.m_touchList = [];
        _this.m_line = new dLine();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level2.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 75, "resourceFileName": "data/font64.json", "text": "", "width": 320, "x": 0, "y": -721 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 160, "resourceFileName": "level/23.png", "width": 587, "x": 0, "y": -542 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 760, "resourceFileName": "level/22.png", "visible": 0, "width": 780, "x": 0, "y": 44 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 60, "height": 60, "resourceFileName": "data/fontNumber.json", "text": "1", "width": 21.5625, "x": -484, "y": 204 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text1", "classType": "dBitmapFont", "fontSize": 60, "height": 60, "resourceFileName": "data/fontNumber.json", "text": "2", "width": 33.75, "x": 409, "y": -166 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text2", "classType": "dBitmapFont", "fontSize": 60, "height": 60.9375, "resourceFileName": "data/fontNumber.json", "text": "3", "width": 33.75, "x": -399, "y": -192 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text3", "classType": "dBitmapFont", "fontSize": 60, "height": 60, "resourceFileName": "data/fontNumber.json", "text": "4", "width": 33.75, "x": 262, "y": 539 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text4", "classType": "dBitmapFont", "fontSize": 60, "height": 60.9375, "resourceFileName": "data/fontNumber.json", "text": "5", "width": 33.75, "x": 0, "y": -387 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text5", "classType": "dBitmapFont", "fontSize": 60, "height": 60.9375, "resourceFileName": "data/fontNumber.json", "text": "6", "width": 33.75, "x": -256, "y": 547 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text6", "classType": "dBitmapFont", "fontSize": 60, "height": 60, "resourceFileName": "data/fontNumber.json", "text": "7", "width": 31.875, "x": 491, "y": 214 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 109, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img1", "classType": "dImage", "height": 141, "resourceFileName": "level/21.png", "width": 141, "x": 0, "y": -270 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 113, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img2", "classType": "dImage", "height": 141, "resourceFileName": "level/21.png", "width": 141, "x": 312, "y": -118 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 109, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img3", "classType": "dImage", "height": 141, "resourceFileName": "level/21.png", "width": 141, "x": 387, "y": 215 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 110, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img4", "classType": "dImage", "height": 141, "resourceFileName": "level/21.png", "width": 141, "x": 174, "y": 486 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 102, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img5", "classType": "dImage", "height": 141, "resourceFileName": "level/21.png", "width": 141, "x": -173, "y": 486 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 109, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img6", "classType": "dImage", "height": 141, "resourceFileName": "level/21.png", "width": 141, "x": -385, "y": 215 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 105, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img7", "classType": "dImage", "height": 141, "resourceFileName": "level/21.png", "width": 141, "x": -311, "y": -118 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level2.prototype.GetHintImageName = function () {
        return "level/24.png";
    };
    Level2.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.SetHandleMouse(true);
        this.AddChild(this.m_line, 0);
        this.m_line.lineWidth = 30;
        this.m_line.spriteColor = 0xfffddb3c;
        this.m_imgs = [this.Img1, this.Img2, this.Img3, this.Img4, this.Img5, this.Img6, this.Img7];
        this.m_texts = [this.Img1_Text, this.Img2_Text, this.Img3_Text, this.Img4_Text, this.Img5_Text, this.Img6_Text, this.Img7_Text];
        var pTouchEvent = new dSprite();
        pTouchEvent.OnTouchDown = function (x, y, delta) {
            if (gameWorld.isGameClear())
                return;
            var col = _this.CollectImage(x, y);
            if (col != null && col.spriteFrame == 0) {
                col.spriteFrame = 1;
                _this.m_touchList.push(col);
                if (!_this.m_line.hasMoveTo()) {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_line.MoveTo(col.positionX, col.positionY);
                    _this.m_line.LineTo(col.positionX, col.positionY);
                }
                else {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_line.SetLastPos(col.positionX, col.positionY);
                    _this.m_line.LineTo(col.positionX, col.positionY);
                }
            }
        };
        pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
            if (gameWorld.isGameClear())
                return;
            var col = _this.CollectImage(x, y);
            _this.PlayDrawSound();
            if (col != null && col.spriteFrame == 0) {
                col.spriteFrame = 1;
                _this.m_touchList.push(col);
                if (!_this.m_line.hasMoveTo()) {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_line.MoveTo(col.positionX, col.positionY);
                    _this.m_line.LineTo(col.positionX, col.positionY);
                }
                else {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_line.SetLastPos(col.positionX, col.positionY);
                    _this.m_line.LineTo(col.positionX, col.positionY);
                }
                _this.CheckClear(col);
            }
            if (_this.m_line.GetLineCount() > 0) {
                _this.m_line.SetLastPos(x, y);
            }
        };
        pTouchEvent.OnTouchUp = function (x, y) {
            if (gameWorld.isGameClear())
                return;
            for (var i = 0; i < _this.m_imgs.length; i++)
                _this.m_imgs[i].spriteFrame = 0;
            _this.m_touchList.clear();
            _this.m_line.Clear();
        };
        this.SetTouchEvent(pTouchEvent);
    };
    Level2.prototype.CheckClear = function (p) {
        if (this.m_touchList.length == 7) {
            var str = "";
            for (var i = 0; i < this.m_touchList.length; i++) {
                str += this.m_touchList[i].FindChild("Text").text;
            }
            if (str == "") {
                this.m_pGameWorld.ShowClear();
            }
        }
    };
    Level2.prototype.CollectImage = function (x, y) {
        var v = new dVector2();
        for (var i = 0; i < this.m_imgs.length; i++) {
            v.SetValue(this.m_imgs[i].positionX - x, this.m_imgs[i].positionY - y);
            if (v.Length() < this.m_imgs[i].width / 2)
                return this.m_imgs[i];
        }
        return null;
    };
    return Level2;
}(LevelBase));
var Level20 = (function (_super) {
    __extends(Level20, _super);
    function Level20() {
        var _this = _super.call(this) || this;
        _this.m_vecBackBlock = null;
        _this.m_cards = null;
        _this.m_blocks = new Array();
        _this.m_lines = new Array();
        _this.m_crossed = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level20.prototype._dscData = function () { return { "_child": [{ "alpha": 0.501961, "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 184, "resourceFileName": "level/202.png", "width": 576, "x": -4.362061, "y": -640 }, { "anchorU": 0, "anchorV": 0, "className": "LineLayer", "classType": "dSprite", "clipChild": 1, "height": 720, "width": 900, "x": -445, "y": -439 }, { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 58, "resourceFileName": "level/203.png", "width": 58, "x": 0, "y": -3 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 99, "resourceFileName": "level/201.png", "width": 99, "x": 186.002808, "y": 911 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 58, "resourceFileName": "level/203.png", "width": 58, "x": 0, "y": -3 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 99, "resourceFileName": "level/201.png", "width": 99, "x": 364.002808, "y": 911 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 58, "resourceFileName": "level/203.png", "width": 58, "x": 0, "y": -3 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 99, "resourceFileName": "level/201.png", "width": 99, "x": 542.002808, "y": 911 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 58, "resourceFileName": "level/203.png", "width": 58, "x": 0, "y": -3 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 99, "resourceFileName": "level/201.png", "width": 99, "x": 720.002808, "y": 911 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 58, "resourceFileName": "level/203.png", "width": 58, "x": 0, "y": -3 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 99, "resourceFileName": "level/201.png", "width": 99, "x": 88.002808, "y": 1060 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 58, "resourceFileName": "level/203.png", "width": 58, "x": 0, "y": -3 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 99, "resourceFileName": "level/201.png", "width": 99, "x": 266.002808, "y": 1060 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 58, "resourceFileName": "level/203.png", "width": 58, "x": 0, "y": -3 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag7", "classType": "dImage", "height": 99, "resourceFileName": "level/201.png", "width": 99, "x": 444.002808, "y": 1060 }], "anchorU": 0, "anchorV": 0, "className": "GameLayer", "classType": "dSprite", "height": 720, "width": 900, "x": -445, "y": -439 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level20.prototype.GetHintImageName = function () {
        return "level/204.png";
    };
    Level20.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_vecBackBlock = new Array(9);
        for (var j = 0; j < this.m_vecBackBlock.length; j++) {
            this.m_vecBackBlock[j] = new Array(6);
            for (var i = 0; i < this.m_vecBackBlock[j].length; i++) {
                if (j % 2 == 1 && i == this.m_vecBackBlock[j].length - 1) {
                    this.m_vecBackBlock[j][i] = null;
                }
                else {
                    this.m_vecBackBlock[j][i] = new TextBlock6();
                    this.m_vecBackBlock[j][i].SetBlockPos(i, j);
                    this.GameLayer.AddChild(this.m_vecBackBlock[j][i]);
                    this.m_blocks.push(this.m_vecBackBlock[j][i]);
                }
            }
        }
        var vecLineH = new Array();
        for (var i = 0; i < 9; i++) {
            var line = new dLine();
            line.lineWidth = 4;
            this.LineLayer.AddChild(line);
            line.MoveTo(0, i * TextBlock6.HeightWithSpace);
            line.LineTo(1000, i * TextBlock6.HeightWithSpace);
            vecLineH.push(line);
            this.m_lines.push(line);
        }
        var vecLineV = new Array();
        for (var i = 0; i < 11; i++) {
            var line = new dLine();
            line.lineWidth = 4;
            this.LineLayer.AddChild(line);
            line.MoveTo(i * TextBlock6.WidthWithSpace / 2, 0);
            line.LineTo(i * TextBlock6.WidthWithSpace / 2, 1000);
            vecLineV.push(line);
            this.m_lines.push(line);
        }
        var vecLineBevelLeft = new Array();
        for (var i = 0; i < 10; i++) {
            var line = new dLine();
            line.lineWidth = 4;
            this.LineLayer.AddChild(line);
            line.MoveTo(i * TextBlock6.WidthWithSpace, 0);
            line.LineTo(i * TextBlock6.WidthWithSpace - 1000, 1000);
            vecLineBevelLeft.push(line);
            this.m_lines.push(line);
        }
        var vecLineBevelRight = new Array();
        for (var i = 0; i < 10; i++) {
            var line = new dLine();
            line.lineWidth = 4;
            this.LineLayer.AddChild(line);
            line.MoveTo((i - 4) * TextBlock6.WidthWithSpace, 0);
            line.LineTo((i - 4) * TextBlock6.WidthWithSpace + 1000, 1000);
            vecLineBevelRight.push(line);
            this.m_lines.push(line);
        }
        for (var j = 0; j < this.m_vecBackBlock.length; j++) {
            for (var i = 0; i < this.m_vecBackBlock[j].length; i++) {
                var block = this.m_vecBackBlock[j][i];
                if (block) {
                    block.m_lines.push(vecLineH[j]);
                    if (j % 2 == 0) {
                        block.m_lines.push(vecLineV[i * 2]);
                        block.m_lines.push(vecLineBevelLeft[i + dMath.ToInt(j / 2)]);
                        block.m_lines.push(vecLineBevelRight[i + 4 - dMath.ToInt(j / 2)]);
                    }
                    else {
                        block.m_lines.push(vecLineV[i * 2 + 1]);
                        block.m_lines.push(vecLineBevelLeft[i + 1 + dMath.ToInt(j / 2)]);
                        block.m_lines.push(vecLineBevelRight[i + 4 - dMath.ToInt(j / 2)]);
                    }
                }
            }
        }
        this.m_cards = [this.GameLayer_CanDrag1, this.GameLayer_CanDrag2, this.GameLayer_CanDrag3,
            this.GameLayer_CanDrag4, this.GameLayer_CanDrag5, this.GameLayer_CanDrag6, this.GameLayer_CanDrag7];
        for (var i = 0; i < this.m_cards.length; i++) {
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.GameLayer.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.UpdateLineColor();
                        _this.CheckClear(_this.m_cards[i]);
                    }
                    else {
                        _this.UpdateLineColor();
                    }
                };
            };
            fun(i);
        }
        this.UpdateLineColor();
    };
    Level20.prototype.UpdateLineColor = function () {
        this.m_crossed = false;
        for (var i = 0; i < this.m_lines.length; i++)
            this.m_lines[i].spriteColor = 0xff808080;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                for (var j = 0; j < this.m_blocks[i].m_lines.length; j++) {
                    var line = this.m_blocks[i].m_lines[j];
                    if (line) {
                        if (line.spriteColor == 0xff808080) {
                            line.spriteColor = 0xff00ff00;
                        }
                        else {
                            line.spriteColor = 0xffff0000;
                            this.m_crossed = true;
                        }
                    }
                }
            }
        }
    };
    Level20.prototype.CheckClear = function (p) {
        if (this.m_crossed)
            return;
        var cardCount = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card)
                cardCount++;
        }
        if (cardCount != this.m_cards.length)
            return;
        this.m_pGameWorld.ShowClear();
    };
    Level20.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level20.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level20;
}(LevelBase));
var TextBlock6 = (function (_super) {
    __extends(TextBlock6, _super);
    function TextBlock6() {
        var _this = _super.call(this) || this;
        _this.m_blockX = 0;
        _this.m_blockY = 0;
        _this.m_lines = new Array();
        _this.LoadFromFile("level/201.png");
        _this.SetSize(100, 100);
        return _this;
    }
    TextBlock6.prototype.SetBlockPos = function (x, y) {
        this.m_blockX = x;
        this.m_blockY = y;
        var xoff = 0;
        if (y % 2 == 1)
            xoff = TextBlock6.WidthWithSpace / 2;
        this.SetPos(x * TextBlock6.WidthWithSpace + xoff, y * TextBlock6.HeightWithSpace);
    };
    TextBlock6.WidthWithSpace = 180;
    TextBlock6.HeightWithSpace = 90;
    return TextBlock6;
}(dImage));
var Level21 = (function (_super) {
    __extends(Level21, _super);
    function Level21() {
        var _this = _super.call(this) || this;
        _this.m_input = "";
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level21.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 77, "resourceFileName": "data/font64.json", "text": "", "width": 320, "x": 0, "y": -721 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 57, "resourceFileName": "level/211.png", "spriteColor": -2130706433, "width": 130, "x": 352, "y": -129 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 330, "resourceFileName": "level/212.png", "width": 442, "x": 219, "y": -361 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 921, "resourceFileName": "level/213.png", "width": 464, "x": -213, "y": 61 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 64, "height": 65, "resourceFileName": "data/fontNumber.json", "text": "00000000", "width": 288, "x": -240, "y": -302 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 46.079998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -18 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 108, "resourceFileName": "level/214.png", "width": 108, "x": -365, "y": -125 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 58.879997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 108, "resourceFileName": "level/214.png", "width": 108, "x": -241, "y": -125 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 62.719997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 108, "resourceFileName": "level/214.png", "width": 108, "x": -117, "y": -125 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 63.359997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -11 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "height": 108, "resourceFileName": "level/214.png", "width": 108, "x": -365, "y": 8 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 64, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button5", "classType": "dButton", "height": 108, "resourceFileName": "level/214.png", "width": 108, "x": -241, "y": 8 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 65.279999, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -12.382568 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button6", "classType": "dButton", "height": 108, "resourceFileName": "level/214.png", "width": 108, "x": -117, "y": 8 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 62.079998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button7", "classType": "dButton", "height": 108, "resourceFileName": "level/214.png", "width": 108, "x": -365, "y": 145 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 60.799999, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button8", "classType": "dButton", "height": 108, "resourceFileName": "level/214.png", "width": 108, "x": -241, "y": 145 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 64, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -12 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button9", "classType": "dButton", "height": 108, "resourceFileName": "level/214.png", "width": 108, "x": -117, "y": 145 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dSprite1", "classType": "dSprite", "height": 80, "width": 80, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button10", "classType": "dButton", "height": 47, "resourceFileName": "level/215.png", "width": 47, "x": -178.992188, "y": 345 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 74, "resourceFileName": "data/font64.json", "text": "", "width": 128, "x": 0, "y": -16 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ClearButton", "classType": "dButton", "height": 107, "resourceFileName": "data/button2.png", "width": 171, "x": 189, "y": 455 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level21.prototype.GetHintImageName = function () {
        return "level/216.png";
    };
    Level21.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.Button10, this.Button1, this.Button2, this.Button3, this.Button4, this.Button5,
            this.Button6, this.Button7, this.Button8, this.Button9];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_input += String(i);
                    if (_this.m_input.length > 8)
                        _this.m_input = _this.m_input.substring(_this.m_input.length - 8, _this.m_input.length);
                    _this.UpdateNumber();
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
        this.ClearButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_input = "";
            _this.UpdateNumber();
        }));
        this.UpdateNumber();
    };
    Level21.prototype.UpdateNumber = function () {
        this.Number.text = this.m_input;
    };
    Level21.prototype.CheckClear = function () {
        if (this.Number.text == "42024143")
            this.m_pGameWorld.ShowClear();
    };
    return Level21;
}(LevelBase));
var Level22 = (function (_super) {
    __extends(Level22, _super);
    function Level22() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 4;
        _this.m_heightCount = 5;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level22.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 77, "resourceFileName": "data/font64.json", "text": "", "width": 320, "x": 0, "y": -721 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "BlockLayer", "classType": "dSprite", "height": 50, "width": 50, "x": -209, "y": -272 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 457, "resourceFileName": "level/221.png", "width": 795, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "height": 457, "resourceFileName": "", "width": 795, "x": 0, "y": 29 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level22.prototype.GetHintImageName = function () {
        return "level/222.png";
    };
    Level22.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.GameLayer_dImage2.SetTransparentMouse(true);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new TextBlock7();
                    pBlock.SetPos(i * TextBlock7.BlockWidthWithSpace, j * TextBlock7.BlockHeightWithSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.GameLayer_BlockLayer.AddChild(pBlock);
                    var pTouchEvent = new dSprite();
                    pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                        _this.OnMove(pBlock, offx, offy);
                    };
                    pTouchEvent.OnTouchUp = function (x, y) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.OnUp(pBlock);
                    };
                    pBlock.SetTouchEvent(pTouchEvent);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        var a1 = ["", "", "", "", ""];
        var a2 = ["", "", "", "", ""];
        var a3 = ["", "", "", "", ""];
        var a4 = ["", "", "", "", ""];
        for (var i = 0; i < this.m_heightCount; i++) {
            this.m_vecBlocks[i][0].SetText(a1[i]);
            this.m_vecBlocks[i][1].SetText(a2[i]);
            this.m_vecBlocks[i][2].SetText(a3[i]);
            this.m_vecBlocks[i][3].SetText(a4[i]);
        }
        this.GameLayer.clipChild = true;
    };
    Level22.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var canHor = false;
        var canVer = true;
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * TextBlock7.BlockWidthWithSpace) % (this.m_widthCount * TextBlock7.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * TextBlock7.BlockHeightWithSpace) % (this.m_heightCount * TextBlock7.BlockHeightWithSpace);
            }
        }
        this.PlayFrictionSound();
    };
    Level22.prototype.GetText = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetText();
    };
    Level22.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + TextBlock7.BlockWidthWithSpace / 2) / TextBlock7.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + TextBlock7.BlockHeightWithSpace / 2) / TextBlock7.BlockHeightWithSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * TextBlock7.BlockWidthWithSpace, blockY * TextBlock7.BlockHeightWithSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetText(0, 2) == "" && this.GetText(1, 2) == "" && this.GetText(2, 2) == "" && this.GetText(3, 2) == "")
            this.m_pGameWorld.ShowClear();
    };
    return Level22;
}(LevelBase));
var TextBlock7 = (function (_super) {
    __extends(TextBlock7, _super);
    function TextBlock7() {
        var _this = _super.call(this) || this;
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.Text = new dBitmapFont();
        _this.SetAnchor(0, 0);
        var p = new dSprite();
        p.SetSize(TextBlock7.BlockWidthWithSpace, TextBlock7.BlockHeightWithSpace);
        p.SetPos(-(TextBlock7.BlockWidthWithSpace - _this.width) / 2, -(TextBlock7.BlockHeightWithSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.Text.positionY = -10;
        _this.Text.fontSize = 80;
        _this.Text.spriteColor = 0xffffffff;
        _this.Text.LoadFromFile("data/zi.json");
        _this.AddChild(_this.Text);
        return _this;
    }
    TextBlock7.prototype.SetText = function (str) {
        this.Text.text = str;
    };
    TextBlock7.prototype.GetText = function () {
        return this.Text.text;
    };
    TextBlock7.BlockWidth = 126;
    TextBlock7.BlockHeight = 126;
    TextBlock7.BlockWidthWithSpace = 136;
    TextBlock7.BlockHeightWithSpace = 136;
    return TextBlock7;
}(dSprite));
var Level23 = (function (_super) {
    __extends(Level23, _super);
    function Level23() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level23.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Col1", "classType": "dImage", "height": 162, "resourceFileName": "", "visible": 0, "width": 162, "x": -106, "y": -114 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col2", "classType": "dImage", "height": 162, "resourceFileName": "", "visible": 0, "width": 162, "x": 52, "y": -114 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col3", "classType": "dImage", "height": 162, "resourceFileName": "", "visible": 0, "width": 162, "x": 210, "y": -114 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col4", "classType": "dImage", "height": 162, "resourceFileName": "", "visible": 0, "width": 162, "x": -106, "y": 44 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col5", "classType": "dImage", "height": 162, "resourceFileName": "", "visible": 0, "width": 162, "x": 52, "y": 44 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col6", "classType": "dImage", "height": 162, "resourceFileName": "", "visible": 0, "width": 162, "x": 210, "y": 44 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col7", "classType": "dImage", "height": 162, "resourceFileName": "", "visible": 0, "width": 162, "x": -106, "y": 202 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col8", "classType": "dImage", "height": 162, "resourceFileName": "", "visible": 0, "width": 162, "x": 52, "y": 202 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col9", "classType": "dImage", "height": 162, "resourceFileName": "", "visible": 0, "width": 162, "x": 210, "y": 202 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 100, "height": 109, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -8 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragBlock1", "classType": "dImage", "height": 162, "resourceFileName": "level/232.png", "width": 162, "x": 437, "y": 234.146362 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 100, "height": 108, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -8 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragBlock2", "classType": "dImage", "height": 162, "resourceFileName": "level/232.png", "width": 162, "x": 128, "y": 528.146362, "z": -35.078472 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 100, "height": 105, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -8 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragBlock3", "classType": "dImage", "height": 162, "resourceFileName": "level/232.png", "width": 162, "x": 468.291626, "y": -52.85498 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 100, "height": 108, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -8 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragBlock4", "classType": "dImage", "height": 162, "resourceFileName": "level/232.png", "width": 162, "x": 368.932495, "y": -370.853149 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 100, "height": 113, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -8 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragBlock5", "classType": "dImage", "height": 162, "resourceFileName": "level/232.png", "width": 162, "x": -208.067505, "y": -383.853149 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 100, "height": 107, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -8 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragBlock6", "classType": "dImage", "height": 162, "resourceFileName": "level/232.png", "width": 162, "x": 366.932495, "y": 465.146851 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 100, "height": 108, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -8 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragBlock7", "classType": "dImage", "height": 162, "resourceFileName": "level/232.png", "width": 162, "x": 50.1604, "y": -424.484009, "z": 24.960081 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 100, "height": 108, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -8 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragBlock8", "classType": "dImage", "height": 162, "resourceFileName": "level/232.png", "width": 162, "x": -94.8396, "y": 494.515991, "z": 24.960081 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 100, "height": 109, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 0, "y": -8 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragBlock9", "classType": "dImage", "height": 162, "resourceFileName": "level/232.png", "width": 162, "x": -312.8396, "y": 414.515991, "z": 24.960081 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Gamelayer", "classType": "dImage", "height": 566, "resourceFileName": "level/231.png", "width": 588, "x": -53, "y": -47 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level23.prototype.GetHintImageName = function () {
        return "level/233.png";
    };
    Level23.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.Gamelayer_CanDragBlock1, this.Gamelayer_CanDragBlock2, this.Gamelayer_CanDragBlock3,
            this.Gamelayer_CanDragBlock4, this.Gamelayer_CanDragBlock5, this.Gamelayer_CanDragBlock6,
            this.Gamelayer_CanDragBlock7, this.Gamelayer_CanDragBlock8, this.Gamelayer_CanDragBlock9];
        this.m_blocks = [this.Gamelayer_Col1, this.Gamelayer_Col2, this.Gamelayer_Col3, this.Gamelayer_Col4, this.Gamelayer_Col5, this.Gamelayer_Col6,
            this.Gamelayer_Col7, this.Gamelayer_Col8, this.Gamelayer_Col9];
        for (var i = 0; i < this.m_cards.length; i++) {
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.Gamelayer.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level23.prototype.CheckClear = function (p) {
        var answer = "";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                var label = card.FindChild("Quest");
                if (label && label.text == answer.charAt(i))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level23.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level23.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level23;
}(LevelBase));
var Level24 = (function (_super) {
    __extends(Level24, _super);
    function Level24() {
        var _this = _super.call(this) || this;
        _this.m_num1 = 5;
        _this.m_num2 = 5;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level24.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 128, "resourceFileName": "level/243.png", "width": 797, "x": 14, "y": 376 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text1", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 144, "y": 364 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text2", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 351, "y": 364 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton1", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 142, "y": 223 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton2", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 345, "y": 223 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton1", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 142, "y": 528 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton2", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 345, "y": 528 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 355, "resourceFileName": "level/244.png", "width": 144, "x": 0, "y": -150 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 883, "resourceFileName": "level/245.png", "width": 939, "x": 0.172607, "y": -143.39502, "z": -3.896065 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level24.prototype.GetHintImageName = function () {
        return "level/246.png";
    };
    Level24.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.dImage3.SetTransparentMouse(true);
        this.UpdateNumber();
        this.UpButton1.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_num1--;
            if (_this.m_num1 < 0)
                _this.m_num1 = 9;
            _this.UpdateNumber();
            _this.CheckClear();
        }));
        this.DownButton1.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_num1++;
            if (_this.m_num1 > 9)
                _this.m_num1 = 0;
            _this.UpdateNumber();
            _this.CheckClear();
        }));
        this.UpButton2.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_num2--;
            if (_this.m_num2 < 0)
                _this.m_num2 = 9;
            _this.UpdateNumber();
            _this.CheckClear();
        }));
        this.DownButton2.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_num2++;
            if (_this.m_num2 > 9)
                _this.m_num2 = 0;
            _this.UpdateNumber();
            _this.CheckClear();
        }));
    };
    Level24.prototype.UpdateNumber = function () {
        this.Text1.text = this.NumToText(this.m_num1);
        this.Text2.text = this.NumToText(this.m_num2);
    };
    Level24.prototype.NumToText = function (num) {
        switch (num) {
            case 0: return "";
            case 1: return "";
            case 2: return "";
            case 3: return "";
            case 4: return "";
            case 5: return "";
            case 6: return "";
            case 7: return "";
            case 8: return "";
            case 9: return "";
        }
        return "";
    };
    Level24.prototype.CheckClear = function () {
        if (this.m_num1 == 2 && this.m_num2 == 3)
            this.m_pGameWorld.ShowClear();
    };
    return Level24;
}(LevelBase));
var Level25 = (function (_super) {
    __extends(Level25, _super);
    function Level25() {
        var _this = _super.call(this) || this;
        _this.m_buttons = null;
        _this.m_linkData = new Array(8);
        _this.m_moving = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level25.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 781, "resourceFileName": "level/251.png", "width": 731, "x": 0, "y": -77 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 86, "height": 0, "resourceFileName": "data/zi.json", "width": 0, "x": 0, "y": -11 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 108, "resourceFileName": "level/252.png", "visible": 0, "width": 108, "x": 0, "y": -364 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 86, "height": 93.739998, "resourceFileName": "data/zi.json", "text": "", "width": 86, "x": 0, "y": -11 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 108, "resourceFileName": "level/252.png", "width": 108, "x": 221, "y": -272 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 86, "height": 91.160004, "resourceFileName": "data/zi.json", "text": "", "width": 86, "x": 0, "y": -11 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 108, "resourceFileName": "level/252.png", "width": 108, "x": 311, "y": -52 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 86, "height": 92.880005, "resourceFileName": "data/zi.json", "text": "", "width": 86, "x": 0, "y": -11 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "height": 108, "resourceFileName": "level/252.png", "width": 108, "x": 220, "y": 169 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 86, "height": 95.459999, "resourceFileName": "data/zi.json", "text": "", "width": 86, "x": 0, "y": -11 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button5", "classType": "dButton", "height": 108, "resourceFileName": "level/252.png", "width": 108, "x": 0, "y": 260 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 86, "height": 84.279999, "resourceFileName": "data/zi.json", "text": "", "width": 86, "x": 0, "y": -11 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button6", "classType": "dButton", "height": 108, "resourceFileName": "level/252.png", "width": 108, "x": -221, "y": 169 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 86, "height": 94.599998, "resourceFileName": "data/zi.json", "text": "", "width": 86, "x": 0, "y": -11 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button7", "classType": "dButton", "height": 108, "resourceFileName": "level/252.png", "width": 108, "x": -312, "y": -52 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 86, "height": 93.739998, "resourceFileName": "data/zi.json", "text": "", "width": 86, "x": 0, "y": -11 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button8", "classType": "dButton", "height": 108, "resourceFileName": "level/252.png", "width": 108, "x": -220, "y": -272 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level25.prototype.GetHintImageName = function () {
        return "level/253.png";
    };
    Level25.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_buttons = [this.Button1, this.Button2, this.Button3, this.Button4, this.Button5, this.Button6, this.Button7, this.Button8];
        for (var i = 0; i < 8; i++) {
            this.m_linkData[i] = new BlockLinkData();
            this.m_linkData[i].SetPos(this.m_buttons[i].positionX, this.m_buttons[i].positionY);
            this.m_linkData[i].button = this.m_buttons[i];
        }
        var data = this.m_linkData;
        data[0].links.pushVector([data[7], data[1], data[4]]);
        data[1].links.pushVector([data[0], data[2], data[3], data[5], data[7]]);
        data[2].links.pushVector([data[1], data[3], data[6]]);
        data[3].links.pushVector([data[1], data[2], data[4], data[5], data[7]]);
        data[4].links.pushVector([data[0], data[3], data[5]]);
        data[5].links.pushVector([data[1], data[3], data[4], data[6], data[7]]);
        data[6].links.pushVector([data[2], data[5], data[7]]);
        data[7].links.pushVector([data[0], data[3], data[5], data[6], data[1]]);
        for (var i = 0; i < this.m_buttons.length; i++) {
            var fun = function (i) {
                _this.m_buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    if (_this.m_moving)
                        return;
                    dSound.PlaySound("data/sound/button.mp3");
                    var linkData = _this.FindLinkDataByButton(_this.m_buttons[i]);
                    if (linkData) {
                        var empty = linkData.FindEmptyLink();
                        if (empty) {
                            _this.SwapButton(linkData, empty);
                        }
                    }
                }));
            };
            fun(i);
        }
    };
    Level25.prototype.SwapButton = function (p1, p2) {
        var _this = this;
        this.m_moving = true;
        CCActionManager.Instance().AddAction(new CCMoveTo(0.3, p2.positionX, p2.positionY), p1.button);
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCMoveTo(0.3, p1.positionX, p1.positionY),
            new CCCallFunc(function () {
                _this.m_moving = false;
                _this.CheckClear();
            })
        ]), p2.button);
        var tmpButton = p1.button;
        p1.button = p2.button;
        p2.button = tmpButton;
    };
    Level25.prototype.FindLinkDataByButton = function (button) {
        for (var i = 0; i < this.m_linkData.length; i++)
            if (this.m_linkData[i].button == button)
                return this.m_linkData[i];
        return null;
    };
    Level25.prototype.CheckClear = function () {
        if (this.m_linkData[5].GetText() == "" &&
            this.m_linkData[6].GetText() == "" &&
            this.m_linkData[7].GetText() == "" &&
            this.m_linkData[0].GetText() == "" &&
            this.m_linkData[1].GetText() == "" &&
            this.m_linkData[2].GetText() == "" &&
            this.m_linkData[3].GetText() == "")
            this.m_pGameWorld.ShowClear();
    };
    return Level25;
}(LevelBase));
var BlockLinkData = (function (_super) {
    __extends(BlockLinkData, _super);
    function BlockLinkData() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.links = new Array();
        _this.button = null;
        return _this;
    }
    BlockLinkData.prototype.FindEmptyLink = function () {
        for (var i = 0; i < this.links.length; i++) {
            if (this.links[i].GetText() == "")
                return this.links[i];
        }
        return null;
    };
    BlockLinkData.prototype.GetText = function () {
        return this.button.FindChild("Text").text;
    };
    return BlockLinkData;
}(dSprite));
var Level26 = (function (_super) {
    __extends(Level26, _super);
    function Level26() {
        var _this = _super.call(this) || this;
        _this.m_input = "";
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level26.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 823, "resourceFileName": "level/261.png", "width": 889, "x": 0, "y": -362 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 336, "resourceFileName": "level/266.png", "width": 336, "x": 0, "y": 422 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 136, "resourceFileName": "level/262.png", "width": 124, "x": 0, "y": 156 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 136, "resourceFileName": "level/264.png", "width": 124, "x": 0, "y": 680 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "LeftButton", "classType": "dButton", "height": 136, "resourceFileName": "level/265.png", "width": 124, "x": -258, "y": 427 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "RightButton", "classType": "dButton", "height": 136, "resourceFileName": "level/263.png", "width": 124, "x": 258, "y": 427 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level26.prototype.GetHintImageName = function () {
        return "level/267.png";
    };
    Level26.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.UpButton, this.RightButton, this.DownButton, this.LeftButton];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_input += String(i);
                    if (_this.m_input.length > 7)
                        _this.m_input = _this.m_input.substring(_this.m_input.length - 7, _this.m_input.length);
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
    };
    Level26.prototype.CheckClear = function () {
        var str = "1320123";
        if (this.m_input == str)
            this.m_pGameWorld.ShowClear();
    };
    return Level26;
}(LevelBase));
var Level27 = (function (_super) {
    __extends(Level27, _super);
    function Level27() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level27.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 383, "resourceFileName": "level/271.png", "width": 569, "x": 0, "y": -364 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -406, "y": 119, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -203, "y": 119, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 0, "y": 119, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 203, "y": 119, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 406, "y": 119, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 137, "resourceFileName": "level/275.png", "width": 106, "x": 180.002808, "y": 429, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 129, "resourceFileName": "level/274.png", "width": 140, "x": -326.997192, "y": 429, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 128, "resourceFileName": "level/276.png", "width": 142, "x": -157.997192, "y": 429, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 142, "resourceFileName": "level/273.png", "width": 143, "x": 349.002808, "y": 429, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 138, "resourceFileName": "level/272.png", "width": 139, "x": 11.002808, "y": 429, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level27.prototype.GetHintImageName = function () {
        return "level/277.png";
    };
    Level27.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level27.prototype.CheckClear = function (p) {
        var answer = "01234";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level27.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level27.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level27;
}(LevelBase));
var Level28 = (function (_super) {
    __extends(Level28, _super);
    function Level28() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level28.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 371, "resourceFileName": "level/281.png", "width": 582, "x": 0, "y": -526 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -184, "y": -122, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 19, "y": -122, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 222, "y": -122, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -183, "y": 116, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 20, "y": 116, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block6", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 222, "y": 116, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 143, "resourceFileName": "level/286.png", "width": 139, "x": 255.002808, "y": 399, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 149, "resourceFileName": "level/284.png", "width": 137, "x": -251.997192, "y": 399, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 146, "resourceFileName": "level/285.png", "width": 135, "x": -82.997192, "y": 399, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 144, "resourceFileName": "level/282.png", "width": 146, "x": 424.002808, "y": 399, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 145, "resourceFileName": "level/283.png", "width": 140, "x": 86.002808, "y": 399, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 139, "resourceFileName": "level/287.png", "width": 156, "x": -422.997192, "y": 397, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level28.prototype.GetHintImageName = function () {
        return "level/288.png";
    };
    Level28.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5, this.CanDrag6];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5, this.Block6];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level28.prototype.CheckClear = function (p) {
        var answer = "012345";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level28.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level28.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level28;
}(LevelBase));
var Level29 = (function (_super) {
    __extends(Level29, _super);
    function Level29() {
        var _this = _super.call(this) || this;
        _this.m_blocks = new Array(4);
        _this.m_curTouchBlock = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level29.prototype._dscData = function () { return { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "GameLayer", "classType": "dSprite", "height": 684, "width": 819, "x": -409, "y": -343 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 684, "resourceFileName": "level/291.png", "width": 819, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 74, "resourceFileName": "data/font64.json", "text": "", "width": 128, "x": 0, "y": -16 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ClearButton", "classType": "dButton", "height": 107, "resourceFileName": "data/button2.png", "width": 171, "x": -319, "y": 572 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level29.prototype.GetHintImageName = function () {
        return "level/292.png";
    };
    Level29.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.dImage1.SetTransparentMouse(true);
        this.ClearGame();
        this.ClearButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.ClearGame();
            dSound.PlaySound("data/sound/button.mp3");
        }));
        this.SetHandleMouse(true);
    };
    Level29.prototype.ClearGame = function () {
        for (var i = 0; i < this.m_blocks.length; i++) {
            if (this.m_blocks[i])
                this.m_blocks[i].RemoveParent();
        }
        this.m_curTouchBlock = null;
        this.m_blocks[0] = new TextBlock8("", 0xff922828);
        this.m_blocks[0].SetBlockPos(0, 4);
        this.GameLayer.AddChild(this.m_blocks[0]);
        this.m_blocks[1] = new TextBlock8("", 0xff2c81c3);
        this.m_blocks[1].SetBlockPos(4, 0);
        this.GameLayer.AddChild(this.m_blocks[1]);
        this.m_blocks[2] = new TextBlock8("", 0xffc99a0a);
        this.m_blocks[2].SetBlockPos(2, 1);
        this.GameLayer.AddChild(this.m_blocks[2]);
        this.m_blocks[3] = new TextBlock8("", 0xff449122);
        this.m_blocks[3].SetBlockPos(4, 1);
        this.GameLayer.AddChild(this.m_blocks[3]);
    };
    Level29.prototype.OnTouchMove = function (x, y, offx, offy, delta) {
        var blockX = dMath.ToInt((x - this.GameLayer.positionX) / TextBlock8.BlockWidth);
        var blockY = dMath.ToInt((y - this.GameLayer.positionY) / TextBlock8.BlockHeight);
        this.OnTouchBlock(blockX, blockY);
    };
    Level29.prototype.OnTouchDown = function (x, y, delta) {
        var blockX = dMath.ToInt((x - this.GameLayer.positionX) / TextBlock8.BlockWidth);
        var blockY = dMath.ToInt((y - this.GameLayer.positionY) / TextBlock8.BlockHeight);
        this.m_curTouchBlock = this.FindBlock(blockX, blockY);
        if (this.m_curTouchBlock != null) {
            dSound.PlaySound("data/sound/button.mp3");
            this.m_curTouchBlock.PlayTouch();
        }
    };
    Level29.prototype.OnTouchUp = function (x, y) {
        this.m_curTouchBlock = null;
    };
    Level29.prototype.OnTouchBlock = function (blockX, blockY) {
        if (blockX >= 0 && blockX < 6 && blockY >= 0 && blockY < 5) {
            if (blockX == 0 && blockY == 0)
                return;
            if (blockX == 5 && blockY == 4)
                return;
            if (this.m_curTouchBlock) {
                var dirs = [new dVector2(-1, 0), new dVector2(1, 0), new dVector2(0, -1), new dVector2(0, 1)];
                for (var i = 0; i < dirs.length; i++) {
                    var dir = dirs[i];
                    if (blockX == this.m_curTouchBlock.m_blockX + dir.x && blockY == this.m_curTouchBlock.m_blockY + dir.y) {
                        if (this.m_curTouchBlock.GetSecondBody().m_blockX == this.m_curTouchBlock.m_blockX + dir.x && this.m_curTouchBlock.GetSecondBody().m_blockY == this.m_curTouchBlock.m_blockY + dir.y)
                            this.m_curTouchBlock.Move(dir.x, dir.y, true);
                        else if (this.CanMove(blockX, blockY)) {
                            this.m_curTouchBlock.Move(dir.x, dir.y);
                            this.CheckClear();
                        }
                        break;
                    }
                }
            }
        }
    };
    Level29.prototype.CanMove = function (blockX, blockY) {
        for (var i = 0; i < this.m_blocks.length; i++) {
            var bodies = this.m_blocks[i].GetBodies();
            for (var j = 0; j < bodies.length; j++) {
                if (bodies[j].m_blockX == blockX && bodies[j].m_blockY == blockY)
                    return false;
            }
        }
        return true;
    };
    Level29.prototype.FindBlock = function (blockX, blockY) {
        for (var i = 0; i < this.m_blocks.length; i++)
            if (this.m_blocks[i].m_blockX == blockX && this.m_blocks[i].m_blockY == blockY)
                return this.m_blocks[i];
        return null;
    };
    Level29.prototype.CheckClear = function () {
        for (var i = 0; i < this.m_blocks.length; i++)
            if (this.m_blocks[i].m_bodyLength < 6)
                return;
        this.m_pGameWorld.ShowClear();
    };
    return Level29;
}(LevelBase));
var TextBlock8 = (function (_super) {
    __extends(TextBlock8, _super);
    function TextBlock8(context, color) {
        var _this = _super.call(this) || this;
        _this.m_context = "";
        _this.m_blockX = 0;
        _this.m_blockY = 0;
        _this.m_bodies = new Array();
        _this.m_bodyLength = 0;
        _this.m_context = context;
        _this.spriteColor = color;
        _this.m_bodies.resize(_this.m_context.length);
        for (var i = 0; i < _this.m_context.length; i++) {
            _this.m_bodies[i] = new TextBlock8Body(_this.m_context.charAt(_this.m_context.length - i - 1), color);
            _this.AddChild(_this.m_bodies[i]);
        }
        return _this;
    }
    TextBlock8.prototype.GetBodies = function () {
        return this.m_bodies;
    };
    TextBlock8.prototype.SetBlockPos = function (x, y) {
        this.m_blockX = x;
        this.m_blockY = y;
        this.SetPos(x * TextBlock8.BlockWidth + TextBlock8.BlockWidth * this.anchorU, y * TextBlock8.BlockHeight + TextBlock8.BlockHeight * this.anchorV);
        for (var i = 0; i < this.m_bodies.length; i++) {
            this.m_bodies[i].m_blockX = x;
            this.m_bodies[i].m_blockY = y;
        }
    };
    TextBlock8.prototype.PlayTouch = function () {
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCScaleTo(0.05, 1.2, 1.2),
            new CCScaleTo(0.05, 1, 1)
        ]), this.m_bodies.last());
    };
    TextBlock8.prototype.Move = function (dirX, dirY, isBack) {
        if (isBack === void 0) { isBack = false; }
        if (this.m_bodyLength < this.m_context.length - 1 || isBack && this.m_bodyLength > 0) {
            dSound.PlaySound("data/sound/button.mp3");
            this.m_blockX += dirX;
            this.m_blockY += dirY;
            this.SetPos(this.m_blockX * TextBlock8.BlockWidth + TextBlock8.BlockWidth * this.anchorU, this.m_blockY * TextBlock8.BlockHeight + TextBlock8.BlockHeight * this.anchorV);
            if (isBack)
                this.m_bodyLength--;
            else
                this.m_bodyLength++;
            for (var i = 0; i < this.m_bodies.length; i++) {
                this.m_bodies[i].m_blockX += dirX;
                this.m_bodies[i].m_blockY += dirY;
            }
            if (isBack) {
                this.m_bodies[this.m_bodyLength].m_blockX -= dirX;
                this.m_bodies[this.m_bodyLength].m_blockY -= dirY;
                this.m_bodies[this.m_bodyLength].positionX -= dirX * TextBlock8.BlockWidth;
                this.m_bodies[this.m_bodyLength].positionY -= dirY * TextBlock8.BlockHeight;
            }
            for (var i = 0; i < this.m_bodyLength; i++) {
                this.m_bodies[i].positionX -= dirX * TextBlock8.BlockWidth;
                this.m_bodies[i].positionY -= dirY * TextBlock8.BlockHeight;
                this.m_bodies[i].m_label.text = this.m_context.charAt(this.m_bodyLength - i);
                this.m_bodies[i].m_blockX -= dirX;
                this.m_bodies[i].m_blockY -= dirY;
            }
        }
    };
    TextBlock8.prototype.GetSecondBody = function () {
        for (var i = 0; i < this.m_bodies.length; i++) {
            if (this.m_bodies[i].m_label.text == this.m_context.charAt(1))
                return this.m_bodies[i];
        }
        return null;
    };
    TextBlock8.BlockWidth = 136;
    TextBlock8.BlockHeight = 136;
    return TextBlock8;
}(dImage));
var TextBlock8Body = (function (_super) {
    __extends(TextBlock8Body, _super);
    function TextBlock8Body(str, color) {
        var _this = _super.call(this) || this;
        _this.m_label = new dBitmapFont();
        _this.m_blockX = 0;
        _this.m_blockY = 0;
        _this.m_str = "";
        _this.m_str = str;
        _this.pureColor = true;
        _this.spriteColor = color;
        _this.m_label.text = str;
        _this.m_label.LoadFromFile("data/zi.json");
        _this.m_label.positionY = -10;
        _this.m_label.fontSize = 90;
        _this.AddChild(_this.m_label);
        _this.SetSize(TextBlock8.BlockWidth, TextBlock8.BlockHeight);
        return _this;
    }
    return TextBlock8Body;
}(dImage));
var Level3 = (function (_super) {
    __extends(Level3, _super);
    function Level3() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level3.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 75, "resourceFileName": "data/font64.json", "text": "", "width": 256, "x": 0, "y": -721 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 258, "resourceFileName": "level/31.png", "width": 592, "x": 0, "y": -364 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -406, "y": -61 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -203, "y": -61 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 0, "y": -61 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 203, "y": -61 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 406, "y": -61 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 148, "resourceFileName": "level/33.png", "width": 144, "x": 367, "y": 292 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 146, "resourceFileName": "level/34.png", "width": 143, "x": 9, "y": 292 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 150, "resourceFileName": "level/35.png", "width": 144, "x": 188, "y": 428 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 151, "resourceFileName": "level/36.png", "width": 151, "x": -349, "y": 292 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 140, "resourceFileName": "level/37.png", "width": 144, "x": -170, "y": 440 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level3.prototype.GetHintImageName = function () {
        return "level/38.png";
    };
    Level3.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level3.prototype.CheckClear = function (p) {
        var answer = "01234";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level3.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level3.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level3;
}(LevelBase));
var Level30 = (function (_super) {
    __extends(Level30, _super);
    function Level30() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level30.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 297, "resourceFileName": "level/309b.png", "width": 737, "x": 0, "y": -538 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -406, "y": -176, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -203, "y": -176, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 0, "y": -176, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 203, "y": -176, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 406, "y": -176, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block6", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -406, "y": 50, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block7", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -203, "y": 50, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block8", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 0, "y": 50, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block9", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 203, "y": 50, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block10", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 406, "y": 50, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 149, "resourceFileName": "level/305.png", "width": 134, "x": 183.002808, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 122, "resourceFileName": "level/303.png", "width": 133, "x": -323.997192, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 134, "resourceFileName": "level/304.png", "width": 153, "x": -156.997192, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 149, "resourceFileName": "level/301.png", "width": 150, "x": 350.002808, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 143, "resourceFileName": "level/302.png", "width": 138, "x": 12.002808, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 143, "resourceFileName": "level/306.png", "width": 142, "x": -154.997192, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag7", "classType": "dImage", "height": 140, "resourceFileName": "level/307.png", "width": 145, "x": 181.002808, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag8", "classType": "dImage", "height": 136, "resourceFileName": "level/308.png", "width": 132, "x": 14.002808, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag9", "classType": "dImage", "height": 146, "resourceFileName": "level/309.png", "width": 120, "x": -325.997192, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag10", "classType": "dImage", "height": 143, "resourceFileName": "level/309a.png", "width": 147, "x": 352.002808, "y": 325, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level30.prototype.GetHintImageName = function () {
        return "level/309c.png";
    };
    Level30.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5, this.CanDrag6, this.CanDrag7, this.CanDrag8, this.CanDrag9, this.CanDrag10];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5, this.Block6, this.Block7, this.Block8, this.Block9, this.Block10];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level30.prototype.CheckClear = function (p) {
        var answer = "0123456789";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level30.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level30.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level30;
}(LevelBase));
var Level31 = (function (_super) {
    __extends(Level31, _super);
    function Level31() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level31.prototype._dscData = function () { return { "_child": [{ "_child": [{ "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Zi", "classType": "dImage", "height": 122, "resourceFileName": "level/319.png", "width": 139, "x": -33.997192, "y": 49, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Layer6", "classType": "dSprite", "height": 411, "visible": 0, "width": 424, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Zi", "classType": "dImage", "height": 123, "resourceFileName": "level/319b.png", "width": 145, "x": -33.997192, "y": 49, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 137, "y": -34 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot1", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 157, "y": -34 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Layer8", "classType": "dSprite", "height": 411, "visible": 0, "width": 424, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Zi", "classType": "dImage", "height": 129, "resourceFileName": "level/318.png", "width": 140, "x": -33.997192, "y": 49, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 137, "y": -34 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot3", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 157, "y": -15 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Layer5", "classType": "dSprite", "height": 411, "visible": 0, "width": 424, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Zi", "classType": "dImage", "height": 139, "resourceFileName": "level/319d.png", "width": 141, "x": -33.997192, "y": 49, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot1", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 157, "y": -34 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot2", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 137, "y": -15 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Layer10", "classType": "dSprite", "height": 411, "visible": 0, "width": 424, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Zi", "classType": "dImage", "height": 118, "resourceFileName": "level/314.png", "width": 79, "x": -33.997192, "y": 49, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 137, "y": -34 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Layer1", "classType": "dSprite", "height": 411, "visible": 0, "width": 424, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Zi", "classType": "dImage", "height": 116, "resourceFileName": "level/319a.png", "width": 141, "x": -33.997192, "y": 49, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot2", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 137, "y": -15 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Layer7", "classType": "dSprite", "height": 411, "visible": 0, "width": 424, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Zi", "classType": "dImage", "height": 137, "resourceFileName": "level/315.png", "width": 106, "x": -33.997192, "y": 49, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot2", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 137, "y": -15 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot3", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 157, "y": -15 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Layer2", "classType": "dSprite", "height": 411, "visible": 0, "width": 424, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Zi", "classType": "dImage", "height": 138, "resourceFileName": "level/317.png", "width": 140, "x": -33.997192, "y": 49, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot1", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 157, "y": -34 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Layer4", "classType": "dSprite", "height": 411, "visible": 0, "width": 424, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Zi", "classType": "dImage", "height": 131, "resourceFileName": "level/319c.png", "width": 136, "x": -33.997192, "y": 49, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot3", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 157, "y": -15 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Layer9", "classType": "dSprite", "height": 411, "visible": 0, "width": 424, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Zi", "classType": "dImage", "height": 113, "resourceFileName": "level/316.png", "width": 123, "x": -33.997192, "y": 49, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 137, "y": -34 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot2", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 137, "y": -15 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Layer3", "classType": "dSprite", "height": 411, "visible": 0, "width": 424, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "dTabView1", "classType": "dTabView", "height": 411, "width": 424, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 411, "resourceFileName": "level/312.png", "width": 424, "x": 0, "y": -538 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Dot", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": -44, "y": -45 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -406, "y": -176, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Dot2", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": -44, "y": 45 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot3", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 43, "y": 45 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -203, "y": -176, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Dot", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": -44, "y": -45 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot2", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": -44, "y": 45 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 0, "y": -176, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Dot1", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 43, "y": -45 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 203, "y": -176, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Dot", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": -44, "y": -45 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot3", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 43, "y": 45 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 406, "y": -176, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block6", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -406, "y": 50, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Dot2", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": -44, "y": 45 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block7", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -203, "y": 50, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Dot", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": -44, "y": -45 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot1", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 43, "y": -45 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block8", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 0, "y": 50, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Dot3", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 43, "y": 45 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block9", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 203, "y": 50, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Dot1", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": 43, "y": -45 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Dot2", "classType": "dImage", "height": 11, "resourceFileName": "level/313.png", "width": 11, "x": -44, "y": 45 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block10", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 406, "y": 50, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 129, "resourceFileName": "level/318.png", "width": 140, "x": 183.002808, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 113, "resourceFileName": "level/316.png", "width": 123, "x": -323.997192, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 138, "resourceFileName": "level/317.png", "width": 140, "x": -156.997192, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 118, "resourceFileName": "level/314.png", "width": 79, "x": 350.002808, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 137, "resourceFileName": "level/315.png", "width": 106, "x": 12.002808, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 122, "resourceFileName": "level/319.png", "width": 139, "x": -154.997192, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag7", "classType": "dImage", "height": 116, "resourceFileName": "level/319a.png", "width": 141, "x": 181.002808, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag8", "classType": "dImage", "height": 123, "resourceFileName": "level/319b.png", "width": 145, "x": 14.002808, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag9", "classType": "dImage", "height": 131, "resourceFileName": "level/319c.png", "width": 136, "x": -325.997192, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag10", "classType": "dImage", "height": 139, "resourceFileName": "level/319d.png", "width": 141, "x": 352.002808, "y": 325, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level31.prototype.GetHintImageName = function () {
        return "level/319e.png";
    };
    Level31.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5, this.CanDrag6, this.CanDrag7, this.CanDrag8, this.CanDrag9, this.CanDrag10];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5, this.Block6, this.Block7, this.Block8, this.Block9, this.Block10];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
        new dTimer(this).Create(1000, 0, function () {
            _this.dImage1_dTabView1.spriteFrame++;
            _this.dImage1_dTabView1.spriteFrame %= 10;
        });
    };
    Level31.prototype.CheckClear = function (p) {
        var answer = "0123456789";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level31.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level31.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level31;
}(LevelBase));
var Level32 = (function (_super) {
    __extends(Level32, _super);
    function Level32() {
        var _this = _super.call(this) || this;
        _this.m_vecInputs = new Array();
        _this.m_answer = "142351";
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level32.prototype._dscData = function () { return { "_child": [{ "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 63.359997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": 104 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button5", "classType": "dButton", "downImage": "level/324.png", "height": 358, "resourceFileName": "level/323.png", "width": 102, "x": 194, "y": -10 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 66.559998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": 104 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "downImage": "level/324.png", "height": 358, "resourceFileName": "level/323.png", "width": 102, "x": 97, "y": -10 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 69.119995, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": 104 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "downImage": "level/324.png", "height": 358, "resourceFileName": "level/323.png", "width": 102, "x": 0, "y": -10 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 71.040001, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": 104 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "downImage": "level/324.png", "height": 358, "resourceFileName": "level/323.png", "width": 102, "x": -97, "y": -10 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 66.559998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": 104 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "downImage": "level/324.png", "height": 358, "resourceFileName": "level/323.png", "width": 102, "x": -194, "y": -10 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Top", "classType": "dImage", "height": 202, "resourceFileName": "level/322.png", "width": 339, "x": 0, "y": -87 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Piano", "classType": "dSprite", "height": 381, "width": 475, "x": 0, "y": 337 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Button", "classType": "dButton", "height": 59, "resourceFileName": "level/325.png", "width": 59, "x": 147, "y": -25 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 104, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": -35, "y": 35, "z": -6.356201 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Video", "classType": "dImage", "height": 411, "resourceFileName": "level/321.png", "width": 424, "x": 0, "y": -454 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level32.prototype.GetHintImageName = function () {
        return "level/326.png";
    };
    Level32.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.Piano_Button1, this.Piano_Button2, this.Piano_Button3, this.Piano_Button4, this.Piano_Button5];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/piano" + (i + 1) + ".mp3");
                    _this.m_vecInputs.push(i + 1);
                    if (_this.m_vecInputs.length > _this.m_answer.length)
                        _this.m_vecInputs.erase(0);
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
        this.Video_Text.visible = false;
        this.Video_Button.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            if (_this.Video_Text.visible == false) {
                _this.Video_Text.visible = true;
                _this.Piano.visible = false;
                new dTimer(_this).Create(1000, _this.m_answer.length + 1, function (sender, iTimer, fTimer) {
                    if (sender.isLastRepeat()) {
                        _this.Video_Text.visible = false;
                        _this.Piano.visible = true;
                    }
                    else {
                        var str = _this.m_answer.charAt(iTimer);
                        switch (str) {
                            case "1":
                                str = "";
                                break;
                            case "2":
                                str = "";
                                break;
                            case "3":
                                str = "";
                                break;
                            case "4":
                                str = "";
                                break;
                            case "5":
                                str = "";
                                break;
                        }
                        _this.Video_Text.text = str;
                    }
                }).Apply();
            }
        }));
    };
    Level32.prototype.CheckClear = function () {
        if (this.m_vecInputs.length != this.m_answer.length)
            return;
        for (var i = 0; i < this.m_answer.length; i++) {
            if (this.m_vecInputs[i] != Number(this.m_answer.charAt(i)))
                return;
        }
        this.m_pGameWorld.ShowClear();
    };
    return Level32;
}(LevelBase));
var Level33 = (function (_super) {
    __extends(Level33, _super);
    function Level33() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level33.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 581, "resourceFileName": "level/331.png", "spriteColor": -4342339, "width": 828, "x": 0, "y": -316 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 74, "resourceFileName": "level/333.png", "width": 85, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 187, "resourceFileName": "level/332.png", "width": 187, "x": -342, "y": 453 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 76, "resourceFileName": "level/334.png", "width": 91, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 187, "resourceFileName": "level/332.png", "width": 187, "x": -122, "y": 453 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 69, "resourceFileName": "level/335.png", "width": 92, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 187, "resourceFileName": "level/332.png", "width": 187, "x": 98, "y": 453 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 82, "resourceFileName": "level/336.png", "width": 90, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "height": 187, "resourceFileName": "level/332.png", "width": 187, "x": 318, "y": 453 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level33.prototype.GetHintImageName = function () {
        return "level/337.png";
    };
    Level33.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.Button1, this.Button2, this.Button3, this.Button4];
        var imgs = [this.Button1_Image, this.Button2_Image, this.Button3_Image, this.Button4_Image];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData = 0;
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons[i].userData++;
                    CCActionManager.Instance().RemoveAllActionsFromTarget(imgs[i]);
                    CCActionManager.Instance().AddAction(new CCRotateTo(0.2, buttons[i].userData * 90), imgs[i]);
                    _this.CheckClear(buttons);
                }));
            };
            fun(i);
        }
    };
    Level33.prototype.CheckClear = function (buttons) {
        var _this = this;
        var str = "";
        for (var i = 0; i < buttons.length; i++) {
            str += buttons[i].userData % 4;
        }
        if (str == "0213") {
            this.m_pGameWorld.SetBlockMouse(true);
            new dTimer(this).Create(200, 1, function () {
                _this.m_pGameWorld.ShowClear();
            });
        }
    };
    return Level33;
}(LevelBase));
var Level34 = (function (_super) {
    __extends(Level34, _super);
    function Level34() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level34.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 206, "resourceFileName": "level/341.png", "width": 192, "x": 0, "y": -538 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 758, "resourceFileName": "level/342.png", "width": 757, "x": 0, "y": 90 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check1", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": -286, "y": -199 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check2", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": -121, "y": -199 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check3", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": -286, "y": -34 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check4", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": -121, "y": -34 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check5", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": 118, "y": -199 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check6", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": 283, "y": -199 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check7", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": 118, "y": -34 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check8", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": 283, "y": -34 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check9", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": -286, "y": 206 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check10", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": -121, "y": 206 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check11", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": -286, "y": 371 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check12", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": -121, "y": 371 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check13", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": 118, "y": 206 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check14", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": 283, "y": 206 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check15", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": 118, "y": 371 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 1, "checkImage": "level/344.png", "className": "Check16", "classType": "dCheckBox", "height": 121, "resourceFileName": "level/343.png", "width": 121, "x": 283, "y": 371 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level34.prototype.GetHintImageName = function () {
        return "level/345.png";
    };
    Level34.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var checks = [this.Check1, this.Check2, this.Check3, this.Check4,
            this.Check5, this.Check6, this.Check7, this.Check8,
            this.Check9, this.Check10, this.Check11, this.Check12,
            this.Check13, this.Check14, this.Check15, this.Check16];
        for (var i = 0; i < checks.length; i++) {
            checks[i].SetCheck(false);
            checks[i].SetEvent(new dEvent().SetOnCheck(function () {
                dSound.PlaySound("data/sound/button.mp3");
                _this.CheckClear(checks);
            }));
        }
    };
    Level34.prototype.CheckClear = function (checks) {
        var answer = [0, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0];
        for (var i = 0; i < checks.length; i++)
            if (checks[i].isCheck() != Boolean(answer[i]))
                return;
        this.m_pGameWorld.ShowClear();
    };
    return Level34;
}(LevelBase));
var Level35 = (function (_super) {
    __extends(Level35, _super);
    function Level35() {
        var _this = _super.call(this) || this;
        _this.m_vecCars = new Array();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level35.prototype._dscData = function () { return { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "GameLayer", "classType": "dImage", "height": 748, "resourceFileName": "level/351.png", "width": 748, "x": -383, "y": -386 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level35.prototype.GetHintImageName = function () {
        return "level/353.png";
    };
    Level35.prototype.Init = function (gameWorld) {
        _super.prototype.Init.call(this, gameWorld);
        this.AddCar(1, 1, 1);
        this.AddCar(3, 1, 1);
        this.AddCar(4, 1, 2);
        this.AddCar(3, 2, 0);
        this.AddCar(2, 3, 1);
        this.AddCar(5, 3, 2);
        this.AddCar(1, 4, 0);
        this.AddCar(3, 4, 0);
        this.AddCar(4, 4, 3);
    };
    Level35.prototype.AddCar = function (x, y, dir) {
        var _this = this;
        var block = new BlockCar1();
        block.SetBlockPos(x, y);
        block.SetDir(dir);
        this.GameLayer.AddChild(block);
        this.m_vecCars.push(block);
        var pTouchEvent = new dSprite();
        pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
            if (block.dir == 0 || block.dir == 2) {
                if (offy > 0) {
                    if (_this.CanMove(block, block.positionX, block.positionY + offy + BlockCar1.BLOCK_SIZE))
                        block.positionY += offy;
                    else
                        block.PosToBlock();
                }
                else {
                    if (_this.CanMove(block, block.positionX, block.positionY + offy))
                        block.positionY += offy;
                    else
                        block.PosToBlock();
                }
            }
            else {
                if (offx > 0) {
                    if (_this.CanMove(block, block.positionX + offx + BlockCar1.BLOCK_SIZE, block.positionY))
                        block.positionX += offx;
                    else
                        block.PosToBlock();
                }
                else {
                    if (_this.CanMove(block, block.positionX + offx, block.positionY))
                        block.positionX += offx;
                    else
                        block.PosToBlock();
                }
            }
        };
        pTouchEvent.OnTouchUp = function (x, y) {
            dSound.PlaySound("data/sound/button.mp3");
            block.PosToBlock();
            if (block.isMoveOut()) {
                block.PlayMoveOut();
                _this.m_vecCars.remove(block);
                if (_this.m_vecCars.length == 0) {
                    _this.m_pGameWorld.SetBlockMouse(true);
                    new dTimer(_this).Create(500, 1, function () {
                        _this.m_pGameWorld.ShowClear();
                    });
                }
            }
        };
        block.SetHandleMouse(true);
        block.SetTouchEvent(pTouchEvent);
    };
    Level35.prototype.CanMove = function (car, newX, newY) {
        var newBlockX = dMath.Floor((newX - BlockCar1.BLOCK_SIZE * 0.5) / BlockCar1.BLOCK_SIZE);
        var newBlockY = dMath.Floor((newY - BlockCar1.BLOCK_SIZE * 0.5) / BlockCar1.BLOCK_SIZE);
        var newBlockX2 = newBlockX + car.GetDirBlockOffsetX();
        var newBlockY2 = newBlockY + car.GetDirBlockOffsetY();
        if (this.FindCarByBlock(newBlockX, newBlockY, car) != null || this.FindCarByBlock(newBlockX2, newBlockY2, car) != null)
            return false;
        if (car.dir == 0 && newBlockY2 >= 6)
            return false;
        if (car.dir == 1 && newBlockX < 1)
            return false;
        if (car.dir == 2 && newBlockY2 < 0)
            return false;
        if (car.dir == 3 && newBlockX >= 5)
            return false;
        return true;
    };
    Level35.prototype.FindCarByBlock = function (x, y, except) {
        for (var i = 0; i < this.m_vecCars.length; i++) {
            if (this.m_vecCars[i] == except)
                continue;
            if (this.m_vecCars[i].blockX == x && this.m_vecCars[i].blockY == y ||
                this.m_vecCars[i].blockX + this.m_vecCars[i].GetDirBlockOffsetX() == x &&
                    this.m_vecCars[i].blockY + this.m_vecCars[i].GetDirBlockOffsetY() == y)
                return this.m_vecCars[i];
        }
        return null;
    };
    return Level35;
}(LevelBase));
var BlockCar1 = (function (_super) {
    __extends(BlockCar1, _super);
    function BlockCar1() {
        var _this = _super.call(this) || this;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.dir = 0;
        _this.LoadFromFile("level/352.png");
        _this.SetSize(BlockCar1.BLOCK_SIZE, BlockCar1.BLOCK_SIZE * 2);
        _this.SetAnchor(0.5, 0.25);
        return _this;
    }
    BlockCar1.prototype.SetBlockPos = function (x, y) {
        this.blockX = x;
        this.blockY = y;
        this.SetPos(x * BlockCar1.BLOCK_SIZE + BlockCar1.BLOCK_SIZE * 0.5, y * BlockCar1.BLOCK_SIZE + BlockCar1.BLOCK_SIZE * 0.5);
    };
    BlockCar1.prototype.SetDir = function (dir) {
        this.SetRotation(dir * 90);
        this.dir = dir;
    };
    BlockCar1.prototype.GetDirBlockOffsetX = function () {
        switch (this.dir) {
            case 0: return 0;
            case 1: return -1;
            case 2: return 0;
            case 3: return 1;
        }
        return 0;
    };
    BlockCar1.prototype.GetDirBlockOffsetY = function () {
        switch (this.dir) {
            case 0: return 1;
            case 1: return 0;
            case 2: return -1;
            case 3: return 0;
        }
        return 0;
    };
    BlockCar1.prototype.PosToBlock = function () {
        var blockX = dMath.Floor(this.positionX / BlockCar1.BLOCK_SIZE);
        var blockY = dMath.Floor(this.positionY / BlockCar1.BLOCK_SIZE);
        this.SetBlockPos(blockX, blockY);
    };
    BlockCar1.prototype.isMoveOut = function () {
        var a1 = this.blockX;
        var a2 = this.blockY;
        var a3 = this.blockX + this.GetDirBlockOffsetX();
        var a4 = this.blockY + this.GetDirBlockOffsetY();
        if (a1 < 0 || a1 >= 6 || a2 < 0 || a2 >= 6 || a3 < 0 || a3 >= 6 || a4 < 0 || a4 >= 6)
            return true;
        return false;
    };
    BlockCar1.prototype.PlayMoveOut = function () {
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCMoveBy(0.5, -this.GetDirBlockOffsetX() * 500, -this.GetDirBlockOffsetY() * 500),
            new CCRemoveSelf()
        ]), this);
    };
    BlockCar1.BLOCK_SIZE = 124;
    return BlockCar1;
}(dImage));
var Level36 = (function (_super) {
    __extends(Level36, _super);
    function Level36() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level36.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 234, "resourceFileName": "level/369b.png", "width": 1020, "x": 0, "y": -423 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 613, "resourceFileName": "level/369c.png", "width": 846, "x": 0, "y": 212 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 108, "resourceFileName": "level/361.png", "width": 108, "x": 54, "y": 14 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 108, "resourceFileName": "level/362.png", "width": 108, "x": 182, "y": 14 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 108, "resourceFileName": "level/363.png", "width": 108, "x": 310, "y": 14 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "height": 108, "resourceFileName": "level/364.png", "width": 108, "x": 54, "y": 148 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button5", "classType": "dButton", "height": 108, "resourceFileName": "level/365.png", "width": 108, "x": 182, "y": 148 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button6", "classType": "dButton", "height": 108, "resourceFileName": "level/366.png", "width": 108, "x": 310, "y": 148 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button7", "classType": "dButton", "height": 108, "resourceFileName": "level/367.png", "width": 108, "x": 54, "y": 282 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button8", "classType": "dButton", "height": 108, "resourceFileName": "level/368.png", "width": 108, "x": 182, "y": 282 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button9", "classType": "dButton", "height": 108, "resourceFileName": "level/369.png", "width": 108, "x": 310, "y": 282 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button10", "classType": "dButton", "height": 108, "resourceFileName": "level/369a.png", "width": 108, "x": 182, "y": 416 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 0, "resourceFileName": "data/fontNumber.json", "width": 0, "x": -213, "y": 4 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level36.prototype.GetHintImageName = function () {
        return "level/369d.png";
    };
    Level36.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.Button1, this.Button2, this.Button3, this.Button4, this.Button5,
            this.Button6, this.Button7, this.Button8, this.Button9, this.Button10];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.Text.text += String((i + 1) % 10);
                    if (_this.Text.text.length > 6)
                        _this.Text.text = _this.Text.text.substring(_this.Text.text.length - 6, _this.Text.text.length);
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
    };
    Level36.prototype.CheckClear = function () {
        if (this.Text.text == "236802")
            this.m_pGameWorld.ShowClear();
    };
    return Level36;
}(LevelBase));
var Level37 = (function (_super) {
    __extends(Level37, _super);
    function Level37() {
        var _this = _super.call(this) || this;
        _this.m_answer = "13233122";
        _this.m_input = "";
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level37.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 173, "resourceFileName": "level/371.png", "width": 173, "x": -301, "y": 243 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 173, "resourceFileName": "level/372.png", "width": 173, "x": 0, "y": 243 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 173, "resourceFileName": "level/373.png", "width": 173, "x": 301, "y": 243 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Img1", "classType": "dAnimationImage", "height": 76, "resourceFileName": "level/374.png|level/375.png|level/376.png|level/377.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 76, "x": -437, "y": -327 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Img2", "classType": "dAnimationImage", "height": 76, "resourceFileName": "level/374.png|level/375.png|level/376.png|level/377.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 76, "x": -313, "y": -327 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Img3", "classType": "dAnimationImage", "height": 76, "resourceFileName": "level/374.png|level/375.png|level/376.png|level/377.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 76, "x": -189, "y": -327 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Img4", "classType": "dAnimationImage", "height": 76, "resourceFileName": "level/374.png|level/375.png|level/376.png|level/377.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 76, "x": -65, "y": -327 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Img5", "classType": "dAnimationImage", "height": 76, "resourceFileName": "level/374.png|level/375.png|level/376.png|level/377.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 76, "x": 59, "y": -327 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Img6", "classType": "dAnimationImage", "height": 76, "resourceFileName": "level/374.png|level/375.png|level/376.png|level/377.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 76, "x": 183, "y": -327 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Img7", "classType": "dAnimationImage", "height": 76, "resourceFileName": "level/374.png|level/375.png|level/376.png|level/377.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 76, "x": 307, "y": -327 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Img8", "classType": "dAnimationImage", "height": 76, "resourceFileName": "level/374.png|level/375.png|level/376.png|level/377.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 76, "x": 431, "y": -327 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level37.prototype.GetHintImageName = function () {
        return "level/378.png";
    };
    Level37.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.Button1, this.Button2, this.Button3];
        var imgs = [this.Img1, this.Img2, this.Img3, this.Img4, this.Img5, this.Img6, this.Img7, this.Img8];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    var loc = _this.m_input.length;
                    var right = _this.m_answer.charAt(loc);
                    var input = String(i + 1);
                    if (input != right) {
                        _this.m_input = "";
                        _this.m_pGameWorld.ShowWrong(null, buttons[i]);
                        _this.UpdateInput(imgs);
                    }
                    else {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_input += input;
                        if (_this.m_input == _this.m_answer)
                            _this.m_pGameWorld.ShowClear();
                        _this.UpdateInput(imgs);
                    }
                }));
            };
            fun(i);
        }
        this.UpdateInput(imgs);
    };
    Level37.prototype.UpdateInput = function (imgs) {
        for (var i = 0; i < this.m_input.length; i++)
            imgs[i].spriteFrame = Number(this.m_input.charAt(i));
        for (var i = this.m_input.length; i < imgs.length; i++)
            imgs[i].spriteFrame = 0;
    };
    return Level37;
}(LevelBase));
var Level38 = (function (_super) {
    __extends(Level38, _super);
    function Level38() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level38.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 596, "resourceFileName": "level/386.png", "width": 930, "x": 0, "y": 266 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 330, "resourceFileName": "level/381.png", "width": 162, "x": -323, "y": -388 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 270, "resourceFileName": "level/382.png", "width": 230, "x": -148, "y": -403 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 87, "resourceFileName": "level/383.png", "width": 132, "x": 113, "y": -496 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "height": 192, "resourceFileName": "level/384.png", "width": 112, "x": 106, "y": -338 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button5", "classType": "dButton", "height": 353, "resourceFileName": "level/385.png", "width": 203, "x": 278, "y": -391 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level38.prototype.GetHintImageName = function () {
        return "level/387.png";
    };
    Level38.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var colorList = [0xffffffff, 0xffff6565, 0xffffeb65, 0xff65ffad, 0xffd265ff, 0xff65c0ff];
        var answer = [1, 5, 3, 2, 4];
        var buttons = [this.Button1, this.Button2, this.Button3, this.Button4, this.Button5];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData = 0;
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons[i].userData++;
                    buttons[i].userData %= colorList.length;
                    buttons[i].spriteColor = colorList[buttons[i].userData];
                    _this.CheckClear(buttons, answer);
                }));
            };
            fun(i);
        }
    };
    Level38.prototype.CheckClear = function (buttons, answer) {
        for (var i = 0; i < buttons.length; i++)
            if (buttons[i].userData != answer[i])
                return;
        this.m_pGameWorld.ShowClear();
    };
    return Level38;
}(LevelBase));
var Level39 = (function (_super) {
    __extends(Level39, _super);
    function Level39() {
        var _this = _super.call(this) || this;
        _this.m_vecBlocks = new Array();
        _this.m_crossed = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level39.prototype._dscData = function () { return { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "GameLayer", "classType": "dSprite", "height": 792, "width": 792, "x": -397, "y": -458 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level39.prototype.GetHintImageName = function () {
        return "level/393.png";
    };
    Level39.prototype.Init = function (gameWorld) {
        _super.prototype.Init.call(this, gameWorld);
        for (var j = 0; j < 5; j++) {
            for (var i = 0; i < 5; i++) {
                var back = new dImage();
                back.LoadFromFile("level/392.png");
                back.SetPos(i * 197, j * 197);
                this.GameLayer.AddChild(back);
            }
        }
        this.CreateBlock2(0, 0, 3, 2);
        this.CreateBlock2(0, 3, 4, 0);
        this.CreateBlock2(0, 1, 3, 4);
        this.CreateBlock2(2, 0, 1, 4);
        this.CreateBlock2(1, 2, 4, 3);
        this.CreateBlock2(2, 3, 4, 1);
        this.CreateBlock2(0, 4, 3, 1);
        this.CreateBlock2(2, 1, 4, 4);
        this.UpdateLine();
    };
    Level39.prototype.CreateBlock2 = function (x1, y1, x2, y2) {
        var p1 = this.CreateBlock(x1, y1);
        var p2 = this.CreateBlock(x2, y2);
        p1.SetLink(p2);
        this.GameLayer.AddChild(p1);
        this.GameLayer.AddChild(p2);
    };
    Level39.prototype.CreateBlock = function (x, y) {
        var _this = this;
        var block = new Block11(this.GameLayer);
        block.SetBlockPos(x, y);
        var pTouchEvent = new dSprite();
        pTouchEvent.OnTouchDown = function (x, y, delta) {
            _this.GameLayer.AddChild(block);
        };
        pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
            block.positionX += x;
            block.positionY += y;
            _this.UpdateLine();
        };
        pTouchEvent.OnTouchUp = function (x, y) {
            dSound.PlaySound("data/sound/button.mp3");
            var newPos = block.PosToBlockPos();
            if (_this.FindBlockByBlockPos(newPos.x, newPos.y) == null)
                block.SetBlockPos(newPos.x, newPos.y);
            else
                block.SetBlockPos(block.blockX, block.blockY);
            _this.UpdateLine();
            _this.CheckClear();
        };
        block.SetHandleMouse(true);
        block.SetTouchEvent(pTouchEvent);
        this.GameLayer.AddChild(block);
        this.m_vecBlocks.push(block);
        return block;
    };
    Level39.prototype.FindBlockByBlockPos = function (x, y) {
        for (var i = 0; i < this.m_vecBlocks.length; i++) {
            if (this.m_vecBlocks[i].blockX == x && this.m_vecBlocks[i].blockY == y)
                return this.m_vecBlocks[i];
        }
        return null;
    };
    Level39.prototype.UpdateLine = function () {
        for (var i = 0; i < this.m_vecBlocks.length; i++)
            this.m_vecBlocks[i].UpdateLine();
        this.m_crossed = false;
        for (var i = 0; i < this.m_vecBlocks.length; i++)
            this.m_vecBlocks[i].m_line.spriteColor = 0xffffffff;
        for (var i = 0; i < this.m_vecBlocks.length; i += 2) {
            for (var j = 0; j < this.m_vecBlocks.length; j += 2) {
                if (i == j)
                    continue;
                var p1 = this.m_vecBlocks[i];
                var p2 = this.m_vecBlocks[i + 1];
                var p3 = this.m_vecBlocks[j];
                var p4 = this.m_vecBlocks[j + 1];
                if (dMath.LineLineIntersection2D(p1.positionX, p1.positionY, p2.positionX, p2.positionY, p3.positionX, p3.positionY, p4.positionX, p4.positionY)) {
                    this.m_crossed = true;
                    p1.m_line.spriteColor = p2.m_line.spriteColor = p3.m_line.spriteColor = p4.m_line.spriteColor = 0xffff4040;
                }
            }
        }
    };
    Level39.prototype.CheckClear = function () {
        if (!this.m_crossed)
            this.m_pGameWorld.ShowClear();
    };
    return Level39;
}(LevelBase));
var Block11 = (function (_super) {
    __extends(Block11, _super);
    function Block11(pGameLayer) {
        var _this = _super.call(this) || this;
        _this.m_image = new dImage();
        _this.m_line = new dLine();
        _this.blockX = 0;
        _this.blockY = 0;
        _this.m_link = null;
        _this.m_pGameLayer = null;
        _this.m_pGameLayer = pGameLayer;
        _this.SetAnchor(0.5, 0.5);
        _this.SetSize(224, 224);
        _this.m_image.LoadFromFile("level/391.png");
        _this.m_line.lineWidth = 10;
        _this.m_pGameLayer.AddChild(_this.m_line);
        _this.AddChild(_this.m_image);
        return _this;
    }
    Block11.prototype.SetBlockPos = function (x, y) {
        this.blockX = x;
        this.blockY = y;
        this.SetPos(x * 197, y * 197);
    };
    Block11.prototype.PosToBlockPos = function () {
        var x = dMath.Floor((this.positionX + 197 * 0.5) / 197);
        var y = dMath.Floor((this.positionY + 197 * 0.5) / 197);
        if (x < 0)
            x = 0;
        if (x > 4)
            x = 4;
        if (y < 0)
            y = 0;
        if (y > 4)
            y = 4;
        return new dVector2(x, y);
    };
    Block11.prototype.SetLink = function (other) {
        var last = this.m_link;
        this.m_link = other;
        this.UpdateLine();
        if (last == null)
            other.SetLink(this);
    };
    Block11.prototype.UpdateLine = function () {
        this.m_line.Clear();
        if (this.m_link) {
            this.m_line.MoveTo(this.positionX, this.positionY);
            this.m_line.LineTo(this.m_link.positionX, this.m_link.positionY);
        }
    };
    return Block11;
}(dSprite));
var Level4 = (function (_super) {
    __extends(Level4, _super);
    function Level4() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 6;
        _this.m_heightCount = 9;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level4.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 727, "resourceFileName": "level/41.png", "width": 923, "x": 0, "y": -276 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "BlockLayer", "classType": "dSprite", "height": 50, "width": 50, "x": -403, "y": -272 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 136, "resourceFileName": "level/42.png", "width": 939, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "height": 136, "resourceFileName": "", "width": 939, "x": 0, "y": 357 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level4.prototype.GetHintImageName = function () {
        return "level/43.png";
    };
    Level4.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.GameLayer_dImage2.SetTransparentMouse(true);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new TextBlock();
                    pBlock.SetPos(i * TextBlock.BlockWidthWithSpace, j * TextBlock.BlockHeightWithSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.GameLayer_BlockLayer.AddChild(pBlock);
                    var pTouchEvent = new dSprite();
                    pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                        _this.OnMove(pBlock, offx, offy);
                    };
                    pTouchEvent.OnTouchUp = function (x, y) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.OnUp(pBlock);
                    };
                    pBlock.SetTouchEvent(pTouchEvent);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        var a1 = ["", "", "", "", "", "", "", "", ""];
        for (var i = 0; i < this.m_heightCount; i++) {
            this.m_vecBlocks[i][0].SetText(a1[i]);
            this.m_vecBlocks[i][1].SetText(a1[i]);
            this.m_vecBlocks[i][2].SetText(a1[i]);
            this.m_vecBlocks[i][3].SetText(a1[i]);
            this.m_vecBlocks[i][4].SetText(a1[i]);
            this.m_vecBlocks[i][5].SetText(a1[i]);
        }
        this.GameLayer.clipChild = true;
    };
    Level4.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var canHor = false;
        var canVer = true;
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * TextBlock.BlockWidthWithSpace) % (this.m_widthCount * TextBlock.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * TextBlock.BlockHeightWithSpace) % (this.m_heightCount * TextBlock.BlockHeightWithSpace);
            }
        }
        this.PlayFrictionSound();
    };
    Level4.prototype.GetText = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetText();
    };
    Level4.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + TextBlock.BlockWidthWithSpace / 2) / TextBlock.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + TextBlock.BlockHeightWithSpace / 2) / TextBlock.BlockHeightWithSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * TextBlock.BlockWidthWithSpace, blockY * TextBlock.BlockHeightWithSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetText(0, 2) == "" && this.GetText(1, 2) == "" && this.GetText(2, 2) == "" && this.GetText(3, 2) == "" &&
            this.GetText(4, 2) == "" && this.GetText(5, 2) == "")
            this.m_pGameWorld.ShowClear();
    };
    return Level4;
}(LevelBase));
var TextBlock = (function (_super) {
    __extends(TextBlock, _super);
    function TextBlock() {
        var _this = _super.call(this) || this;
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.Text = new dBitmapFont();
        _this.SetAnchor(0, 0);
        var p = new dSprite();
        p.SetSize(TextBlock.BlockWidthWithSpace, TextBlock.BlockHeightWithSpace);
        p.SetPos(-(TextBlock.BlockWidthWithSpace - _this.width) / 2, -(TextBlock.BlockHeightWithSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.Text.positionY = -10;
        _this.Text.fontSize = 80;
        _this.Text.spriteColor = 0xffffffff;
        _this.Text.LoadFromFile("data/zi.json");
        _this.AddChild(_this.Text);
        return _this;
    }
    TextBlock.prototype.SetText = function (str) {
        this.Text.text = str;
    };
    TextBlock.prototype.GetText = function () {
        return this.Text.text;
    };
    TextBlock.BlockWidth = 126;
    TextBlock.BlockHeight = 126;
    TextBlock.BlockWidthWithSpace = 160;
    TextBlock.BlockHeightWithSpace = 136;
    return TextBlock;
}(dSprite));
var Level40 = (function (_super) {
    __extends(Level40, _super);
    function Level40() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level40.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 567, "resourceFileName": "level/401.png", "width": 897, "x": 0, "y": -315 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 137, "resourceFileName": "level/402.png", "width": 137, "x": -438, "y": 383 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 137, "resourceFileName": "level/402.png", "width": 137, "x": -292, "y": 383 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 137, "resourceFileName": "level/402.png", "width": 137, "x": -146, "y": 383 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "height": 137, "resourceFileName": "level/402.png", "width": 137, "x": 0, "y": 383 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button5", "classType": "dButton", "height": 137, "resourceFileName": "level/402.png", "width": 137, "x": 146, "y": 383 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button6", "classType": "dButton", "height": 137, "resourceFileName": "level/402.png", "width": 137, "x": 292, "y": 383 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button7", "classType": "dButton", "height": 137, "resourceFileName": "level/402.png", "width": 137, "x": 438, "y": 383 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level40.prototype.GetHintImageName = function () {
        return "level/403.png";
    };
    Level40.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.Button1, this.Button2, this.Button3, this.Button4, this.Button5, this.Button6, this.Button7];
        var colors = [0xffffffff, 0xffff6565, 0xff65ffad, 0xffffeb65, 0xff65c0ff, 0xffc765ff];
        var answer = [0, 2, 1, 3, 2, 0, 4];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData = 0;
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons[i].userData++;
                    buttons[i].userData %= colors.length;
                    buttons[i].spriteColor = colors[buttons[i].userData];
                    _this.CheckClear(buttons, answer);
                }));
            };
            fun(i);
        }
    };
    Level40.prototype.CheckClear = function (buttons, answer) {
        for (var i = 0; i < buttons.length; i++)
            if (buttons[i].userData != answer[i])
                return;
        this.m_pGameWorld.ShowClear();
    };
    return Level40;
}(LevelBase));
var Level41 = (function (_super) {
    __extends(Level41, _super);
    function Level41() {
        var _this = _super.call(this) || this;
        _this.m_imgs = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level41.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 331, "resourceFileName": "level/411.png", "width": 390, "x": 28, "y": 58 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 474, "resourceFileName": "level/412.png", "width": 503, "x": -286, "y": -194 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 388, "resourceFileName": "level/413.png", "width": 429, "x": 272, "y": -369 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 345, "resourceFileName": "level/414.png", "width": 448, "x": 374, "y": -77 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 235, "resourceFileName": "level/415.png", "width": 194, "x": 322, "y": 262 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 504, "resourceFileName": "level/416.png", "width": 420, "x": 115, "y": 492 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag7", "classType": "dImage", "height": 469, "resourceFileName": "level/417.png", "width": 384, "x": -308, "y": 396 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col1", "classType": "dImage", "height": 331, "resourceFileName": "level/411.png", "visible": 0, "width": 390, "x": -231, "y": -322 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col2", "classType": "dImage", "height": 474, "resourceFileName": "level/412.png", "visible": 0, "width": 503, "x": -202, "y": 38 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col3", "classType": "dImage", "height": 388, "resourceFileName": "level/413.png", "visible": 0, "width": 429, "x": 137, "y": -299 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col4", "classType": "dImage", "height": 345, "resourceFileName": "level/414.png", "visible": 0, "width": 448, "x": -100, "y": 236 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col5", "classType": "dImage", "height": 235, "resourceFileName": "level/415.png", "visible": 0, "width": 194, "x": 45, "y": 76.99704, "z": -2.870835 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col6", "classType": "dImage", "height": 504, "resourceFileName": "level/416.png", "visible": 0, "width": 420, "x": 198, "y": 139 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Col7", "classType": "dImage", "height": 469, "resourceFileName": "level/417.png", "visible": 0, "width": 384, "x": 255, "y": -89 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level41.prototype.GetHintImageName = function () {
        return "level/418.png";
    };
    Level41.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var imgs = [this.CanDrag1, this.CanDrag2, this.CanDrag3, this.CanDrag4, this.CanDrag5, this.CanDrag6, this.CanDrag7];
        this.m_imgs = imgs;
        for (var i = 0; i < imgs.length; i++) {
            imgs[i].userData["id"] = (i + 1);
            imgs[i].userData["CanDrag"].onTouchUp = function (sender) {
                for (var j = 0; j < imgs.length; j++) {
                    if (_this.CheckNear(sender.m_target, imgs[j])) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.CheckClear();
                    }
                }
            };
        }
    };
    Level41.prototype.CheckNear = function (p1, p2) {
        if (p1 == p2)
            return false;
        if (p1.GetParent() != this || p2.GetParent() != this)
            return false;
        var id1 = p1.userData["id"];
        var id2 = p2.userData["id"];
        var col1 = this.FindChild("Col" + id1);
        var col2 = this.FindChild("Col" + id2);
        var sub = col2.GetPosVector2().Sub(col1.GetPosVector2());
        var sub2 = p2.GetPosVector2().Sub(p1.GetPosVector2());
        if (dMath.Abs(sub.x - sub2.x) < 50 && dMath.Abs(sub.y - sub2.y) < 50) {
            p2.SetPosVector2(p1.GetPosVector2().Add(sub));
            p1.AddChild(p2);
            p2.positionX -= p1.positionX;
            p2.positionY -= p1.positionY;
            p2.SetHandleMouse(false);
            return true;
        }
        return false;
    };
    Level41.prototype.CheckClear = function () {
        var countInDesk = 0;
        var p = null;
        for (var i = 0; i < this.m_imgs.length; i++) {
            if (this.m_imgs[i].GetParent() == this) {
                countInDesk++;
                p = this.m_imgs[i];
            }
        }
        if (countInDesk == 1)
            this.m_pGameWorld.ShowClear();
    };
    return Level41;
}(LevelBase));
var Level42 = (function (_super) {
    __extends(Level42, _super);
    function Level42() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level42.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 419, "resourceFileName": "level/421.png", "width": 368, "x": 0, "y": -459 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 110, "resourceFileName": "level/423.png", "width": 96, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 164, "resourceFileName": "level/422.png", "width": 164, "x": 0, "y": -13 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 110, "resourceFileName": "level/423.png", "width": 96, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 164, "resourceFileName": "level/422.png", "width": 164, "x": -115, "y": 203 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 110, "resourceFileName": "level/423.png", "width": 96, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 164, "resourceFileName": "level/422.png", "width": 164, "x": 101, "y": 203 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 110, "resourceFileName": "level/423.png", "width": 96, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "height": 164, "resourceFileName": "level/422.png", "width": 164, "x": -216, "y": 428 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 110, "resourceFileName": "level/423.png", "width": 96, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button5", "classType": "dButton", "height": 164, "resourceFileName": "level/422.png", "width": 164, "x": 0, "y": 428 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 110, "resourceFileName": "level/423.png", "width": 96, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button6", "classType": "dButton", "height": 164, "resourceFileName": "level/422.png", "width": 164, "x": 216, "y": 428 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level42.prototype.GetHintImageName = function () {
        return "level/424.png";
    };
    Level42.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.Button1, this.Button2, this.Button3, this.Button4, this.Button5, this.Button6];
        var imgs = [this.Button1_Img, this.Button2_Img, this.Button3_Img, this.Button4_Img, this.Button5_Img, this.Button6_Img];
        var answer = [1, 2, 3, 0, 0, 2];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData = 0;
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons[i].userData++;
                    CCActionManager.Instance().RemoveAllActionsFromTarget(imgs[i]);
                    CCActionManager.Instance().AddAction(new CCRotateTo(0.2, buttons[i].userData * 90), imgs[i]);
                    _this.CheckClear(buttons, answer);
                }));
            };
            fun(i);
        }
    };
    Level42.prototype.CheckClear = function (buttons, answer) {
        var _this = this;
        for (var i = 0; i < buttons.length; i++)
            if ((buttons[i].userData % 4) != answer[i])
                return;
        this.m_pGameWorld.SetBlockMouse(true);
        new dTimer(this).Create(200, 1, function () {
            _this.m_pGameWorld.ShowClear();
        });
    };
    return Level42;
}(LevelBase));
var Level43 = (function (_super) {
    __extends(Level43, _super);
    function Level43() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level43.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.53, "anchorV": 0.894253, "className": "CanRotationArrow1", "classType": "dImage", "height": 210, "resourceFileName": "level/431.png", "width": 87, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.894253, "className": "CanRotationArrow2", "classType": "dImage", "height": 225, "resourceFileName": "level/432.png", "rotation": 90, "width": 93, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dImage", "height": 682, "resourceFileName": "level/433.png", "width": 682, "x": 0, "y": -180 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 174, "resourceFileName": "level/434.png", "width": 222, "x": -337, "y": 563 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level43.prototype.GetHintImageName = function () {
        return "level/435.png";
    };
    Level43.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.Back_CanRotationArrow1.userData["CanRotation"].onTouchUp =
            this.Back_CanRotationArrow2.userData["CanRotation"].onTouchUp = function () {
                dSound.PlaySound("data/sound/button.mp3");
                var angle1 = _this.Back_CanRotationArrow1.rotation % 360;
                var angle2 = _this.Back_CanRotationArrow2.rotation % 360;
                if (dMath.Abs(angle1 - 270) < 45 && dMath.Abs(angle2 - 135) < 45)
                    _this.m_pGameWorld.ShowClear();
            };
    };
    return Level43;
}(LevelBase));
var Level44 = (function (_super) {
    __extends(Level44, _super);
    function Level44() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level44.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown11", "classType": "dImage", "height": 238, "resourceFileName": "level/442.png", "width": 112, "x": -353, "y": 74 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown12", "classType": "dImage", "height": 228, "resourceFileName": "level/443.png", "width": 93, "x": -210, "y": 74 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown13", "classType": "dImage", "height": 250, "resourceFileName": "level/444.png", "width": 112, "x": -67, "y": 74 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown14", "classType": "dImage", "height": 253, "resourceFileName": "level/445.png", "width": 93, "x": 76, "y": 74 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown15", "classType": "dImage", "height": 247, "resourceFileName": "level/446.png", "width": 101, "x": 219, "y": 74 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown16", "classType": "dImage", "height": 243, "resourceFileName": "level/447.png", "width": 105, "x": 362, "y": 74 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dImage", "height": 160, "resourceFileName": "level/441.png", "width": 895, "x": 0, "y": -150 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage8", "classType": "dImage", "height": 295, "resourceFileName": "level/448.png", "width": 738, "x": 37, "y": -583 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage9", "classType": "dImage", "height": 233, "resourceFileName": "level/449.png", "width": 719, "x": -4, "y": 387 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level44.prototype.GetHintImageName = function () {
        return "level/449a.png";
    };
    Level44.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.Back_CanTouchDown11, this.Back_CanTouchDown12, this.Back_CanTouchDown13, this.Back_CanTouchDown14, this.Back_CanTouchDown15, this.Back_CanTouchDown16];
        var answer = [1, 0, 1, 0, 1, 0];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData["Num"] = 0;
                buttons[i].userData["CanTouchDown"].onTouchDown = function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons[i].userData["Num"]++;
                    buttons[i].userData["Num"] %= 2;
                    CCActionManager.Instance().RemoveAllActionsFromTarget(buttons[i]);
                    var pos = [73, -73];
                    CCActionManager.Instance().AddAction(new CCMoveTo(0.1, buttons[i].positionX, pos[buttons[i].userData["Num"]]), buttons[i]);
                    _this.CheckClear(buttons, answer);
                };
            };
            fun(i);
        }
    };
    Level44.prototype.CheckClear = function (button, answer) {
        var _this = this;
        for (var i = 0; i < button.length; i++)
            if (button[i].userData["Num"] != answer[i])
                return;
        this.m_pGameWorld.SetBlockMouse(true);
        new dTimer(this).Create(100, 1, function () {
            _this.m_pGameWorld.ShowClear();
        });
    };
    return Level44;
}(LevelBase));
var Level45 = (function (_super) {
    __extends(Level45, _super);
    function Level45() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 4;
        _this.m_heightCount = 6;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level45.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 1120, "resourceFileName": "level/451.png", "width": 850, "x": 0, "y": -94 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "BlockLayer", "classType": "dSprite", "height": 50, "width": 50, "x": -403, "y": -272 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "height": 136, "resourceFileName": "", "width": 939, "x": 90, "y": 271 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level45.prototype.GetHintImageName = function () {
        return "level/452.png";
    };
    Level45.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new TextBlock9();
                    pBlock.SetPos(i * TextBlock9.BlockWidthWithSpace, j * TextBlock9.BlockHeightWithSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.GameLayer_BlockLayer.AddChild(pBlock);
                    var pTouchEvent = new dSprite();
                    pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                        _this.OnMove(pBlock, offx, offy);
                    };
                    pTouchEvent.OnTouchUp = function (x, y) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.OnUp(pBlock);
                    };
                    pBlock.SetTouchEvent(pTouchEvent);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        var a1 = ["", "", "", "", "", ""];
        for (var i = 0; i < this.m_heightCount; i++) {
            this.m_vecBlocks[i][0].SetText(a1[i]);
            this.m_vecBlocks[i][1].SetText(a1[i]);
            this.m_vecBlocks[i][2].SetText(a1[i]);
            this.m_vecBlocks[i][3].SetText(a1[i]);
        }
        this.GameLayer.clipChild = true;
    };
    Level45.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var canHor = false;
        var canVer = true;
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * TextBlock9.BlockWidthWithSpace) % (this.m_widthCount * TextBlock9.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * TextBlock9.BlockHeightWithSpace) % (this.m_heightCount * TextBlock9.BlockHeightWithSpace);
            }
        }
        this.PlayFrictionSound();
    };
    Level45.prototype.GetText = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetText();
    };
    Level45.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + TextBlock9.BlockWidthWithSpace / 2) / TextBlock9.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + TextBlock9.BlockHeightWithSpace / 2) / TextBlock9.BlockHeightWithSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * TextBlock9.BlockWidthWithSpace, blockY * TextBlock9.BlockHeightWithSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetText(0, 2) == "" && this.GetText(1, 2) == "" && this.GetText(2, 2) == "" && this.GetText(3, 2) == "")
            this.m_pGameWorld.ShowClear();
    };
    return Level45;
}(LevelBase));
var TextBlock9 = (function (_super) {
    __extends(TextBlock9, _super);
    function TextBlock9() {
        var _this = _super.call(this) || this;
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.Text = new dBitmapFont();
        _this.SetAnchor(0, 0);
        var p = new dSprite();
        p.SetSize(TextBlock9.BlockWidthWithSpace, TextBlock9.BlockHeightWithSpace);
        p.SetPos(-(TextBlock9.BlockWidthWithSpace - _this.width) / 2, -(TextBlock9.BlockHeightWithSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.Text.positionY = -10;
        _this.Text.fontSize = 80;
        _this.Text.spriteColor = 0xffffffff;
        _this.Text.LoadFromFile("data/zi.json");
        _this.AddChild(_this.Text);
        return _this;
    }
    TextBlock9.prototype.SetText = function (str) {
        this.Text.text = str;
    };
    TextBlock9.prototype.GetText = function () {
        return this.Text.text;
    };
    TextBlock9.BlockWidth = 126;
    TextBlock9.BlockHeight = 126;
    TextBlock9.BlockWidthWithSpace = 182;
    TextBlock9.BlockHeightWithSpace = 136;
    return TextBlock9;
}(dSprite));
var Level46 = (function (_super) {
    __extends(Level46, _super);
    function Level46() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level46.prototype._dscData = function () { return { "_child": [{ "alpha": 0.447059, "anchorU": 0.5, "anchorV": 0.5, "className": "dImage5", "classType": "dImage", "height": 476, "resourceFileName": "level/465.png", "width": 421, "x": 310, "y": -575 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dImage", "height": 879, "resourceFileName": "level/466.png", "width": 879, "x": 0, "y": 103.006348, "z": 16.686871 }, { "_child": [{ "anchorU": 0.5, "anchorV": 5.480069, "className": "CanRotation1", "classType": "dImage", "height": 88, "resourceFileName": "level/461.png", "width": 88, "x": -3.545785, "y": 5.246094 }, { "anchorU": 0.5, "anchorV": 3.438601, "className": "CanRotation2", "classType": "dImage", "height": 110, "resourceFileName": "level/462.png", "width": 110, "x": -5.721051, "y": 5.246094 }, { "anchorU": 0.5, "anchorV": 3.46607, "className": "CanRotation3", "classType": "dImage", "height": 76, "resourceFileName": "level/463.png", "width": 76, "x": -4.633415, "y": 7.421356 }, { "anchorU": 0.5, "anchorV": 3.135896, "className": "CanRotation4", "classType": "dImage", "height": 57, "resourceFileName": "level/464.png", "width": 57, "x": -4.633417, "y": 5.246094 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dSprite", "height": 879, "width": 879, "x": 0, "y": 100 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level46.prototype.GetHintImageName = function () {
        return "level/467.png";
    };
    Level46.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.GameLayer_CanRotation1, this.GameLayer_CanRotation2, this.GameLayer_CanRotation3, this.GameLayer_CanRotation4];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData["CanRotation"].m_angleStep = 45;
                buttons[i].userData["CanRotation"].onTouchUp = function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.CheckClear();
                };
            };
            fun(i);
        }
    };
    Level46.prototype.CheckClear = function () {
        if (this.GameLayer_CanRotation1.rotation == 135 && this.GameLayer_CanRotation2.rotation == 90 &&
            this.GameLayer_CanRotation3.rotation == 225 && this.GameLayer_CanRotation4.rotation == 315)
            this.m_pGameWorld.ShowClear();
    };
    return Level46;
}(LevelBase));
var Level47 = (function (_super) {
    __extends(Level47, _super);
    function Level47() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 4;
        _this.m_heightCount = 9;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level47.prototype._dscData = function () { return { "_child": [{ "_child": [{ "alpha": 0.647059, "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 896, "resourceFileName": "level/472.png", "width": 889, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Top", "classType": "dImage", "height": 818, "resourceFileName": "level/471.png", "width": 818, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dImage", "clipChild": 1, "height": 818, "resourceFileName": "", "width": 818, "x": 0, "y": -246, "z": -2.484268 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "BlockLayer", "classType": "dSprite", "height": 50, "width": 50, "x": -274, "y": -272 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 128, "resourceFileName": "level/473.png", "width": 675, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "height": 128, "resourceFileName": "", "width": 675, "x": 0, "y": 357 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level47.prototype.GetHintImageName = function () {
        return "level/474.png";
    };
    Level47.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.Back_Top.SetTransparentMouse(true);
        this.Back_CanDrag1.userData["CanDrag"].canDragOutsideScreen = true;
        this.Back_CanDrag1.userData["CanDrag"].dragLimitLengthV = new dVector2(-300, 300);
        this.Back_CanDrag1.userData["CanDrag"].dragLimitLengthH = new dVector2(-300, 300);
        this.GameLayer_dImage2.SetTransparentMouse(true);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new TextBlock47();
                    pBlock.SetPos(i * TextBlock47.BlockWidthWithSpace, j * TextBlock47.BlockHeightWithSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.GameLayer_BlockLayer.AddChild(pBlock);
                    var pTouchEvent = new dSprite();
                    pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                        _this.OnMove(pBlock, offx, offy);
                    };
                    pTouchEvent.OnTouchUp = function (x, y) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.OnUp(pBlock);
                    };
                    pBlock.SetTouchEvent(pTouchEvent);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        var a1 = ["", "", "", "", "", "", "", "", ""];
        for (var i = 0; i < this.m_heightCount; i++) {
            this.m_vecBlocks[i][0].SetText(a1[i]);
            this.m_vecBlocks[i][1].SetText(a1[i]);
            this.m_vecBlocks[i][2].SetText(a1[i]);
            this.m_vecBlocks[i][3].SetText(a1[i]);
        }
        this.GameLayer.clipChild = true;
    };
    Level47.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var canHor = false;
        var canVer = true;
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * TextBlock47.BlockWidthWithSpace) % (this.m_widthCount * TextBlock47.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * TextBlock47.BlockHeightWithSpace) % (this.m_heightCount * TextBlock47.BlockHeightWithSpace);
            }
        }
        this.PlayFrictionSound();
    };
    Level47.prototype.GetText = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetText();
    };
    Level47.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + TextBlock47.BlockWidthWithSpace / 2) / TextBlock47.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + TextBlock47.BlockHeightWithSpace / 2) / TextBlock47.BlockHeightWithSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * TextBlock47.BlockWidthWithSpace, blockY * TextBlock47.BlockHeightWithSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetText(0, 2) == "" && this.GetText(1, 2) == "" && this.GetText(2, 2) == "" && this.GetText(3, 2) == "")
            this.m_pGameWorld.ShowClear();
    };
    return Level47;
}(LevelBase));
var TextBlock47 = (function (_super) {
    __extends(TextBlock47, _super);
    function TextBlock47() {
        var _this = _super.call(this) || this;
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.Text = new dBitmapFont();
        _this.SetAnchor(0, 0);
        var p = new dSprite();
        p.SetSize(TextBlock47.BlockWidthWithSpace, TextBlock47.BlockHeightWithSpace);
        p.SetPos(-(TextBlock47.BlockWidthWithSpace - _this.width) / 2, -(TextBlock47.BlockHeightWithSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.Text.positionY = -10;
        _this.Text.fontSize = 80;
        _this.Text.spriteColor = 0xffffffff;
        _this.Text.LoadFromFile("data/zi.json");
        _this.AddChild(_this.Text);
        return _this;
    }
    TextBlock47.prototype.SetText = function (str) {
        this.Text.text = str;
    };
    TextBlock47.prototype.GetText = function () {
        return this.Text.text;
    };
    TextBlock47.BlockWidth = 126;
    TextBlock47.BlockHeight = 126;
    TextBlock47.BlockWidthWithSpace = 183;
    TextBlock47.BlockHeightWithSpace = 136;
    return TextBlock47;
}(dSprite));
var Level48 = (function (_super) {
    __extends(Level48, _super);
    function Level48() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level48.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 1060, "resourceFileName": "level/481.png", "width": 882, "x": 0, "y": -58 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown1", "classType": "dImage", "height": 145, "resourceFileName": "level/482.png", "width": 131, "x": -330, "y": -463 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown2", "classType": "dImage", "height": 110, "resourceFileName": "level/483.png", "width": 117, "x": -162, "y": -459 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown3", "classType": "dImage", "height": 153, "resourceFileName": "level/484.png", "width": 127, "x": 1, "y": -457 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown4", "classType": "dImage", "height": 157, "resourceFileName": "level/485.png", "width": 156, "x": 164, "y": -462 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown5", "classType": "dImage", "height": 107, "resourceFileName": "level/486.png", "width": 136, "x": -326, "y": -189 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown6", "classType": "dImage", "height": 116, "resourceFileName": "level/487.png", "width": 132, "x": -152, "y": -181 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown7", "classType": "dImage", "height": 128, "resourceFileName": "level/488.png", "width": 120, "x": 12, "y": -186 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown8", "classType": "dImage", "height": 110, "resourceFileName": "level/489.png", "width": 117, "x": 176, "y": -177 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown9", "classType": "dImage", "height": 129, "resourceFileName": "level/489a.png", "width": 103, "x": -331, "y": 80 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown10", "classType": "dImage", "height": 136, "resourceFileName": "level/489b.png", "width": 157, "x": -159, "y": 78 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown11", "classType": "dImage", "height": 130, "resourceFileName": "level/489c.png", "width": 131, "x": 14, "y": 84 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown12", "classType": "dImage", "height": 128, "resourceFileName": "level/489d.png", "width": 92, "x": 174, "y": 77.865982 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown13", "classType": "dImage", "height": 125, "resourceFileName": "level/489e.png", "width": 152, "x": -320, "y": 338 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown14", "classType": "dImage", "height": 138, "resourceFileName": "level/489f.png", "width": 163, "x": -136, "y": 340 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown15", "classType": "dImage", "height": 128, "resourceFileName": "level/489g.png", "width": 92, "x": 18, "y": 338 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown16", "classType": "dImage", "height": 145, "resourceFileName": "level/489h.png", "width": 112, "x": 172, "y": 334 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level48.prototype.GetHintImageName = function () {
        return "level/489i.png";
    };
    Level48.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.CanTouchDown1, this.CanTouchDown2, this.CanTouchDown3, this.CanTouchDown4,
            this.CanTouchDown5, this.CanTouchDown6, this.CanTouchDown7, this.CanTouchDown8,
            this.CanTouchDown9, this.CanTouchDown10, this.CanTouchDown11, this.CanTouchDown12,
            this.CanTouchDown13, this.CanTouchDown14, this.CanTouchDown15, this.CanTouchDown16];
        var answer = [1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].alpha = 0;
                buttons[i].userData["CanTouchDown"].onTouchDown = function () {
                    buttons[i].alpha = buttons[i].alpha ? 0 : 1;
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.CheckClear(buttons, answer);
                };
            };
            fun(i);
        }
    };
    Level48.prototype.CheckClear = function (buttons, answer) {
        for (var i = 0; i < buttons.length; i++)
            if (buttons[i].alpha != answer[i])
                return;
        this.m_pGameWorld.ShowClear();
    };
    return Level48;
}(LevelBase));
var Level49 = (function (_super) {
    __extends(Level49, _super);
    function Level49() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level49.prototype._dscData = function () { return { "_child": [{ "anchorU": 0, "anchorV": 0.5, "className": "CanRotation1", "classType": "dImage", "height": 272, "resourceFileName": "level/491.png", "width": 272, "x": -288, "y": -697 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 271, "resourceFileName": "level/492.png", "width": 271, "x": 394, "y": -458 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 666, "resourceFileName": "level/493.png", "width": 636, "x": -102, "y": -363 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 110, "resourceFileName": "level/495.png", "width": 96, "x": -85, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 110, "resourceFileName": "level/495.png", "width": 96, "x": 85, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ButtonBack1", "classType": "dImage", "height": 193, "resourceFileName": "level/494.png", "width": 420, "x": 0, "y": 161 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 110, "resourceFileName": "level/495.png", "width": 96, "x": -85, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 110, "resourceFileName": "level/495.png", "width": 96, "x": 85, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ButtonBack2", "classType": "dImage", "height": 193, "resourceFileName": "level/494.png", "width": 420, "x": 0, "y": 383 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 110, "resourceFileName": "level/495.png", "width": 96, "x": -85, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 110, "resourceFileName": "level/495.png", "width": 96, "x": 85, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ButtonBack3", "classType": "dImage", "height": 193, "resourceFileName": "level/494.png", "width": 420, "x": 0, "y": 605 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level49.prototype.GetHintImageName = function () {
        return "level/496.png";
    };
    Level49.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.dImage1.SetTransparentMouse(true);
        this.CanDrag1.userData["CanDrag"].canDragV = false;
        var buttons = [this.ButtonBack1_Button1, this.ButtonBack1_Button2, this.ButtonBack2_Button1, this.ButtonBack2_Button2, this.ButtonBack3_Button1, this.ButtonBack3_Button2];
        var answer = [3, 1, 2, 3, 1, 2];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData = 0;
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons[i].userData++;
                    CCActionManager.Instance().RemoveAllActionsFromTarget(buttons[i]);
                    CCActionManager.Instance().AddAction(new CCRotateTo(0.1, buttons[i].userData * 90), buttons[i]);
                    _this.CheckClear(buttons, answer);
                }));
            };
            fun(i);
        }
    };
    Level49.prototype.CheckClear = function (buttons, answer) {
        var _this = this;
        for (var i = 0; i < buttons.length; i++) {
            if ((buttons[i].userData % 4) != answer[i])
                return;
        }
        this.m_pGameWorld.SetBlockMouse(true);
        new dTimer(this).Create(100, 1, function () {
            _this.m_pGameWorld.ShowClear();
        });
    };
    return Level49;
}(LevelBase));
var Level5 = (function (_super) {
    __extends(Level5, _super);
    function Level5() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level5.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 854, "resourceFileName": "level/51.png", "width": 1028, "x": 0, "y": -246 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.653179, "className": "Img", "classType": "dImage", "height": 115, "resourceFileName": "level/53.png", "width": 78, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown1", "classType": "dImage", "height": 199, "resourceFileName": "level/52.png", "width": 200, "x": -424, "y": 449 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.653179, "className": "Img", "classType": "dImage", "height": 115, "resourceFileName": "level/53.png", "width": 78, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown2", "classType": "dImage", "height": 199, "resourceFileName": "level/52.png", "width": 200, "x": -212, "y": 449 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.653179, "className": "Img", "classType": "dImage", "height": 115, "resourceFileName": "level/53.png", "width": 78, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown3", "classType": "dImage", "height": 199, "resourceFileName": "level/52.png", "width": 200, "x": 0, "y": 449 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.653179, "className": "Img", "classType": "dImage", "height": 115, "resourceFileName": "level/53.png", "width": 78, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown4", "classType": "dImage", "height": 199, "resourceFileName": "level/52.png", "width": 200, "x": 212, "y": 449 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.653179, "className": "Img", "classType": "dImage", "height": 115, "resourceFileName": "level/53.png", "width": 78, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown5", "classType": "dImage", "height": 199, "resourceFileName": "level/52.png", "width": 200, "x": 424, "y": 449 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level5.prototype.GetHintImageName = function () {
        return "level/54.png";
    };
    Level5.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var imgs = [this.CanTouchDown1, this.CanTouchDown2, this.CanTouchDown3, this.CanTouchDown4, this.CanTouchDown5];
        for (var i = 0; i < imgs.length; i++) {
            var fun = function (i) {
                imgs[i].userData["rot"] = 0;
                imgs[i].userData["CanTouchDown"].touchDownScaleMode = false;
                imgs[i].userData["CanTouchDown"].onTouchDown = function (canTouchDown) {
                    dSound.PlaySound("data/sound/button.mp3");
                    imgs[i].userData["rot"]++;
                    CCActionManager.Instance().AddAction(new CCRotateTo(0.1, imgs[i].userData["rot"] * 90), imgs[i]);
                    _this.CheckClear(imgs);
                };
            };
            fun(i);
        }
    };
    Level5.prototype.CheckClear = function (imgs) {
        var _this = this;
        if (imgs[0].userData["rot"] % 4 == 3 &&
            imgs[1].userData["rot"] % 4 == 0 &&
            imgs[2].userData["rot"] % 4 == 1 &&
            imgs[3].userData["rot"] % 4 == 0 &&
            imgs[4].userData["rot"] % 4 == 2) {
            this.m_pGameWorld.SetBlockMouse(true);
            new dTimer(this).Create(100, 1, function () {
                _this.m_pGameWorld.ShowClear();
            });
        }
    };
    return Level5;
}(LevelBase));
var Level50 = (function (_super) {
    __extends(Level50, _super);
    function Level50() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 4;
        _this.m_heightCount = 9;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level50.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "BlockLayer", "classType": "dSprite", "height": 50, "width": 50, "x": -274, "y": -272 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 128, "resourceFileName": "level/473.png", "width": 675, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "height": 128, "resourceFileName": "", "width": 675, "x": 0, "y": 401 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage4", "classType": "dImage", "height": 537, "resourceFileName": "level/504.png", "width": 689, "x": -87, "y": -184 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanRotation3", "classType": "dImage", "height": 937, "resourceFileName": "level/503.png", "width": 939, "x": -1, "y": -241 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanRotation2", "classType": "dImage", "height": 600, "resourceFileName": "level/502.png", "width": 603, "x": -1, "y": -241 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanRotation1", "classType": "dImage", "height": 284, "resourceFileName": "level/501.png", "width": 289, "x": -1, "y": -241 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level50.prototype.GetHintImageName = function () {
        return "level/506.png";
    };
    Level50.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.CanRotation1.userData["CanRotation"].onDrag =
            this.CanRotation2.userData["CanRotation"].onDrag =
                this.CanRotation3.userData["CanRotation"].onDrag = function () {
                    _this.PlayFrictionSound();
                };
        this.GameLayer_dImage2.SetTransparentMouse(true);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new TextBlock50();
                    pBlock.SetPos(i * TextBlock50.BlockWidthWithSpace, j * TextBlock50.BlockHeightWithSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.GameLayer_BlockLayer.AddChild(pBlock);
                    var pTouchEvent = new dSprite();
                    pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                        _this.OnMove(pBlock, offx, offy);
                    };
                    pTouchEvent.OnTouchUp = function (x, y) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.OnUp(pBlock);
                    };
                    pBlock.SetTouchEvent(pTouchEvent);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        var a1 = ["", "", "", "", "", "", "", "", ""];
        for (var i = 0; i < this.m_heightCount; i++) {
            this.m_vecBlocks[i][0].SetText(a1[i]);
            this.m_vecBlocks[i][1].SetText(a1[i]);
            this.m_vecBlocks[i][2].SetText(a1[i]);
            this.m_vecBlocks[i][3].SetText(a1[i]);
        }
        this.GameLayer.clipChild = true;
    };
    Level50.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var canHor = false;
        var canVer = true;
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * TextBlock50.BlockWidthWithSpace) % (this.m_widthCount * TextBlock50.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * TextBlock50.BlockHeightWithSpace) % (this.m_heightCount * TextBlock50.BlockHeightWithSpace);
            }
        }
        this.PlayFrictionSound();
    };
    Level50.prototype.GetText = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetText();
    };
    Level50.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + TextBlock50.BlockWidthWithSpace / 2) / TextBlock50.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + TextBlock50.BlockHeightWithSpace / 2) / TextBlock50.BlockHeightWithSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * TextBlock50.BlockWidthWithSpace, blockY * TextBlock50.BlockHeightWithSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetText(0, 2) == "" && this.GetText(1, 2) == "" && this.GetText(2, 2) == "" && this.GetText(3, 2) == "")
            this.m_pGameWorld.ShowClear();
    };
    return Level50;
}(LevelBase));
var TextBlock50 = (function (_super) {
    __extends(TextBlock50, _super);
    function TextBlock50() {
        var _this = _super.call(this) || this;
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.Text = new dBitmapFont();
        _this.SetAnchor(0, 0);
        var p = new dSprite();
        p.SetSize(TextBlock50.BlockWidthWithSpace, TextBlock50.BlockHeightWithSpace);
        p.SetPos(-(TextBlock50.BlockWidthWithSpace - _this.width) / 2, -(TextBlock50.BlockHeightWithSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.Text.positionY = -10;
        _this.Text.fontSize = 80;
        _this.Text.spriteColor = 0xffffffff;
        _this.Text.LoadFromFile("data/zi.json");
        _this.AddChild(_this.Text);
        return _this;
    }
    TextBlock50.prototype.SetText = function (str) {
        this.Text.text = str;
    };
    TextBlock50.prototype.GetText = function () {
        return this.Text.text;
    };
    TextBlock50.BlockWidth = 126;
    TextBlock50.BlockHeight = 126;
    TextBlock50.BlockWidthWithSpace = 183;
    TextBlock50.BlockHeightWithSpace = 136;
    return TextBlock50;
}(dSprite));
var Level51 = (function (_super) {
    __extends(Level51, _super);
    function Level51() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 6;
        _this.m_heightCount = 9;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level51.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 783, "resourceFileName": "level/512.png", "width": 962, "x": 0, "y": -303 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "BlockLayer", "classType": "dSprite", "height": 50, "width": 50, "x": -380, "y": -272 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 128, "resourceFileName": "level/513.png", "width": 891, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "height": 128, "resourceFileName": "", "width": 891, "x": 0, "y": 401 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 582, "resourceFileName": "level/511.png", "width": 675, "x": 28, "y": -37 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level51.prototype.GetHintImageName = function () {
        return "level/514.png";
    };
    Level51.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.GameLayer_dImage2.SetTransparentMouse(true);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new TextBlock51();
                    pBlock.SetPos(i * TextBlock51.BlockWidthWithSpace, j * TextBlock51.BlockHeightWithSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.GameLayer_BlockLayer.AddChild(pBlock);
                    var pTouchEvent = new dSprite();
                    pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                        _this.OnMove(pBlock, offx, offy);
                    };
                    pTouchEvent.OnTouchUp = function (x, y) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.OnUp(pBlock);
                    };
                    pBlock.SetTouchEvent(pTouchEvent);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        var a1 = ["", "", "", "", "", "", "", "", ""];
        for (var i = 0; i < this.m_heightCount; i++) {
            this.m_vecBlocks[i][0].SetText(a1[i]);
            this.m_vecBlocks[i][1].SetText(a1[i]);
            this.m_vecBlocks[i][2].SetText(a1[i]);
            this.m_vecBlocks[i][3].SetText(a1[i]);
            this.m_vecBlocks[i][4].SetText(a1[i]);
            this.m_vecBlocks[i][5].SetText(a1[i]);
        }
        this.GameLayer.clipChild = true;
    };
    Level51.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var canHor = false;
        var canVer = true;
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * TextBlock51.BlockWidthWithSpace) % (this.m_widthCount * TextBlock51.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * TextBlock51.BlockHeightWithSpace) % (this.m_heightCount * TextBlock51.BlockHeightWithSpace);
            }
        }
        this.PlayFrictionSound();
    };
    Level51.prototype.GetText = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetText();
    };
    Level51.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + TextBlock51.BlockWidthWithSpace / 2) / TextBlock51.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + TextBlock51.BlockHeightWithSpace / 2) / TextBlock51.BlockHeightWithSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * TextBlock51.BlockWidthWithSpace, blockY * TextBlock51.BlockHeightWithSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetText(0, 2) == "" && this.GetText(1, 2) == "" && this.GetText(2, 2) == "" && this.GetText(3, 2) == "" &&
            this.GetText(4, 2) == "" && this.GetText(5, 2) == "")
            this.m_pGameWorld.ShowClear();
    };
    return Level51;
}(LevelBase));
var TextBlock51 = (function (_super) {
    __extends(TextBlock51, _super);
    function TextBlock51() {
        var _this = _super.call(this) || this;
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.Text = new dBitmapFont();
        _this.SetAnchor(0, 0);
        var p = new dSprite();
        p.SetSize(TextBlock51.BlockWidthWithSpace, TextBlock51.BlockHeightWithSpace);
        p.SetPos(-(TextBlock51.BlockWidthWithSpace - _this.width) / 2, -(TextBlock51.BlockHeightWithSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.Text.positionY = -10;
        _this.Text.fontSize = 80;
        _this.Text.spriteColor = 0xffffffff;
        _this.Text.LoadFromFile("data/zi.json");
        _this.AddChild(_this.Text);
        return _this;
    }
    TextBlock51.prototype.SetText = function (str) {
        this.Text.text = str;
    };
    TextBlock51.prototype.GetText = function () {
        return this.Text.text;
    };
    TextBlock51.BlockWidth = 126;
    TextBlock51.BlockHeight = 126;
    TextBlock51.BlockWidthWithSpace = 153;
    TextBlock51.BlockHeightWithSpace = 136;
    return TextBlock51;
}(dSprite));
var Level52 = (function (_super) {
    __extends(Level52, _super);
    function Level52() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level52.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529h.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown1", "classType": "dImage", "height": 164, "resourceFileName": "level/521.png", "width": 164, "x": -240, "y": -408 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529i.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown2", "classType": "dImage", "height": 164, "resourceFileName": "level/522.png", "width": 164, "x": -80, "y": -408 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529j.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown3", "classType": "dImage", "height": 164, "resourceFileName": "level/523.png", "width": 164, "x": 80, "y": -408 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529k.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown4", "classType": "dImage", "height": 164, "resourceFileName": "level/524.png", "width": 164, "x": 240, "y": -408 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529l.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown5", "classType": "dImage", "height": 164, "resourceFileName": "level/525.png", "width": 164, "x": -240, "y": -248 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529m.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown6", "classType": "dImage", "height": 164, "resourceFileName": "level/526.png", "width": 164, "x": -80, "y": -248 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529n.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown7", "classType": "dImage", "height": 164, "resourceFileName": "level/527.png", "width": 164, "x": 80, "y": -248 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529o.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown8", "classType": "dImage", "height": 164, "resourceFileName": "level/528.png", "width": 164, "x": 240, "y": -247 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529p.png", "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown9", "classType": "dImage", "height": 164, "resourceFileName": "level/529.png", "width": 164, "x": -240, "y": -88 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529q.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown10", "classType": "dImage", "height": 164, "resourceFileName": "level/529a.png", "width": 164, "x": -80, "y": -88 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529r.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown11", "classType": "dImage", "height": 164, "resourceFileName": "level/529b.png", "width": 164, "x": 80, "y": -88 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529s.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown12", "classType": "dImage", "height": 164, "resourceFileName": "level/529c.png", "width": 164, "x": 240, "y": -88 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529t.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown13", "classType": "dImage", "height": 164, "resourceFileName": "level/529d.png", "width": 164, "x": -240, "y": 72 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529u.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown14", "classType": "dImage", "height": 164, "resourceFileName": "level/529e.png", "width": 164, "x": -80, "y": 72 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529v.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown15", "classType": "dImage", "height": 164, "resourceFileName": "level/529f.png", "width": 164, "x": 80, "y": 72 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 164, "resourceFileName": "level/529w.png", "visible": 0, "width": 164, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown16", "classType": "dImage", "height": 164, "resourceFileName": "level/529g.png", "width": 164, "x": 240, "y": 72 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level52.prototype.GetHintImageName = function () {
        return "level/529x.png";
    };
    Level52.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var imgs = [this.CanTouchDown1, this.CanTouchDown2, this.CanTouchDown3, this.CanTouchDown4,
            this.CanTouchDown5, this.CanTouchDown6, this.CanTouchDown7, this.CanTouchDown8,
            this.CanTouchDown9, this.CanTouchDown10, this.CanTouchDown11, this.CanTouchDown12,
            this.CanTouchDown13, this.CanTouchDown14, this.CanTouchDown15, this.CanTouchDown16];
        var swaped = [0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1];
        for (var i = 0; i < imgs.length; i++) {
            this.SetSwap(imgs[i], swaped[i]);
            var fun = function (i) {
                imgs[i].userData["CanTouchDown"].touchDownScaleMode = false;
                imgs[i].userData["CanTouchDown"].onTouchDown = function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    CCActionManager.Instance().RemoveAllActionsFromTarget(imgs[i]);
                    CCActionManager.Instance().AddAction(new CCSequence([
                        new CCScaleTo(0.1, 0, 1),
                        new CCCallFunc(function () {
                            imgs[i].userData["Num"] = imgs[i].userData["Num"] ? 0 : 1;
                            _this.SetSwap(imgs[i], imgs[i].userData["Num"]);
                            _this.CheckClear(imgs);
                        }),
                        new CCScaleTo(0.1, 1, 1)
                    ]), imgs[i]);
                };
            };
            fun(i);
        }
    };
    Level52.prototype.SetSwap = function (p, isSwap) {
        p.userData["Num"] = isSwap;
        if (isSwap) {
            p.spriteColor = 0;
            p.FindChild("dImage1").visible = true;
        }
        else {
            p.spriteColor = 0xffffffff;
            p.FindChild("dImage1").visible = false;
        }
    };
    Level52.prototype.CheckClear = function (imgs) {
        for (var i = 0; i < imgs.length; i++)
            if (imgs[i].userData["Num"] != 1)
                return;
        this.m_pGameWorld.ShowClear();
    };
    return Level52;
}(LevelBase));
var Level53 = (function (_super) {
    __extends(Level53, _super);
    function Level53() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level53.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 701, "resourceFileName": "level/531.png", "width": 794, "x": 0, "y": -228 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 182, "resourceFileName": "level/532.png", "width": 182, "x": -186, "y": -102, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 182, "resourceFileName": "level/532.png", "width": 182, "x": -196, "y": -526, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 182, "resourceFileName": "level/532.png", "width": 182, "x": 177, "y": -91, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 182, "resourceFileName": "level/532.png", "width": 182, "x": 199, "y": -524, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 98, "resourceFileName": "level/535.png", "width": 96, "x": 74.002808, "y": 427, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 104, "resourceFileName": "level/536.png", "width": 106, "x": 249.002808, "y": 427, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 61, "resourceFileName": "level/533.png", "width": 74, "x": -275.997192, "y": 427, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 102, "resourceFileName": "level/534.png", "width": 104, "x": -100.997192, "y": 427, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level53.prototype.GetHintImageName = function () {
        return "level/537.png";
    };
    Level53.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level53.prototype.CheckClear = function (p) {
        var answer = "0123456789";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level53.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level53.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level53;
}(LevelBase));
var Level54 = (function (_super) {
    __extends(Level54, _super);
    function Level54() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level54.prototype._dscData = function () { return { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "Back", "classType": "dImage", "height": 848, "resourceFileName": "level/546.png", "width": 708, "x": -354, "y": -496 }, { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "CanDrag1", "classType": "dImage", "height": 420, "resourceFileName": "level/541.png", "width": 280, "x": 557, "y": 357, "z": -3.376804 }, { "anchorU": 0, "anchorV": 0, "className": "CanDrag2", "classType": "dImage", "height": 280, "resourceFileName": "level/542.png", "width": 420, "x": -136, "y": -277 }, { "anchorU": 0, "anchorV": 0, "className": "CanDrag3", "classType": "dImage", "height": 420, "resourceFileName": "level/543.png", "width": 280, "x": -141, "y": 752 }, { "anchorU": 0, "anchorV": 0, "className": "CanDrag4", "classType": "dImage", "height": 280, "resourceFileName": "level/544.png", "width": 280, "x": 510, "y": -233 }, { "anchorU": 0, "anchorV": 0, "className": "CanDrag5", "classType": "dImage", "height": 280, "resourceFileName": "level/545.png", "width": 420, "x": 385, "y": 790 }], "anchorU": 0, "anchorV": 0, "className": "GameLayer", "classType": "dImage", "height": 848, "resourceFileName": "", "width": 708, "x": -350, "y": -492 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level54.prototype.GetHintImageName = function () {
        return "level/547.png";
    };
    Level54.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var imgs = [this.GameLayer_CanDrag1, this.GameLayer_CanDrag2, this.GameLayer_CanDrag3, this.GameLayer_CanDrag4, this.GameLayer_CanDrag5];
        for (var i = 0; i < imgs.length; i++) {
            imgs[i].userData["blockX"] = 0;
            imgs[i].userData["blockY"] = 0;
            var fun = function (i) {
                imgs[i].userData["CanDrag"].onTouchDown = function () {
                    imgs[i].GetParent().AddChild(imgs[i]);
                };
                imgs[i].userData["CanDrag"].onTouchUp = function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    var blockX = dMath.Floor((imgs[i].positionX + 70) / 140);
                    var blockY = dMath.Floor((imgs[i].positionY + 70) / 140);
                    imgs[i].SetPos(blockX * 140, blockY * 140);
                    imgs[i].userData["blockX"] = blockX;
                    imgs[i].userData["blockY"] = blockY;
                    _this.CheckClear(imgs);
                };
            };
            fun(i);
        }
    };
    Level54.prototype.CheckClear = function (img) {
        var str = "";
        for (var i = 0; i < img.length; i++) {
            str += img[i].userData["blockX"];
            str += img[i].userData["blockY"];
        }
        if (str == "2022032401")
            this.m_pGameWorld.ShowClear();
    };
    return Level54;
}(LevelBase));
var Level55 = (function (_super) {
    __extends(Level55, _super);
    function Level55() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level55.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 851, "resourceFileName": "level/551.png", "width": 972, "x": 0, "y": -284 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 145, "resourceFileName": "level/552.png", "width": 145, "x": -409, "y": 210, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 145, "resourceFileName": "level/552.png", "width": 145, "x": -244, "y": 212, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 145, "resourceFileName": "level/552.png", "width": 145, "x": -82, "y": 219, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 145, "resourceFileName": "level/552.png", "width": 145, "x": 82, "y": 211, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 145, "resourceFileName": "level/552.png", "width": 145, "x": 251, "y": 210, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block6", "classType": "dImage", "height": 145, "resourceFileName": "level/552.png", "width": 145, "x": 423, "y": 214, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 84, "resourceFileName": "level/553.png", "width": 64, "x": 213.002808, "y": 441, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 68, "resourceFileName": "level/554.png", "width": 93, "x": -3.997192, "y": 448, "z": 3.224541 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 78, "resourceFileName": "level/555.png", "width": 86, "x": -364.997192, "y": 365, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 83, "resourceFileName": "level/556.png", "width": 87, "x": -238.997192, "y": 444, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 87, "resourceFileName": "level/557.png", "width": 88, "x": 115.002808, "y": 378, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 79, "resourceFileName": "level/558.png", "width": 65, "x": -115.997192, "y": 371, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragA1", "classType": "dImage", "height": 210, "resourceFileName": "level/559.png", "width": 210, "x": -400, "y": 636 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragA2", "classType": "dImage", "height": 210, "resourceFileName": "level/559a.png", "width": 210, "x": -150, "y": 638 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDragA3", "classType": "dImage", "height": 210, "resourceFileName": "level/559b.png", "width": 210, "x": 107, "y": 638 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level55.prototype.GetHintImageName = function () {
        return "level/559c.png";
    };
    Level55.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5, this.CanDrag6];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5, this.Block6];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level55.prototype.CheckClear = function (p) {
        var answer = "0123456789";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level55.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level55.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level55;
}(LevelBase));
var Level56 = (function (_super) {
    __extends(Level56, _super);
    function Level56() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level56.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 219, "resourceFileName": "level/562.png", "width": 147, "x": 0, "y": -638 }, { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 66.559998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -161 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 427, "resourceFileName": "level/561.png", "width": 145, "x": -364, "y": 30 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 71.040001, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -161 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 427, "resourceFileName": "level/561.png", "width": 145, "x": -182, "y": 30 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 63.359997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -161 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 427, "resourceFileName": "level/561.png", "width": 145, "x": 0, "y": 30 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 66.559998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -161 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 427, "resourceFileName": "level/561.png", "width": 145, "x": 182, "y": 30 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 64, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -161 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 427, "resourceFileName": "level/561.png", "width": 145, "x": 364, "y": 30 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dSprite", "clipChild": 1, "height": 500, "width": 908, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 105, "resourceFileName": "level/563.png", "width": 908, "x": 0, "y": 268 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level56.prototype.GetHintImageName = function () {
        return "level/564.png";
    };
    Level56.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.GameLayer_CanDrag1, this.GameLayer_CanDrag2, this.GameLayer_CanDrag3, this.GameLayer_CanDrag4, this.GameLayer_CanDrag5];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData["CanDrag"].canDragH = false;
                buttons[i].userData["CanDrag"].dragLimitLengthV = new dVector2(0, 282);
                var startPos = buttons[i].GetPosVector2();
                buttons[i].userData["Num"] = 6;
                buttons[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    dSound.PlaySound("data/sound/button.mp3");
                    var y = canDrag.GetDragOffset().y;
                    y += 47 / 2;
                    y = dMath.Floor(y / 47);
                    buttons[i].userData["Num"] = 6 - y;
                    y *= 47;
                    buttons[i].positionY = y + startPos.y;
                    _this.CheckClear(buttons);
                };
            };
            fun(i);
        }
    };
    Level56.prototype.CheckClear = function (buttons) {
        var str = "";
        for (var i = 0; i < buttons.length; i++)
            str += buttons[i].userData["Num"];
        if (str == "35241")
            this.m_pGameWorld.ShowClear();
    };
    return Level56;
}(LevelBase));
var Level57 = (function (_super) {
    __extends(Level57, _super);
    function Level57() {
        var _this = _super.call(this) || this;
        _this.m_vecInputs = new Array();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level57.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Box", "classType": "dImage", "height": 143, "resourceFileName": "level/573.png", "width": 1018, "x": 0, "y": -240 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Light", "classType": "dAnimationImage", "height": 226, "resourceFileName": "level/572.png|level/571.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 156, "x": 0, "y": -641 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 95, "resourceFileName": "level/574.png", "width": 67, "x": -363, "y": 83 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 97, "resourceFileName": "level/575.png", "width": 89, "x": -222, "y": 85 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 95, "resourceFileName": "level/574.png", "width": 67, "x": -219, "y": 242 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 97, "resourceFileName": "level/575.png", "width": 89, "x": -78, "y": 244 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 95, "resourceFileName": "level/574.png", "width": 67, "x": 39, "y": 83 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 97, "resourceFileName": "level/575.png", "width": 89, "x": 180, "y": 85 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag7", "classType": "dImage", "height": 95, "resourceFileName": "level/574.png", "width": 67, "x": 183, "y": 242 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag8", "classType": "dImage", "height": 97, "resourceFileName": "level/575.png", "width": 89, "x": 324, "y": 244 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level57.prototype.GetHintImageName = function () {
        return "level/576.png";
    };
    Level57.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.CanDrag1, this.CanDrag2, this.CanDrag3, this.CanDrag4, this.CanDrag5, this.CanDrag6, this.CanDrag7, this.CanDrag8];
        var answer = [0, 1, 0, 0, 1, 1, 0, 1];
        this.CanDrag1.userData["Num"] = 0;
        this.CanDrag2.userData["Num"] = 1;
        this.CanDrag3.userData["Num"] = 0;
        this.CanDrag4.userData["Num"] = 1;
        this.CanDrag5.userData["Num"] = 0;
        this.CanDrag6.userData["Num"] = 1;
        this.CanDrag7.userData["Num"] = 0;
        this.CanDrag8.userData["Num"] = 1;
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData["CanDrag"].onDrag = function () {
                    if (_this.m_vecInputs.indexOf(buttons[i]) != -1) {
                        _this.m_vecInputs.remove(buttons[i]);
                        _this.UpdateInput();
                    }
                };
                buttons[i].userData["CanDrag"].onTouchUp = function () {
                    if (_this.isCollectSprite(buttons[i], _this.Box)) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_vecInputs.push(buttons[i]);
                        _this.UpdateInput();
                        _this.CheckClear(answer);
                    }
                };
            };
            fun(i);
        }
        var delayList = new Array();
        delayList.push(-1);
        for (var i = 0; i < answer.length; i++)
            delayList.push(answer[i]);
        new dTimer(this).Create(2000, 1, function () {
            _this.PlayLight(delayList);
        });
    };
    Level57.prototype.UpdateInput = function () {
        for (var i = 0; i < this.m_vecInputs.length; i++) {
            this.m_vecInputs[i].SetPos(this.Box.positionX + i * 100 + 150 - this.Box.width * this.Box.anchorU, this.Box.positionY);
        }
    };
    Level57.prototype.PlayLight = function (delayList) {
        var _this = this;
        var delayList2 = new Array();
        delayList2.copy(delayList);
        var fun = function () {
            delayList2.erase(0);
            if (delayList2.length == 0)
                delayList2.copy(delayList);
            _this.PlayLight2(delayList2[0], fun);
        };
        fun();
    };
    Level57.prototype.PlayLight2 = function (type, onComplete) {
        if (type == -1) {
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCDelayTime(2),
                new CCCallFunc(onComplete)
            ]), this.Light);
        }
        else if (type == 0) {
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCFrameTo(1),
                new CCDelayTime(0.3),
                new CCFrameTo(0),
                new CCDelayTime(0.5),
                new CCCallFunc(onComplete)
            ]), this.Light);
        }
        else if (type == 1) {
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCFrameTo(1),
                new CCDelayTime(1.5),
                new CCFrameTo(0),
                new CCDelayTime(0.5),
                new CCCallFunc(onComplete)
            ]), this.Light);
        }
    };
    Level57.prototype.CheckClear = function (answer) {
        if (this.m_vecInputs.length != answer.length)
            return;
        for (var i = 0; i < this.m_vecInputs.length; i++)
            if (this.m_vecInputs[i].userData["Num"] != answer[i])
                return;
        this.m_pGameWorld.ShowClear();
    };
    return Level57;
}(LevelBase));
var Level58 = (function (_super) {
    __extends(Level58, _super);
    function Level58() {
        var _this = _super.call(this) || this;
        _this.m_line = new dLine();
        _this.m_moving = false;
        _this.m_vecSnake = new Array();
        _this.m_imgs = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level58.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "LineLayer", "classType": "dSprite", "height": 1600, "width": 1080, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 69.760002, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img1", "classType": "dImage", "height": 124, "resourceFileName": "level/581.png", "width": 124, "x": -347, "y": 320 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 71.040001, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img2", "classType": "dImage", "height": 124, "resourceFileName": "level/581.png", "width": 124, "x": 19, "y": -152 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 69.119995, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img3", "classType": "dImage", "height": 124, "resourceFileName": "level/581.png", "width": 124, "x": -119, "y": 545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 71.040001, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img4", "classType": "dImage", "height": 124, "resourceFileName": "level/581.png", "width": 124, "x": -319, "y": -268 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 67.839996, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img5", "classType": "dImage", "height": 124, "resourceFileName": "level/581.png", "width": 124, "x": 361, "y": 502 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 66.559998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img6", "classType": "dImage", "height": 124, "resourceFileName": "level/581.png", "width": 124, "x": 166, "y": -391 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 68.479996, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img7", "classType": "dImage", "height": 124, "resourceFileName": "level/581.png", "width": 124, "x": 174, "y": 279 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 64, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img8", "classType": "dImage", "height": 124, "resourceFileName": "level/581.png", "width": 124, "x": -126, "y": -545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 63.359997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img9", "classType": "dImage", "height": 124, "resourceFileName": "level/581.png", "width": 124, "x": -71, "y": 111 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 72.32, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img10", "classType": "dImage", "height": 124, "resourceFileName": "level/581.png", "width": 124, "x": 379, "y": -315 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "ClearButton", "classType": "dButton", "height": 107, "resourceFileName": "level/582.png", "width": 171, "x": 391, "y": -679 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level58.prototype.GetHintImageName = function () {
        return "level/583.png";
    };
    Level58.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_imgs = [this.Img2, this.Img3, this.Img4, this.Img5, this.Img6, this.Img7, this.Img8, this.Img9, this.Img10];
        this.m_line.lineWidth = 10;
        this.LineLayer.AddChild(this.m_line);
        this.SetHandleMouse(true);
        this.ClearButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_pGameWorld.Restart();
        }));
        new dTimer(this).Create(0, 0, function () {
            _this.LineLayer.SetSize(_this.m_pGameWorld.width, _this.m_pGameWorld.height);
        });
    };
    Level58.prototype.OnTouchDown = function (x, y, delta) {
        if (this.m_moving)
            return;
        this.m_line.Clear();
        this.m_line.MoveTo(this.Img1.positionX, this.Img1.positionY);
    };
    Level58.prototype.OnTouchMove = function (x, y, offx, offy, delta) {
        if (this.m_moving)
            return;
        if (this.m_line.hasMoveTo())
            this.m_line.LineTo(x, y);
    };
    Level58.prototype.OnTouchUp = function (x, y) {
        if (this.m_moving)
            return;
        this.m_vecSnake.push(this.Img1);
        this.PlayMove();
        this.m_moving = true;
    };
    Level58.prototype.PlayMove = function () {
        var _this = this;
        var lineList = this.m_line.GetLineList();
        var pointList = new Array();
        var pathLength = new Array();
        var lengthTotal = 0;
        for (var i = 0; i < this.m_line.GetLineCount(); i++) {
            pointList.push(lineList[i].GetPosVector2());
            if (i == 0)
                pathLength.push(0);
            else {
                var len = pointList[i].LengthTo(pointList[i - 1]);
                lengthTotal += len;
                pathLength.push(len);
            }
        }
        if (pointList.length < 2)
            return;
        var time = 0;
        var clearChecked = false;
        new dTimer(this).Create(0, 0, function (sender, iTimer, fTimer) {
            for (var i = 0; i < _this.m_imgs.length; i++) {
                if (_this.isCollectCircleCircle(_this.Img1, _this.m_imgs[i])) {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_vecSnake.push(_this.m_imgs[i]);
                    _this.m_imgs.erase(i);
                    i--;
                }
            }
            time += fTimer * 500;
            if (time > lengthTotal) {
                time = lengthTotal;
                if (!clearChecked) {
                    clearChecked = true;
                    _this.CheckClear();
                }
            }
            for (var i = 0; i < _this.m_vecSnake.length; i++)
                _this.SetToLength(pointList, pathLength, _this.m_vecSnake[i], time - i * 124);
        });
    };
    Level58.prototype.SetToLength = function (pointList, pathLength, p, length) {
        var i = 1;
        for (i = 1; i < pathLength.length; i++) {
            if (length > pathLength[i])
                length -= pathLength[i];
            else
                break;
        }
        if (i > pathLength.length - 1) {
            i = pathLength.length - 1;
            length = pathLength.last();
        }
        var p1 = pointList[i];
        var p2 = pointList[i - 1];
        var dir = p1.Sub(p2);
        dir.Normalize();
        p.SetPos(p2.x + dir.x * length, p2.y + dir.y * length);
    };
    Level58.prototype.CheckClear = function () {
        if (this.m_vecSnake.length != 10)
            return;
        var imgs = [this.Img1, this.Img2, this.Img3, this.Img4, this.Img5,
            this.Img6, this.Img7, this.Img8, this.Img9, this.Img10];
        for (var i = 0; i < this.m_vecSnake.length; i++)
            if (this.m_vecSnake[i] != imgs[i])
                return;
        this.m_pGameWorld.ShowClear();
    };
    return Level58;
}(LevelBase));
var Level59 = (function (_super) {
    __extends(Level59, _super);
    function Level59() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level59.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 87, "resourceFileName": "level/595.png", "width": 92, "x": 203.74353, "y": -16.999451, "z": 1.987023 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 82, "resourceFileName": "level/596.png", "width": 80, "x": 70.74353, "y": -16.999451, "z": 1.68882 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 83, "resourceFileName": "level/597.png", "width": 92, "x": -328.25647, "y": -16.999451, "z": 1.987023 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage4", "classType": "dImage", "height": 76, "resourceFileName": "level/598.png", "width": 88, "x": -62.25647, "y": -16.999451, "z": 1.987023 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage5", "classType": "dImage", "height": 87, "resourceFileName": "level/599.png", "width": 85, "x": -195.25647, "y": -16.999451, "z": 1.987023 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage6", "classType": "dImage", "height": 74, "resourceFileName": "level/599a.png", "width": 78, "x": 336.74353, "y": -16.999451, "z": 2.583439 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dImage", "height": 740, "resourceFileName": "level/593.png", "width": 888, "x": 0, "y": 10 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 138, "resourceFileName": "level/594.png", "width": 343, "x": -309, "y": 505 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 102, "resourceFileName": "level/591.png", "width": 54, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 137, "resourceFileName": "level/592.png", "width": 137, "x": -384, "y": -562 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 102, "resourceFileName": "level/591.png", "width": 54, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 137, "resourceFileName": "level/592.png", "width": 137, "x": -231, "y": -562 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 102, "resourceFileName": "level/591.png", "width": 54, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 137, "resourceFileName": "level/592.png", "width": 137, "x": -78, "y": -562 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 102, "resourceFileName": "level/591.png", "width": 54, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "height": 137, "resourceFileName": "level/592.png", "width": 137, "x": 75, "y": -562 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 102, "resourceFileName": "level/591.png", "width": 54, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button5", "classType": "dButton", "height": 137, "resourceFileName": "level/592.png", "width": 137, "x": 228, "y": -562 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 102, "resourceFileName": "level/591.png", "width": 54, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button6", "classType": "dButton", "height": 137, "resourceFileName": "level/592.png", "width": 137, "x": 381, "y": -562 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level59.prototype.GetHintImageName = function () {
        return "level/599b.png";
    };
    Level59.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var imgs = [this.Back_dImage1, this.Back_dImage2, this.Back_dImage3, this.Back_dImage4, this.Back_dImage5, this.Back_dImage6];
        var loc = 0;
        for (var i = 0; i < imgs.length; i++)
            imgs[i].alpha = 0;
        CCActionManager.Instance().AddAction(new CCRepeatForever(new CCSequence([
            new CCCustom(0.5, function (value) {
                imgs[loc].alpha = value;
            }),
            new CCCustom(0.5, function (value) {
                imgs[loc].alpha = 1 - value;
            }),
            new CCDelayTime(0.5),
            new CCCallFunc(function () {
                loc++;
                loc %= imgs.length;
            })
        ])), this);
        var buttons = [this.Button1, this.Button2, this.Button3, this.Button4, this.Button5, this.Button6];
        var answer = [1, 0, 1, 0, 1, 0];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData = 0;
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons[i].userData = buttons[i].userData ? 0 : 1;
                    CCActionManager.Instance().RemoveAllActionsFromTarget(buttons[i]);
                    CCActionManager.Instance().AddAction(new CCRotateTo(0.1, buttons[i].userData * 90), buttons[i]);
                    _this.CheckClear(buttons, answer);
                }));
            };
            fun(i);
        }
    };
    Level59.prototype.CheckClear = function (button, answer) {
        for (var i = 0; i < button.length; i++)
            if (button[i].userData != answer[i])
                return;
        this.m_pGameWorld.ShowClear();
    };
    return Level59;
}(LevelBase));
var Level6 = (function (_super) {
    __extends(Level6, _super);
    function Level6() {
        var _this = _super.call(this) || this;
        _this.m_timeMax = 10;
        _this.m_curTime = 0;
        _this.m_shooting = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level6.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 73, "resourceFileName": "data/font64.json", "text": "", "width": 256, "x": 0, "y": -721 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 159, "resourceFileName": "level/64.png", "width": 159, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 80, "height": 81.25, "resourceFileName": "data/fontNumber.json", "text": "10", "width": 73.75, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Img1", "classType": "dImage", "height": 196, "resourceFileName": "level/61.png", "width": 366, "x": 0, "y": -357 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Img2", "classType": "dImage", "height": 124, "resourceFileName": "level/62.png", "width": 391, "x": 0, "y": 503 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 74, "resourceFileName": "data/font64.json", "text": "", "width": 128, "x": 0, "y": -16 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ShootButton", "classType": "dButton", "height": 107, "resourceFileName": "data/button2.png", "width": 171, "x": 337, "y": 468 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Arrow", "classType": "dImage", "height": 80, "resourceFileName": "level/63.png", "width": 85, "x": 0, "y": 561 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level6.prototype.GetHintText = function () {
        return "3";
    };
    Level6.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_curTime = this.m_timeMax;
        new dTimer(this).Create(1000, 0, function () {
            if (!_this.m_pGameWorld.isGameClear()) {
                _this.m_curTime--;
                if (_this.m_curTime < 0)
                    _this.m_curTime = _this.m_timeMax;
                _this.UpdateNum();
            }
        });
        this.UpdateNum();
        var startPos = this.Arrow.GetPosVector2();
        this.ShootButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            if (!_this.m_shooting) {
                _this.m_shooting = true;
                dSound.PlaySound("data/sound/button.mp3");
                _this.Arrow.SetPosVector2(startPos);
                CCActionManager.Instance().AddAction(new CCSequence([
                    new CCMoveTo(3, _this.Img1.positionX, _this.Img1.positionY),
                    new CCCallFunc(function () {
                        if (_this.m_curTime == 0)
                            _this.m_pGameWorld.ShowClear();
                        else {
                            _this.m_shooting = false;
                            _this.m_pGameWorld.ShowWrong(null, _this.Img1);
                            _this.Arrow.SetPosVector2(startPos);
                        }
                    })
                ]), _this.Arrow);
            }
        }));
    };
    Level6.prototype.UpdateNum = function () {
        this.Img1_Num.text = String(this.m_curTime);
        if (this.m_curTime == 0) {
            this.Img1_Num.visible = false;
            this.Img1_Img.visible = true;
        }
        else {
            this.Img1_Num.visible = true;
            this.Img1_Img.visible = false;
        }
    };
    return Level6;
}(LevelBase));
var Level60 = (function (_super) {
    __extends(Level60, _super);
    function Level60() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level60.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 653, "resourceFileName": "level/601.png", "width": 912, "x": 0, "y": -433 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -372, "y": -436, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -122, "y": -436, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 128, "y": -436, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 378, "y": -436, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -363, "y": 11, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block6", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -116, "y": 11, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block7", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 131, "y": 11, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block8", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 378, "y": 11, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 107, "resourceFileName": "level/606.png", "width": 110, "x": 309.002808, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 103, "resourceFileName": "level/603.png", "width": 110, "x": -197.997192, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 110, "resourceFileName": "level/605.png", "width": 107, "x": -322.997192, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 108, "resourceFileName": "level/602.png", "width": 99, "x": 184.002808, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 101, "resourceFileName": "level/604.png", "width": 111, "x": -153.997192, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 96, "resourceFileName": "level/607.png", "width": 103, "x": -28.997192, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag7", "classType": "dImage", "height": 107, "resourceFileName": "level/608.png", "width": 107, "x": 15.002808, "y": 520, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag8", "classType": "dImage", "height": 102, "resourceFileName": "level/609.png", "width": 113, "x": 140.002808, "y": 325, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level60.prototype.GetHintImageName = function () {
        return "level/609a.png";
    };
    Level60.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5, this.CanDrag6, this.CanDrag7, this.CanDrag8];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5, this.Block6, this.Block7, this.Block8];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level60.prototype.CheckClear = function (p) {
        var answer = "01234567";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level60.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level60.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level60;
}(LevelBase));
var Level61 = (function (_super) {
    __extends(Level61, _super);
    function Level61() {
        var _this = _super.call(this) || this;
        _this.m_num1 = 5;
        _this.m_num2 = 5;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level61.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 637, "resourceFileName": "level/611.png", "width": 699, "x": 0, "y": -343 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 102, "resourceFileName": "level/612.png", "width": 394, "x": -215, "y": 364 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": 140, "y": 379 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage4", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": 347, "y": 379 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text1", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 144, "y": 364 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text2", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 351, "y": 364 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton1", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 142, "y": 223 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton2", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 345, "y": 223 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton1", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 142, "y": 528 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton2", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 345, "y": 528 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level61.prototype.GetHintImageName = function () {
        return "level/614.png";
    };
    Level61.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.dImage3.SetTransparentMouse(true);
        this.UpdateNumber();
        this.UpButton1.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_num1--;
            if (_this.m_num1 < 0)
                _this.m_num1 = 9;
            _this.UpdateNumber();
            _this.CheckClear();
        }));
        this.DownButton1.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_num1++;
            if (_this.m_num1 > 9)
                _this.m_num1 = 0;
            _this.UpdateNumber();
            _this.CheckClear();
        }));
        this.UpButton2.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_num2--;
            if (_this.m_num2 < 0)
                _this.m_num2 = 9;
            _this.UpdateNumber();
            _this.CheckClear();
        }));
        this.DownButton2.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_num2++;
            if (_this.m_num2 > 9)
                _this.m_num2 = 0;
            _this.UpdateNumber();
            _this.CheckClear();
        }));
    };
    Level61.prototype.UpdateNumber = function () {
        this.Text1.text = this.NumToText(this.m_num1);
        this.Text2.text = this.NumToText(this.m_num2);
    };
    Level61.prototype.NumToText = function (num) {
        switch (num) {
            case 0: return "";
            case 1: return "";
            case 2: return "";
            case 3: return "";
            case 4: return "";
            case 5: return "";
            case 6: return "";
            case 7: return "";
            case 8: return "";
            case 9: return "";
        }
        return "";
    };
    Level61.prototype.CheckClear = function () {
        if (this.m_num1 == 7 && this.m_num2 == 2)
            this.m_pGameWorld.ShowClear();
    };
    return Level61;
}(LevelBase));
var Level62 = (function (_super) {
    __extends(Level62, _super);
    function Level62() {
        var _this = _super.call(this) || this;
        _this.m_vecBlocks = new Array();
        _this.m_curTouchBlock = null;
        _this.m_allRight = false;
        _this.m_nums = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level62.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 708, "resourceFileName": "level/622.png", "width": 708, "x": -67, "y": -18 }, { "anchorU": 0, "anchorV": 0, "className": "GameLayer", "classType": "dSprite", "height": 700, "width": 700, "x": -417, "y": -368 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num1", "classType": "dBitmapFont", "fontSize": 80, "height": 73.599998, "resourceFileName": "data/zi.json", "text": "", "width": 80, "x": 353, "y": -308 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num2", "classType": "dBitmapFont", "fontSize": 80, "height": 73.599998, "resourceFileName": "data/zi.json", "text": "", "width": 80, "x": 353, "y": -167 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num3", "classType": "dBitmapFont", "fontSize": 80, "height": 80, "resourceFileName": "data/zi.json", "text": "", "width": 80, "x": 353, "y": -26 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num4", "classType": "dBitmapFont", "fontSize": 80, "height": 78.400002, "resourceFileName": "data/zi.json", "text": "", "width": 80, "x": 353, "y": 115 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num5", "classType": "dBitmapFont", "fontSize": 80, "height": 73.599998, "resourceFileName": "data/zi.json", "text": "", "width": 80, "x": 353, "y": 256 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num6", "classType": "dBitmapFont", "fontSize": 80, "height": 78.400002, "resourceFileName": "data/zi.json", "text": "", "width": 80, "x": -354, "y": 411 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num7", "classType": "dBitmapFont", "fontSize": 80, "height": 73.599998, "resourceFileName": "data/zi.json", "text": "", "width": 80, "x": -214, "y": 411 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num8", "classType": "dBitmapFont", "fontSize": 80, "height": 79.200005, "resourceFileName": "data/zi.json", "text": "", "width": 80, "x": -74, "y": 411 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num9", "classType": "dBitmapFont", "fontSize": 80, "height": 73.599998, "resourceFileName": "data/zi.json", "text": "", "width": 80, "x": 66, "y": 411 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num10", "classType": "dBitmapFont", "fontSize": 80, "height": 78.400002, "resourceFileName": "data/zi.json", "text": "", "width": 80, "x": 206, "y": 411 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level62.prototype.GetHintImageName = function () {
        return "level/623.png";
    };
    Level62.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_nums = [this.Num1, this.Num2, this.Num3, this.Num4, this.Num5, this.Num6, this.Num7, this.Num8, this.Num9, this.Num10];
        for (var i = 0; i < 14; i++) {
            var block = new GameBlock62();
            var x = dMath.ToInt(i / 5);
            var y = i % 5;
            block.SetBlockPos(x, y, false);
            this.GameLayer.AddChild(block);
            this.m_vecBlocks.push(block);
        }
        this.GameLayer.SetHandleMouse(true);
        var pTouchEvent = new dSprite();
        pTouchEvent.OnTouchDown = function (x, y, delta) {
            var blockX = dMath.ToInt(x / GameBlock62.CELL_SIZE);
            var blockY = dMath.ToInt(y / GameBlock62.CELL_SIZE);
            _this.m_curTouchBlock = _this.FindBlockByBlockPos(blockX, blockY);
        };
        pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
            var blockX = dMath.ToInt(x / GameBlock62.CELL_SIZE);
            var blockY = dMath.ToInt(y / GameBlock62.CELL_SIZE);
            if (_this.m_curTouchBlock && _this.CanMove(blockX, blockY, _this.m_curTouchBlock)) {
                var off = dMath.Abs(_this.m_curTouchBlock.blockX - blockX) + dMath.Abs(_this.m_curTouchBlock.blockY - blockY);
                if (off == 1) {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_curTouchBlock.SetBlockPos(blockX, blockY, true);
                    _this.UpdateNum();
                    _this.CheckClear();
                }
            }
        };
        this.GameLayer.SetTouchEvent(pTouchEvent);
        this.UpdateNum();
    };
    Level62.prototype.CanMove = function (x, y, except) {
        if (this.m_pGameWorld.isGameClear())
            return false;
        if (x >= 0 && y >= 0 && x < 5 && y < 5) {
            var find = this.FindBlockByBlockPos(x, y);
            if (find == null || find == except)
                return true;
        }
        return false;
    };
    Level62.prototype.FindBlockByBlockPos = function (x, y) {
        for (var i = 0; i < this.m_vecBlocks.length; i++)
            if (this.m_vecBlocks[i].blockX == x && this.m_vecBlocks[i].blockY == y)
                return this.m_vecBlocks[i];
        return null;
    };
    Level62.prototype.UpdateNum = function () {
        this.m_allRight = true;
        for (var j = 0; j < 5; j++) {
            var add = 0;
            for (var i = 0; i < 5; i++)
                if (this.FindBlockByBlockPos(i, j))
                    add++;
            var need = this.TextToNum(this.m_nums[j].text);
            if (add != need) {
                this.m_nums[j].spriteColor = 0xffffffff;
                this.m_allRight = false;
            }
            else
                this.m_nums[j].spriteColor = 0xff00ff00;
        }
        for (var i = 0; i < 5; i++) {
            var add = 0;
            for (var j = 0; j < 5; j++)
                if (this.FindBlockByBlockPos(i, j))
                    add++;
            var need = this.TextToNum(this.m_nums[i + 5].text);
            if (add != need) {
                this.m_nums[i + 5].spriteColor = 0xffffffff;
                this.m_allRight = false;
            }
            else
                this.m_nums[i + 5].spriteColor = 0xff00ff00;
        }
    };
    Level62.prototype.CheckClear = function () {
        if (this.m_allRight)
            this.m_pGameWorld.ShowClear();
    };
    Level62.prototype.TextToNum = function (str) {
        switch (str) {
            case "": return 5;
            case "": return 4;
            case "": return 3;
            case "": return 2;
            case "": return 1;
        }
        return 0;
    };
    return Level62;
}(LevelBase));
var GameBlock62 = (function (_super) {
    __extends(GameBlock62, _super);
    function GameBlock62() {
        var _this = _super.call(this) || this;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.LoadFromFile("level/621.png");
        _this.SetSize(GameBlock62.CELL_SIZE, GameBlock62.CELL_SIZE);
        _this.SetAnchor(0, 0);
        return _this;
    }
    GameBlock62.prototype.SetBlockPos = function (x, y, ani) {
        this.blockX = x;
        this.blockY = y;
        var targetX = x * GameBlock62.CELL_SIZE;
        var targetY = y * GameBlock62.CELL_SIZE;
        if (ani)
            CCActionManager.Instance().AddAction(new CCMoveTo(0.05, targetX, targetY), this);
        else
            this.SetPos(targetX, targetY);
    };
    GameBlock62.CELL_SIZE = 140;
    return GameBlock62;
}(dImage));
var Level63 = (function (_super) {
    __extends(Level63, _super);
    function Level63() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level63.prototype._dscData = function () { return { "_child": [{ "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 424.800018, "lineSpace": 20, "resourceFileName": "data/zi.json", "text": "\\n\\n", "width": 120.000008, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown1", "classType": "dImage", "height": 424.800018, "resourceFileName": "", "width": 120.000008, "x": -369, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 422.400024, "lineSpace": 20, "resourceFileName": "data/zi.json", "text": "\n\n", "width": 120.000008, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown2", "classType": "dImage", "height": 424.800018, "resourceFileName": "", "width": 120.000008, "x": -246, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 420.000031, "lineSpace": 20, "resourceFileName": "data/zi.json", "text": "\n\n", "width": 120.000008, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown3", "classType": "dImage", "height": 424.800018, "resourceFileName": "", "width": 120.000008, "x": -123, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 424.800018, "lineSpace": 20, "resourceFileName": "data/zi.json", "text": "\n\n", "width": 120.000008, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown4", "classType": "dImage", "height": 424.800018, "resourceFileName": "", "width": 120.000008, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 417.600006, "lineSpace": 20, "resourceFileName": "data/zi.json", "text": "\n\n", "width": 120.000008, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown5", "classType": "dImage", "height": 424.800018, "resourceFileName": "", "width": 120.000008, "x": 123, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 416.400024, "lineSpace": 20, "resourceFileName": "data/zi.json", "text": "\n\n", "width": 120.000008, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown6", "classType": "dImage", "height": 424.800018, "resourceFileName": "", "width": 120.000008, "x": 246, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 120, "height": 423.600006, "lineSpace": 20, "resourceFileName": "data/zi.json", "text": "\n\n", "width": 120.000008, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown7", "classType": "dImage", "height": 424.800018, "resourceFileName": "", "width": 120.000008, "x": 369, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dImage", "height": 165, "resourceFileName": "level/631.png", "width": 889, "x": 0, "y": -351 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 103, "resourceFileName": "level/632.png", "width": 754, "x": 0, "y": 265 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level63.prototype.GetHintImageName = function () {
        return "level/633.png";
    };
    Level63.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.Back_CanTouchDown1, this.Back_CanTouchDown2, this.Back_CanTouchDown3, this.Back_CanTouchDown4, this.Back_CanTouchDown5,
            this.Back_CanTouchDown6, this.Back_CanTouchDown7];
        var answer = [0, 2, 1, 0, 1, 2, 0];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData["Num"] = 1;
                buttons[i].userData["CanTouchDown"].onTouchDown = function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons[i].userData["Num"]++;
                    buttons[i].userData["Num"] %= 3;
                    CCActionManager.Instance().RemoveAllActionsFromTarget(buttons[i]);
                    var pos = [140, 0, -140];
                    CCActionManager.Instance().AddAction(new CCMoveTo(0.1, buttons[i].positionX, pos[buttons[i].userData["Num"]]), buttons[i]);
                    _this.CheckClear(buttons, answer);
                };
            };
            fun(i);
        }
    };
    Level63.prototype.CheckClear = function (button, answer) {
        var _this = this;
        for (var i = 0; i < button.length; i++)
            if (button[i].userData["Num"] != answer[i])
                return;
        this.m_pGameWorld.SetBlockMouse(true);
        new dTimer(this).Create(100, 1, function () {
            _this.m_pGameWorld.ShowClear();
        });
    };
    return Level63;
}(LevelBase));
var Level64 = (function (_super) {
    __extends(Level64, _super);
    function Level64() {
        var _this = _super.call(this) || this;
        _this.m_input = [0, 0, 0, 0];
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level64.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0, "anchorV": 0, "className": "dSprite2", "classType": "dSprite", "height": 160, "width": 221, "x": -223, "y": -229 }, { "anchorU": 0, "anchorV": 0, "className": "dSprite1", "classType": "dSprite", "height": 166, "width": 115, "x": -225, "y": -10 }, { "anchorU": 0, "anchorV": 0, "className": "dSprite3", "classType": "dSprite", "height": 160, "width": 116, "x": -8, "y": 64 }, { "anchorU": 0, "anchorV": 0, "className": "dSprite4", "classType": "dSprite", "height": 68, "width": 67, "x": 164, "y": 163 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 439, "resourceFileName": "level/641.png", "width": 439, "x": -22, "y": -441 }, { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "dSprite3", "classType": "dSprite", "height": 149, "width": 260, "x": -243, "y": -207 }, { "anchorU": 0, "anchorV": 0, "className": "dSprite1", "classType": "dSprite", "height": 118, "width": 107, "x": -204, "y": 50 }, { "anchorU": 0, "anchorV": 0, "className": "dSprite2", "classType": "dSprite", "height": 229, "width": 149, "x": -21, "y": -21 }, { "anchorU": 0, "anchorV": 0, "className": "dSprite4", "classType": "dSprite", "height": 68, "width": 67, "x": 184, "y": 144 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 402, "resourceFileName": "level/642.png", "width": 476, "x": 191, "y": -322 }, { "_child": [{ "anchorU": 0, "anchorV": 0, "className": "dSprite1", "classType": "dSprite", "height": 154, "width": 258, "x": -243, "y": -228 }, { "anchorU": 0, "anchorV": 0, "className": "dSprite2", "classType": "dSprite", "height": 256, "width": 117, "x": -210, "y": -62 }, { "anchorU": 0, "anchorV": 0, "className": "dSprite3", "classType": "dSprite", "height": 234, "width": 148, "x": -22, "y": -44 }, { "anchorU": 0, "anchorV": 0, "className": "dSprite4", "classType": "dSprite", "height": 68, "width": 67, "x": 184, "y": 162 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 438, "resourceFileName": "level/643.png", "width": 476, "x": -147, "y": -178 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum1", "classType": "dSprite", "height": 396, "width": 151, "x": -296, "y": 427 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum2", "classType": "dSprite", "height": 396, "width": 151, "x": -103, "y": 427 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum3", "classType": "dSprite", "height": 396, "width": 151, "x": 90, "y": 427 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum4", "classType": "dSprite", "height": 396, "width": 151, "x": 283, "y": 427 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level64.prototype.GetHintImageName = function () {
        return "level/644.png";
    };
    Level64.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.CanDrag1.SetTransparentMouse(true, false);
        this.CanDrag2.SetTransparentMouse(true, false);
        this.CanDrag3.SetTransparentMouse(true, false);
        this.UpdateNumber();
        var upButtons = [this.InputNum1_UpButton, this.InputNum2_UpButton, this.InputNum3_UpButton, this.InputNum4_UpButton];
        for (var i = 0; i < upButtons.length; i++) {
            var fun = function (i) {
                upButtons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_input[i]--;
                    if (_this.m_input[i] < 0)
                        _this.m_input[i] = 9;
                    _this.UpdateNumber();
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
        var downButtons = [this.InputNum1_DownButton, this.InputNum2_DownButton, this.InputNum3_DownButton, this.InputNum4_DownButton];
        for (var i = 0; i < downButtons.length; i++) {
            var fun = function (i) {
                downButtons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_input[i]++;
                    if (_this.m_input[i] > 9)
                        _this.m_input[i] = 0;
                    _this.UpdateNumber();
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
    };
    Level64.prototype.UpdateNumber = function () {
        this.InputNum1_Text.text = this.NumToText(this.m_input[0]);
        this.InputNum2_Text.text = this.NumToText(this.m_input[1]);
        this.InputNum3_Text.text = this.NumToText(this.m_input[2]);
        this.InputNum4_Text.text = this.NumToText(this.m_input[3]);
    };
    Level64.prototype.NumToText = function (num) {
        switch (num) {
            case 0: return "";
            case 1: return "";
            case 2: return "";
            case 3: return "";
            case 4: return "";
            case 5: return "";
            case 6: return "";
            case 7: return "";
            case 8: return "";
            case 9: return "";
        }
        return "";
    };
    Level64.prototype.CheckClear = function () {
        if (this.m_input[0] == 4 && this.m_input[1] == 7 && this.m_input[2] == 2 && this.m_input[3] == 6)
            this.m_pGameWorld.ShowClear();
    };
    return Level64;
}(LevelBase));
var Level65 = (function (_super) {
    __extends(Level65, _super);
    function Level65() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level65.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 549, "resourceFileName": "level/651.png", "width": 831, "x": 0, "y": -401 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 156, "resourceFileName": "level/652.png", "width": 156, "x": -333, "y": 13, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 156, "resourceFileName": "level/652.png", "width": 156, "x": -110, "y": 13, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 156, "resourceFileName": "level/652.png", "width": 156, "x": 113, "y": 13, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 156, "resourceFileName": "level/652.png", "width": 156, "x": 336, "y": 13, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 156, "resourceFileName": "level/655.png", "width": 156, "x": -283.997192, "y": 395, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 156, "resourceFileName": "level/656.png", "width": 156, "x": 37.002808, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 156, "resourceFileName": "level/653.png", "width": 156, "x": 292.002808, "y": 422, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 156, "resourceFileName": "level/654.png", "width": 156, "x": -45.997192, "y": 541, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level65.prototype.GetHintImageName = function () {
        return "level/657.png";
    };
    Level65.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level65.prototype.CheckClear = function (p) {
        var answer = "0123";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level65.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level65.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level65;
}(LevelBase));
var Level66 = (function (_super) {
    __extends(Level66, _super);
    function Level66() {
        var _this = _super.call(this) || this;
        _this.m_input = [0, 0, 0, 0];
        _this.m_vecwall = new Array();
        _this.m_hero = new GameBlock66();
        _this.m_heroReached = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level66.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 924, "resourceFileName": "level/663.png", "width": 848, "x": 0, "y": -323 }, { "anchorU": 0, "anchorV": 0, "className": "GameLayer", "classType": "dSprite", "height": 700, "width": 840, "x": -420, "y": -780 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 64, "height": 65, "resourceFileName": "data/fontNumber.json", "text": "5917", "width": 129, "x": 37.001709, "y": 85, "z": 13.707539 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum1", "classType": "dSprite", "height": 396, "width": 151, "x": -41, "y": 359 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum2", "classType": "dSprite", "height": 396, "width": 151, "x": 121, "y": 359 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum3", "classType": "dSprite", "height": 396, "width": 151, "x": 283, "y": 359 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum4", "classType": "dSprite", "height": 396, "width": 151, "x": 445, "y": 359 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Quest", "classType": "dBitmapFont", "fontSize": 64, "height": 74, "resourceFileName": "data/font64.json", "text": "", "width": 128, "x": 0, "y": -16 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ClearButton", "classType": "dButton", "height": 107, "resourceFileName": "data/button2.png", "width": 171, "x": 383, "y": 34 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 110, "resourceFileName": "level/103.png", "width": 96, "x": -333, "y": 256 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 110, "resourceFileName": "level/104.png", "width": 96, "x": -332, "y": 480 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "LeftButton", "classType": "dButton", "height": 95, "resourceFileName": "level/105.png", "width": 109, "x": -453, "y": 372 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "RightButton", "classType": "dButton", "height": 95, "resourceFileName": "level/106.png", "width": 109, "x": -215, "y": 372 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level66.prototype.GetHintImageName = function () {
        return "level/664.png";
    };
    Level66.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.UpdateNumber();
        var upButtons = [this.InputNum1_UpButton, this.InputNum2_UpButton, this.InputNum3_UpButton, this.InputNum4_UpButton];
        for (var i = 0; i < upButtons.length; i++) {
            var fun = function (i) {
                upButtons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_input[i]--;
                    if (_this.m_input[i] < 0)
                        _this.m_input[i] = 9;
                    _this.UpdateNumber();
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
        var downButtons = [this.InputNum1_DownButton, this.InputNum2_DownButton, this.InputNum3_DownButton, this.InputNum4_DownButton];
        for (var i = 0; i < downButtons.length; i++) {
            var fun = function (i) {
                downButtons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_input[i]++;
                    if (_this.m_input[i] > 9)
                        _this.m_input[i] = 0;
                    _this.UpdateNumber();
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
        this.ClearButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_pGameWorld.Restart();
        }));
        var buttons = [this.UpButton, this.RightButton, this.DownButton, this.LeftButton];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    if (!_this.m_hero.isMoving && !_this.m_heroReached) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.MoveHero(i);
                    }
                }));
            };
            fun(i);
        }
        this.Number.visible = false;
        this.AddWall(2, 1);
        this.AddWall(9, 0);
        this.AddWall(11, 2);
        this.AddWall(4, 4);
        this.AddWall(0, 4);
        this.AddWall(1, 6);
        this.AddWall(10, 6);
        this.AddWall(6, 7);
        this.AddWall(7, 8);
        this.AddWall(3, 9);
        this.AddWall(11, 9);
        this.m_hero.SetHero();
        this.m_hero.SetBlockPos(6, 4);
        this.GameLayer.AddChild(this.m_hero);
    };
    Level66.prototype.AddWall = function (x, y) {
        var wall = new GameBlock66();
        wall.SetWall();
        wall.SetBlockPos(x, y);
        this.m_vecwall.push(wall);
        this.GameLayer.AddChild(wall);
    };
    Level66.prototype.UpdateNumber = function () {
        this.InputNum1_Text.text = this.NumToText(this.m_input[0]);
        this.InputNum2_Text.text = this.NumToText(this.m_input[1]);
        this.InputNum3_Text.text = this.NumToText(this.m_input[2]);
        this.InputNum4_Text.text = this.NumToText(this.m_input[3]);
    };
    Level66.prototype.NumToText = function (num) {
        switch (num) {
            case 0: return "";
            case 1: return "";
            case 2: return "";
            case 3: return "";
            case 4: return "";
            case 5: return "";
            case 6: return "";
            case 7: return "";
            case 8: return "";
            case 9: return "";
        }
        return "";
    };
    Level66.prototype.MoveHero = function (dir) {
        var _this = this;
        var x = this.m_hero.blockX;
        var y = this.m_hero.blockY;
        if (dir == 0) {
            for (; y >= 0; y--)
                if (this.FindWall(x, y))
                    break;
            y++;
        }
        else if (dir == 1) {
            for (; x < 12; x++)
                if (this.FindWall(x, y))
                    break;
            x--;
        }
        else if (dir == 2) {
            for (; y < 10; y++)
                if (this.FindWall(x, y))
                    break;
            y--;
        }
        else if (dir == 3) {
            for (; x >= 0; x--)
                if (this.FindWall(x, y))
                    break;
            x++;
        }
        if (x == 6 && y == 9) {
            y++;
            this.m_heroReached = true;
        }
        this.m_hero.MoveToBlock(x, y, function () {
            if (_this.m_heroReached)
                _this.Number.visible = true;
        });
    };
    Level66.prototype.CheckClear = function () {
        if (this.m_input[0] == 5 && this.m_input[1] == 9 && this.m_input[2] == 1 && this.m_input[3] == 7)
            this.m_pGameWorld.ShowClear();
    };
    Level66.prototype.FindWall = function (x, y) {
        for (var i = 0; i < this.m_vecwall.length; i++)
            if (this.m_vecwall[i].blockX == x && this.m_vecwall[i].blockY == y)
                return this.m_vecwall[i];
        return null;
    };
    return Level66;
}(LevelBase));
var GameBlock66 = (function (_super) {
    __extends(GameBlock66, _super);
    function GameBlock66() {
        var _this = _super.call(this) || this;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.isMoving = false;
        _this.SetSize(GameBlock66.CELL_SIZE, GameBlock66.CELL_SIZE);
        _this.SetAnchor(0, 0);
        return _this;
    }
    GameBlock66.prototype.SetBlockPos = function (x, y) {
        this.blockX = x;
        this.blockY = y;
        this.SetPos(x * GameBlock66.CELL_SIZE, y * GameBlock66.CELL_SIZE);
    };
    GameBlock66.prototype.SetWall = function () {
        this.LoadFromFile("level/662.png");
    };
    GameBlock66.prototype.SetHero = function () {
        this.LoadFromFile("level/661.png");
    };
    GameBlock66.prototype.MoveToBlock = function (x, y, onComplete) {
        var _this = this;
        var off = dMath.Abs(this.blockX - x) + dMath.Abs(this.blockY - y);
        this.blockX = x;
        this.blockY = y;
        this.isMoving = true;
        CCActionManager.Instance().AddAction(new CCSequence([
            new CCMoveTo(off * 0.05, x * GameBlock66.CELL_SIZE, y * GameBlock66.CELL_SIZE),
            new CCCallFunc(function () {
                _this.isMoving = false;
                onComplete();
            })
        ]), this);
    };
    GameBlock66.CELL_SIZE = 70;
    return GameBlock66;
}(dImage));
var Level67 = (function (_super) {
    __extends(Level67, _super);
    function Level67() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level67.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 623, "resourceFileName": "level/671.png", "width": 610, "x": 0, "y": -451 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 50, "resourceFileName": "level/676.png", "width": 985, "x": 0, "y": -63 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -396, "y": 90, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -134, "y": 90, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 125, "y": 90, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 388, "y": 90, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 131, "resourceFileName": "level/674.png", "width": 113, "x": 97.002808, "y": 400, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 122, "resourceFileName": "level/675.png", "width": 138, "x": -356.997192, "y": 407, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 121, "resourceFileName": "level/672.png", "width": 139, "x": 280.002808, "y": 495, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 131, "resourceFileName": "level/673.png", "width": 118, "x": -131.997192, "y": 503, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level67.prototype.GetHintImageName = function () {
        return "level/677.png";
    };
    Level67.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level67.prototype.CheckClear = function (p) {
        var answer = "0123456789";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level67.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level67.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level67;
}(LevelBase));
var Level68 = (function (_super) {
    __extends(Level68, _super);
    function Level68() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level68.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 623, "resourceFileName": "level/685.png", "width": 610, "x": 118, "y": -444 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 770, "resourceFileName": "level/686.png", "width": 1024, "x": -10, "y": -73 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown1", "classType": "dImage", "height": 568, "resourceFileName": "level/681.png", "width": 89, "x": 0, "y": 235 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -377, "y": -362, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown1", "classType": "dImage", "height": 585, "resourceFileName": "level/682.png", "width": 99, "x": 0, "y": 246 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -174, "y": 158, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown1", "classType": "dImage", "height": 558, "resourceFileName": "level/683.png", "width": 94, "x": 0, "y": 235 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 90, "y": 97, "z": 6.247593 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "CanTouchDown1", "classType": "dImage", "height": 551, "resourceFileName": "level/684.png", "width": 93, "x": 0, "y": 235 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 310, "y": 210, "z": 6.247593 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level68.prototype.GetHintImageName = function () {
        return "level/687.png";
    };
    Level68.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons = [this.Block1_CanTouchDown1, this.Block2_CanTouchDown1, this.Block3_CanTouchDown1, this.Block4_CanTouchDown1];
        var answer = [2, 1, 3, 3];
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].userData["Num"] = 0;
                buttons[i].userData["CanTouchDown"].onTouchDown = function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons[i].userData["Num"]++;
                    buttons[i].userData["Num"] %= 4;
                    CCActionManager.Instance().RemoveAllActionsFromTarget(buttons[i]);
                    var pos = [235, 81, -81, -235];
                    CCActionManager.Instance().AddAction(new CCMoveTo(0.1, buttons[i].positionX, pos[buttons[i].userData["Num"]]), buttons[i]);
                    _this.CheckClear(buttons, answer);
                };
            };
            fun(i);
        }
    };
    Level68.prototype.CheckClear = function (button, answer) {
        var _this = this;
        for (var i = 0; i < button.length; i++)
            if (button[i].userData["Num"] != answer[i])
                return;
        this.m_pGameWorld.SetBlockMouse(true);
        new dTimer(this).Create(100, 1, function () {
            _this.m_pGameWorld.ShowClear();
        });
    };
    return Level68;
}(LevelBase));
var Level69 = (function (_super) {
    __extends(Level69, _super);
    function Level69() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level69.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 1311, "resourceFileName": "level/693.png", "width": 866, "x": 0, "y": -97 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox1", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": -206, "y": -548 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox2", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": -21, "y": -548 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox3", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": 164, "y": -548 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox4", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": 349, "y": -548 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox5", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": -206, "y": -342 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox6", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": -21, "y": -342 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox7", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": 164, "y": -342 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox8", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": 349, "y": -342 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox9", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": -206, "y": -136 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox10", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": -21, "y": -136 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox11", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": 164, "y": -136 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox12", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": 349, "y": -136 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox13", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": -206, "y": 70 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox14", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": -21, "y": 70 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox15", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": 164, "y": 70 }, { "anchorU": 0.5, "anchorV": 0.5, "check": 0, "checkImage": "level/691.png", "className": "CheckBox16", "classType": "dCheckBox", "height": 99, "resourceFileName": "level/692.png", "width": 99, "x": 349, "y": 70 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level69.prototype.GetHintImageName = function () {
        return "level/694.png";
    };
    Level69.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var checks = [this.CheckBox1, this.CheckBox2, this.CheckBox3, this.CheckBox4,
            this.CheckBox5, this.CheckBox6, this.CheckBox7, this.CheckBox8, this.CheckBox9,
            this.CheckBox10, this.CheckBox11, this.CheckBox12, this.CheckBox13, this.CheckBox14,
            this.CheckBox15, this.CheckBox16];
        var answer = [1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1];
        for (var i = 0; i < checks.length; i++) {
            var fun = function (i) {
                checks[i].SetEvent(new dEvent().SetOnCheck(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.CheckClear(checks, answer);
                }));
            };
            fun(i);
        }
    };
    Level69.prototype.CheckClear = function (checks, answer) {
        for (var i = 0; i < checks.length; i++)
            if (Number(checks[i].isCheck()) != answer[i])
                return;
        this.m_pGameWorld.ShowClear();
    };
    return Level69;
}(LevelBase));
var Level7 = (function (_super) {
    __extends(Level7, _super);
    function Level7() {
        var _this = _super.call(this) || this;
        _this.m_vecLines = new Array();
        _this.m_curLine = null;
        _this.m_imgs = null;
        _this.m_curTouchDownDot = null;
        _this.m_lineCrossed = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level7.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 117, "resourceFileName": "level/71.png", "width": 117, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 46.079998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -14 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 18, "x": 0, "y": -80 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Can1", "classType": "dImage", "height": 117, "resourceFileName": "", "width": 117, "x": -265, "y": -379.483459 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 117, "resourceFileName": "level/71.png", "width": 117, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 63.359997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 18, "x": 0, "y": -80 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Can2", "classType": "dImage", "height": 117, "resourceFileName": "", "width": 117, "x": -76, "y": -131.522949 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 117, "resourceFileName": "level/71.png", "width": 117, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 58.879997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 18, "x": 0, "y": -80 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Can3", "classType": "dImage", "height": 117, "resourceFileName": "", "width": 117, "x": -355, "y": 44.581787 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 117, "resourceFileName": "level/71.png", "width": 117, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 63.359997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 18, "x": 0, "y": -80 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Can4", "classType": "dImage", "height": 117, "resourceFileName": "", "width": 117, "x": 66, "y": -427.418213 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 117, "resourceFileName": "level/71.png", "width": 117, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 46.079998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -14 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 18, "x": 0, "y": -80 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Can5", "classType": "dImage", "height": 117, "resourceFileName": "", "width": 117, "x": 324, "y": -284.418213 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 117, "resourceFileName": "level/71.png", "width": 117, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 62.719997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 18, "x": 0, "y": -80 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Can6", "classType": "dImage", "height": 117, "resourceFileName": "", "width": 117, "x": 392.967896, "y": 19.581787 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 117, "resourceFileName": "level/71.png", "width": 117, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 46.079998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -14 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 18, "x": 0, "y": -80 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Can7", "classType": "dImage", "height": 117, "resourceFileName": "", "width": 117, "x": 301, "y": 275.581787 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 117, "resourceFileName": "level/71.png", "width": 117, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 62.719997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 18, "x": 0, "y": -80 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Can8", "classType": "dImage", "height": 117, "resourceFileName": "", "width": 117, "x": -228, "y": 368.581787 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 117, "resourceFileName": "level/71.png", "width": 117, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 46.079998, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -14 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 18, "x": 0, "y": -80 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Can9", "classType": "dImage", "height": 117, "resourceFileName": "", "width": 117, "x": 46, "y": 430.581787 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 117, "resourceFileName": "level/71.png", "width": 117, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 63.359997, "resourceFileName": "data/zi.json", "text": "", "width": 64, "x": 0, "y": -6 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Num", "classType": "dBitmapFont", "fontSize": 32, "height": 32.5, "resourceFileName": "data/fontNumber.json", "text": "0", "width": 18, "x": 0, "y": -80 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Can10", "classType": "dImage", "height": 117, "resourceFileName": "", "width": 117, "x": 14, "y": 104.581787 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 74, "resourceFileName": "data/font64.json", "text": "", "width": 128, "x": 0, "y": -16 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ClearButton", "classType": "dButton", "height": 107, "resourceFileName": "data/button2.png", "width": 171, "x": 369, "y": -575 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level7.prototype.GetHintImageName = function () {
        return "level/72.png";
    };
    Level7.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var imgs = [this.Can1, this.Can2, this.Can3, this.Can4, this.Can5, this.Can6, this.Can7, this.Can8, this.Can9, this.Can10];
        this.m_imgs = imgs;
        for (var i = 0; i < imgs.length; i++) {
            var fun = function (i) {
                imgs[i].SetHandleMouse(true);
                var pTouchEvent = new dSprite();
                pTouchEvent.OnTouchDown = function (x, y, delta) {
                    x = imgs[i].positionX;
                    y = imgs[i].positionY;
                    _this.BeginTouchDot(imgs[i], x, y);
                };
                pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                    x += imgs[i].positionX;
                    y += imgs[i].positionY;
                    _this.OnTouchMoveDot(imgs[i], x, y);
                };
                pTouchEvent.OnTouchUp = function (x, y) {
                    _this.OnTouchUpDot();
                };
                imgs[i].SetTouchEvent(pTouchEvent);
            };
            fun(i);
        }
        this.ClearButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            for (var i = 0; i < _this.m_vecLines.length; i++)
                _this.m_vecLines[i].RemoveParent();
            _this.m_vecLines.clear();
            _this.UpdateDotNum();
        }));
    };
    Level7.prototype.BeginTouchDot = function (p, x, y) {
        var _this = this;
        this.m_curTouchDownDot = p;
        this.m_curLine = new dLine();
        this.m_curLine.userData = {};
        this.m_curLine.lineWidth = 30;
        this.m_curLine.spriteColor = 0xfffddb3c;
        this.m_curLine.MoveTo(x, y);
        this.m_curLine.SetHandleMouse(true);
        var pTouchEvent = new dSprite();
        var line = this.m_curLine;
        pTouchEvent.OnTouchDown = function (x, y, delta) {
            _this.m_vecLines.remove(line);
            line.RemoveParent();
            dSound.PlaySound("data/sound/button.mp3");
            _this.CheckLineCross();
            _this.UpdateDotNum();
        };
        this.m_curLine.SetTouchEvent(pTouchEvent);
        this.AddChild(this.m_curLine, 0);
        dSound.PlaySound("data/sound/button.mp3");
        this.UpdateDotNum();
    };
    Level7.prototype.OnTouchMoveDot = function (p, x, y) {
        if (this.m_curLine) {
            this.m_curLine.SetLastPos(x, y);
            var col = this.CheckCollisionDot(this.m_curTouchDownDot, x, y);
            if (col && this.CanLink(col, this.m_curTouchDownDot)) {
                this.m_curLine.userData["1"] = col;
                this.m_curLine.userData["2"] = this.m_curTouchDownDot;
                this.m_curLine.SetLastPos(col.positionX, col.positionY);
                this.m_vecLines.push(this.m_curLine);
                this.m_curLine = null;
                this.m_curTouchDownDot = null;
                dSound.PlaySound("data/sound/button.mp3");
                this.UpdateDotNum();
            }
            this.CheckLineCross();
            if (col)
                this.CheckClear();
            this.PlayDrawSound();
        }
    };
    Level7.prototype.OnTouchUpDot = function () {
        this.m_curTouchDownDot = null;
        if (this.m_curLine) {
            this.m_curLine.RemoveParent();
            this.m_curLine = null;
        }
        this.UpdateDotNum();
    };
    Level7.prototype.CheckCollisionDot = function (withOut, x, y) {
        var v = new dVector2(x, y);
        for (var i = 0; i < this.m_imgs.length; i++) {
            if (this.m_imgs[i] == withOut)
                continue;
            if (v.LengthTo(this.m_imgs[i].GetPosVector2()) < this.m_imgs[i].width / 2)
                return this.m_imgs[i];
        }
        return null;
    };
    Level7.prototype.CheckLineCross = function () {
        this.m_lineCrossed = false;
        if (this.m_curLine)
            this.m_curLine.spriteColor = 0xfffddb3c;
        for (var i = 0; i < this.m_vecLines.length; i++) {
            this.m_vecLines[i].spriteColor = 0xfffddb3c;
            for (var j = 0; j <= this.m_vecLines.length; j++) {
                if (i == j)
                    continue;
                var line1 = this.m_vecLines[i];
                var line2;
                if (j == this.m_vecLines.length)
                    line2 = this.m_curLine;
                else
                    line2 = this.m_vecLines[j];
                if (!line2)
                    continue;
                var p1start = new dVector2(line1.GetLineToX(), line1.GetLineToY());
                var p1end = line1.GetMoveTo();
                var dir1 = p1end.Sub(p1start);
                dir1.Normalize();
                dir1.MulAppendF(10);
                p1start.AddAppend(dir1);
                p1end.SubAppend(dir1);
                var p2start = new dVector2(line2.GetLineToX(), line2.GetLineToY());
                var p2end = line2.GetMoveTo();
                var dir2 = p2end.Sub(p2start);
                dir2.Normalize();
                dir2.MulAppendF(10);
                p2start.AddAppend(dir2);
                p2end.SubAppend(dir2);
                if (dMath.LineLineIntersection2D(p1start.x, p1start.y, p1end.x, p1end.y, p2start.x, p2start.y, p2end.x, p2end.y)) {
                    this.m_lineCrossed = true;
                    line1.spriteColor = 0xffff0000;
                    line2.spriteColor = 0xffff0000;
                }
            }
        }
    };
    Level7.prototype.CanLink = function (p1, p2) {
        for (var i = 0; i < this.m_vecLines.length; i++) {
            var line = this.m_vecLines[i];
            if (line.userData["1"] == p1 && line.userData["2"] == p2 ||
                line.userData["2"] == p1 && line.userData["1"] == p2)
                return false;
        }
        return true;
    };
    Level7.prototype.UpdateDotNum = function () {
        for (var i = 0; i < this.m_imgs.length; i++) {
            var label = this.m_imgs[i].FindChild("Num");
            var curNum = this.GetLineNum(this.m_imgs[i]);
            var needNum = this.GetNeedNum(this.m_imgs[i]);
            label.text = String(curNum);
            label.spriteColor = curNum == needNum ? 0xff5aff27 : 0xffffffff;
        }
    };
    Level7.prototype.GetLineNum = function (p) {
        var ret = 0;
        if (this.m_curTouchDownDot == p)
            ret++;
        for (var i = 0; i < this.m_vecLines.length; i++) {
            if (this.m_vecLines[i].userData["1"] == p || this.m_vecLines[i].userData["2"] == p)
                ret++;
        }
        return ret;
    };
    Level7.prototype.GetNeedNum = function (p) {
        var label2 = p.FindChild("Text");
        if (label2.text == "")
            return 1;
        if (label2.text == "")
            return 2;
        if (label2.text == "")
            return 3;
        if (label2.text == "")
            return 4;
        if (label2.text == "")
            return 5;
        return 0;
    };
    Level7.prototype.CheckClear = function () {
        if (this.m_curLine)
            return;
        for (var i = 0; i < this.m_imgs.length; i++) {
            var curNum = this.GetLineNum(this.m_imgs[i]);
            var needNum = this.GetNeedNum(this.m_imgs[i]);
            if (curNum != needNum)
                return;
        }
        this.m_pGameWorld.ShowClear();
    };
    return Level7;
}(LevelBase));
var dLine = (function (_super) {
    __extends(dLine, _super);
    function dLine() {
        var _this = _super.call(this) || this;
        _this.m_vecImage = new Array();
        _this.m_fLineWidth = 1;
        _this.m_vMoveTo = new dVector2();
        _this.m_nUsingImageIndex = 0;
        _this.m_hasMoveTo = false;
        _this.m_repeatMode = false;
        return _this;
    }
    dLine.prototype.SetColor = function (color, bWithChild) {
        if (bWithChild === void 0) { bWithChild = false; }
        _super.prototype.SetColor.call(this, color, bWithChild);
        for (var i = 0; i < this.m_vecImage.length; i++)
            this.m_vecImage[i].SetColor(color);
    };
    dLine.prototype.Release = function () {
        for (var i = 0; i < this.m_vecImage.length; i++)
            this.RemoveChild(this.m_vecImage[i]);
        this.m_vecImage.clear();
    };
    dLine.prototype.Clear = function () {
        this.m_nUsingImageIndex = 0;
        for (var i = 0; i < this.m_vecImage.length; i++)
            this.m_vecImage[i].visible = false;
        this.m_vMoveTo.SetValue(0, 0);
        this.m_hasMoveTo = false;
    };
    dLine.prototype.MoveTo = function (x, y) {
        this.m_vMoveTo.SetValue(x, y);
        this.m_hasMoveTo = true;
    };
    dLine.prototype.hasMoveTo = function () {
        return this.m_hasMoveTo;
    };
    Object.defineProperty(dLine.prototype, "lineWidth", {
        get: function () {
            return this.m_fLineWidth;
        },
        set: function (value) {
            this.m_fLineWidth = value;
        },
        enumerable: false,
        configurable: true
    });
    dLine.prototype.SetBitmapData = function (bmp, pSourceRect, at, sampleType) {
        if (pSourceRect === void 0) { pSourceRect = null; }
        if (at === void 0) { at = 0; }
        if (sampleType === void 0) { sampleType = 0; }
        _super.prototype.SetBitmapData.call(this, bmp, pSourceRect, at, sampleType);
        if (bmp != null) {
            for (var i = 0; i < this.m_vecImage.length; i++) {
                this.m_vecImage[i].pureColor = false;
                this.m_vecImage[i].SetBitmapData(bmp, pSourceRect, at, sampleType);
            }
        }
        else {
            for (var i = 0; i < this.m_vecImage.length; i++) {
                this.m_vecImage[i].SetBitmapData(null);
                this.m_vecImage[i].pureColor = true;
            }
        }
    };
    dLine.prototype.CreateLineImage = function () {
        if (this.m_nUsingImageIndex < this.m_vecImage.length)
            return this.m_vecImage[this.m_nUsingImageIndex++];
        var pImage;
        if (this.m_repeatMode)
            pImage = new dRepeatImage();
        else
            pImage = new dImage();
        pImage.SetAnchor(0, 0.5);
        pImage.SetTransparentMouse(this.isTransparentMouse());
        if (this.GetBitmapData() != null)
            pImage.SetBitmapData(this.GetBitmapData(), this.GetBitmapSourceRect());
        else
            pImage.pureColor = true;
        pImage.SetColor(this.GetColor());
        this.AddChild(pImage);
        this.m_vecImage.push(pImage);
        this.m_nUsingImageIndex++;
        return pImage;
    };
    dLine.prototype.RemoveAllChild = function (bDestory) {
        if (bDestory === void 0) { bDestory = false; }
        _super.prototype.RemoveAllChild.call(this, bDestory);
        for (var i = 0; i < this.m_vecImage.length; i++)
            this.AddChild(this.m_vecImage[i]);
    };
    dLine.prototype.LineTo = function (x, y) {
        var pImage = this.CreateLineImage();
        pImage.visible = true;
        var vStart = new dVector2(this.m_vMoveTo.x, this.m_vMoveTo.y);
        var vEnd = new dVector2(x, y);
        pImage.SetPos(this.m_vMoveTo.x, this.m_vMoveTo.y);
        pImage.SetSize(vEnd.LengthTo(vStart), this.m_fLineWidth);
        pImage.rotation = dMath.RadianToAngle((vEnd.Sub(vStart).Normalize().ToRadian() - dMath.dPI / 2));
        this.m_vMoveTo.SetValue(x, y);
    };
    dLine.prototype.SetLastPos = function (x, y) {
        if (this.GetLineCount() > 0) {
            var pImage = this.m_vecImage[this.m_nUsingImageIndex - 1];
            pImage.visible = true;
            var vStart = new dVector2(pImage.positionX, pImage.positionY);
            var vEnd = new dVector2(x, y);
            pImage.SetSize(vEnd.LengthTo(vStart), this.m_fLineWidth);
            pImage.rotation = dMath.RadianToAngle((vEnd.Sub(vStart).Normalize().ToRadian() - dMath.dPI / 2));
            this.m_vMoveTo.SetValue(x, y);
        }
        else
            this.LineTo(x, y);
    };
    dLine.prototype.GetMoveToX = function () {
        return this.m_vMoveTo.x;
    };
    dLine.prototype.GetMoveToY = function () {
        return this.m_vMoveTo.y;
    };
    dLine.prototype.GetMoveTo = function () {
        return new dVector2(this.m_vMoveTo.x, this.m_vMoveTo.y);
    };
    dLine.prototype.GetLineCount = function () {
        return this.m_nUsingImageIndex;
    };
    dLine.prototype.GetLineList = function () {
        return this.m_vecImage;
    };
    dLine.prototype.GetLineToX = function (at) {
        if (at === void 0) { at = 0; }
        if (at < 0)
            return this.GetMoveToX();
        if (at >= this.m_vecImage.length)
            return 0;
        return this.m_vecImage[at].positionX;
    };
    dLine.prototype.GetLineToY = function (at) {
        if (at === void 0) { at = 0; }
        if (at < 0)
            return this.GetMoveToY();
        if (at >= this.m_vecImage.length)
            return 0;
        return this.m_vecImage[at].positionY;
    };
    dLine.prototype.LoadFromFile = function (strImage, onLoadComplete, bAutoResize, rcSource) {
        var _this = this;
        if (onLoadComplete === void 0) { onLoadComplete = null; }
        if (bAutoResize === void 0) { bAutoResize = true; }
        if (rcSource === void 0) { rcSource = null; }
        if (bAutoResize)
            this.lineWidth = 0;
        _super.prototype.LoadFromFile.call(this, strImage, function () {
            if (_this.GetBitmapData() != null) {
                if (bAutoResize && _this.lineWidth == 0)
                    _this.lineWidth = _this.GetBitmapData().GetWidth();
            }
            for (var i = 0; i < _this.m_vecImage.length; i++)
                _this.m_vecImage[i].SetBitmapData(_this.GetBitmapData());
            if (onLoadComplete)
                onLoadComplete(_this);
        }, false);
        return this;
    };
    return dLine;
}(dImage));
var Level70 = (function (_super) {
    __extends(Level70, _super);
    function Level70() {
        var _this = _super.call(this) || this;
        _this.m_curTouchDownImage = null;
        _this.m_curTouchDownLine = null;
        _this.m_vecImages = null;
        _this.m_vecLines = new Array();
        _this.m_lineCrossed = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level70.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "ClearButton", "classType": "dButton", "height": 107, "resourceFileName": "level/582.png", "width": 171, "x": 349, "y": -655 }, { "anchorU": 0, "anchorV": 0, "className": "LineLayer", "classType": "dSprite", "height": 0, "width": 0, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage14", "classType": "dImage", "height": 89, "resourceFileName": "level/709b.png", "width": 449, "x": 0, "y": -705 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 107, "resourceFileName": "level/701.png", "width": 107, "x": -184, "y": -299 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 107, "resourceFileName": "level/702.png", "width": 107, "x": -18, "y": -108 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 107, "resourceFileName": "level/703.png", "width": 107, "x": -245, "y": 195 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage4", "classType": "dImage", "height": 107, "resourceFileName": "level/704.png", "width": 107, "x": 215, "y": 75 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage5", "classType": "dImage", "height": 107, "resourceFileName": "level/705.png", "width": 107, "x": 31, "y": -350 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage6", "classType": "dImage", "height": 107, "resourceFileName": "level/706.png", "width": 107, "x": -434, "y": -77 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage7", "classType": "dImage", "height": 107, "resourceFileName": "level/707.png", "width": 107, "x": -365, "y": -461 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage8", "classType": "dImage", "height": 107, "resourceFileName": "level/708.png", "width": 107, "x": -357, "y": 504 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage9", "classType": "dImage", "height": 107, "resourceFileName": "level/709.png", "width": 107, "x": -59, "y": 319 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage10", "classType": "dImage", "height": 107, "resourceFileName": "level/709a.png", "width": 107, "x": 387, "y": 208 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage11", "classType": "dImage", "height": 107, "resourceFileName": "level/706.png", "width": 107, "x": 323, "y": 414 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage12", "classType": "dImage", "height": 107, "resourceFileName": "level/706.png", "width": 107, "x": 239, "y": -422 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage13", "classType": "dImage", "height": 107, "resourceFileName": "level/707.png", "width": 107, "x": 436, "y": -335 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level70.prototype.GetHintImageName = function () {
        return "level/709c.png";
    };
    Level70.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.ClearButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_pGameWorld.Restart();
        }));
        this.m_vecImages = [this.dImage1, this.dImage2, this.dImage3, this.dImage4, this.dImage5, this.dImage6,
            this.dImage7, this.dImage8, this.dImage9, this.dImage10, this.dImage11, this.dImage12, this.dImage13];
        this.dImage1.userData = "";
        this.dImage2.userData = "";
        this.dImage3.userData = "";
        this.dImage4.userData = "";
        this.dImage5.userData = "";
        this.dImage6.userData = "";
        this.dImage7.userData = "";
        this.dImage8.userData = "";
        this.dImage9.userData = "";
        this.dImage10.userData = "";
        this.dImage11.userData = "";
        this.dImage12.userData = "";
        this.dImage13.userData = "";
        this.SetHandleMouse(true);
    };
    Level70.prototype.OnTouchDown = function (x, y, delta) {
        var col = this.CollectImage(x, y);
        if (col) {
            this.SetStartImage(col);
        }
    };
    Level70.prototype.SetStartImage = function (col) {
        var _this = this;
        this.m_curTouchDownImage = col;
        var line = this.m_curTouchDownLine = new GameLine70();
        this.m_curTouchDownLine.linkStart = this.m_curTouchDownImage;
        this.m_curTouchDownLine.lineWidth = 20;
        this.LineLayer.AddChild(this.m_curTouchDownLine);
        this.m_curTouchDownLine.MoveTo(this.m_curTouchDownImage.positionX, this.m_curTouchDownImage.positionY);
        dSound.PlaySound("data/sound/button.mp3");
        this.m_curTouchDownLine.SetHandleMouse(true);
        var pTouchEvent = new dSprite();
        pTouchEvent.OnTouchDown = function (x, y, delta) {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_vecLines.remove(line);
            line.RemoveParent();
            _this.UpdateLineColor();
            _this.CheckClear();
        };
        this.m_curTouchDownLine.SetTouchEvent(pTouchEvent);
    };
    Level70.prototype.UpdateLineColor = function () {
        this.m_lineCrossed = false;
        if (this.m_curTouchDownLine)
            this.m_vecLines.push(this.m_curTouchDownLine);
        for (var i = 0; i < this.m_vecLines.length; i++)
            this.m_vecLines[i].spriteColor = 0xffffffff;
        for (var i = 0; i < this.m_vecLines.length; i++) {
            for (var j = 0; j < this.m_vecLines.length; j++) {
                if (i == j)
                    continue;
                if (this.m_vecLines[i].GetLineCount() == 0 || this.m_vecLines[j].GetLineCount() == 0)
                    continue;
                var x1 = this.m_vecLines[i].GetMoveToX();
                var y1 = this.m_vecLines[i].GetMoveToY();
                var x2 = this.m_vecLines[i].GetLineToX();
                var y2 = this.m_vecLines[i].GetLineToY();
                var x3 = this.m_vecLines[j].GetMoveToX();
                var y3 = this.m_vecLines[j].GetMoveToY();
                var x4 = this.m_vecLines[j].GetLineToX();
                var y4 = this.m_vecLines[j].GetLineToY();
                if (dMath.LineLineIntersection2D(x1, y1, x2, y2, x3, y3, x4, y4)) {
                    this.m_vecLines[i].spriteColor = 0xffff0000;
                    this.m_vecLines[j].spriteColor = 0xffff0000;
                    this.m_lineCrossed = true;
                }
            }
        }
        if (this.m_curTouchDownLine)
            this.m_vecLines.pop();
    };
    Level70.prototype.OnTouchMove = function (x, y, offx, offy, delta) {
        if (this.m_curTouchDownLine) {
            this.m_curTouchDownLine.SetLastPos(x, y);
            var col = this.CollectImage(x, y);
            if (col && col != this.m_curTouchDownImage && this.FindLineByLinkStartEnd(col, this.m_curTouchDownImage) == null) {
                var dir = col.GetPosVector2().Sub(this.m_curTouchDownImage.GetPosVector2());
                dir.Normalize();
                dir.MulAppendF(10);
                this.m_curTouchDownLine.Clear();
                this.m_curTouchDownLine.MoveTo(this.m_curTouchDownImage.positionX + dir.x, this.m_curTouchDownImage.positionY + dir.y);
                this.m_curTouchDownLine.SetLastPos(col.positionX - dir.x, col.positionY - dir.y);
                this.m_curTouchDownLine.linkEnd = col;
                this.m_vecLines.push(this.m_curTouchDownLine);
                this.SetStartImage(col);
                this.CheckClear();
            }
            this.UpdateLineColor();
        }
    };
    Level70.prototype.OnTouchUp = function (x, y) {
        if (this.m_curTouchDownLine) {
            this.m_curTouchDownLine.RemoveParent();
            this.m_curTouchDownLine = null;
        }
        this.m_curTouchDownImage = null;
        this.UpdateLineColor();
    };
    Level70.prototype.CheckClear = function () {
        if (this.m_lineCrossed)
            return;
        var lines = [["", "", ""],
            ["", "", "", ""],
            ["", "", ""],
            ["", "", ""]];
        var add = [[0, 0, 0], [0, 0, 0, 0], [0, 0, 0], [0, 0, 0]];
        for (var i = 0; i < this.m_vecLines.length; i++) {
            var finded = false;
            for (var j = 0; j < lines.length; j++) {
                var v = this.FindLine(lines[j], this.m_vecLines[i].linkStart.userData, this.m_vecLines[i].linkEnd.userData);
                if (v) {
                    add[j][v.x]++;
                    add[j][v.y]++;
                    finded = true;
                    break;
                }
            }
            if (!finded)
                return;
        }
        for (var i = 0; i < add.length; i++) {
            var add2 = 0;
            for (var j = 0; j < add[i].length; j++) {
                if (add[i][j] == 0)
                    return;
                add2 += add[i][j];
            }
            if (add2 != add[i].length * 2 - 2)
                return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level70.prototype.FindLine = function (line, start, end) {
        var index1 = line.indexOf(start);
        var index2 = line.indexOf(end);
        if (index1 != -1 && index2 != -1)
            return new dVector2(index1, index2);
        return null;
    };
    Level70.prototype.CollectImage = function (x, y) {
        var pt = new dVector2(x, y);
        for (var i = 0; i < this.m_vecImages.length; i++) {
            if (pt.LengthTo(this.m_vecImages[i].GetPosVector2()) < this.m_vecImages[i].width / 2)
                return this.m_vecImages[i];
        }
        return null;
    };
    Level70.prototype.FindLineByLinkStartEnd = function (linkStart, linkEnd) {
        for (var i = 0; i < this.m_vecLines.length; i++)
            if (this.m_vecLines[i].linkStart == linkStart && this.m_vecLines[i].linkEnd == linkEnd ||
                this.m_vecLines[i].linkStart == linkEnd && this.m_vecLines[i].linkEnd == linkStart)
                return this.m_vecLines[i];
        return null;
    };
    return Level70;
}(LevelBase));
var GameLine70 = (function (_super) {
    __extends(GameLine70, _super);
    function GameLine70() {
        var _this = _super.call(this) || this;
        _this.linkStart = null;
        _this.linkEnd = null;
        return _this;
    }
    return GameLine70;
}(dLine));
var Level71 = (function (_super) {
    __extends(Level71, _super);
    function Level71() {
        var _this = _super.call(this) || this;
        _this.m_answer = [[1, 0, 3, 2], [3, 1, 0, 2], [0, 3, 2, 1], [2, 1, 0, 3]];
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level71.prototype._dscData = function () { return { "_child": [{ "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani1", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": -120, "y": -54, "z": -9.138526 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Ani2", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": -40, "y": -54, "z": -9.138526 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Ani3", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 40, "y": -54, "z": -9.138526 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Ani4", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 120, "y": -54, "z": -9.138526 }], "anchorU": 0, "anchorV": 0, "className": "AniLayer", "classType": "dSprite", "height": 0, "width": 0, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "NoSign", "classType": "dImage", "height": 78, "resourceFileName": "level/713.png", "width": 406, "x": 2, "y": -48 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Back", "classType": "dImage", "height": 349, "resourceFileName": "level/712.png", "width": 497, "x": 0, "y": -538 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "ButtonLeft", "classType": "dButton", "height": 88, "resourceFileName": "level/711.png", "width": 88, "x": -166, "y": -442 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "ButtonMiddle", "classType": "dButton", "height": 88, "resourceFileName": "level/711.png", "width": 88, "x": 0, "y": -442 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "ButtonRight", "classType": "dButton", "height": 88, "resourceFileName": "level/711.png", "width": 88, "x": 166, "y": -442 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 178, "resourceFileName": "level/714.png", "width": 1017, "x": 0, "y": -213 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dButton1", "classType": "dButton", "height": 0, "resourceFileName": "", "width": 0, "x": 0, "y": 0 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": -210, "y": 101 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": -70, "y": 101 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": 70, "y": 101 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": 210, "y": 101 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button5", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": -210, "y": 241 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button6", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": -70, "y": 241 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button7", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": 70, "y": 241 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button8", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": 210, "y": 241 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button9", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": -210, "y": 381 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button10", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": -70, "y": 381 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button11", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": 70, "y": 381 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button12", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": 210, "y": 381 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button13", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": -210, "y": 521 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button14", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": -70, "y": 521 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button15", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": 70, "y": 521 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 72, "resourceFileName": "level/716.png|level/717.png|level/718.png|level/719.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 48, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button16", "classType": "dButton", "height": 144, "resourceFileName": "level/719a.png", "width": 144, "x": 210, "y": 521 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level71.prototype.GetHintImageName = function () {
        return "level/719b.png";
    };
    Level71.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var buttons1 = [this.ButtonLeft, this.ButtonMiddle, this.ButtonRight];
        var buttons2 = [this.Button1, this.Button2, this.Button3, this.Button4, this.Button5,
            this.Button6, this.Button7, this.Button8, this.Button9, this.Button10, this.Button11,
            this.Button12, this.Button13, this.Button14, this.Button15, this.Button16];
        this.Back_AniLayer.visible = false;
        for (var i = 0; i < buttons1.length; i++) {
            var fun = function (i) {
                buttons1[i].userData = 0;
                buttons1[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons1[i].userData++;
                    CCActionManager.Instance().RemoveAllActionsFromTarget(buttons1[i]);
                    CCActionManager.Instance().AddAction(new CCRotateTo(0.1, buttons1[i].userData * 90), buttons1[i]);
                    _this.UpdateSignal();
                }));
            };
            fun(i);
        }
        for (var i = 0; i < buttons2.length; i++) {
            var fun = function (i) {
                buttons2[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons2[i].FindChild("Ani").spriteFrame++;
                    buttons2[i].FindChild("Ani").spriteFrame %= 4;
                    _this.CheckClear(buttons2);
                }));
            };
            fun(i);
        }
    };
    Level71.prototype.CheckClear = function (buttons) {
        for (var j = 0; j < 4; j++) {
            for (var i = 0; i < 4; i++) {
                if (buttons[j * 4 + i].FindChild("Ani").spriteFrame != this.m_answer[j][i])
                    return;
            }
        }
        this.m_pGameWorld.ShowClear();
    };
    Level71.prototype.UpdateSignal = function () {
        var a1 = this.ButtonLeft.userData % 4;
        var a2 = this.ButtonMiddle.userData % 4;
        var a3 = this.ButtonRight.userData % 4;
        if (a1 == 0 && a2 == 1 && a3 == 2) {
            this.ShowSignal(this.m_answer[0]);
        }
        else if (a1 == 3 && a2 == 2 && a3 == 0) {
            this.ShowSignal(this.m_answer[1]);
        }
        else if (a1 == 0 && a2 == 3 && a3 == 0) {
            this.ShowSignal(this.m_answer[2]);
        }
        else if (a1 == 2 && a2 == 0 && a3 == 1) {
            this.ShowSignal(this.m_answer[3]);
        }
        else {
            this.Back_AniLayer.visible = false;
            this.Back_NoSign.visible = true;
        }
    };
    Level71.prototype.ShowSignal = function (answer) {
        this.Back_AniLayer.visible = true;
        this.Back_NoSign.visible = false;
        this.Back_AniLayer_Ani1.spriteFrame = answer[0];
        this.Back_AniLayer_Ani2.spriteFrame = answer[1];
        this.Back_AniLayer_Ani3.spriteFrame = answer[2];
        this.Back_AniLayer_Ani4.spriteFrame = answer[3];
    };
    return Level71;
}(LevelBase));
var Level72 = (function (_super) {
    __extends(Level72, _super);
    function Level72() {
        var _this = _super.call(this) || this;
        _this.m_widthCount = 8;
        _this.m_heightCount = 4;
        _this.m_vecBlocks = null;
        _this.m_vTouchMoveAdd = new dVector2();
        _this.m_moving = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level72.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "BlockLayer", "classType": "dSprite", "height": 50, "width": 50, "x": -778, "y": -214 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 564, "resourceFileName": "level/729h.png", "width": 564, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "height": 564, "resourceFileName": "", "width": 564, "x": 0, "y": -21 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level72.prototype.GetHintImageName = function () {
        return "level/729i.png";
    };
    Level72.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.GameLayer_dImage2.SetTransparentMouse(true);
        this.m_vecBlocks = new Array(this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            this.m_vecBlocks[j] = Array(this.m_widthCount);
            for (var i = 0; i < this.m_widthCount; i++) {
                var fun = function (i, j) {
                    var pBlock = new TextBlock72();
                    pBlock.SetPos(i * TextBlock72.BlockWidthWithSpace, j * TextBlock72.BlockHeightWithSpace);
                    pBlock.blockX = i;
                    pBlock.blockY = j;
                    pBlock.SetHandleMouse(true);
                    _this.GameLayer_BlockLayer.AddChild(pBlock);
                    var pTouchEvent = new dSprite();
                    pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
                        _this.OnMove(pBlock, offx, offy);
                    };
                    pTouchEvent.OnTouchUp = function (x, y) {
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.OnUp(pBlock);
                    };
                    pBlock.SetTouchEvent(pTouchEvent);
                    _this.m_vecBlocks[j][i] = pBlock;
                };
                fun(i, j);
            }
        }
        var imgData = [["721", "722", "723", "724"],
            ["725", "726", "727", "728"],
            ["729", "729a", "729b", "729c"],
            ["729d", "729e", "729f", "729g"]];
        for (var j = 0; j < 4; j++) {
            for (var i = 0; i < 8; i++)
                this.m_vecBlocks[j][i].SetImage(imgData[j][i % 4]);
        }
        this.GameLayer.clipChild = true;
        this.OnMove(this.m_vecBlocks[0][0], -200, 0);
        this.OnUp(this.m_vecBlocks[0][0]);
        this.OnMove(this.m_vecBlocks[1][0], -782, 0);
        this.OnUp(this.m_vecBlocks[1][0]);
        this.OnMove(this.m_vecBlocks[2][0], 125, 0);
        this.OnUp(this.m_vecBlocks[2][0]);
        this.OnMove(this.m_vecBlocks[3][0], 435, 0);
        this.OnUp(this.m_vecBlocks[3][0]);
    };
    Level72.prototype.OnMove = function (pBlock, offx, offy) {
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var canHor = true;
        var canVer = false;
        if (canHor && !canVer) {
            for (var k = 0; k < this.m_widthCount; k++) {
                this.m_vecBlocks[j][k].positionX += offx;
                this.m_vecBlocks[j][k].positionX = (this.m_vecBlocks[j][k].positionX + this.m_widthCount * TextBlock72.BlockWidthWithSpace) % (this.m_widthCount * TextBlock72.BlockWidthWithSpace);
            }
        }
        else if (canVer && !canHor) {
            for (var k = 0; k < this.m_heightCount; k++) {
                this.m_vecBlocks[k][i].positionY += offy;
                this.m_vecBlocks[k][i].positionY = (this.m_vecBlocks[k][i].positionY + this.m_heightCount * TextBlock72.BlockHeightWithSpace) % (this.m_heightCount * TextBlock72.BlockHeightWithSpace);
            }
        }
    };
    Level72.prototype.GetText = function (i, j) {
        if (i < 0 || i >= this.m_widthCount || j < 0 || j >= this.m_heightCount)
            return 0;
        return this.m_vecBlocks[j][i].GetText();
    };
    Level72.prototype.OnUp = function (pBlock) {
        this.m_vTouchMoveAdd.SetValue(0, 0);
        var i = pBlock.blockX;
        var j = pBlock.blockY;
        var vecBlocks = new Array(this.m_widthCount * this.m_heightCount);
        for (var j = 0; j < this.m_heightCount; j++) {
            for (var i = 0; i < this.m_widthCount; i++) {
                vecBlocks[j * this.m_widthCount + i] = this.m_vecBlocks[j][i];
                this.m_vecBlocks[j][i] = null;
            }
        }
        for (var i = 0; i < vecBlocks.length; i++) {
            if (vecBlocks[i]) {
                var blockX = dMath.ToInt((vecBlocks[i].positionX + TextBlock72.BlockWidthWithSpace / 2) / TextBlock72.BlockWidthWithSpace) % this.m_widthCount;
                var blockY = dMath.ToInt((vecBlocks[i].positionY + TextBlock72.BlockHeightWithSpace / 2) / TextBlock72.BlockHeightWithSpace) % this.m_heightCount;
                vecBlocks[i].SetPos(blockX * TextBlock72.BlockWidthWithSpace, blockY * TextBlock72.BlockHeightWithSpace);
                this.m_vecBlocks[blockY][blockX] = vecBlocks[i];
                vecBlocks[i].blockX = blockX;
                vecBlocks[i].blockY = blockY;
            }
        }
        if (this.GetText(0, 0) == "721" && this.GetText(0, 1) == "725" && this.GetText(0, 2) == "729" && this.GetText(0, 3) == "729d")
            this.m_pGameWorld.ShowClear();
    };
    return Level72;
}(LevelBase));
var TextBlock72 = (function (_super) {
    __extends(TextBlock72, _super);
    function TextBlock72() {
        var _this = _super.call(this) || this;
        _this.m_nNum = 1;
        _this.blockX = 0;
        _this.blockY = 0;
        _this.m_image = new dImage();
        _this.m_strImage = "";
        _this.SetAnchor(0, 0);
        var p = new dSprite();
        p.SetSize(TextBlock72.BlockWidthWithSpace, TextBlock72.BlockHeightWithSpace);
        p.SetPos(-(TextBlock72.BlockWidthWithSpace - _this.width) / 2, -(TextBlock72.BlockHeightWithSpace - _this.height) / 2);
        _this.AddChild(p);
        _this.AddChild(_this.m_image);
        return _this;
    }
    TextBlock72.prototype.SetImage = function (str) {
        this.m_strImage = str;
        this.m_image.LoadFromFile("level/" + str + ".png");
    };
    TextBlock72.prototype.GetText = function () {
        return this.m_strImage;
    };
    TextBlock72.BlockWidth = 126;
    TextBlock72.BlockHeight = 126;
    TextBlock72.BlockWidthWithSpace = 142;
    TextBlock72.BlockHeightWithSpace = 142;
    return TextBlock72;
}(dSprite));
var Level73 = (function (_super) {
    __extends(Level73, _super);
    function Level73() {
        var _this = _super.call(this) || this;
        _this.m_input = [0, 0];
        _this.m_line = new dLine();
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level73.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0, "anchorV": 0, "className": "LineLayer", "classType": "dSprite", "height": 0, "width": 0, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Img", "classType": "dImage", "height": 739, "resourceFileName": "level/732.png", "width": 754, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dImage", "clipChild": 1, "height": 845, "resourceFileName": "level/731.png", "width": 845, "x": 0, "y": -316 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 81, "resourceFileName": "level/733.png", "width": 313, "x": -170, "y": 371 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum1", "classType": "dSprite", "height": 396, "width": 151, "x": 99, "y": 369 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum2", "classType": "dSprite", "height": 396, "width": 151, "x": 261, "y": 369 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level73.prototype.GetHintImageName = function () {
        return "level/735.png";
    };
    Level73.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var upButtons = [this.InputNum1_UpButton, this.InputNum2_UpButton];
        for (var i = 0; i < upButtons.length; i++) {
            var fun = function (i) {
                upButtons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_input[i]--;
                    if (_this.m_input[i] < 0)
                        _this.m_input[i] = 9;
                    _this.UpdateNumber();
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
        var downButtons = [this.InputNum1_DownButton, this.InputNum2_DownButton];
        for (var i = 0; i < downButtons.length; i++) {
            var fun = function (i) {
                downButtons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_input[i]++;
                    if (_this.m_input[i] > 9)
                        _this.m_input[i] = 0;
                    _this.UpdateNumber();
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
        this.SetHandleMouse(true);
        this.m_line.lineWidth = 50;
        this.GameLayer_LineLayer.AddChild(this.m_line);
        this.GameLayer_Img.SetTransparentMouse(true);
        this.UpdateNumber();
    };
    Level73.prototype.OnTouchDown = function (x, y, delta) {
        this.m_line.MoveTo(x - this.GameLayer.positionX, y - this.GameLayer.positionY);
    };
    Level73.prototype.OnTouchMove = function (x, y, offx, offy, delta) {
        this.m_line.LineTo(x - this.GameLayer.positionX, y - this.GameLayer.positionY);
        var dot = new dImage();
        dot.LoadFromFile("level/734.png");
        dot.SetTransparentMouse(true);
        dot.SetPos(x - this.GameLayer.positionX, y - this.GameLayer.positionY);
        this.m_line.AddChild(dot);
        this.PlayDrawSound();
    };
    Level73.prototype.UpdateNumber = function () {
        this.InputNum1_Text.text = this.NumToText(this.m_input[0]);
        this.InputNum2_Text.text = this.NumToText(this.m_input[1]);
    };
    Level73.prototype.NumToText = function (num) {
        switch (num) {
            case 0: return "";
            case 1: return "";
            case 2: return "";
            case 3: return "";
            case 4: return "";
            case 5: return "";
            case 6: return "";
            case 7: return "";
            case 8: return "";
            case 9: return "";
        }
        return "";
    };
    Level73.prototype.CheckClear = function () {
        if (this.m_input[0] == 3 && this.m_input[1] == 3)
            this.m_pGameWorld.ShowClear();
    };
    return Level73;
}(LevelBase));
var Level74 = (function (_super) {
    __extends(Level74, _super);
    function Level74() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level74.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 4, "resourceFileName": "level/743.png", "width": 588, "x": 0, "y": -538 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Light1", "classType": "dAnimationImage", "height": 93, "resourceFileName": "level/741.png|level/742.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 62, "x": -156, "y": -490 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Light2", "classType": "dAnimationImage", "height": 93, "resourceFileName": "level/741.png|level/742.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 62, "x": -52, "y": -490 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Light3", "classType": "dAnimationImage", "height": 93, "resourceFileName": "level/741.png|level/742.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 62, "x": 52, "y": -490 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Light4", "classType": "dAnimationImage", "height": 93, "resourceFileName": "level/741.png|level/742.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1", "width": 62, "x": 156, "y": -490 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 494, "resourceFileName": "level/744.png", "width": 878, "x": -3.057861, "y": -128 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 140, "resourceFileName": "level/745.png|level/746.png|level/747.png|level/748.png|level/749.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 140, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button1", "classType": "dButton", "height": 140, "resourceFileName": "", "width": 140, "x": -380, "y": 394 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 140, "resourceFileName": "level/745.png|level/746.png|level/747.png|level/748.png|level/749.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 140, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button2", "classType": "dButton", "height": 140, "resourceFileName": "", "width": 140, "x": -190, "y": 394 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 140, "resourceFileName": "level/745.png|level/746.png|level/747.png|level/748.png|level/749.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 140, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button3", "classType": "dButton", "height": 140, "resourceFileName": "", "width": 140, "x": 0, "y": 394 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 140, "resourceFileName": "level/745.png|level/746.png|level/747.png|level/748.png|level/749.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 140, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button4", "classType": "dButton", "height": 140, "resourceFileName": "", "width": 140, "x": 190, "y": 394 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Ani", "classType": "dAnimationImage", "height": 140, "resourceFileName": "level/745.png|level/746.png|level/747.png|level/748.png|level/749.png", "resourceOffsetsAndScale": "0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1", "width": 140, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Button5", "classType": "dButton", "height": 140, "resourceFileName": "", "width": 140, "x": 380, "y": 394 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level74.prototype.GetHintImageName = function () {
        return "level/749a.png";
    };
    Level74.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var lights = [this.Light1, this.Light2, this.Light3, this.Light4];
        var buttons = [this.Button1, this.Button2, this.Button3, this.Button4, this.Button5];
        var answer = [1, 4, 0, 2, 3];
        new dTimer(this).Create(1000, 0, function (sender, iTimer, fTimer) {
            _this.ShowLight(lights, iTimer % 6);
        });
        for (var i = 0; i < buttons.length; i++) {
            var fun = function (i) {
                buttons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    buttons[i].FindChild("Ani").spriteFrame++;
                    buttons[i].FindChild("Ani").spriteFrame %= 5;
                    _this.CheckClear(buttons, answer);
                }));
            };
            fun(i);
        }
    };
    Level74.prototype.CheckClear = function (buttons, answer) {
        for (var i = 0; i < buttons.length; i++)
            if (buttons[i].FindChild("Ani").spriteFrame != answer[i])
                return;
        this.m_pGameWorld.ShowClear();
    };
    Level74.prototype.ShowLight = function (lights, n) {
        var data = [
            [1, 1, 0, 1],
            [1, 0, 1, 0],
            [0, 1, 1, 0],
            [0, 0, 1, 1],
            [1, 0, 0, 1],
            [0, 0, 0, 0]
        ];
        for (var i = 0; i < lights.length; i++)
            lights[i].spriteFrame = data[n][i];
    };
    return Level74;
}(LevelBase));
var Level75 = (function (_super) {
    __extends(Level75, _super);
    function Level75() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level75.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 927, "resourceFileName": "level/751.png", "width": 731, "x": 0, "y": -330 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 185, "y": -634, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -215, "y": 194, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -15, "y": 194, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -215, "y": -361, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 185, "y": -361, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block6", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -15, "y": -75, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block7", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -315, "y": -634, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block8", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -215, "y": -634, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block9", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -115, "y": -634, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block10", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -15, "y": -634, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block11", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 85, "y": -634, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block12", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 285, "y": -634, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block13", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -315, "y": -361, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block14", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -115, "y": -361, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block15", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -15, "y": -361, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block16", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 85, "y": -361, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block17", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 285, "y": -361, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block18", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 185, "y": -75, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block19", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -315, "y": -75, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block20", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -215, "y": -75, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block21", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -115, "y": -75, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block22", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 85, "y": -75, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block23", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 285, "y": -75, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block24", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 185, "y": 194, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block25", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -315, "y": 194, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block26", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": -115, "y": 194, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block27", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 85, "y": 194, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block28", "classType": "dImage", "height": 93, "resourceFileName": "level/752.png", "width": 93, "x": 285, "y": 194, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 93, "resourceFileName": "level/757.png", "width": 93, "x": 226.002808, "y": 401, "z": 8.787048 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 93, "resourceFileName": "level/755.png", "width": 93, "x": -441.997192, "y": 401, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 93, "resourceFileName": "level/756.png", "width": 93, "x": -107.997192, "y": 401, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 93, "resourceFileName": "level/753.png", "width": 93, "x": 393.002808, "y": 451, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 93, "resourceFileName": "level/754.png", "width": 93, "x": 59.002808, "y": 451, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 93, "resourceFileName": "level/758.png", "width": 93, "x": -274.997192, "y": 451, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level75.prototype.GetHintImageName = function () {
        return "level/759.png";
    };
    Level75.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5, this.CanDrag6];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5, this.Block6, this.Block7, this.Block8, this.Block9, this.Block10,
            this.Block11, this.Block12, this.Block13, this.Block14, this.Block15, this.Block16, this.Block17, this.Block18, this.Block19, this.Block20,
            this.Block21, this.Block22, this.Block23, this.Block24, this.Block25, this.Block26, this.Block27, this.Block28];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level75.prototype.CheckClear = function (p) {
        var answer = "012345";
        for (var i = 0; i < answer.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level75.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level75.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level75;
}(LevelBase));
var Level76 = (function (_super) {
    __extends(Level76, _super);
    function Level76() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level76.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 154, "resourceFileName": "level/761.png", "width": 778, "x": 0, "y": -450 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -325, "y": -225, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -112, "y": -225, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 101, "y": -225, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 314, "y": -225, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 114, "resourceFileName": "level/764.png", "width": 131, "x": -78.997192, "y": 325, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 119, "resourceFileName": "level/765.png", "width": 116, "x": 87.002808, "y": 322, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 125, "resourceFileName": "level/762.png", "width": 106, "x": 253.002808, "y": 322, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 128, "resourceFileName": "level/763.png", "width": 130, "x": -244.997192, "y": 322, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level76.prototype.GetHintImageName = function () {
        return "level/766.png";
    };
    Level76.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level76.prototype.CheckClear = function (p) {
        var answer = "0123456789";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level76.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level76.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level76;
}(LevelBase));
var Level77 = (function (_super) {
    __extends(Level77, _super);
    function Level77() {
        var _this = _super.call(this) || this;
        _this.m_curTouchDownImage = null;
        _this.m_curTouchDownLine = null;
        _this.m_vecImages = null;
        _this.m_vecLines = new Array();
        _this.m_lineCrossed = false;
        _this.m_lastShowWrong = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level77.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage11", "classType": "dImage", "height": 239, "resourceFileName": "level/773.png", "width": 251, "x": 0, "y": -683 }, { "anchorU": 0, "anchorV": 0, "className": "LineLayer", "classType": "dSprite", "height": 0, "width": 0, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 111, "resourceFileName": "level/771.png", "width": 111, "x": -381, "y": 79 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 111, "resourceFileName": "level/772.png", "width": 111, "x": -235, "y": -228 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 111, "resourceFileName": "level/771.png", "width": 111, "x": 115, "y": -96 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage4", "classType": "dImage", "height": 111, "resourceFileName": "level/772.png", "width": 111, "x": 25, "y": -412 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage5", "classType": "dImage", "height": 111, "resourceFileName": "level/771.png", "width": 111, "x": 354, "y": -264 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage6", "classType": "dImage", "height": 111, "resourceFileName": "level/772.png", "width": 111, "x": 411, "y": 49 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage7", "classType": "dImage", "height": 111, "resourceFileName": "level/771.png", "width": 111, "x": -104, "y": 107 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage8", "classType": "dImage", "height": 111, "resourceFileName": "level/772.png", "width": 111, "x": 375, "y": 396 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage9", "classType": "dImage", "height": 111, "resourceFileName": "level/771.png", "width": 111, "x": 50, "y": 485 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage10", "classType": "dImage", "height": 111, "resourceFileName": "level/772.png", "width": 111, "x": -261, "y": 372 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "ClearButton", "classType": "dButton", "height": 107, "resourceFileName": "level/582.png", "width": 171, "x": 349, "y": -655 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level77.prototype.GetHintImageName = function () {
        return "level/774.png";
    };
    Level77.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.ClearButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_pGameWorld.Restart();
        }));
        this.m_vecImages = [this.dImage1, this.dImage2, this.dImage3, this.dImage4, this.dImage5, this.dImage6,
            this.dImage7, this.dImage8, this.dImage9, this.dImage10];
        this.dImage1.userData = 0;
        this.dImage2.userData = 1;
        this.dImage3.userData = 0;
        this.dImage4.userData = 1;
        this.dImage5.userData = 0;
        this.dImage6.userData = 1;
        this.dImage7.userData = 0;
        this.dImage8.userData = 1;
        this.dImage9.userData = 0;
        this.dImage10.userData = 1;
        this.SetHandleMouse(true);
    };
    Level77.prototype.OnTouchDown = function (x, y, delta) {
        var col = this.CollectImage(x, y);
        if (col) {
            if (this.GetLinkCount(col) < 2)
                this.SetStartImage(col);
        }
    };
    Level77.prototype.SetStartImage = function (col) {
        var _this = this;
        this.m_curTouchDownImage = col;
        var line = this.m_curTouchDownLine = new GameLine77();
        this.m_curTouchDownLine.linkStart = this.m_curTouchDownImage;
        this.m_curTouchDownLine.lineWidth = 20;
        this.LineLayer.AddChild(this.m_curTouchDownLine);
        this.m_curTouchDownLine.MoveTo(this.m_curTouchDownImage.positionX, this.m_curTouchDownImage.positionY);
        dSound.PlaySound("data/sound/button.mp3");
        this.m_curTouchDownLine.SetHandleMouse(true);
        var pTouchEvent = new dSprite();
        pTouchEvent.OnTouchDown = function (x, y, delta) {
            dSound.PlaySound("data/sound/button.mp3");
            _this.m_vecLines.remove(line);
            line.RemoveParent();
            _this.UpdateLineColor();
            _this.CheckClear();
        };
        this.m_curTouchDownLine.SetTouchEvent(pTouchEvent);
    };
    Level77.prototype.UpdateLineColor = function () {
        this.m_lineCrossed = false;
        if (this.m_curTouchDownLine)
            this.m_vecLines.push(this.m_curTouchDownLine);
        for (var i = 0; i < this.m_vecLines.length; i++)
            this.m_vecLines[i].spriteColor = 0xffffffff;
        for (var i = 0; i < this.m_vecLines.length; i++) {
            for (var j = 0; j < this.m_vecLines.length; j++) {
                if (i == j)
                    continue;
                if (this.m_vecLines[i].GetLineCount() == 0 || this.m_vecLines[j].GetLineCount() == 0)
                    continue;
                var x1 = this.m_vecLines[i].GetMoveToX();
                var y1 = this.m_vecLines[i].GetMoveToY();
                var x2 = this.m_vecLines[i].GetLineToX();
                var y2 = this.m_vecLines[i].GetLineToY();
                var x3 = this.m_vecLines[j].GetMoveToX();
                var y3 = this.m_vecLines[j].GetMoveToY();
                var x4 = this.m_vecLines[j].GetLineToX();
                var y4 = this.m_vecLines[j].GetLineToY();
                if (dMath.LineLineIntersection2D(x1, y1, x2, y2, x3, y3, x4, y4)) {
                    this.m_vecLines[i].spriteColor = 0xffff0000;
                    this.m_vecLines[j].spriteColor = 0xffff0000;
                    this.m_lineCrossed = true;
                }
            }
        }
        if (this.m_curTouchDownLine)
            this.m_vecLines.pop();
    };
    Level77.prototype.OnTouchMove = function (x, y, offx, offy, delta) {
        if (this.m_curTouchDownLine) {
            this.m_curTouchDownLine.SetLastPos(x, y);
            var col = this.CollectImage(x, y);
            if (col && col != this.m_curTouchDownImage && this.FindLineByLinkStartEnd(col, this.m_curTouchDownImage) == null) {
                if (this.m_curTouchDownImage.userData == col.userData) {
                    if (col != this.m_lastShowWrong) {
                        this.m_pGameWorld.ShowWrong(null, col);
                        this.m_lastShowWrong = col;
                    }
                }
                else {
                    if (this.GetLinkCount(col) < 2) {
                        var dir = col.GetPosVector2().Sub(this.m_curTouchDownImage.GetPosVector2());
                        dir.Normalize();
                        dir.MulAppendF(10);
                        this.m_curTouchDownLine.Clear();
                        this.m_curTouchDownLine.MoveTo(this.m_curTouchDownImage.positionX + dir.x, this.m_curTouchDownImage.positionY + dir.y);
                        this.m_curTouchDownLine.SetLastPos(col.positionX - dir.x, col.positionY - dir.y);
                        this.m_curTouchDownLine.linkEnd = col;
                        this.m_vecLines.push(this.m_curTouchDownLine);
                        this.SetStartImage(col);
                        this.CheckClear();
                        this.m_lastShowWrong = null;
                    }
                }
            }
            this.UpdateLineColor();
        }
    };
    Level77.prototype.OnTouchUp = function (x, y) {
        if (this.m_curTouchDownLine) {
            this.m_curTouchDownLine.RemoveParent();
            this.m_curTouchDownLine = null;
        }
        this.m_curTouchDownImage = null;
        this.UpdateLineColor();
        this.m_lastShowWrong = null;
    };
    Level77.prototype.CheckClear = function () {
        if (this.m_lineCrossed)
            return;
        var add = new Array();
        for (var i = 0; i < this.m_vecImages.length; i++)
            add.push(0);
        for (var i = 0; i < this.m_vecLines.length; i++) {
            var index1 = this.m_vecImages.indexOf(this.m_vecLines[i].linkStart);
            var index2 = this.m_vecImages.indexOf(this.m_vecLines[i].linkEnd);
            if (index1 != -1 && index2 != -1) {
                add[index1]++;
                add[index2]++;
            }
        }
        for (var i = 0; i < add.length; i++)
            if (add[i] != 2)
                return;
        this.m_pGameWorld.ShowClear();
    };
    Level77.prototype.GetLinkCount = function (col) {
        var ret = 0;
        for (var i = 0; i < this.m_vecLines.length; i++)
            if (this.m_vecLines[i].linkStart == col || this.m_vecLines[i].linkEnd == col)
                ret++;
        return ret;
    };
    Level77.prototype.FindLine = function (line, start, end) {
        var index1 = line.indexOf(start);
        var index2 = line.indexOf(end);
        if (index1 != -1 && index2 != -1)
            return new dVector2(index1, index2);
        return null;
    };
    Level77.prototype.CollectImage = function (x, y) {
        var pt = new dVector2(x, y);
        for (var i = 0; i < this.m_vecImages.length; i++) {
            if (pt.LengthTo(this.m_vecImages[i].GetPosVector2()) < this.m_vecImages[i].width / 2)
                return this.m_vecImages[i];
        }
        return null;
    };
    Level77.prototype.FindLineByLinkStartEnd = function (linkStart, linkEnd) {
        for (var i = 0; i < this.m_vecLines.length; i++)
            if (this.m_vecLines[i].linkStart == linkStart && this.m_vecLines[i].linkEnd == linkEnd ||
                this.m_vecLines[i].linkStart == linkEnd && this.m_vecLines[i].linkEnd == linkStart)
                return this.m_vecLines[i];
        return null;
    };
    return Level77;
}(LevelBase));
var GameLine77 = (function (_super) {
    __extends(GameLine77, _super);
    function GameLine77() {
        var _this = _super.call(this) || this;
        _this.linkStart = null;
        _this.linkEnd = null;
        return _this;
    }
    return GameLine77;
}(dLine));
var Level78 = (function (_super) {
    __extends(Level78, _super);
    function Level78() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level78.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": -411, "y": -481 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": -247, "y": -481 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": -82, "y": -481 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": 82, "y": -481 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": 247, "y": -481 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block6", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": 411, "y": -481 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block7", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": -411, "y": -316 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block8", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": -247, "y": -316 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block9", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": -82, "y": -316 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block10", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": 82, "y": -316 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block11", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": 247, "y": -316 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block12", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": 411, "y": -316 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block13", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": -411, "y": -150 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block14", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": -247, "y": -150 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block15", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": -82, "y": -150 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block16", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": 82, "y": -150 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block17", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": 247, "y": -150 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block18", "classType": "dImage", "height": 169, "resourceFileName": "level/782.png", "width": 169, "x": 411, "y": -150 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 137, "resourceFileName": "level/781.png", "width": 137, "x": -293.997192, "y": 92, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 137, "resourceFileName": "level/781.png", "width": 137, "x": -110.997192, "y": 92, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 137, "resourceFileName": "level/781.png", "width": 137, "x": 72.002808, "y": 92, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 137, "resourceFileName": "level/781.png", "width": 137, "x": 255.002808, "y": 92, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 137, "resourceFileName": "level/781.png", "width": 137, "x": 438.002808, "y": 92, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag6", "classType": "dImage", "height": 137, "resourceFileName": "level/781.png", "width": 137, "x": -390.997192, "y": 260, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag7", "classType": "dImage", "height": 137, "resourceFileName": "level/781.png", "width": 137, "x": -207.997192, "y": 260, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag8", "classType": "dImage", "height": 137, "resourceFileName": "level/781.png", "width": 137, "x": -24.997192, "y": 260, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag9", "classType": "dImage", "height": 137, "resourceFileName": "level/781.png", "width": 137, "x": 158.002808, "y": 260, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag10", "classType": "dImage", "height": 137, "resourceFileName": "level/781.png", "width": 137, "x": 341.002808, "y": 260, "z": 3.224545 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 30, "height": 30, "resourceFileName": "data/fontNumber.json", "text": "2", "width": 16.875, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Label1", "classType": "dImage", "height": 36, "resourceFileName": "level/783.png", "width": 72, "x": -166, "y": -424 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 30, "height": 30, "resourceFileName": "data/fontNumber.json", "text": "1", "width": 10.78125, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Label2", "classType": "dImage", "height": 36, "resourceFileName": "level/783.png", "width": 72, "x": 329, "y": -424 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 30, "height": 30, "resourceFileName": "data/fontNumber.json", "text": "1", "width": 10.78125, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Label3", "classType": "dImage", "height": 36, "resourceFileName": "level/783.png", "width": 72, "x": -330, "y": -264 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 30, "height": 30, "resourceFileName": "data/fontNumber.json", "text": "2", "width": 16.875, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Label4", "classType": "dImage", "height": 36, "resourceFileName": "level/783.png", "width": 72, "x": 164, "y": -264 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 30, "height": 30, "resourceFileName": "data/fontNumber.json", "text": "1", "width": 10.78125, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Label5", "classType": "dImage", "height": 36, "resourceFileName": "level/783.png", "width": 72, "x": 329, "y": -264 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 30, "height": 30, "resourceFileName": "data/fontNumber.json", "text": "2", "width": 16.875, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Label6", "classType": "dImage", "height": 36, "resourceFileName": "level/783.png", "width": 72, "x": -164, "y": -100 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 30, "height": 30, "resourceFileName": "data/fontNumber.json", "text": "2", "width": 16.875, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Label7", "classType": "dImage", "height": 36, "resourceFileName": "level/783.png", "width": 72, "x": 0, "y": -100 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 30, "height": 30, "resourceFileName": "data/fontNumber.json", "text": "1", "width": 10.78125, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Label8", "classType": "dImage", "height": 36, "resourceFileName": "level/783.png", "width": 72, "x": 163, "y": -100 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Number", "classType": "dBitmapFont", "fontSize": 30, "height": 30, "resourceFileName": "data/fontNumber.json", "text": "1", "width": 10.78125, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Label9", "classType": "dImage", "height": 36, "resourceFileName": "level/783.png", "width": 72, "x": 327, "y": -100 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level78.prototype.GetHintImageName = function () {
        return "level/784.png";
    };
    Level78.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5, this.CanDrag6, this.CanDrag7, this.CanDrag8, this.CanDrag9, this.CanDrag10];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5, this.Block6, this.Block7, this.Block8, this.Block9, this.Block10,
            this.Block11, this.Block12, this.Block13, this.Block14, this.Block15, this.Block16, this.Block17, this.Block18];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.UpdateNumber();
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
        this.UpdateNumber();
    };
    Level78.prototype.CheckClear = function (p) {
        var labels = [this.Label1_Number, this.Label2_Number, this.Label3_Number, this.Label4_Number, this.Label5_Number, this.Label6_Number,
            this.Label7_Number, this.Label8_Number, this.Label9_Number];
        for (var i = 0; i < labels.length; i++)
            if (labels[i].spriteColor == 0xffffffff)
                return;
        this.m_pGameWorld.ShowClear();
    };
    Level78.prototype.UpdateNumber = function () {
        var a1 = 0xff00ff00;
        var a2 = 0xffffffff;
        this.Label1_Number.spriteColor = this.GetBlockCardCount(this.Block2, this.Block3) == 2 ? a1 : a2;
        this.Label2_Number.spriteColor = this.GetBlockCardCount(this.Block5, this.Block6) == 1 ? a1 : a2;
        this.Label3_Number.spriteColor = this.GetBlockCardCount(this.Block7, this.Block8) == 1 ? a1 : a2;
        this.Label4_Number.spriteColor = this.GetBlockCardCount(this.Block10, this.Block11) == 2 ? a1 : a2;
        this.Label5_Number.spriteColor = this.GetBlockCardCount(this.Block11, this.Block12) == 1 ? a1 : a2;
        this.Label6_Number.spriteColor = this.GetBlockCardCount(this.Block14, this.Block15) == 2 ? a1 : a2;
        this.Label7_Number.spriteColor = this.GetBlockCardCount(this.Block15, this.Block16) == 2 ? a1 : a2;
        this.Label8_Number.spriteColor = this.GetBlockCardCount(this.Block16, this.Block17) == 1 ? a1 : a2;
        this.Label9_Number.spriteColor = this.GetBlockCardCount(this.Block17, this.Block18) == 1 ? a1 : a2;
    };
    Level78.prototype.GetBlockCardCount = function (block1, block2) {
        var ret = 0;
        if (this.FindCardByPos(block1.positionX, block1.positionY))
            ret++;
        if (this.FindCardByPos(block2.positionX, block2.positionY))
            ret++;
        return ret;
    };
    Level78.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level78.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level78;
}(LevelBase));
var Level79 = (function (_super) {
    __extends(Level79, _super);
    function Level79() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level79.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 184, "resourceFileName": "level/791.png", "width": 790, "x": 0, "y": -450 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -333, "y": -224, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -113, "y": -224, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 107, "y": -224, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 327, "y": -224, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 131, "resourceFileName": "level/794.png", "width": 131, "x": 301.002808, "y": 163, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 114, "resourceFileName": "level/795.png", "width": 123, "x": 109.002808, "y": 163, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 128, "resourceFileName": "level/792.png", "width": 122, "x": -274.997192, "y": 163, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 129, "resourceFileName": "level/793.png", "width": 120, "x": -82.997192, "y": 163, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level79.prototype.GetHintImageName = function () {
        return "level/796.png";
    };
    Level79.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level79.prototype.CheckClear = function (p) {
        var answer = "0123456789";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level79.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level79.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level79;
}(LevelBase));
var Level8 = (function (_super) {
    __extends(Level8, _super);
    function Level8() {
        var _this = _super.call(this) || this;
        _this.m_buttons = null;
        _this.m_rotating = false;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level8.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "GameLayer", "classType": "dSprite", "height": 1000, "width": 1000, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level8.prototype.GetHintImageName = function () {
        return "level/80.png";
    };
    Level8.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var hCount = [3, 4, 5, 4, 3];
        this.m_buttons = new Array(5);
        for (var j = 0; j < 5; j++) {
            this.m_buttons[j] = new Array(5);
            var start = dMath.ToInt((5 - hCount[j]) / 2);
            var end = start + hCount[j];
            for (var i = 0; i < 5; i++) {
                var round = null;
                if (i >= start && i < end) {
                    round = new RoundButton1();
                    this.GameLayer.AddChild(round);
                    round.SetBlockPos(i, j);
                    round.SetEvent(new dEvent().SetOnButtonDown(function (sender) {
                        if (!_this.m_rotating) {
                            dSound.PlaySound("data/sound/button.mp3");
                            _this.RotateButton(sender);
                        }
                    }));
                }
                this.m_buttons[j][i] = round;
            }
        }
        this.m_buttons[1][1].SetId(1);
        this.m_buttons[1][2].SetId(2);
        this.m_buttons[3][1].SetId(4);
        this.m_buttons[3][2].SetId(3);
        var hints = new Array(4);
        for (var i = 0; i < hints.length; i++) {
            hints[i] = new dImage();
            hints[i].LoadFromFile("level/" + (i + 81) + ".png");
            this.GameLayer.AddChild(hints[i], 0);
        }
        hints[0].SetPos(this.m_buttons[0][2].positionX, this.m_buttons[0][2].positionY - 100);
        hints[1].SetPos(this.m_buttons[4][2].positionX, this.m_buttons[4][2].positionY + 100);
        hints[2].SetPos(this.m_buttons[2][0].positionX - 100, this.m_buttons[2][0].positionY);
        hints[3].SetPos(this.m_buttons[2][4].positionX + 100, this.m_buttons[2][4].positionY);
    };
    Level8.prototype.RotateButton = function (round) {
        var _this = this;
        var x = round.m_blockX;
        var y = round.m_blockY;
        var neiboers = null;
        if (y % 2 == 0)
            neiboers = [this.GetButton(x - 1, y), this.GetButton(x - 1, y - 1), this.GetButton(x, y - 1), this.GetButton(x + 1, y), this.GetButton(x, y + 1), this.GetButton(x - 1, y + 1)];
        else
            neiboers = [this.GetButton(x - 1, y), this.GetButton(x, y - 1), this.GetButton(x + 1, y - 1), this.GetButton(x + 1, y), this.GetButton(x + 1, y + 1), this.GetButton(x, y + 1)];
        var hasEmpty = false;
        for (var i = 0; i < neiboers.length; i++) {
            if (!neiboers[i]) {
                hasEmpty = true;
                break;
            }
        }
        for (var i = 0; i < neiboers.length; i++) {
            if (neiboers[i]) {
                neiboers[i].positionX -= round.positionX;
                neiboers[i].positionY -= round.positionY;
                round.AddChild(neiboers[i]);
            }
        }
        this.m_rotating = true;
        if (hasEmpty) {
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCRotateBy(0.1, 5),
                new CCRotateBy(0.1, -5),
                new CCCallFunc(function () {
                    for (var i = 0; i < neiboers.length; i++) {
                        if (neiboers[i]) {
                            neiboers[i].SetBlockPos(neiboers[i].m_blockX, neiboers[i].m_blockY);
                            _this.GameLayer.AddChild(neiboers[i]);
                        }
                    }
                    round.rotation = 0;
                    _this.m_rotating = false;
                })
            ]), round);
        }
        else {
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCRotateBy(0.3, 60),
                new CCCallFunc(function () {
                    var blockPosSave = new Array();
                    for (var i = 0; i < neiboers.length; i++)
                        blockPosSave.push(new dVector2(neiboers[i].m_blockX, neiboers[i].m_blockY));
                    for (var i = 0; i < neiboers.length; i++) {
                        if (neiboers[i]) {
                            neiboers[i].SetBlockPos(blockPosSave[(i + 1) % neiboers.length].x, blockPosSave[(i + 1) % neiboers.length].y);
                            _this.m_buttons[neiboers[i].m_blockY][neiboers[i].m_blockX] = neiboers[i];
                            _this.GameLayer.AddChild(neiboers[i]);
                        }
                    }
                    round.rotation = 0;
                    _this.m_rotating = false;
                    for (var i = 0; i < neiboers.length; i++) {
                        if (neiboers[i] && neiboers[i].m_image)
                            neiboers[i].m_image.rotation = 0;
                    }
                    _this.CheckClear();
                })
            ]), round);
        }
    };
    Level8.prototype.CheckClear = function () {
        if (this.m_buttons[0][2].GetId() == 1 &&
            this.m_buttons[4][2].GetId() == 2 &&
            this.m_buttons[2][0].GetId() == 3 &&
            this.m_buttons[2][4].GetId() == 4)
            this.m_pGameWorld.ShowClear();
    };
    Level8.prototype.GetButton = function (blockX, blockY) {
        if (blockX >= 0 && blockY >= 0 && blockY < this.m_buttons.length && blockX < this.m_buttons[blockY].length)
            return this.m_buttons[blockY][blockX];
        return null;
    };
    return Level8;
}(LevelBase));
var RoundButton1 = (function (_super) {
    __extends(RoundButton1, _super);
    function RoundButton1() {
        var _this = _super.call(this) || this;
        _this.m_image = null;
        _this.m_id = 0;
        _this.m_blockX = 0;
        _this.m_blockY = 0;
        _this.LoadFromFile("level/85.png");
        _this.SetSize(RoundButton1.SIZE, RoundButton1.SIZE);
        _this.touchDownScaleMode = false;
        return _this;
    }
    RoundButton1.prototype.SetBlockPos = function (x, y) {
        this.m_blockX = x;
        this.m_blockY = y;
        var totalSize = 4 * RoundButton1.SIZE_WITH_SPACE;
        var yy = new dVector2().FromAngle(150).y;
        var xx = 0;
        if (y % 2 != 0)
            xx = RoundButton1.SIZE_WITH_SPACE / 2;
        this.SetPos(x * RoundButton1.SIZE_WITH_SPACE + xx - totalSize / 2, y * yy * RoundButton1.SIZE_WITH_SPACE - yy * totalSize / 2);
    };
    RoundButton1.prototype.SetId = function (id) {
        this.m_id = id;
        if (id != 0) {
            this.m_image = new dImage();
            this.m_image.LoadFromFile("level/" + (id + 85) + ".png");
        }
        if (this.m_image)
            this.AddChild(this.m_image);
    };
    RoundButton1.prototype.GetId = function () {
        return this.m_id;
    };
    RoundButton1.prototype.SetRotation = function (angle) {
        _super.prototype.SetRotation.call(this, angle);
        if (this.m_image)
            this.m_image.rotation = -angle;
        var vec = this.GetChildList();
        for (var i = 0; i < vec.length; i++) {
            if (vec[i] instanceof RoundButton1 && vec[i].m_image)
                vec[i].m_image.rotation = -angle;
        }
    };
    RoundButton1.SIZE = 141;
    RoundButton1.SIZE_WITH_SPACE = 141 + 36;
    return RoundButton1;
}(dButton));
var Level80 = (function (_super) {
    __extends(Level80, _super);
    function Level80() {
        var _this = _super.call(this) || this;
        _this.m_input = [5, 5];
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level80.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 1046, "resourceFileName": "level/801.png", "width": 697, "x": 0, "y": -95 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum1", "classType": "dSprite", "height": 396, "width": 151, "x": 120, "y": 386 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage3", "classType": "dImage", "height": 128, "resourceFileName": "level/613.png", "width": 128, "x": -1, "y": 2 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 100, "height": 100, "resourceFileName": "data/zi.json", "text": "", "width": 100, "x": 3, "y": -13 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "UpButton", "classType": "dButton", "height": 69, "resourceFileName": "level/241.png", "width": 86, "x": 1, "y": -154 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "DownButton", "classType": "dButton", "height": 69, "resourceFileName": "level/242.png", "width": 86, "x": 1, "y": 151 }], "anchorU": 0.5, "anchorV": 0.5, "className": "InputNum2", "classType": "dSprite", "height": 396, "width": 151, "x": 282, "y": 386 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level80.prototype.GetHintImageName = function () {
        return "level/802.png";
    };
    Level80.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        var upButtons = [this.InputNum1_UpButton, this.InputNum2_UpButton];
        for (var i = 0; i < upButtons.length; i++) {
            var fun = function (i) {
                upButtons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_input[i]--;
                    if (_this.m_input[i] < 0)
                        _this.m_input[i] = 9;
                    _this.UpdateNumber();
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
        var downButtons = [this.InputNum1_DownButton, this.InputNum2_DownButton];
        for (var i = 0; i < downButtons.length; i++) {
            var fun = function (i) {
                downButtons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    _this.m_input[i]++;
                    if (_this.m_input[i] > 9)
                        _this.m_input[i] = 0;
                    _this.UpdateNumber();
                    _this.CheckClear();
                }));
            };
            fun(i);
        }
        this.UpdateNumber();
    };
    Level80.prototype.UpdateNumber = function () {
        this.InputNum1_Text.text = this.NumToText(this.m_input[0]);
        this.InputNum2_Text.text = this.NumToText(this.m_input[1]);
    };
    Level80.prototype.NumToText = function (num) {
        switch (num) {
            case 0: return "";
            case 1: return "";
            case 2: return "";
            case 3: return "";
            case 4: return "";
            case 5: return "";
            case 6: return "";
            case 7: return "";
            case 8: return "";
            case 9: return "";
        }
        return "";
    };
    Level80.prototype.CheckClear = function () {
        if (this.m_input[0] == 2 && this.m_input[1] == 3)
            this.m_pGameWorld.ShowClear();
    };
    return Level80;
}(LevelBase));
var Level9 = (function (_super) {
    __extends(Level9, _super);
    function Level9() {
        var _this = _super.call(this) || this;
        _this.m_cards = null;
        _this.m_blocks = null;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    Level9.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 575, "resourceFileName": "level/91.png", "width": 649, "x": 0, "y": -364 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block1", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -406, "y": 119, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block2", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": -203, "y": 119, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block3", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 0, "y": 119, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block4", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 203, "y": 119, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Block5", "classType": "dImage", "height": 179, "resourceFileName": "level/32.png", "width": 179, "x": 406, "y": 119, "z": 6.247593 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag5", "classType": "dImage", "height": 145, "resourceFileName": "level/96.png", "width": 144, "x": 180.002808, "y": 429, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag3", "classType": "dImage", "height": 118, "resourceFileName": "level/94.png", "width": 143, "x": -326.997192, "y": 429, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag4", "classType": "dImage", "height": 142, "resourceFileName": "level/95.png", "width": 144, "x": -157.997192, "y": 429, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag1", "classType": "dImage", "height": 155, "resourceFileName": "level/92.png", "width": 138, "x": 349.002808, "y": 429, "z": 3.224545 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CanDrag2", "classType": "dImage", "height": 138, "resourceFileName": "level/93.png", "width": 106, "x": 11.002808, "y": 429, "z": 3.224545 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dImage", "height": 1600, "pureColor": 1, "spriteColor": -12171706, "width": 1080, "x": 0, "y": 0 }; };
    Level9.prototype.GetHintImageName = function () {
        return "level/97.png";
    };
    Level9.prototype.Init = function (gameWorld) {
        var _this = this;
        _super.prototype.Init.call(this, gameWorld);
        this.m_cards = [this.CanDrag1, this.CanDrag2, this.CanDrag3,
            this.CanDrag4, this.CanDrag5];
        this.m_blocks = [this.Block1, this.Block2, this.Block3, this.Block4, this.Block5];
        for (var i = 0; i < this.m_cards.length; i++) {
            this.m_cards[i].userData["Num"] = i;
            var fun = function (i) {
                _this.m_cards[i].userData["CanDrag"].onTouchDown = function () {
                    _this.AddChild(_this.m_cards[i]);
                };
                _this.m_cards[i].userData["CanDrag"].onTouchUp = function (canDrag) {
                    var block = _this.FindNearBlock(_this.m_cards[i]);
                    if (block != null) {
                        var oldCard = _this.FindCardByPos(block.positionX, block.positionY);
                        if (oldCard)
                            oldCard.SetPos(canDrag.m_dragStartPos.x, canDrag.m_dragStartPos.y);
                        dSound.PlaySound("data/sound/button.mp3");
                        _this.m_cards[i].SetPos(block.positionX, block.positionY);
                        _this.CheckClear(_this.m_cards[i]);
                    }
                };
            };
            fun(i);
        }
    };
    Level9.prototype.CheckClear = function (p) {
        var answer = "01234";
        for (var i = 0; i < this.m_blocks.length; i++) {
            var card = this.FindCardByPos(this.m_blocks[i].positionX, this.m_blocks[i].positionY);
            if (card) {
                if (card.userData["Num"] == Number(answer.charAt(i)))
                    continue;
            }
            return;
        }
        this.m_pGameWorld.ShowClear();
    };
    Level9.prototype.FindNearBlock = function (card) {
        var block = null;
        var len = 0;
        for (var i = 0; i < this.m_blocks.length; i++) {
            var len2 = this.m_blocks[i].GetPosVector2().LengthTo(card.GetPosVector2());
            if (block == null || len2 < len) {
                len = len2;
                block = this.m_blocks[i];
            }
        }
        if (this.isCollectSprite(block, card))
            return block;
        return null;
    };
    Level9.prototype.FindCardByPos = function (x, y) {
        for (var i = 0; i < this.m_cards.length; i++) {
            if (this.m_cards[i].positionX == x && this.m_cards[i].positionY == y)
                return this.m_cards[i];
        }
        return null;
    };
    return Level9;
}(LevelBase));
var AddEnergyPanel = (function (_super) {
    __extends(AddEnergyPanel, _super);
    function AddEnergyPanel(onAddEnergyClose) {
        if (onAddEnergyClose === void 0) { onAddEnergyClose = null; }
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.SetHandleMouse(true);
        _this.Window_CloseButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().ClosePanel(null, _this);
            if (onAddEnergyClose)
                onAddEnergyClose(_this);
        }));
        _this.Window_CloseButton2.SetEvent(_this.Window_CloseButton.GetEvent());
        _this.Window_AddButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            MyAd.ShowAdRewardedVideoTrace("AddEnergy", function () {
                PageManager.Instance().ClosePanel(null, _this, null, false);
                SaveData.Instance().energy += 5;
                SaveData.Instance().WriteToDisk();
                PageManager.Instance().UpdateCurPage();
            });
        }));
        return _this;
    }
    AddEnergyPanel.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 120, "resourceFileName": "data/energyicon.png", "scaleX": 1.5, "scaleY": 1.5, "width": 72, "x": 0, "y": -90 }, { "align": 0, "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 48, "height": 56.25, "resourceFileName": "data/font64.json", "spriteColor": -12632257, "text": "+5", "width": 386.25, "x": 0, "y": 94 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 40, "height": 46.875, "resourceFileName": "data/font64.json", "spriteColor": -12632257, "text": "", "width": 160, "x": 32, "y": -9 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "AdIcon", "classType": "dImage", "height": 46, "resourceFileName": "data/adicon.png", "spriteColor": -12632257, "width": 66, "x": -88, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "AddButton", "classType": "dButtonScale9", "height": 116, "resourceFileName": "data/button1.png", "width": 300, "x": -200, "y": 236.5 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton", "classType": "dButton", "height": 109, "resourceFileName": "data/closebutton.png", "width": 109, "x": 425, "y": -367 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 40, "height": 45.625, "resourceFileName": "data/font64.json", "spriteColor": -12632257, "text": "", "width": 80, "x": 0, "y": -9 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton2", "classType": "dButtonScale9", "height": 116, "resourceFileName": "data/button1.png", "width": 300, "x": 200, "y": 236.5 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "TitleText", "classType": "dBitmapFont", "fontSize": 64, "height": 72, "resourceFileName": "data/font64.json", "spriteColor": -1476488, "text": "", "width": 192, "x": 0, "y": 50 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Title", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 590, "x": 0, "y": -367.5 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Window", "classType": "dScale9", "height": 800, "resourceFileName": "data/window.png", "width": 900, "x": 550, "y": 936.5 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "MyAdBanner", "classType": "MyAdBanner", "height": 200, "layoutAlignV": 2, "width": 1080, "x": 540, "y": 1820 }], "anchorU": 0, "anchorV": 0, "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": -2147483648, "width": 1080, "x": 0, "y": 0 }; };
    return AddEnergyPanel;
}(dImage));
var AddKeyPanel = (function (_super) {
    __extends(AddKeyPanel, _super);
    function AddKeyPanel() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.SetHandleMouse(true);
        _this.Window_CloseButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().ClosePanel(null, _this);
        }));
        _this.Window_CloseButton2.SetEvent(_this.Window_CloseButton.GetEvent());
        _this.Window_AddButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            MyAd.ShowAdRewardedVideoTrace("AddKey", function () {
                PageManager.Instance().ClosePanel(null, _this, null, false);
                SaveData.Instance().WriteToDisk();
                PageManager.Instance().UpdateCurPage();
            });
        }));
        return _this;
    }
    AddKeyPanel.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 96, "resourceFileName": "", "scaleX": 1.5, "scaleY": 1.5, "width": 72, "x": 0, "y": -90 }, { "align": 0, "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 48, "height": 56.25, "resourceFileName": "data/font64.json", "spriteColor": -12632257, "text": "+1", "width": 385.5, "x": 0, "y": 94 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 40, "height": 46.875, "resourceFileName": "data/font64.json", "spriteColor": -12632257, "text": "", "width": 160, "x": 32, "y": -5 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "AdIcon", "classType": "dImage", "height": 46, "resourceFileName": "data/adicon.png", "spriteColor": -12632257, "width": 66, "x": -88, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "AddButton", "classType": "dButtonScale9", "height": 116, "resourceFileName": "data/button1.png", "width": 300, "x": -200, "y": 236.5 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton", "classType": "dButton", "height": 109, "resourceFileName": "data/closebutton.png", "width": 109, "x": 425, "y": -367 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 40, "height": 45.625, "resourceFileName": "data/font64.json", "spriteColor": -12632257, "text": "", "width": 80, "x": 0, "y": -5 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton2", "classType": "dButtonScale9", "height": 116, "resourceFileName": "data/button1.png", "width": 300, "x": 200, "y": 236.5 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "TitleText", "classType": "dBitmapFont", "fontSize": 64, "height": 73, "resourceFileName": "data/font64.json", "spriteColor": -1476488, "text": "", "width": 192, "x": 0, "y": 41 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Title", "classType": "dImage", "height": 144, "resourceFileName": "", "width": 590, "x": 0, "y": -367.5 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Window", "classType": "dScale9", "height": 800, "resourceFileName": "data/window.png", "width": 900, "x": 550, "y": 936.5 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "MyAdBanner", "classType": "MyAdBanner", "height": 200, "layoutAlignV": 2, "width": 1080, "x": 540, "y": 1820 }], "anchorU": 0, "anchorV": 0, "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": -2147483648, "width": 1080, "x": 0, "y": 0 }; };
    return AddKeyPanel;
}(dImage));
var HintPanel = (function (_super) {
    __extends(HintPanel, _super);
    function HintPanel(hintText, imgName, gameWorld) {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.SetHandleMouse(true);
        if (gameWorld.m_bHinted) {
            _this.Window_Panel_Text.text = hintText;
            if (imgName) {
                _this.Window_Panel_HintBack_Image.LoadFromFile(imgName, function () {
                    var scaleX = 820 / _this.Window_Panel_HintBack_Image.width;
                    var scaleY = 820 / _this.Window_Panel_HintBack_Image.height;
                    if (scaleX > 1)
                        scaleX = 1;
                    if (scaleY > 1)
                        scaleY = 1;
                    var scale = dMath.Min(scaleX, scaleY);
                    _this.Window_Panel_HintBack_Image.SetScale(scale, scale);
                });
            }
            _this.Window_Panel_SkipButton.visible = true;
            _this.Window_Panel_ShowButton.visible = false;
        }
        else {
            _this.Window_Panel_SkipButton.visible = false;
            _this.Window_Panel_ShowButton.visible = true;
        }
        _this.Window_Panel_CloseButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/window.mp3");
            PageManager.Instance().ClosePanel(null, _this);
        }));
        _this.Window_Panel_CloseButton2.SetEvent(_this.Window_Panel_CloseButton.GetEvent());
        _this.Window_Panel_ShowButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            MyAd.ShowAdRewardedVideoTrace("Hint" + gameWorld.GetStageData().stage, function () {
                _this.Window_Panel_Text.text = hintText;
                gameWorld.m_bHinted = true;
                _this.Window_Panel_SkipButton.visible = true;
                if (imgName) {
                    _this.Window_Panel_HintBack_Image.LoadFromFile(imgName, function () {
                        var scaleX = 820 / _this.Window_Panel_HintBack_Image.width;
                        var scaleY = 820 / _this.Window_Panel_HintBack_Image.height;
                        if (scaleX > 1)
                            scaleX = 1;
                        if (scaleY > 1)
                            scaleY = 1;
                        var scale = dMath.Min(scaleX, scaleY);
                        _this.Window_Panel_HintBack_Image.SetScale(scale, scale);
                    });
                }
            });
        }));
        _this.Window_Panel_SkipButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            MyAd.ShowAdRewardedVideoTrace("Skip" + gameWorld.GetStageData().stage, function () {
                var stageData = gameWorld.GetStageData();
                if (SaveData.Instance().passStage < stageData.stage) {
                    SaveData.Instance().passStage = stageData.stage;
                    SaveData.Instance().WriteToDisk();
                }
                stageData.stage++;
                PageManager.Instance().ClosePanel(null, _this, null, false);
                PageManager.Instance().ChangePage(GamePage, stageData);
            });
        }));
        return _this;
    }
    HintPanel.prototype._dscData = function () { return { "_child": [{ "_child": [{ "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 0, "resourceFileName": "", "width": 0, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "HintBack", "classType": "dImage", "height": 899, "resourceFileName": "data/hintback.png", "spriteColor": -12171706, "width": 870, "x": 0, "y": -23 }, { "align": 0, "anchorU": 0.5, "anchorV": 0.5, "autoWrap": 1, "className": "Text", "classType": "dBitmapFont", "fontSize": 52, "height": 62.5625, "resourceFileName": "data/font64.json", "text": "", "width": 762, "x": 0.002197, "y": -28.386963, "z": -0.856064 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton", "classType": "dButton", "height": 109, "resourceFileName": "data/closebutton.png", "width": 109, "x": 427, "y": -595 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 40, "height": 45.625, "resourceFileName": "data/font64.json", "spriteColor": -16777216, "text": "", "width": 80, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton2", "classType": "dButtonScale9", "height": 116, "resourceFileName": "data/button1.png", "width": 300, "x": 200, "y": 495.5 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "TitleText", "classType": "dBitmapFont", "fontSize": 64, "height": 75, "resourceFileName": "data/font64.json", "spriteColor": -1476488, "text": "", "width": 128, "x": 0, "y": -569 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 40, "height": 47.5, "resourceFileName": "data/font64.json", "spriteColor": -16777216, "text": "", "width": 160, "x": 25, "y": -11 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "AdIcon", "classType": "dImage", "height": 46, "resourceFileName": "data/adicon.png", "scaleX": 0.782609, "scaleY": 0.782609, "spriteColor": -16777216, "width": 66, "x": -84.17392, "y": -8 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ShowButton", "classType": "dButtonScale9", "height": 116, "resourceFileName": "data/button1.png", "width": 300, "x": -200, "y": 495.5 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 40, "height": 45.625, "resourceFileName": "data/font64.json", "spriteColor": -16777216, "text": "", "width": 160, "x": 25, "y": -9 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "AdIcon", "classType": "dImage", "height": 46, "resourceFileName": "data/adicon.png", "scaleX": 0.782609, "scaleY": 0.782609, "spriteColor": -16777216, "width": 66, "x": -84.17392, "y": -6 }], "anchorU": 0.5, "anchorV": 0.5, "className": "SkipButton", "classType": "dButtonScale9", "height": 116, "resourceFileName": "data/button1.png", "width": 300, "x": -200, "y": 495.5 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Panel", "classType": "dScale9", "height": 1300, "repeatType": 1, "resourceFileName": "data/window.png", "width": 944, "x": 0, "y": 94 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Window", "classType": "dScale9", "height": 868, "resourceFileName": "", "width": 991, "x": 540, "y": 905.5 }], "anchorU": 0, "anchorV": 0, "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": -2147483648, "width": 1080, "x": 0, "y": 0 }; };
    return HintPanel;
}(dImage));
var LightEff = (function (_super) {
    __extends(LightEff, _super);
    function LightEff() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        CCActionManager.Instance().AddAction(new CCRepeatForever(new CCRotateBy(6, 360)), _this.Light);
        new dTimer(_this).Create(500, 0, function () {
            var dot = new dImage();
            dot.LoadFromFile("data/light2.png");
            _this.AddChild(dot);
            var dir = new dVector2(dMath.RandomRange(-1, 1), dMath.RandomRange(-1, 1));
            dir.Normalize();
            var time = dMath.RandomRange(2, 3);
            dot.SetPos(dir.x * 100, dir.y * 100);
            dir.MulAppendF(dMath.RandomRange(300, 400));
            CCActionManager.Instance().AddAction(new CCSequence([
                new CCSpawn([
                    new CCMoveBy(time, dir.x, dir.y),
                    new CCFadeOut(time)
                ]),
                new CCRemoveSelf()
            ]), dot);
        });
        return _this;
    }
    LightEff.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Light", "classType": "dImage", "height": 868, "resourceFileName": "data/light.png", "width": 869, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dSprite", "height": 868, "width": 869, "x": 0, "y": 0 }; };
    return LightEff;
}(dSprite));
var SelectLevelPanel = (function (_super) {
    __extends(SelectLevelPanel, _super);
    function SelectLevelPanel() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.SetHandleMouse(true);
        _this.Window_CloseButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().ClosePanel(null, _this);
        }));
        _this.Window_ListBox.blankCount = 5;
        _this.Window_ListBox.blankSpace = 3;
        _this.Window_ListBox.lineSpace = 5;
        for (var i = 0; i < 40; i++) {
            var fun = function (i) {
                var stageBar = new StageBar();
                _this.Window_ListBox.AddChild(stageBar);
                stageBar.SetEvent(new dEvent().SetOnButtonDown(function () {
                    dSound.PlaySound("data/sound/button.mp3");
                    if (!stageBar.isLock()) {
                        PageManager.Instance().SubEnergy(function () {
                            PageManager.Instance().ClosePanel(null, _this, null, false);
                            var stageData = new StageData();
                            stageData.stage = stageBar.GetStage();
                            PageManager.Instance().ChangePage(GamePage, stageData, null, true, null, false);
                        });
                    }
                }));
            };
            fun(i);
        }
        _this.Window_ListBox.SetEvent(new dEvent().SetOnListShowVirtualChild(function (sender, childIndex, virtualIndex) {
            var stageBar = _this.Window_ListBox.GetChildListAt(childIndex);
            var stage = virtualIndex + 1;
            stageBar.SetStage(stage);
            stageBar.SetLock(stage > SaveData.Instance().passStage + 1);
        }));
        _this.Window_ListBox.SetVirtualChildCount(GDefine.MAX_STAGE);
        return _this;
    }
    SelectLevelPanel.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton", "classType": "dButton", "height": 109, "resourceFileName": "data/closebutton.png", "width": 109, "x": 452, "y": -650 }, { "anchorU": 0.5, "anchorV": 0.5, "canDragH": 0, "canDragV": 1, "className": "ListBox", "classType": "dListBox", "clipChild": 1, "height": 1025, "vertical": 1, "viewPosX": 0, "viewPosY": 0, "width": 880, "x": -5, "y": 64.5 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "TitleText", "classType": "dBitmapFont", "fontSize": 64, "height": 73, "resourceFileName": "data/font64.json", "text": "", "width": 256, "x": 0, "y": -610 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Window", "classType": "dScale9", "height": 1400, "repeatType": 1, "resourceFileName": "data/window.png", "width": 1000, "x": 550, "y": 936.5 }], "anchorU": 0, "anchorV": 0, "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": -2147483648, "width": 1080, "x": 0, "y": 0 }; };
    return SelectLevelPanel;
}(dImage));
var SettingPanel = (function (_super) {
    __extends(SettingPanel, _super);
    function SettingPanel() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.Update();
        _this.SetHandleMouse(true);
        _this.Panel_MusicButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            SaveData.Instance().enableMusic = !SaveData.Instance().enableMusic;
            SaveData.Instance().WriteToDisk();
            _this.Update();
        }));
        _this.Panel_SoundButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            SaveData.Instance().enableSound = !SaveData.Instance().enableSound;
            SaveData.Instance().WriteToDisk();
            _this.Update();
        }));
        _this.Panel_CloseButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().ClosePanel(null, _this);
        }));
        _this.Panel_YinSiButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            if (dThread.GetSdkName() == "web")
                dThread.ShowHtmlDialog(MyAd.yinSiUrl);
            else {
                _this.Panel_MyAdPanel.RemoveParent();
                PageManager.Instance().OpenPanel(null, new PrivacyDialog(true, false), null, false);
            }
        }));
        _this.Panel_YongHuButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            if (dThread.GetSdkName() == "web")
                dThread.ShowHtmlDialog(MyAd.yongHuUrl);
            else {
                _this.Panel_MyAdPanel.RemoveParent();
                PageManager.Instance().OpenPanel(null, new PrivacyDialog(false, true), null, false);
            }
        }));
        if (!MyAd.isNeedShowPrivacyLink()) {
            _this.Panel_YinSiButton.visible = false;
            _this.Panel_YongHuButton.visible = false;
        }
        return _this;
    }
    SettingPanel.prototype._dscData = function () { return { "_child": [{ "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontEdgeColor": -16741189, "fontEdgeSize": 3, "fontSize": 48, "height": 51, "resourceFileName": "data/font64.json", "text": "Music on", "width": 172.5, "x": 0, "y": -4 }], "anchorU": 0.5, "anchorV": 0.5, "className": "MusicButton", "classType": "dButtonScale9", "height": 116, "resourceFileName": "data/button1.png", "visible": 0, "width": 300, "x": 0, "y": -93 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontEdgeColor": -16741189, "fontEdgeSize": 3, "fontSize": 48, "height": 51, "resourceFileName": "data/font64.json", "spriteColor": -12632257, "text": "Sound on", "width": 175.5, "x": 0, "y": -13 }], "anchorU": 0.5, "anchorV": 0.5, "className": "SoundButton", "classType": "dButtonScale9", "height": 116, "resourceFileName": "data/button1.png", "width": 300, "x": 0, "y": -14 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "MyAdPanel", "classType": "MyAdBanner", "height": 300, "width": 886, "x": 0, "y": 785 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 40, "height": 46.25, "resourceFileName": "data/font64.json", "spriteColor": -9342607, "text": "", "width": 160, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Line", "classType": "dImage", "height": 4, "pureColor": 1, "spriteColor": -9342607, "width": 150, "x": 0, "y": 28 }], "anchorU": 0.5, "anchorV": 0.5, "className": "YongHuButton", "classType": "dButton", "height": 80, "resourceFileName": "", "width": 240, "x": 175, "y": 246 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 40, "height": 45, "resourceFileName": "data/font64.json", "spriteColor": -9342607, "text": "", "width": 160, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Line", "classType": "dImage", "height": 4, "pureColor": 1, "spriteColor": -9342607, "width": 150, "x": 0, "y": 28 }], "anchorU": 0.5, "anchorV": 0.5, "className": "YinSiButton", "classType": "dButton", "height": 80, "resourceFileName": "", "width": 240, "x": -175.5, "y": 246 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton", "classType": "dButton", "height": 109, "resourceFileName": "data/closebutton.png", "width": 109, "x": 430, "y": -383 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "TitleText", "classType": "dBitmapFont", "fontSize": 64, "height": 74, "resourceFileName": "data/font64.json", "text": "", "text_LANG_CHINESE_SIMPLIFIED": "", "width": 128, "x": 0, "y": -334 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Panel", "classType": "dScale9", "height": 861, "repeatType": 1, "resourceFileName": "data/window.png", "width": 956, "x": 550, "y": 884 }], "anchorU": 0, "anchorV": 0, "classType": "dImage", "height": 1920, "pureColor": 1, "spriteColor": 1677721600, "width": 1080, "x": 0, "y": 0 }; };
    SettingPanel.prototype.Update = function () {
        if (SaveData.Instance().enableMusic)
            this.Panel_MusicButton_Text.text = "";
        else
            this.Panel_MusicButton_Text.text = "";
        if (SaveData.Instance().enableSound)
            this.Panel_SoundButton_Text.text = "";
        else
            this.Panel_SoundButton_Text.text = "";
        SaveData.Instance().UpdateSound();
    };
    SettingPanel.prototype.OnExit = function () {
    };
    return SettingPanel;
}(dImage));
var StageBar = (function (_super) {
    __extends(StageBar, _super);
    function StageBar() {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        return _this;
    }
    StageBar.prototype._dscData = function () { return { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Lock", "classType": "dImage", "height": 68, "resourceFileName": "data/lock.png", "spriteColor": -13848426, "width": 54, "x": 0, "y": 0 }, { "align": 0, "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 64, "height": 67, "resourceFileName": "data/font64.json", "spriteColor": -11779278, "text": "1", "width": 28, "x": 0, "y": -10 }], "anchorU": 0.5, "anchorV": 0.5, "classType": "dButton", "height": 169, "resourceFileName": "data/rbutton.png", "width": 169, "x": 0, "y": 0 }; };
    StageBar.prototype.SetStage = function (stage) {
        this.Text.text = String(stage);
    };
    StageBar.prototype.GetStage = function () {
        return Number(this.Text.text);
    };
    StageBar.prototype.SetLock = function (isLock) {
        this.Lock.visible = isLock;
        this.Text.visible = !isLock;
    };
    StageBar.prototype.isLock = function () {
        return this.Lock.visible;
    };
    return StageBar;
}(dButton));
var StageClearPanel = (function (_super) {
    __extends(StageClearPanel, _super);
    function StageClearPanel(stageData) {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        _this.SetHandleMouse(true);
        MyShareRecording.Instance().EndRecord(_this.Window_ShareButton);
        MyAd.SendPassStage(stageData.stage);
        if (SaveData.Instance().passStage < stageData.stage) {
            SaveData.Instance().passStage = stageData.stage;
            SaveData.Instance().WriteToDisk();
        }
        _this.Window_NextButton.repeatType = true;
        _this.Window_ShareButton.repeatType = true;
        if (GDefine.EnableEnergy && SaveData.Instance().energy > 0) {
            SaveData.Instance().energy--;
            SaveData.Instance().WriteToDisk();
            PageManager.Instance().UpdateCurPage();
        }
        _this.Window_NextButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().SubEnergy(function () {
                stageData.stage++;
                PageManager.Instance().ClosePanel(null, _this, function () {
                    PageManager.Instance().ChangePage(GamePage, stageData, null, true, null, false);
                });
            }, true);
        }));
        _this.Window_CloseButton.visible = SaveData.Instance().energy == 0;
        _this.Window_CloseButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            dSound.PlaySound("data/sound/button.mp3");
            PageManager.Instance().ChangePage(LoginPage);
            PageManager.Instance().ClosePanel(null, _this, null, false);
        }));
        return _this;
    }
    StageClearPanel.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Light", "classType": "LightEff", "x": 0, "y": -326 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 363, "resourceFileName": "data/gongxi.png", "width": 1044, "x": 0, "y": -327 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 60, "height": 68.4375, "resourceFileName": "data/font64.json", "spriteColor": -12237499, "text": "", "width": 180, "x": 0, "y": -16 }], "anchorU": 0.5, "anchorV": 0.5, "className": "NextButton", "classType": "dButtonScale9", "height": 128, "resourceFileName": "data/button1.png", "width": 417, "x": -15.5, "y": 504.500244, "z": 0.596382 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton", "classType": "dButton", "height": 109, "resourceFileName": "data/closebutton.png", "width": 109, "x": 463, "y": -406 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dBitmapFont", "fontSize": 48, "height": 57, "resourceFileName": "data/font64.json", "spriteColor": -12237499, "text": "", "text_LANG_CHINESE_SIMPLIFIED": "", "width": 288, "x": 49, "y": -6 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Icon", "classType": "dImage", "height": 84, "resourceFileName": "data/shareicon.png", "scaleX": 0.873563, "scaleY": 0.873563, "spriteColor": -12237499, "width": 87, "x": -157.5, "y": 0.689655 }], "anchorU": 0.5, "anchorV": 0.5, "className": "ShareButton", "classType": "dButtonScale9", "height": 128, "resourceFileName": "data/button1.png", "width": 417, "x": -10, "y": 726, "z": 0.596382 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Window", "classType": "dScale9", "height": 868, "resourceFileName": "", "width": 991, "x": 540, "y": 936.5 }], "anchorU": 0, "anchorV": 0, "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": -2147483648, "width": 1080, "x": 0, "y": 0 }; };
    return StageClearPanel;
}(dImage));
var dBitmapData = (function (_super) {
    __extends(dBitmapData, _super);
    function dBitmapData() {
        var _this = _super.call(this) || this;
        _this.m_pBufferData = null;
        return _this;
    }
    Object.defineProperty(dBitmapData, "WHITE_BITMAPDATA", {
        get: function () {
            if (dBitmapData._WHITE_BITMAPDATA == null)
                dBitmapData._WHITE_BITMAPDATA = new dBitmapData().Create(2, 2, 0xffffffff);
            return dBitmapData._WHITE_BITMAPDATA;
        },
        enumerable: false,
        configurable: true
    });
    dBitmapData.SetGlobalImageLoadComplete = function (callback) {
        if (dBitmapData.s_nGlobalLoadingCountAddRef == 0)
            callback();
        else
            dBitmapData.s_globalLoadCompleteCallback.push(callback);
    };
    dBitmapData.prototype.Release = function () {
        if (this.m_pBufferData) {
            this.m_pBufferData.Release();
            this.m_pBufferData = null;
        }
    };
    dBitmapData.prototype.Create = function (w, h, color, isRenderToTexture) {
        if (isRenderToTexture === void 0) { isRenderToTexture = 0; }
        this.Release();
        this.m_pBufferData = new __dBitmapDataBufferData();
        var canvas = this.m_pBufferData.m_pCanvas = dInterface.ptr.CreateCanvas();
        this.m_pBufferData.m_pCanvasContext = this.m_pBufferData.m_pCanvas.getContext("2d");
        this.m_pBufferData.m_bRenderToTexture = isRenderToTexture;
        canvas.width = w;
        canvas.height = h;
        this.FillColor(color);
        return this;
    };
    dBitmapData.prototype.FillColor = function (color) {
        var _this = this;
        if (color == 0xffffffff) {
            this.m_pBufferData.m_pImageData = dInterface.ptr.CreateImage();
            this.m_pBufferData.m_bLoading = true;
            this.m_pBufferData.m_pImageData.onload = function () {
                _this.m_pBufferData.m_bLoading = false;
            };
            this.m_pBufferData.m_pImageData.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAAXNSR0IArs4c6QAAABRJREFUGFdj/P///38GBgYGRhgDAFfVB/vDfnUlAAAAAElFTkSuQmCC';
        }
        else {
            var ctx = this.m_pBufferData.m_pCanvasContext;
            var r = (color & 0x00ff0000) >> 16;
            var g = (color & 0x0000ff00) >> 8;
            var b = (color & 0x000000ff);
            var a = (color & 0xff000000) >>> 24;
            ctx.globalCompositeOperation = "copy";
            ctx.globalAlpha = a / 255.0;
            ctx.fillStyle = "rgb(" + r + "," + g + "," + b + ")";
            ctx.fillRect(0, 0, this.GetWidth(), this.GetHeight());
            ctx.globalAlpha = 1.0;
            ctx.globalCompositeOperation = "source-over";
        }
    };
    dBitmapData.prototype.FillText = function (text, nFontSize, nFontColor, bBold, bItalic, fLimitWidth, nAlign, flag, fWordSpace, fLineSpace, edgeSize, edgeColor, xOffset, yOffset) {
        if (bBold === void 0) { bBold = false; }
        if (bItalic === void 0) { bItalic = false; }
        if (fLimitWidth === void 0) { fLimitWidth = -1; }
        if (nAlign === void 0) { nAlign = -1; }
        if (flag === void 0) { flag = 0; }
        if (fWordSpace === void 0) { fWordSpace = 0; }
        if (fLineSpace === void 0) { fLineSpace = 0; }
        if (edgeSize === void 0) { edgeSize = 0; }
        if (edgeColor === void 0) { edgeColor = 0; }
        if (xOffset === void 0) { xOffset = 0; }
        if (yOffset === void 0) { yOffset = 0; }
        if (this.m_pBufferData) {
            this.m_pBufferData.Release();
            this.m_pBufferData = null;
        }
        if (this.m_pBufferData == null) {
            this.m_pBufferData = new __dBitmapDataBufferData();
            this.m_pBufferData.m_pCanvas = dInterface.ptr.CreateCanvas();
            this.m_pBufferData.m_pCanvasContext = this.m_pBufferData.m_pCanvas.getContext("2d");
        }
        var canvas = this.m_pBufferData.m_pCanvas;
        var ctx = this.m_pBufferData.m_pCanvasContext;
        var strFont = (bBold ? "bold " : "") + (bItalic ? "italic " : "") + nFontSize + "px Arial";
        ctx.font = strFont;
        if (canvas.style)
            canvas.style.letterSpacing = fWordSpace + "px";
        var lineTexts = new Array();
        var measureTexts = new Array();
        if (fLimitWidth != -1 || text.indexOf("\n") != -1) {
            var str = "";
            var last;
            for (var i = 0; i < text.length; i++) {
                last = str;
                var s = text.charAt(i);
                str += s;
                if (fLimitWidth != -1 && ctx.measureText(str).width > fLimitWidth || s == "\n") {
                    lineTexts.push(last);
                    measureTexts.push({ width: ctx.measureText(last).width });
                    if (s != "\n")
                        str = s;
                    else
                        str = "";
                }
            }
            lineTexts.push(str);
            measureTexts.push({ width: ctx.measureText(str).width });
        }
        else {
            lineTexts.push(text);
            measureTexts.push({ width: ctx.measureText(text).width });
        }
        var maxWidth = 0, maxHeight = 0;
        for (var i = 0; i < measureTexts.length; i++) {
            var w = measureTexts[i].width;
            measureTexts[i].fontBoundingBoxAscent = nFontSize;
            measureTexts[i].fontBoundingBoxDescent = nFontSize * 0.2;
            var h = measureTexts[i].fontBoundingBoxAscent + measureTexts[i].fontBoundingBoxDescent;
            if (maxWidth < w)
                maxWidth = w;
            maxHeight += h;
        }
        maxWidth += edgeSize * 2 + xOffset;
        maxHeight += (lineTexts.length - 1) * fLineSpace + edgeSize * 2 + yOffset;
        {
            canvas.width = maxWidth;
            canvas.height = maxHeight;
        }
        ctx.font = strFont;
        if (canvas.style)
            canvas.style.letterSpacing = fWordSpace + "px";
        var r = (nFontColor & 0x00ff0000) >> 16;
        var g = (nFontColor & 0x0000ff00) >> 8;
        var b = (nFontColor & 0x000000ff);
        var a = (nFontColor & 0xff000000) >>> 24;
        ctx.globalAlpha = a / 255.0;
        ctx.fillStyle = "rgb(" + r + "," + g + "," + b + ")";
        if (edgeSize > 0 && edgeColor != 0) {
            var r2 = (edgeColor & 0x00ff0000) >> 16;
            var g2 = (edgeColor & 0x0000ff00) >> 8;
            var b2 = (edgeColor & 0x000000ff);
            var a2 = (edgeColor & 0xff000000) >>> 24;
            ctx.strokeStyle = "rgba(" + r2 + "," + g2 + "," + b2 + "," + a2 + ")";
            ctx.lineWidth = edgeSize + 1;
        }
        var y = 0;
        if (dInterface.sdkName == "oppo" || dInterface.sdkName == "vivo")
            y += nFontSize * 0.22;
        for (var i = 0; i < lineTexts.length; i++) {
            ctx.globalCompositeOperation = i == 0 ? "copy" : "source-over";
            var left = (maxWidth - xOffset - measureTexts[i].width) * ((nAlign + 1) / 2);
            if (edgeSize > 0 && edgeColor != 0) {
                ctx.strokeText(lineTexts[i], left + xOffset, y + measureTexts[i].fontBoundingBoxAscent + yOffset);
                ctx.globalCompositeOperation = "source-over";
            }
            ctx.fillText(lineTexts[i], left + xOffset, y + measureTexts[i].fontBoundingBoxAscent + yOffset);
            y += measureTexts[i].fontBoundingBoxAscent + measureTexts[i].fontBoundingBoxDescent + fLineSpace;
        }
        ctx.globalAlpha = 1.0;
        ctx.globalCompositeOperation = "source-over";
    };
    dBitmapData.prototype.LoadFromFile = function (fileName, onComplete, onProgress, onFailed) {
        var _this = this;
        if (onComplete === void 0) { onComplete = null; }
        if (onProgress === void 0) { onProgress = null; }
        if (onFailed === void 0) { onFailed = null; }
        this.Release();
        if (dInterface.ptr.m_arrBitmapBuffer.has(fileName)) {
            this.m_pBufferData = dInterface.ptr.m_arrBitmapBuffer.get(fileName);
            if (this.m_pBufferData.m_bLoading) {
                this.m_pBufferData.AddComplete(onComplete, onFailed);
            }
            else {
                if (this.m_pBufferData.m_pImageData) {
                    if (onComplete)
                        onComplete(this);
                }
                else {
                    if (onFailed)
                        onFailed(this);
                }
            }
        }
        else {
            this.m_pBufferData = new __dBitmapDataBufferData();
            this.m_pBufferData.m_strResourceFileName = fileName;
            this.m_pBufferData.AddComplete(onComplete, onFailed);
            this.m_pBufferData.m_bLoading = true;
            dBitmapData.s_nGlobalLoadingCountAddRef++;
            dInterface.ptr.m_arrBitmapBuffer.set(fileName, this.m_pBufferData);
            dInterface.ptr.LoadImage(fileName, function (response) {
                _this.m_pBufferData.m_bLoading = false;
                dBitmapData.s_nGlobalLoadingCountAddRef--;
                if (response) {
                    _this.m_pBufferData.m_pImageData = response;
                    _this.m_pBufferData.CallComplete(true, _this);
                }
                else
                    _this.m_pBufferData.CallComplete(false, _this);
                if (dBitmapData.s_globalLoadCompleteCallback.length > 0) {
                    for (var i = 0; i < dBitmapData.s_globalLoadCompleteCallback.length; i++)
                        dBitmapData.s_globalLoadCompleteCallback[i]();
                    dBitmapData.s_globalLoadCompleteCallback.clear();
                }
            });
        }
    };
    dBitmapData.prototype.GetResourceFileName = function () {
        if (this.m_pBufferData)
            return this.m_pBufferData.m_strResourceFileName;
        return "";
    };
    dBitmapData.prototype.GetBitmapSourceRect = function () {
        return new dRect(0, 0, this.GetWidth(), this.GetHeight());
    };
    dBitmapData.prototype.GetWidth = function () {
        if (this.m_pBufferData)
            return this.m_pBufferData.GetWidth();
        return 0;
    };
    dBitmapData.prototype.GetHeight = function () {
        if (this.m_pBufferData)
            return this.m_pBufferData.GetHeight();
        return 0;
    };
    dBitmapData.prototype.isLoading = function () {
        if (this.m_pBufferData)
            return this.m_pBufferData.m_bLoading;
        return false;
    };
    dBitmapData.prototype.SetLoadCompleteCallback = function (callback) {
        var _this = this;
        if (!this.isLoading) {
            if (callback)
                callback(this);
        }
        else {
            new dTimer().Create(100, 0, function (sender) {
                if (!_this.isLoading) {
                    sender.Stop();
                    if (callback)
                        callback(_this);
                }
            });
        }
    };
    dBitmapData.prototype._CanvasToImage = function () {
        var _this = this;
        if (this.m_pBufferData != null && this.m_pBufferData.m_pCanvas && this.m_pBufferData.m_pImageData == null) {
            var image = new Image();
            this.m_pBufferData.m_pImageData = image;
            this.m_pBufferData.m_bLoading = true;
            image.onload = function () {
                _this.m_pBufferData.m_bLoading = false;
            };
            image.src = this.m_pBufferData.m_pCanvas.toDataURL("image/png");
        }
    };
    dBitmapData.prototype._SetTexture = function (nSampleID) {
        var webgl = dInterface.ptr.webgl;
        var p = this;
        if (!p.m_pBufferData || p.m_pBufferData.GetCanvas() == null && p.m_pBufferData.m_pImageData == null) {
            return false;
        }
        if (p.m_pBufferData.m_bLoading) {
            return false;
        }
        if (p.m_pBufferData.m_pTexture == null) {
            if (p.m_pBufferData.m_bRenderToTexture) {
                return false;
            }
            if (p.m_pBufferData.m_pImageData == null && p.m_pBufferData.GetCanvas() && dThread.GetSdkName() == "tt") {
                this._CanvasToImage();
                return false;
            }
            p.m_pBufferData.m_pTexture = webgl.createTexture();
            webgl.activeTexture(webgl.TEXTURE0 + nSampleID);
            webgl.bindTexture(webgl.TEXTURE_2D, p.m_pBufferData.m_pTexture);
            webgl.pixelStorei(webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);
            if (p.m_pBufferData.m_pImageData != null)
                webgl.texImage2D(webgl.TEXTURE_2D, 0, webgl.RGBA, webgl.RGBA, webgl.UNSIGNED_BYTE, p.m_pBufferData.m_pImageData);
            else if (p.m_pBufferData.GetCanvas() != null)
                webgl.texImage2D(webgl.TEXTURE_2D, 0, webgl.RGBA, webgl.RGBA, webgl.UNSIGNED_BYTE, p.m_pBufferData.GetCanvas());
            dInterface.ptr.m_arrTextureBuffer.set(p.m_pBufferData.objectId, p.m_pBufferData);
        }
        else {
            webgl.activeTexture(webgl.TEXTURE0 + nSampleID);
            webgl.bindTexture(webgl.TEXTURE_2D, p.m_pBufferData.m_pTexture);
        }
        webgl.texParameteri(webgl.TEXTURE_2D, webgl.TEXTURE_MIN_FILTER, webgl.NEAREST);
        webgl.texParameteri(webgl.TEXTURE_2D, webgl.TEXTURE_MAG_FILTER, webgl.NEAREST);
        webgl.texParameteri(webgl.TEXTURE_2D, webgl.TEXTURE_WRAP_S, webgl.CLAMP_TO_EDGE);
        webgl.texParameteri(webgl.TEXTURE_2D, webgl.TEXTURE_WRAP_T, webgl.CLAMP_TO_EDGE);
        p.m_pBufferData.m_lLastUsingTextureTime = dInterface.ptr.GetRenderTick();
        return true;
    };
    dBitmapData.prototype._UnSetTexture = function (nSampleID) {
        var webgl = dInterface.ptr.webgl;
        webgl.activeTexture(webgl.TEXTURE0 + nSampleID);
        webgl.bindTexture(webgl.TEXTURE_2D, null);
    };
    dBitmapData.CHANNEL_R = 1;
    dBitmapData.CHANNEL_G = 2;
    dBitmapData.CHANNEL_B = 4;
    dBitmapData.CHANNEL_A = 8;
    dBitmapData.DRAW_FILTER_DEFAULT = 0;
    dBitmapData.DRAW_FILTER_POINT = 4;
    dBitmapData.DRAW_FILTER_LINEAR = 8;
    dBitmapData.BLEND_MODE_NORMAL = 0;
    dBitmapData.BLEND_MODE_COPY = 1;
    dBitmapData.BLEND_MODE_INVERSE = 2;
    dBitmapData.BLEND_MODE_ADD = 3;
    dBitmapData.BLEND_MODE_SUB = 4;
    dBitmapData.BLEND_MODE_MUL = 5;
    dBitmapData.CHANNEL_TYPE_ARGB = 0;
    dBitmapData.CHANNEL_TYPE_RGBA = 1;
    dBitmapData.CHANNEL_TYPE_BGRA = 2;
    dBitmapData.FORMAT_UNKONWN = 0;
    dBitmapData.FORMAT_A8R8G8B8 = 1;
    dBitmapData.FORMAT_A4R4G4B4 = 2;
    dBitmapData.FORMAT_R5G6B5 = 3;
    dBitmapData.FORMAT_A1R5G5B5 = 4;
    dBitmapData.FORMAT_A8 = 5;
    dBitmapData.FORMAT_COMPRESS_PVR = 6;
    dBitmapData.FORMAT_A32 = 7;
    dBitmapData.FLAG_RENDER_TO_TEXTURE = 1;
    dBitmapData.FLAG_SHARED_CANVAS = 2;
    dBitmapData._WHITE_BITMAPDATA = null;
    dBitmapData.s_globalLoadCompleteCallback = new Array();
    dBitmapData.s_nGlobalLoadingCountAddRef = 0;
    return dBitmapData;
}(dObject));
var __dBitmapDataBufferData = (function (_super) {
    __extends(__dBitmapDataBufferData, _super);
    function __dBitmapDataBufferData() {
        var _this = _super.call(this) || this;
        _this.m_pTexture = null;
        _this.m_bLoading = false;
        _this.m_pImageData = null;
        _this.m_pCanvas = null;
        _this.m_lLastUsingTextureTime = 0;
        _this.m_strResourceFileName = "";
        _this.m_vecOnComplete = null;
        _this.m_vecOnFailed = null;
        _this.m_bRenderToTexture = 0;
        _this.m_markFlag = -1;
        _this.m_pRenderToTextureRboDepth = null;
        _this.m_pRenderToTextureFbo = null;
        return _this;
    }
    __dBitmapDataBufferData.prototype.AddComplete = function (onComplete, onFailed) {
        if (!this.m_vecOnComplete)
            this.m_vecOnComplete = new Array();
        if (!this.m_vecOnFailed)
            this.m_vecOnFailed = new Array();
        if (onComplete)
            this.m_vecOnComplete.push(onComplete);
        if (onFailed)
            this.m_vecOnFailed.push(onFailed);
    };
    __dBitmapDataBufferData.prototype.CallComplete = function (bSuccess, sender) {
        if (bSuccess) {
            if (this.m_vecOnComplete) {
                for (var i = 0; i < this.m_vecOnComplete.length; i++)
                    this.m_vecOnComplete[i](sender);
            }
        }
        else {
            if (this.m_vecOnFailed) {
                for (var i = 0; i < this.m_vecOnFailed.length; i++)
                    this.m_vecOnFailed[i](sender);
            }
        }
        this.m_vecOnComplete = null;
        this.m_vecOnFailed = null;
    };
    __dBitmapDataBufferData.prototype.Release = function () {
        if (this.m_pTexture) {
            dInterface.ptr.webgl.deleteTexture(this.m_pTexture);
            this.m_pTexture = null;
        }
        if (this.m_pRenderToTextureRboDepth) {
            dInterface.ptr.webgl.deleteRenderbuffer(this.m_pRenderToTextureRboDepth);
            this.m_pRenderToTextureRboDepth = null;
        }
        if (this.m_pRenderToTextureFbo) {
            dInterface.ptr.webgl.deleteFramebuffer(this.m_pRenderToTextureFbo);
            this.m_pRenderToTextureFbo = null;
        }
    };
    __dBitmapDataBufferData.prototype.GetCanvas = function () {
        return this.m_pCanvas;
    };
    __dBitmapDataBufferData.prototype.GetWidth = function () {
        if (this.m_pImageData)
            return this.m_pImageData.width;
        if (this.m_pCanvas)
            return this.m_pCanvas.width;
        return 0;
    };
    __dBitmapDataBufferData.prototype.GetHeight = function () {
        if (this.m_pImageData)
            return this.m_pImageData.height;
        if (this.m_pCanvas)
            return this.m_pCanvas.height;
        return 0;
    };
    return __dBitmapDataBufferData;
}(dObject));
var dBoundingBox = (function () {
    function dBoundingBox(_x1, _y1, _z1, _x2, _y2, _z2) {
        if (_x1 === void 0) { _x1 = 0.0; }
        if (_y1 === void 0) { _y1 = 0.0; }
        if (_z1 === void 0) { _z1 = 0.0; }
        if (_x2 === void 0) { _x2 = 0.0; }
        if (_y2 === void 0) { _y2 = 0.0; }
        if (_z2 === void 0) { _z2 = 0.0; }
        this.m_vCenter = null;
        var a = this;
        a.x1 = _x1;
        a.y1 = _y1;
        a.z1 = _z1;
        a.x2 = _x2;
        a.y2 = _y2;
        a.z2 = _z2;
        if (dBoundingBox.s_vecCollectCameraTemp == null) {
            dBoundingBox.s_vecCollectCameraTemp = new Array(8);
            for (var i = 0; i < 8; i++)
                dBoundingBox.s_vecCollectCameraTemp[i] = new dVector4();
        }
    }
    dBoundingBox.prototype.SetValue = function (_x1, _y1, _z1, _x2, _y2, _z2) {
        var a = this;
        a.x1 = _x1;
        a.y1 = _y1;
        a.z1 = _z1;
        a.x2 = _x2;
        a.y2 = _y2;
        a.z2 = _z2;
        return a;
    };
    dBoundingBox.prototype.Copy = function (v) {
        var a = this;
        a.x1 = v.x1;
        a.y1 = v.y1;
        a.z1 = v.z1;
        a.x2 = v.x2;
        a.y2 = v.y2;
        a.z2 = v.z2;
        return a;
    };
    dBoundingBox.prototype.Merge = function (p) {
        var a = this;
        if (a.x1 > p.x1)
            a.x1 = p.x1;
        if (a.y1 > p.y1)
            a.y1 = p.y1;
        if (a.z1 > p.z1)
            a.z1 = p.z1;
        if (a.x2 < p.x2)
            a.x2 = p.x2;
        if (a.y2 < p.y2)
            a.y2 = p.y2;
        if (a.z2 < p.z2)
            a.z2 = p.z2;
        return this;
    };
    dBoundingBox.prototype.MergePoint = function (v) {
        var a = this;
        if (a.x1 > v.x)
            a.x1 = v.x;
        if (a.y1 > v.y)
            a.y1 = v.y;
        if (a.z1 > v.z)
            a.z1 = v.z;
        if (a.x2 < v.x)
            a.x2 = v.x;
        if (a.y2 < v.y)
            a.y2 = v.y;
        if (a.z2 < v.z)
            a.z2 = v.z;
        return this;
    };
    dBoundingBox.prototype.GetCenter = function () {
        if (this.m_vCenter == null)
            this.m_vCenter = new dVector3();
        this.m_vCenter.x = (this.x1 + this.x2) / 2.0;
        this.m_vCenter.y = (this.y1 + this.y2) / 2.0;
        this.m_vCenter.z = (this.z1 + this.z2) / 2.0;
        return this.m_vCenter;
    };
    dBoundingBox.prototype.GetExtents = function () {
        var vCenter = this.GetCenter();
        return new dVector3(this.x2 - vCenter.x, this.y2 - vCenter.y, this.z2 - vCenter.z);
    };
    dBoundingBox.prototype.isCollectionRay = function (vPos, vDir) {
        var vCenter = this.GetCenter();
        var vExtends = new dVector3(this.x2 - vCenter.x, this.y2 - vCenter.y, this.z2 - vCenter.z);
        var mFDir = new dVector3(dMath.Abs(vDir.x), dMath.Abs(vDir.y), dMath.Abs(vDir.z));
        var Dx = vPos.x - vCenter.x;
        if (dMath.Abs(Dx) > vExtends.x && Dx * vDir.x >= 0.0)
            return false;
        var Dy = vPos.y - vCenter.y;
        if (dMath.Abs(Dy) > vExtends.y && Dy * vDir.y >= 0.0)
            return false;
        var Dz = vPos.z - vCenter.z;
        if (dMath.Abs(Dz) > vExtends.z && Dz * vDir.z >= 0.0)
            return false;
        var f;
        f = vDir.y * Dz - vDir.z * Dy;
        if (dMath.Abs(f) > vExtends.y * mFDir.z + vExtends.z * mFDir.y)
            return false;
        f = vDir.z * Dx - vDir.x * Dz;
        if (dMath.Abs(f) > vExtends.x * mFDir.z + vExtends.z * mFDir.x)
            return false;
        f = vDir.x * Dy - vDir.y * Dx;
        if (dMath.Abs(f) > vExtends.x * mFDir.y + vExtends.y * mFDir.x)
            return false;
        return true;
    };
    dBoundingBox.prototype.ToPoint8 = function () {
        var ret = new Array(8);
        ret[0] = new dVector3(this.x1, this.y2, this.z2);
        ret[1] = new dVector3(this.x2, this.y2, this.z2);
        ret[2] = new dVector3(this.x2, this.y2, this.z1);
        ret[3] = new dVector3(this.x1, this.y2, this.z1);
        ret[4] = new dVector3(this.x1, this.y1, this.z2);
        ret[5] = new dVector3(this.x2, this.y1, this.z2);
        ret[6] = new dVector3(this.x2, this.y1, this.z1);
        ret[7] = new dVector3(this.x1, this.y1, this.z1);
        return ret;
    };
    dBoundingBox.prototype.isCollectionFrustumPlane = function (vecFustumPlane) {
        var t = dBoundingBox.s_vecCollectCameraTemp;
        t[0].SetValue(this.x1, this.y2, this.z2, 1.0);
        t[1].SetValue(this.x2, this.y2, this.z2, 1.0);
        t[2].SetValue(this.x2, this.y2, this.z1, 1.0);
        t[3].SetValue(this.x1, this.y2, this.z1, 1.0);
        t[4].SetValue(this.x1, this.y1, this.z2, 1.0);
        t[5].SetValue(this.x2, this.y1, this.z2, 1.0);
        t[6].SetValue(this.x2, this.y1, this.z1, 1.0);
        t[7].SetValue(this.x1, this.y1, this.z1, 1.0);
        for (var i = 0; i < 6; ++i) {
            var iInCount = 8;
            for (var j = 0; j < 8; ++j) {
                if (vecFustumPlane[i].Dot(t[j]) < 0) {
                    --iInCount;
                }
            }
            if (iInCount == 0)
                return false;
        }
        return true;
    };
    dBoundingBox.prototype.isPointIn = function (x, y, z, radio) {
        if (radio === void 0) { radio = 0; }
        if (x + radio >= this.x1 && x - radio <= this.x2 &&
            y + radio >= this.y1 && y - radio <= this.y2 &&
            z + radio >= this.z1 && z - radio <= this.z2)
            return true;
        return false;
    };
    dBoundingBox.prototype.isCollectionAABB = function (p) {
        var vCenter1 = this.GetCenter();
        var vCenter2 = p.GetCenter();
        var vExtents1 = this.GetExtents();
        var vExtents2 = p.GetExtents();
        var tx = vCenter1.x - vCenter2.x;
        var ex = vExtents2.x + vExtents1.x;
        if (tx > ex)
            return false;
        var ty = vCenter1.y - vCenter2.y;
        var ey = vExtents2.y + vExtents1.y;
        if (ty > ey)
            return false;
        var tz = vCenter1.z - vCenter2.z;
        var ez = vExtents2.z + vExtents1.z;
        if (tz > ez)
            return false;
        return true;
    };
    dBoundingBox.prototype.TransformToAABB = function (mat) {
        var ret = new dBoundingBox();
        var v8 = this.ToPoint8();
        for (var i = 0; i < v8.length; i++) {
            v8[i].Transform(mat);
        }
        ret.x2 = ret.x1 = v8[0].x;
        ret.y2 = ret.y1 = v8[0].y;
        ret.z2 = ret.z1 = v8[0].z;
        for (var i = 1; i < v8.length; i++) {
            if (ret.x1 > v8[i].x)
                ret.x1 = v8[i].x;
            if (ret.y1 > v8[i].y)
                ret.y1 = v8[i].y;
            if (ret.z1 > v8[i].z)
                ret.z1 = v8[i].z;
            if (ret.x2 < v8[i].x)
                ret.x2 = v8[i].x;
            if (ret.y2 < v8[i].y)
                ret.y2 = v8[i].y;
            if (ret.z2 < v8[i].z)
                ret.z2 = v8[i].z;
        }
        return ret;
    };
    dBoundingBox.prototype.getSeparatingPlaneMulDot = function (p, mul, plane) {
        return p.x * plane.x * mul + p.y * plane.y * mul + p.z * plane.z * mul;
    };
    dBoundingBox.prototype.getSeparatingPlane = function (RPos, Plane, box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1Half_size, box2Half_size) {
        return (dMath.Abs(RPos.Dot(Plane)) >
            (dMath.Abs(this.getSeparatingPlaneMulDot(box1AxisX, box1Half_size.x, Plane)) +
                dMath.Abs(this.getSeparatingPlaneMulDot(box1AxisY, box1Half_size.y, Plane)) +
                dMath.Abs(this.getSeparatingPlaneMulDot(box1AxisZ, box1Half_size.z, Plane)) +
                dMath.Abs(this.getSeparatingPlaneMulDot(box2AxisX, box2Half_size.x, Plane)) +
                dMath.Abs(this.getSeparatingPlaneMulDot(box2AxisY, box2Half_size.y, Plane)) +
                dMath.Abs(this.getSeparatingPlaneMulDot(box2AxisZ, box2Half_size.z, Plane))));
    };
    dBoundingBox.prototype.isCollectionOBB = function (box2, mat1, mat2) {
        var box1Pos = this.GetCenter();
        var box2Pos = box2.GetCenter();
        box1Pos.Transform(mat1);
        box2Pos.Transform(mat2);
        var box1AxisX = new dVector3(1, 0, 0).TransformNormal(mat1);
        var box1AxisY = new dVector3(0, 1, 0).TransformNormal(mat1);
        var box1AxisZ = new dVector3(0, 0, 1).TransformNormal(mat1);
        var box2AxisX = new dVector3(1, 0, 0).TransformNormal(mat2);
        var box2AxisY = new dVector3(0, 1, 0).TransformNormal(mat2);
        var box2AxisZ = new dVector3(0, 0, 1).TransformNormal(mat2);
        var box1HalfSize = new dVector3(this.Width() * 0.5, this.Height() * 0.5, this.Depth() * 0.5);
        var box2HalfSize = new dVector3(box2.Width() * 0.5, box2.Height() * 0.5, box2.Depth() * 0.5);
        var RPos = box2Pos.Sub(box1Pos);
        var cross = new dVector3();
        return !(this.getSeparatingPlane(RPos, box1AxisX, box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, box1AxisY, box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, box1AxisZ, box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, box2AxisX, box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, box2AxisY, box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, box2AxisZ, box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, dVector3.Vec3Cross(cross, box1AxisX, box2AxisX), box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, dVector3.Vec3Cross(cross, box1AxisX, box2AxisY), box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, dVector3.Vec3Cross(cross, box1AxisX, box2AxisZ), box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, dVector3.Vec3Cross(cross, box1AxisY, box2AxisX), box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, dVector3.Vec3Cross(cross, box1AxisY, box2AxisY), box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, dVector3.Vec3Cross(cross, box1AxisY, box2AxisZ), box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, dVector3.Vec3Cross(cross, box1AxisZ, box2AxisX), box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, dVector3.Vec3Cross(cross, box1AxisZ, box2AxisY), box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize) ||
            this.getSeparatingPlane(RPos, dVector3.Vec3Cross(cross, box1AxisZ, box2AxisZ), box1AxisX, box1AxisY, box1AxisZ, box2AxisX, box2AxisY, box2AxisZ, box1HalfSize, box2HalfSize));
    };
    dBoundingBox.prototype.WriteToBin = function (to) {
        to.WriteFloat(this.x1);
        to.WriteFloat(this.y1);
        to.WriteFloat(this.z1);
        to.WriteFloat(this.x2);
        to.WriteFloat(this.y2);
        to.WriteFloat(this.z2);
    };
    dBoundingBox.prototype.ReadFromBin = function (data) {
        this.x1 = data.ReadFloat();
        this.y1 = data.ReadFloat();
        this.z1 = data.ReadFloat();
        this.x2 = data.ReadFloat();
        this.y2 = data.ReadFloat();
        this.z2 = data.ReadFloat();
        return this;
    };
    dBoundingBox.prototype.Width = function () {
        return this.x2 - this.x1;
    };
    dBoundingBox.prototype.Height = function () {
        return this.y2 - this.y1;
    };
    dBoundingBox.prototype.Depth = function () {
        return this.z2 - this.z1;
    };
    dBoundingBox.s_vecCollectCameraTemp = null;
    return dBoundingBox;
}());
var dByteArray = (function (_super) {
    __extends(dByteArray, _super);
    function dByteArray() {
        var _this = _super.call(this) || this;
        _this.m_pArraybuffer = null;
        _this.m_pDataView = null;
        _this.m_bLoadOK = false;
        _this.m_nSize = 0;
        _this.m_nSysSize = 0;
        _this.m_nPosition = 0;
        _this.m_nEndian = dByteArray.BIG_ENDIAN;
        return _this;
    }
    dByteArray.prototype.isLittleEndian = function () {
        return this.m_nEndian == dByteArray.LITTLE_ENDIAN;
    };
    dByteArray.prototype.requreSize = function (size) {
        size -= this.m_nSize - this.m_nPosition;
        if (size <= 0)
            return;
        var curSysSize = this.m_nSysSize;
        while (this.m_nSize + size >= this.m_nSysSize) {
            if (this.m_nSysSize < 64)
                this.m_nSysSize = 64;
            else
                this.m_nSysSize *= 2;
        }
        this.m_nSize += size;
        if (this.m_nSysSize > curSysSize) {
            var newArrayBuffer = new ArrayBuffer(this.m_nSysSize);
            if (this.m_pArraybuffer == null)
                this.m_pArraybuffer = newArrayBuffer;
            else {
                var p1 = new Uint8Array(this.m_pArraybuffer);
                var p2 = new Uint8Array(newArrayBuffer);
                for (var i = 0; i < this.m_nSize; i++)
                    p2[i] = p1[i];
            }
            this.m_pArraybuffer = newArrayBuffer;
            this.m_pDataView = new DataView(newArrayBuffer);
        }
    };
    dByteArray.prototype.requireSizeDirect = function (size) {
        if (this.m_nSize != size) {
            this.m_nSize = size;
            this.m_nSysSize = size;
            var newArrayBuffer = new ArrayBuffer(this.m_nSysSize);
            if (this.m_pArraybuffer == null)
                this.m_pArraybuffer = newArrayBuffer;
            else {
                var p1 = new Uint8Array(this.m_pArraybuffer);
                var p2 = new Uint8Array(newArrayBuffer);
                for (var i = 0; i < this.m_nSize; i++)
                    p2[i] = p1[i];
            }
            this.m_pArraybuffer = newArrayBuffer;
            this.m_pDataView = new DataView(newArrayBuffer);
        }
    };
    dByteArray.prototype.addpos = function (offset) {
        var curPos = this.m_nPosition;
        this.m_nPosition += offset;
        if (this.m_nPosition > this.m_nSize)
            this.m_nPosition = this.m_nSize;
        return curPos;
    };
    dByteArray.prototype.Release = function () {
    };
    dByteArray.prototype.ReadChar = function () {
        if (this.m_nPosition + 1 > this.m_nSize) {
            this.m_nPosition = this.m_nSize;
            return 0;
        }
        return this.m_pDataView ? this.m_pDataView.getInt8(this.addpos(1)) : 0;
    };
    dByteArray.prototype.GetChar = function (pos) {
        if (pos === void 0) { pos = -1; }
        if (pos == -1) {
            var old_pos = this.GetPosition();
            var ret = this.ReadChar();
            this.SetPosition(old_pos);
            return ret;
        }
        else {
            var old_pos = this.GetPosition();
            this.SetPosition(pos);
            var ret = this.ReadChar();
            this.SetPosition(old_pos);
            return ret;
        }
        return 0;
    };
    dByteArray.prototype.ReadByte = function () {
        if (this.m_nPosition + 1 > this.m_nSize) {
            this.m_nPosition = this.m_nSize;
            return 0;
        }
        return this.m_pDataView ? this.m_pDataView.getUint8(this.addpos(1)) : 0;
    };
    dByteArray.prototype.GetByte = function (pos) {
        if (pos === void 0) { pos = -1; }
        if (pos == -1) {
            var old_pos = this.GetPosition();
            var ret = this.ReadByte();
            this.SetPosition(old_pos);
            return ret;
        }
        else {
            var old_pos = this.GetPosition();
            this.SetPosition(pos);
            var ret = this.ReadByte();
            this.SetPosition(old_pos);
            return ret;
        }
        return 0;
    };
    dByteArray.prototype.ReadBoolean = function () {
        return this.ReadByte();
    };
    dByteArray.prototype.ReadShort = function () {
        if (this.m_nPosition + 2 > this.m_nSize) {
            this.m_nPosition = this.m_nSize;
            return 0;
        }
        return this.m_pDataView ? this.m_pDataView.getInt16(this.addpos(2), this.isLittleEndian()) : 0;
    };
    dByteArray.prototype.GetShort = function (pos) {
        if (pos === void 0) { pos = -1; }
        var old_pos = this.GetPosition();
        if (pos != -1)
            this.SetPosition(pos);
        var ret = this.ReadShort();
        this.SetPosition(old_pos);
        return ret;
    };
    dByteArray.prototype.ReadUnsignedShort = function () {
        if (this.m_nPosition + 2 > this.m_nSize) {
            this.m_nPosition = this.m_nSize;
            return 0;
        }
        return this.m_pDataView ? this.m_pDataView.getUint16(this.addpos(2), this.isLittleEndian()) : 0;
    };
    dByteArray.prototype.GetUnsignedShort = function (pos) {
        if (pos === void 0) { pos = -1; }
        var old_pos = this.GetPosition();
        if (pos != -1)
            this.SetPosition(pos);
        var ret = this.ReadUnsignedShort();
        this.SetPosition(old_pos);
        return ret;
    };
    dByteArray.prototype.ReadInt = function () {
        if (this.m_nPosition + 4 > this.m_nSize) {
            this.m_nPosition = this.m_nSize;
            return 0;
        }
        return this.m_pDataView ? this.m_pDataView.getInt32(this.addpos(4), this.isLittleEndian()) : 0;
    };
    dByteArray.prototype.ReadUnsignedInt = function () {
        if (this.m_nPosition + 4 > this.m_nSize) {
            this.m_nPosition = this.m_nSize;
            return 0;
        }
        return this.m_pDataView ? this.m_pDataView.getUint32(this.addpos(4), this.isLittleEndian()) : 0;
    };
    dByteArray.prototype.ReadInts = function (length) {
        if (length === void 0) { length = -1; }
        if (length == -1)
            length = this.ReadInt();
        if (length == -1)
            return null;
        var ret = new Array(length);
        for (var i = 0; i < length; i++)
            ret[i] = this.ReadInt();
        return ret;
    };
    dByteArray.prototype.ReadIntsVector = function (length) {
        var ret = new Array(length);
        for (var i = 0; i < length; i++)
            ret[i] = this.ReadInt();
        return ret;
    };
    dByteArray.prototype.GetInt = function (pos) {
        if (pos === void 0) { pos = -1; }
        var old_pos = this.GetPosition();
        if (pos != -1)
            this.SetPosition(pos);
        var ret = this.ReadInt();
        this.SetPosition(old_pos);
        return ret;
    };
    dByteArray.prototype.ReadFloat = function () {
        if (this.m_nPosition + 4 > this.m_nSize) {
            this.m_nPosition = this.m_nSize;
            return 0;
        }
        return this.m_pDataView ? this.m_pDataView.getFloat32(this.addpos(4), this.isLittleEndian()) : 0;
    };
    dByteArray.prototype.ReadFloats = function (length) {
        var ret = new Array(length);
        for (var i = 0; i < length; i++)
            ret[i] = this.ReadFloat();
        return ret;
    };
    dByteArray.prototype.ReadDouble = function () {
        if (this.m_nPosition + 8 > this.m_nSize) {
            this.m_nPosition = this.m_nSize;
            return 0;
        }
        return this.m_pDataView ? this.m_pDataView.getFloat64(this.addpos(8), this.isLittleEndian()) : 0;
    };
    dByteArray.prototype.ReadDoubles = function (length) {
        var ret = new Array(length);
        for (var i = 0; i < length; i++)
            ret[i] = this.ReadDouble();
        return ret;
    };
    dByteArray.prototype.ReadLong = function () {
        var ret = 0;
        if (this.isLittleEndian()) {
            var low = this.ReadInt();
            ret = (this.ReadInt() & 0x1FFFFF) * 0x100000000;
            if (low < 0) {
                ret += 0x80000000;
                ret += low & 0x7FFFFFFF;
            }
            else
                ret += low;
            return ret;
        }
        else {
            ret = (this.ReadInt() & 0x1FFFFF) * 0x100000000;
            var low = this.ReadInt();
            if (low < 0) {
                ret += 0x80000000;
                ret += low & 0x7FFFFFFF;
            }
            else
                ret += low;
            return ret;
        }
    };
    dByteArray.prototype.ReadLongs = function (length) {
        var ret = new Array(length);
        for (var i = 0; i < length; i++)
            ret[i] = this.ReadLong();
        return ret;
    };
    dByteArray.prototype.ReadStringZeroEnd = function (nCodePage) {
        if (nCodePage === void 0) { nCodePage = dStringUtils.CODE_PAGE_UTF8; }
        var data = new dByteArray();
        var i;
        while ((i = this.ReadByte()) != 0 && this.AvailableSize())
            data.WriteByte(i);
        return data.ToStringBuffer(nCodePage);
    };
    dByteArray.prototype.ReadStringLine = function (nCodePage) {
        if (nCodePage === void 0) { nCodePage = dStringUtils.CODE_PAGE_UTF8; }
        var data = new dByteArray();
        var i;
        while (this.AvailableSize()) {
            i = this.ReadByte();
            if (i == '\n'.charCodeAt(0) || i == '\r'.charCodeAt(0)) {
                if (i == '\r'.charCodeAt(0) && this.GetByte() == '\n'.charCodeAt(0))
                    this.Skip(1);
                break;
            }
            data.WriteByte(i);
        }
        return data.ToStringBuffer(nCodePage);
    };
    dByteArray.prototype.ReadStringWord = function (strSplit, nCodePage) {
        if (strSplit === void 0) { strSplit = ""; }
        if (nCodePage === void 0) { nCodePage = dStringUtils.CODE_PAGE_UTF8; }
        var data = new dByteArray();
        var i;
        while (this.AvailableSize()) {
            i = this.ReadByte();
            if (i <= 32 || strSplit.length && strSplit.indexOf(String.fromCharCode(i)) != -1) {
                if (data.Size() == 0)
                    continue;
                else {
                    if (i > 32)
                        this.SetPosition(this.GetPosition() - 1);
                    break;
                }
            }
            data.WriteByte(i);
        }
        return data.ToStringBuffer(nCodePage);
    };
    dByteArray.prototype.ReadString = function () {
        return this.ReadStringEx(0, dStringUtils.CODE_PAGE_UTF8);
    };
    dByteArray.prototype.ReadStringEx = function (nSizeInBits, nCodePage) {
        if (this.GetInt() == 0xFFFFFFFF) {
            this.ReadInt();
            return null;
        }
        if (nSizeInBits <= 0)
            nSizeInBits = this.ReadStringLength();
        if (nSizeInBits <= 0)
            return "";
        if (this.m_nPosition + nSizeInBits > this.m_nSize) {
            this.m_nPosition = this.m_nSize;
            return "";
        }
        if (nCodePage == dStringUtils.CODE_PAGE_UTF8)
            return this.Utf8ArrayToStr(new Uint8Array(this.m_pArraybuffer, this.addpos(nSizeInBits), nSizeInBits));
        else if (nCodePage == dStringUtils.CODE_PAGE_UNICODE)
            return String.fromCharCode.apply(null, new Uint16Array(this.m_pArraybuffer, this.addpos(nSizeInBits), nSizeInBits));
        return "";
    };
    dByteArray.prototype.ToStringBuffer = function (codePage) {
        if (codePage === void 0) { codePage = dStringUtils.CODE_PAGE_UTF8; }
        var pos = this.GetPosition();
        this.SetPosition(0);
        var magic1 = this.ReadByte();
        var magic2 = this.ReadByte();
        var magic3 = this.ReadByte();
        this.SetPosition(0);
        var ret;
        if (magic1 == 0xFF && magic2 == 0xFE) {
            this.SetPosition(2);
            var oldEndian = this.GetEndian();
            this.SetEndian(dByteArray.LITTLE_ENDIAN);
            ret = this.ReadStringEx(this.AvailableSize(), dStringUtils.CODE_PAGE_UNICODE);
            this.SetEndian(oldEndian);
        }
        else if (magic1 == 0xFE && magic2 == 0xFF) {
            this.SetPosition(2);
            var oldEndian = this.GetEndian();
            this.SetEndian(dByteArray.BIG_ENDIAN);
            ret = this.ReadStringEx(this.AvailableSize(), dStringUtils.CODE_PAGE_UNICODE);
            this.SetEndian(oldEndian);
        }
        else if (magic1 == 0xEF && magic2 == 0xBB && magic3 == 0xBF) {
            this.SetPosition(3);
            ret = this.ReadStringEx(this.AvailableSize(), dStringUtils.CODE_PAGE_UTF8);
        }
        else {
            this.SetPosition(0);
            ret = this.ReadStringEx(this.AvailableSize(), codePage);
        }
        this.SetPosition(pos);
        return ret;
    };
    dByteArray.prototype.ToBinString = function () {
        var pos = this.GetPosition();
        this.SetPosition(0);
        if (this.AvailableSize() == 0)
            return "";
        var ret = "";
        for (var i = 0, n = this.AvailableSize() * 2; i < n; i += 2) {
            var tbyte = this.ReadByte();
            var a = (tbyte & 0xF0) >> 4;
            if (a < 10)
                ret += String.fromCharCode(a + 48);
            else
                ret += String.fromCharCode(a - 10 + 65);
            a = tbyte & 0xF;
            if (a < 10)
                ret += String.fromCharCode(a + 48);
            else
                ret += String.fromCharCode(a - 10 + 65);
        }
        return ret;
    };
    dByteArray.prototype.WriteFromBinString = function (str) {
        var s = "";
        for (var i = 0; i < str.length; i += 2) {
            s = "0x" + str.charAt(i) + str.charAt(i + 1);
            var data = dMath.ParseInt(s, 16);
            this.WriteByte(data);
        }
    };
    dByteArray.prototype.ReadBinTo = function (to, size) {
        if (size === void 0) { size = -1; }
        var thisPos = this.GetPosition();
        var pos = to.GetPosition();
        if (size == -1)
            size = this.AvailableSize();
        else if (size > this.AvailableSize())
            size = this.AvailableSize();
        to.requreSize(size);
        for (var i = 0; i < size; i++)
            to.m_pDataView.setInt8(to.addpos(1), this.m_pDataView.getInt8(this.m_nPosition + i));
        this.SetPosition(thisPos + size);
        to.SetPosition(pos);
    };
    dByteArray.prototype.ReadBin = function () {
        return this.ReadBinEx(this.AvailableSize());
    };
    dByteArray.prototype.ReadBinEx = function (size) {
        var pos = this.GetPosition();
        var ret = new dByteArray();
        if (size > this.AvailableSize())
            size = this.AvailableSize();
        var ret = new dByteArray();
        ret.requireSizeDirect(size);
        ret.WriteBin(this, this.GetPosition(), size);
        ret.SetPosition(0);
        this.SetPosition(this.GetPosition() + size);
        ret.SetEndian(this.GetEndian());
        this.SetPosition(pos + size);
        return ret;
    };
    dByteArray.prototype.ReadBytes = function (size) {
        var ret = new Array(size);
        for (var i = 0; i < size; i++)
            ret[i] = this.ReadByte();
        return ret;
    };
    dByteArray.prototype.ReadBytesTo = function (to, toOffset, size) {
        if (size > this.AvailableSize())
            size = this.AvailableSize();
        if (this.m_pDataView == null)
            return;
        for (var i = 0; i < size; i++) {
            if (this.m_nPosition + 1 > this.m_nSize) {
                this.m_nPosition = this.m_nSize;
                return;
            }
            to[i + toOffset] = this.m_pDataView.getUint8(this.addpos(1));
        }
        return size;
    };
    dByteArray.prototype.WriteByte = function (data, pos) {
        if (pos === void 0) { pos = -1; }
        if (pos == -1) {
            this.requreSize(1);
            this.m_pDataView.setInt8(this.addpos(1), data);
        }
        else {
            var pos2 = this.GetPosition();
            this.SetPosition(pos);
            this.WriteByte(data);
            this.SetPosition(pos2);
        }
    };
    dByteArray.prototype.WriteBoolean = function (data) {
        return this.WriteByte(Number(data));
    };
    dByteArray.prototype.WriteBytes = function (arr, offset, size) {
        if (offset === void 0) { offset = 0; }
        if (size === void 0) { size = -1; }
        if (size == -1)
            size = arr.length;
        this.requreSize(size);
        for (var i = 0; i < size; i++)
            this.m_pDataView.setInt8(this.addpos(1), arr[i + offset]);
    };
    dByteArray.prototype.WriteBytesEx = function (arr, offset, count) {
        for (var i = offset, n = count; i < n; i++)
            this.WriteByte(arr[i]);
        return count;
    };
    dByteArray.prototype.WriteShort = function (data, pos) {
        if (pos === void 0) { pos = -1; }
        if (pos == -1) {
            this.requreSize(2);
            this.m_pDataView.setInt16(this.addpos(2), data, this.isLittleEndian());
        }
        else {
            var oldPos = this.GetPosition();
            this.SetPosition(pos);
            this.WriteShort(data);
            this.SetPosition(oldPos);
        }
    };
    dByteArray.prototype.WriteInt = function (data, pos) {
        if (pos === void 0) { pos = -1; }
        if (pos == -1) {
            this.requreSize(4);
            this.m_pDataView.setInt32(this.addpos(4), data, this.isLittleEndian());
        }
        else {
            var oldPos = this.GetPosition();
            this.SetPosition(pos);
            this.WriteInt(data);
            this.SetPosition(oldPos);
        }
    };
    dByteArray.prototype.WriteInts = function (arr, length, bWriteLength) {
        if (length === void 0) { length = -1; }
        if (bWriteLength === void 0) { bWriteLength = false; }
        if (arr == null && bWriteLength)
            this.WriteInt(-1);
        else {
            if (length == -1)
                length = arr.length;
            if (bWriteLength)
                this.WriteInt(length);
            for (var i = 0; i < length; i++)
                this.WriteInt(arr[i]);
        }
    };
    dByteArray.prototype.WriteFloat = function (data) {
        this.requreSize(4);
        this.m_pDataView.setFloat32(this.addpos(4), data, this.isLittleEndian());
    };
    dByteArray.prototype.WriteFloats = function (arr, length) {
        if (length === void 0) { length = -1; }
        if (length == -1)
            length = arr.length;
        for (var i = 0; i < length; i++)
            this.WriteFloat(arr[i]);
    };
    dByteArray.prototype.WriteDouble = function (data) {
        this.requreSize(8);
        this.m_pDataView.setFloat64(this.addpos(8), data, this.isLittleEndian());
    };
    dByteArray.prototype.WriteDoubles = function (arr) {
        for (var i = 0, n = arr.length; i < n; i++)
            this.WriteDouble(arr[i]);
    };
    dByteArray.prototype.WriteLong = function (data) {
        if (this.isLittleEndian()) {
            this.WriteInt(data & 0xffffffff);
            this.WriteInt((data / 0x100000000) & 0xffffffff);
        }
        else {
            this.WriteInt((data / 0x100000000) & 0xffffffff);
            this.WriteInt(data & 0xffffffff);
        }
    };
    dByteArray.prototype.WriteLongs = function (arr) {
        for (var i = 0, n = arr.length; i < n; i++)
            this.WriteLong(arr[i]);
    };
    dByteArray.prototype.WriteString = function (data) {
        this.WriteStringEx(data, true, dStringUtils.CODE_PAGE_UTF8);
    };
    dByteArray.prototype.WriteStringEx = function (str, bWriteLength, charset) {
        if (bWriteLength === void 0) { bWriteLength = true; }
        if (charset === void 0) { charset = dStringUtils.CODE_PAGE_UTF8; }
        if (str == null && bWriteLength) {
            this.WriteInt(0xFFFFFFFF);
        }
        else {
            if (charset == dStringUtils.CODE_PAGE_UNICODE) {
                if (bWriteLength)
                    this.WriteStringLength(str.length * 2);
                for (var i = 0, strLen = str.length; i < strLen; i++)
                    this.WriteShort(str.charCodeAt(i));
            }
            else if (charset == dStringUtils.CODE_PAGE_UTF8) {
                var ab = this.str2ab(str);
                var len = ab.byteLength;
                if (bWriteLength)
                    this.WriteStringLength(len);
                for (var i = 0; i < len; i++)
                    this.WriteByte(ab[i]);
            }
        }
        return this;
    };
    dByteArray.prototype.WriteStringLength = function (len) {
        if (len <= 0x7fff)
            this.WriteShort(len);
        else {
            var a = (len & 0xFFFF8000) >> 15;
            var b = len & 0x7FFF;
            this.WriteShort(b | 0x8000);
            this.WriteShort(a);
        }
    };
    dByteArray.prototype.ReadStringLength = function () {
        var b = this.ReadUnsignedShort();
        if ((b & 0x8000) == 0)
            return b;
        b &= 0x7FFF;
        var a = this.ReadUnsignedShort();
        return (a << 15) | b;
    };
    dByteArray.prototype.WriteStringLengthed = function (data, length, charset) {
        if (charset === void 0) { charset = dStringUtils.CODE_PAGE_UTF8; }
        var arr = new dByteArray();
        arr.WriteStringEx(data, false, charset);
        arr.SetPosition(0);
        for (var i = 0; i < length; i++)
            this.WriteByte(arr.ReadByte());
    };
    dByteArray.prototype.WriteBin = function (data, startPos, length) {
        if (startPos === void 0) { startPos = -1; }
        if (length === void 0) { length = -1; }
        if (startPos == -1)
            startPos = data.GetPosition();
        var pos = data.GetPosition();
        data.SetPosition(startPos);
        if (length == -1)
            length = data.AvailableSize();
        this.WriteBinEx(data, length);
        data.SetPosition(pos);
    };
    dByteArray.prototype.WriteBinEx = function (pFrom, size) {
        var pos = this.GetPosition();
        if (size > pFrom.AvailableSize())
            size = pFrom.AvailableSize();
        this.requreSize(size);
        for (var i = 0; i < size; i++)
            this.m_pDataView.setInt8(this.addpos(1), pFrom.m_pDataView.getInt8(pFrom.m_nPosition + i));
        this.SetPosition(pos);
    };
    dByteArray.prototype.Size = function () {
        return this.m_nSize;
    };
    dByteArray.prototype.Resize = function (size) {
        if (this.Size() < size) {
            for (var i = this.Size(); i < size; i++)
                this.WriteByte(0);
        }
        else {
            this.SetPosition(0);
            this.m_nSize = size;
        }
    };
    dByteArray.prototype.AvailableSize = function () {
        return this.m_nSize - this.m_nPosition;
    };
    dByteArray.prototype.GetPosition = function () {
        return this.m_nPosition;
    };
    dByteArray.prototype.SetPosition = function (pos) {
        if (pos < 0)
            pos = 0;
        if (pos > this.Size())
            pos = this.Size();
        this.m_nPosition = pos;
    };
    dByteArray.prototype.Seek = function (pos) {
        this.SetPosition(pos);
        while (this.GetPosition() < pos) {
            this.WriteByte(0);
        }
    };
    dByteArray.prototype.Skip = function (size) {
        this.SetPosition(this.GetPosition() + size);
    };
    dByteArray.prototype.GetEndian = function () {
        return this.m_nEndian;
    };
    dByteArray.prototype.SetEndian = function (endian) {
        this.m_nEndian = endian;
    };
    dByteArray.prototype.LoadFromFile = function (url, onLoadComplete, onProgress, onFailed, startOffset, length) {
        if (onLoadComplete === void 0) { onLoadComplete = null; }
        if (onProgress === void 0) { onProgress = null; }
        if (onFailed === void 0) { onFailed = null; }
        if (startOffset === void 0) { startOffset = 0; }
        if (length === void 0) { length = -1; }
        var p = this;
        dInterface.ptr.LoadArrayBuffer(url, function (response) {
            if (response) {
                p.m_pArraybuffer = response;
                p.m_pDataView = new DataView(p.m_pArraybuffer);
                p.m_nSize = p.m_nSysSize = p.m_pDataView.byteLength;
                p.m_nPosition = 0;
                if (onLoadComplete)
                    onLoadComplete(p);
            }
            else {
                if (onFailed)
                    onFailed(p);
            }
        });
    };
    dByteArray.prototype.SaveToFile = function (url, onLoadComplete, onProgress, onFailed, bShowDialog, additional) {
        if (onLoadComplete === void 0) { onLoadComplete = null; }
        if (onProgress === void 0) { onProgress = null; }
        if (onFailed === void 0) { onFailed = null; }
        if (bShowDialog === void 0) { bShowDialog = false; }
        if (additional === void 0) { additional = false; }
        return false;
    };
    dByteArray.OpenFile = function (strNotify, strFileType, bMultiFile, onLoadComplete, onFailed) {
        if (onLoadComplete === void 0) { onLoadComplete = null; }
        if (onFailed === void 0) { onFailed = null; }
    };
    dByteArray.prototype.EraseValid = function () {
        var ret = new dByteArray();
        ret.SetEndian(this.GetEndian());
        ret.WriteBin(this);
        ret.SetPosition(0);
        return ret;
    };
    dByteArray.prototype.Compress = function (method) {
        if (method === void 0) { method = "zlib"; }
    };
    dByteArray.prototype.Uncompress = function (method, uncompressSize) {
        if (method === void 0) { method = "zlib"; }
        if (uncompressSize === void 0) { uncompressSize = 0; }
        var out = __dByteArrayZip.zip_inflate(this.m_pDataView);
        this.m_pDataView = out.m_pDataView;
        this.m_pArraybuffer = out.m_pArraybuffer;
        this.m_nSize = out.m_nSize;
        this.m_nSysSize = out.m_nSysSize;
        this.m_nPosition = 0;
    };
    dByteArray.prototype.ToBytes = function () {
        var ret = new Array(this.Size());
        for (var i = 0, n = this.Size(); i < n; i++)
            ret[i] = this.GetByte(i);
        return ret;
    };
    dByteArray.prototype.GetBytes = function () {
        var ret = new Array(this.AvailableSize());
        for (var i = 0; this.AvailableSize() > 0; i++)
            ret[i] = this.ReadByte();
        return ret;
    };
    dByteArray.EnumFileList = function (strFilePath, bWithFolder, strExtNames) {
        if (strExtNames === void 0) { strExtNames = null; }
        return null;
    };
    dByteArray.prototype.WriteMatrix = function (mat) {
        mat.WriteToBin(this);
    };
    dByteArray.prototype.ReadMatrix = function () {
        return new dMatrix().ReadFromBin(this);
    };
    dByteArray.prototype.ReadVector2 = function () {
        return new dVector2().ReadFromBin(this);
    };
    dByteArray.prototype.ReadVector3 = function () {
        return new dVector3().ReadFromBin(this);
    };
    dByteArray.prototype.ReadVector4 = function () {
        return new dVector4().ReadFromBin(this);
    };
    dByteArray.prototype.WriteByteArray = function (data) {
        if (data == null)
            this.WriteInt(-1);
        else {
            data.SetPosition(0);
            this.WriteInt(data.Size());
            if (data.Size() > 0)
                this.WriteBin(data);
        }
    };
    dByteArray.prototype.ReadByteArray = function () {
        var size = this.ReadInt();
        if (size == -1)
            return null;
        if (size == 0)
            return new dByteArray();
        return this.ReadBinEx(size);
    };
    dByteArray.prototype.WriteArrayStringString = function (arr) {
        var e_4, _a;
        if (arr == null)
            this.WriteInt(-1);
        else {
            this.WriteInt(arr.size);
            try {
                for (var _b = __values(arr.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var key = _c.value;
                    this.WriteString(key);
                    this.WriteString(arr.get(key));
                }
            }
            catch (e_4_1) { e_4 = { error: e_4_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_4) throw e_4.error; }
            }
        }
    };
    dByteArray.prototype.ReadArrayStringString = function () {
        var size = this.ReadInt();
        if (size < 0)
            return null;
        var ret = new Map();
        for (var i = 0; i < size; i++) {
            ret.set(this.ReadString(), this.ReadString());
        }
        return ret;
    };
    dByteArray.prototype.SetClipboard = function (type) {
        if (type === void 0) { type = "DataObject"; }
    };
    dByteArray.prototype.FromClipboard = function (type) {
        if (type === void 0) { type = "DataObject"; }
        return false;
    };
    dByteArray.ReadStorage = function (key, onComplete, defaultRet) {
        if (defaultRet === void 0) { defaultRet = null; }
        dInterface.ptr.ReadStorage(key, onComplete, defaultRet);
    };
    dByteArray.WriteStorage = function (key, value) {
        dInterface.ptr.WriteStorage(key, value);
    };
    dByteArray.prototype.Utf8ArrayToStr = function (array) {
        var out, i, len, c;
        var char2, char3;
        out = "";
        len = array.length;
        i = 0;
        while (i < len) {
            c = array[i++];
            switch (c >> 4) {
                case 0:
                case 1:
                case 2:
                case 3:
                case 4:
                case 5:
                case 6:
                case 7:
                    out += String.fromCharCode(c);
                    break;
                case 12:
                case 13:
                    char2 = array[i++];
                    out += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));
                    break;
                case 14:
                    char2 = array[i++];
                    char3 = array[i++];
                    out += String.fromCharCode(((c & 0x0F) << 12) |
                        ((char2 & 0x3F) << 6) |
                        ((char3 & 0x3F) << 0));
                    break;
            }
        }
        return out;
    };
    dByteArray.prototype.str2ab = function (str) {
        var s = unescape(encodeURIComponent(str));
        var buf = new ArrayBuffer(s.length);
        var bufView = new Uint8Array(buf);
        for (var i = 0, strLen = s.length; i < strLen; i++) {
            bufView[i] = s.charCodeAt(i);
        }
        return bufView;
    };
    dByteArray.BIG_ENDIAN = 0;
    dByteArray.LITTLE_ENDIAN = 1;
    return dByteArray;
}(dObject));
var __dByteArrayZip;
(function (__dByteArrayZip) {
    var zip_WSIZE = 32768;
    var zip_STORED_BLOCK = 0;
    var zip_STATIC_TREES = 1;
    var zip_DYN_TREES = 2;
    var zip_lbits = 9;
    var zip_dbits = 6;
    var zip_INBUFSIZ = 32768;
    var zip_INBUF_EXTRA = 64;
    var zip_slide;
    var zip_wp;
    var zip_fixed_tl = null;
    var zip_fixed_td;
    var zip_fixed_bl, zip_fixed_bd;
    var zip_bit_buf;
    var zip_bit_len;
    var zip_method;
    var zip_eof;
    var zip_copy_leng;
    var zip_copy_dist;
    var zip_tl, zip_td;
    var zip_bl, zip_bd;
    var zip_inflate_data;
    var zip_inflate_pos;
    var zip_MASK_BITS = new Array(0x0000, 0x0001, 0x0003, 0x0007, 0x000f, 0x001f, 0x003f, 0x007f, 0x00ff, 0x01ff, 0x03ff, 0x07ff, 0x0fff, 0x1fff, 0x3fff, 0x7fff, 0xffff);
    var zip_cplens = new Array(3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31, 35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258, 0, 0);
    var zip_cplext = new Array(0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0, 99, 99);
    var zip_cpdist = new Array(1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, 257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145, 8193, 12289, 16385, 24577);
    var zip_cpdext = new Array(0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13);
    var zip_border = new Array(16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15);
    function zip_HuftList() {
        this.next = null;
        this.list = null;
    }
    function zip_HuftNode() {
        this.e = 0;
        this.b = 0;
        this.n = 0;
        this.t = null;
    }
    function zip_HuftBuild(b, n, s, d, e, mm) {
        this.BMAX = 16;
        this.N_MAX = 288;
        this.status = 0;
        this.root = null;
        this.m = 0;
        {
            var a;
            var c = new Array(this.BMAX + 1);
            var el;
            var f;
            var g;
            var h;
            var i;
            var j;
            var k;
            var lx = new Array(this.BMAX + 1);
            var p;
            var pidx;
            var q;
            var r = new zip_HuftNode();
            var u = new Array(this.BMAX);
            var v = new Array(this.N_MAX);
            var w;
            var x = new Array(this.BMAX + 1);
            var xp;
            var y;
            var z;
            var o;
            var tail;
            tail = this.root = null;
            for (i = 0; i < c.length; i++)
                c[i] = 0;
            for (i = 0; i < lx.length; i++)
                lx[i] = 0;
            for (i = 0; i < u.length; i++)
                u[i] = null;
            for (i = 0; i < v.length; i++)
                v[i] = 0;
            for (i = 0; i < x.length; i++)
                x[i] = 0;
            el = n > 256 ? b[256] : this.BMAX;
            p = b;
            pidx = 0;
            i = n;
            do {
                c[p[pidx]]++;
                pidx++;
            } while (--i > 0);
            if (c[0] == n) {
                this.root = null;
                this.m = 0;
                this.status = 0;
                return;
            }
            for (j = 1; j <= this.BMAX; j++)
                if (c[j] != 0)
                    break;
            k = j;
            if (mm < j)
                mm = j;
            for (i = this.BMAX; i != 0; i--)
                if (c[i] != 0)
                    break;
            g = i;
            if (mm > i)
                mm = i;
            for (y = 1 << j; j < i; j++, y <<= 1)
                if ((y -= c[j]) < 0) {
                    this.status = 2;
                    this.m = mm;
                    return;
                }
            if ((y -= c[i]) < 0) {
                this.status = 2;
                this.m = mm;
                return;
            }
            c[i] += y;
            x[1] = j = 0;
            p = c;
            pidx = 1;
            xp = 2;
            while (--i > 0)
                x[xp++] = (j += p[pidx++]);
            p = b;
            pidx = 0;
            i = 0;
            do {
                if ((j = p[pidx++]) != 0)
                    v[x[j]++] = i;
            } while (++i < n);
            n = x[g];
            x[0] = i = 0;
            p = v;
            pidx = 0;
            h = -1;
            w = lx[0] = 0;
            q = null;
            z = 0;
            for (; k <= g; k++) {
                a = c[k];
                while (a-- > 0) {
                    while (k > w + lx[1 + h]) {
                        w += lx[1 + h];
                        h++;
                        z = (z = g - w) > mm ? mm : z;
                        if ((f = 1 << (j = k - w)) > a + 1) {
                            f -= a + 1;
                            xp = k;
                            while (++j < z) {
                                if ((f <<= 1) <= c[++xp])
                                    break;
                                f -= c[xp];
                            }
                        }
                        if (w + j > el && w < el)
                            j = el - w;
                        z = 1 << j;
                        lx[1 + h] = j;
                        q = new Array(z);
                        for (o = 0; o < z; o++) {
                            q[o] = new zip_HuftNode();
                        }
                        if (tail == null)
                            tail = this.root = new zip_HuftList();
                        else
                            tail = tail.next = new zip_HuftList();
                        tail.next = null;
                        tail.list = q;
                        u[h] = q;
                        if (h > 0) {
                            x[h] = i;
                            r.b = lx[h];
                            r.e = 16 + j;
                            r.t = q;
                            j = (i & ((1 << w) - 1)) >> (w - lx[h]);
                            u[h - 1][j].e = r.e;
                            u[h - 1][j].b = r.b;
                            u[h - 1][j].n = r.n;
                            u[h - 1][j].t = r.t;
                        }
                    }
                    r.b = k - w;
                    if (pidx >= n)
                        r.e = 99;
                    else if (p[pidx] < s) {
                        r.e = (p[pidx] < 256 ? 16 : 15);
                        r.n = p[pidx++];
                    }
                    else {
                        r.e = e[p[pidx] - s];
                        r.n = d[p[pidx++] - s];
                    }
                    f = 1 << (k - w);
                    for (j = i >> w; j < z; j += f) {
                        q[j].e = r.e;
                        q[j].b = r.b;
                        q[j].n = r.n;
                        q[j].t = r.t;
                    }
                    for (j = 1 << (k - 1); (i & j) != 0; j >>= 1)
                        i ^= j;
                    i ^= j;
                    while ((i & ((1 << w) - 1)) != x[h]) {
                        w -= lx[h];
                        h--;
                    }
                }
            }
            this.m = lx[1];
            this.status = ((y != 0 && g != 1) ? 1 : 0);
        }
    }
    function zip_GET_BYTE() {
        if (zip_inflate_data.length == zip_inflate_pos)
            return -1;
        var ret = zip_inflate_data.getUint8(zip_inflate_pos++);
        return ret;
    }
    function zip_NEEDBITS(n) {
        while (zip_bit_len < n) {
            zip_bit_buf |= zip_GET_BYTE() << zip_bit_len;
            zip_bit_len += 8;
        }
    }
    function zip_GETBITS(n) {
        return zip_bit_buf & zip_MASK_BITS[n];
    }
    function zip_DUMPBITS(n) {
        zip_bit_buf >>= n;
        zip_bit_len -= n;
    }
    function zip_inflate_codes(buff, off, size) {
        var e;
        var t;
        var n;
        if (size == 0)
            return 0;
        n = 0;
        for (;;) {
            zip_NEEDBITS(zip_bl);
            t = zip_tl.list[zip_GETBITS(zip_bl)];
            e = t.e;
            while (e > 16) {
                if (e == 99)
                    return -1;
                zip_DUMPBITS(t.b);
                e -= 16;
                zip_NEEDBITS(e);
                t = t.t[zip_GETBITS(e)];
                e = t.e;
            }
            zip_DUMPBITS(t.b);
            if (e == 16) {
                zip_wp &= zip_WSIZE - 1;
                buff.setInt8(off + n++, zip_slide[zip_wp++] = t.n);
                if (n == size)
                    return size;
                continue;
            }
            if (e == 15)
                break;
            zip_NEEDBITS(e);
            zip_copy_leng = t.n + zip_GETBITS(e);
            zip_DUMPBITS(e);
            zip_NEEDBITS(zip_bd);
            t = zip_td.list[zip_GETBITS(zip_bd)];
            e = t.e;
            while (e > 16) {
                if (e == 99)
                    return -1;
                zip_DUMPBITS(t.b);
                e -= 16;
                zip_NEEDBITS(e);
                t = t.t[zip_GETBITS(e)];
                e = t.e;
            }
            zip_DUMPBITS(t.b);
            zip_NEEDBITS(e);
            zip_copy_dist = zip_wp - t.n - zip_GETBITS(e);
            zip_DUMPBITS(e);
            while (zip_copy_leng > 0 && n < size) {
                zip_copy_leng--;
                zip_copy_dist &= zip_WSIZE - 1;
                zip_wp &= zip_WSIZE - 1;
                buff.setInt8(off + n++, zip_slide[zip_wp++] = zip_slide[zip_copy_dist++]);
            }
            if (n == size)
                return size;
        }
        zip_method = -1;
        return n;
    }
    function zip_inflate_stored(buff, off, size) {
        var n;
        n = zip_bit_len & 7;
        zip_DUMPBITS(n);
        zip_NEEDBITS(16);
        n = zip_GETBITS(16);
        zip_DUMPBITS(16);
        zip_NEEDBITS(16);
        if (n != ((~zip_bit_buf) & 0xffff))
            return -1;
        zip_DUMPBITS(16);
        zip_copy_leng = n;
        n = 0;
        while (zip_copy_leng > 0 && n < size) {
            zip_copy_leng--;
            zip_wp &= zip_WSIZE - 1;
            zip_NEEDBITS(8);
            buff.setInt8(off + n++, zip_slide[zip_wp++] = zip_GETBITS(8));
            zip_DUMPBITS(8);
        }
        if (zip_copy_leng == 0)
            zip_method = -1;
        return n;
    }
    function zip_inflate_fixed(buff, off, size) {
        if (zip_fixed_tl == null) {
            var i;
            var l = new Array(288);
            var h;
            for (i = 0; i < 144; i++)
                l[i] = 8;
            for (; i < 256; i++)
                l[i] = 9;
            for (; i < 280; i++)
                l[i] = 7;
            for (; i < 288; i++)
                l[i] = 8;
            zip_fixed_bl = 7;
            h = new zip_HuftBuild(l, 288, 257, zip_cplens, zip_cplext, zip_fixed_bl);
            if (h.status != 0) {
                alert("HufBuild error: " + h.status);
                return -1;
            }
            zip_fixed_tl = h.root;
            zip_fixed_bl = h.m;
            for (i = 0; i < 30; i++)
                l[i] = 5;
            zip_fixed_bd = 5;
            h = new zip_HuftBuild(l, 30, 0, zip_cpdist, zip_cpdext, zip_fixed_bd);
            if (h.status > 1) {
                zip_fixed_tl = null;
                alert("HufBuild error: " + h.status);
                return -1;
            }
            zip_fixed_td = h.root;
            zip_fixed_bd = h.m;
        }
        zip_tl = zip_fixed_tl;
        zip_td = zip_fixed_td;
        zip_bl = zip_fixed_bl;
        zip_bd = zip_fixed_bd;
        return zip_inflate_codes(buff, off, size);
    }
    function zip_inflate_dynamic(buff, off, size) {
        var i;
        var j;
        var l;
        var n;
        var t;
        var nb;
        var nl;
        var nd;
        var ll = new Array(286 + 30);
        var h;
        for (i = 0; i < ll.length; i++)
            ll[i] = 0;
        zip_NEEDBITS(5);
        nl = 257 + zip_GETBITS(5);
        zip_DUMPBITS(5);
        zip_NEEDBITS(5);
        nd = 1 + zip_GETBITS(5);
        zip_DUMPBITS(5);
        zip_NEEDBITS(4);
        nb = 4 + zip_GETBITS(4);
        zip_DUMPBITS(4);
        if (nl > 286 || nd > 30)
            return -1;
        for (j = 0; j < nb; j++) {
            zip_NEEDBITS(3);
            ll[zip_border[j]] = zip_GETBITS(3);
            zip_DUMPBITS(3);
        }
        for (; j < 19; j++)
            ll[zip_border[j]] = 0;
        zip_bl = 7;
        h = new zip_HuftBuild(ll, 19, 19, null, null, zip_bl);
        if (h.status != 0)
            return -1;
        zip_tl = h.root;
        zip_bl = h.m;
        n = nl + nd;
        i = l = 0;
        while (i < n) {
            zip_NEEDBITS(zip_bl);
            t = zip_tl.list[zip_GETBITS(zip_bl)];
            j = t.b;
            zip_DUMPBITS(j);
            j = t.n;
            if (j < 16)
                ll[i++] = l = j;
            else if (j == 16) {
                zip_NEEDBITS(2);
                j = 3 + zip_GETBITS(2);
                zip_DUMPBITS(2);
                if (i + j > n)
                    return -1;
                while (j-- > 0)
                    ll[i++] = l;
            }
            else if (j == 17) {
                zip_NEEDBITS(3);
                j = 3 + zip_GETBITS(3);
                zip_DUMPBITS(3);
                if (i + j > n)
                    return -1;
                while (j-- > 0)
                    ll[i++] = 0;
                l = 0;
            }
            else {
                zip_NEEDBITS(7);
                j = 11 + zip_GETBITS(7);
                zip_DUMPBITS(7);
                if (i + j > n)
                    return -1;
                while (j-- > 0)
                    ll[i++] = 0;
                l = 0;
            }
        }
        zip_bl = zip_lbits;
        h = new zip_HuftBuild(ll, nl, 257, zip_cplens, zip_cplext, zip_bl);
        if (zip_bl == 0)
            h.status = 1;
        if (h.status != 0) {
            if (h.status == 1) {
            }
            return -1;
        }
        zip_tl = h.root;
        zip_bl = h.m;
        for (i = 0; i < nd; i++)
            ll[i] = ll[i + nl];
        zip_bd = zip_dbits;
        h = new zip_HuftBuild(ll, nd, 0, zip_cpdist, zip_cpdext, zip_bd);
        zip_td = h.root;
        zip_bd = h.m;
        if (zip_bd == 0 && nl > 257) {
            return -1;
        }
        if (h.status == 1) {
            ;
        }
        if (h.status != 0)
            return -1;
        return zip_inflate_codes(buff, off, size);
    }
    function zip_inflate_start() {
        var i;
        if (zip_slide == null)
            zip_slide = new Array(2 * zip_WSIZE);
        zip_wp = 0;
        zip_bit_buf = 0;
        zip_bit_len = 0;
        zip_method = -1;
        zip_eof = false;
        zip_copy_leng = zip_copy_dist = 0;
        zip_tl = null;
    }
    function zip_inflate_internal(buff, off, size) {
        var n, i;
        n = 0;
        while (n < size) {
            if (zip_eof && zip_method == -1)
                return n;
            if (zip_copy_leng > 0) {
                if (zip_method != zip_STORED_BLOCK) {
                    while (zip_copy_leng > 0 && n < size) {
                        zip_copy_leng--;
                        zip_copy_dist &= zip_WSIZE - 1;
                        zip_wp &= zip_WSIZE - 1;
                        buff.setInt8(off + n++, zip_slide[zip_wp++] = zip_slide[zip_copy_dist++]);
                    }
                }
                else {
                    while (zip_copy_leng > 0 && n < size) {
                        zip_copy_leng--;
                        zip_wp &= zip_WSIZE - 1;
                        zip_NEEDBITS(8);
                        buff.setInt8(off + n++, zip_slide[zip_wp++] = zip_GETBITS(8));
                        zip_DUMPBITS(8);
                    }
                    if (zip_copy_leng == 0)
                        zip_method = -1;
                }
                if (n == size)
                    return n;
            }
            if (zip_method == -1) {
                if (zip_eof)
                    break;
                zip_NEEDBITS(1);
                if (zip_GETBITS(1) != 0)
                    zip_eof = true;
                zip_DUMPBITS(1);
                zip_NEEDBITS(2);
                zip_method = zip_GETBITS(2);
                zip_DUMPBITS(2);
                zip_tl = null;
                zip_copy_leng = 0;
            }
            switch (zip_method) {
                case 0:
                    i = zip_inflate_stored(buff, off + n, size - n);
                    break;
                case 1:
                    if (zip_tl != null)
                        i = zip_inflate_codes(buff, off + n, size - n);
                    else
                        i = zip_inflate_fixed(buff, off + n, size - n);
                    break;
                case 2:
                    if (zip_tl != null)
                        i = zip_inflate_codes(buff, off + n, size - n);
                    else
                        i = zip_inflate_dynamic(buff, off + n, size - n);
                    break;
                default:
                    i = -1;
                    break;
            }
            if (i == -1) {
                if (zip_eof)
                    return 0;
                return -1;
            }
            n += i;
        }
        return n;
    }
    function zip_inflate(str) {
        var out, buff;
        var i, j;
        zip_inflate_start();
        zip_inflate_data = str;
        zip_inflate_pos = 0;
        var arrayBuffer = new ArrayBuffer(10240);
        var outData = new DataView(arrayBuffer);
        out = new dByteArray();
        while (true) {
            if ((i = zip_inflate_internal(outData, 0, outData.byteLength)) > 0) {
                var size = i;
                for (var j = 0; j < size; j++)
                    out.WriteByte(outData.getInt8(j));
            }
            else {
                zip_inflate_data = null;
                break;
            }
        }
        return out;
    }
    __dByteArrayZip.zip_inflate = zip_inflate;
    function zip_inflate2(str, progressCallback, completeCallback) {
        var out, buff;
        var i, j;
        zip_inflate_start();
        zip_inflate_data = str;
        zip_inflate_pos = 0;
        var arrayBuffer = new ArrayBuffer(10240);
        var outData = new DataView(arrayBuffer);
        out = "";
        var id = setInterval(function () {
            for (var j = 0; j < 10; j++) {
                if ((i = zip_inflate_internal(outData, 0, outData.byteLength)) > 0) {
                    progressCallback(zip_inflate_pos / str.byteLength);
                    out += String.fromCharCode.apply(null, new Uint8Array(arrayBuffer, 0, i));
                }
                else {
                    clearInterval(id);
                    out = decodeURIComponent(escape(out));
                    zip_inflate_data = null;
                    completeCallback(out);
                    break;
                }
            }
        }, 1);
    }
})(__dByteArrayZip || (__dByteArrayZip = {}));
;
var dCompleteCallback = (function (_super) {
    __extends(dCompleteCallback, _super);
    function dCompleteCallback(target) {
        if (target === void 0) { target = null; }
        var _this = _super.call(this) || this;
        _this.m_nCompleteRef = 0;
        _this.m_nCompleteRefTotal = 0;
        _this.m_onComplete = null;
        _this.m_onProgress = null;
        _this.m_pTarget = null;
        _this.m_pTarget = target;
        return _this;
    }
    dCompleteCallback.prototype.SetProgress = function (onProgress) {
        this.m_onProgress = onProgress;
    };
    dCompleteCallback.prototype.SetCompleteFun = function (onComplete) {
        this.m_onComplete = onComplete;
        if (this.m_nCompleteRef == this.m_nCompleteRefTotal && this.m_onComplete != null)
            this.m_onComplete(this.m_pTarget);
    };
    dCompleteCallback.prototype.CreateCompleteFun_Normal = function () {
        var _this = this;
        this.m_nCompleteRefTotal++;
        return function (target) {
            _this.DoComplete();
        };
    };
    dCompleteCallback.prototype.CreateFailedFun_Normal = function () {
        var _this = this;
        return function (target) {
            _this.DoComplete();
        };
    };
    dCompleteCallback.prototype.Add = function (count) {
        if (count === void 0) { count = 1; }
        this.m_nCompleteRefTotal += count;
    };
    dCompleteCallback.prototype.GetCompleteRefTotal = function () {
        return this.m_nCompleteRefTotal;
    };
    dCompleteCallback.prototype.GetCompleteRef = function () {
        return this.m_nCompleteRef;
    };
    dCompleteCallback.prototype.DoComplete = function () {
        this.m_nCompleteRef++;
        if (this.m_onProgress)
            this.m_onProgress(this, this.m_nCompleteRef * 100 / this.m_nCompleteRefTotal);
        if (this.m_nCompleteRef == this.m_nCompleteRefTotal && this.m_onComplete)
            this.m_onComplete(this.m_pTarget);
    };
    return dCompleteCallback;
}(dObject));
var dDateTime = (function (_super) {
    __extends(dDateTime, _super);
    function dDateTime() {
        var _this = _super.call(this) || this;
        _this.year = 0;
        _this.month = 0;
        _this.day = 0;
        _this.hour = 0;
        _this.minute = 0;
        _this.second = 0;
        _this.milliseconds = 0;
        return _this;
    }
    dDateTime.NowTime = function () {
        var date = new Date();
        var ret = new dDateTime();
        ret.year = date.getFullYear();
        ret.month = date.getMonth() + 1;
        ret.day = date.getDate();
        ret.hour = date.getHours();
        ret.minute = date.getMinutes();
        ret.second = date.getSeconds();
        ret.milliseconds = date.getMilliseconds();
        return ret;
    };
    dDateTime.GetTimeZone = function () {
        return 0;
    };
    dDateTime.prototype.Copy = function (from) {
        this.year = from.year;
        this.month = from.month;
        this.day = from.day;
        this.hour = from.hour;
        this.minute = from.minute;
        this.second = from.second;
        this.milliseconds = from.milliseconds;
        return this;
    };
    dDateTime.prototype.ToYearMonthDay = function (split) {
        if (split === void 0) { split = "-"; }
        var str = dStringUtils.FormatInt(this.year, 4) + split +
            dStringUtils.FormatInt(this.month, 2) + split +
            dStringUtils.FormatInt(this.day, 2);
        return str;
    };
    dDateTime.prototype.ToDosTime = function () {
        var ret = ((this.year - 1980) & 0x7f) << 25
            | (this.month + 1) << 21
            | this.day << 16
            | this.hour << 11
            | this.minute << 5
            | this.second >> 1;
        return ret;
    };
    dDateTime.prototype.ToUnixTime = function () {
        var zero = new dDateTime();
        zero.Copy(this);
        zero.AddHour(-dDateTime.GetTimeZone());
        return dMath.ToInt((zero.ToLongTime() - 62135596800000) / 1000);
    };
    dDateTime.prototype.FromUnixTime = function (value) {
        this.FromLongTime(value * 1000 + 62135596800000);
        this.AddHour(dDateTime.GetTimeZone());
        return this;
    };
    dDateTime.prototype.FromDosTime = function (value) {
        this.year = ((value >> 25) & 0x7f) + 1980;
        this.month = (value >> 21 & 0xF) - 1;
        this.day = (value >> 16) & 0x1F;
        this.hour = (value >> 11) & 0x1F;
        this.minute = (value >> 5) & 0x3F;
        this.second = (value << 1) & 0x3F;
        return this;
    };
    dDateTime.prototype.FromString = function (str, split) {
        if (split === void 0) { split = "- :"; }
        for (var i = 1; i < split.length; i++)
            str = dStringUtils.ReplaceAll(str, split.charAt(i), split.charAt(0));
        var arr = str.split(split.charAt(0));
        while (arr.length < 7)
            arr.push("");
        switch (arr[1].toLowerCase()) {
            case "jan":
                arr[1] = "1";
                break;
            case "feb":
                arr[1] = "2";
                break;
            case "mar":
                arr[1] = "3";
                break;
            case "apr":
                arr[1] = "4";
                break;
            case "may":
                arr[1] = "5";
                break;
            case "jun":
                arr[1] = "6";
                break;
            case "jul":
                arr[1] = "7";
                break;
            case "aug":
                arr[1] = "8";
                break;
            case "sep":
                arr[1] = "9";
                break;
            case "oct":
                arr[1] = "10";
                break;
            case "nov":
                arr[1] = "11";
                break;
            case "dec":
                arr[1] = "12";
                break;
        }
        this.year = dMath.ParseInt(arr[0]);
        this.month = dMath.ParseInt(arr[1]);
        this.day = dMath.ParseInt(arr[2]);
        if (this.day >= 32 && this.year < 32) {
            var tmp = this.day;
            this.day = this.year;
            this.year = tmp;
        }
        this.hour = dMath.ParseInt(arr[3]);
        this.minute = dMath.ParseInt(arr[4]);
        this.second = dMath.ParseInt(arr[5]);
        this.milliseconds = dMath.ParseInt(arr[6]);
        return this;
    };
    dDateTime.IsLeapYear = function (_year) {
        if ((_year % 4) != 0)
            return false;
        if ((_year % 100) == 0)
            return ((_year % 400) == 0);
        return true;
    };
    dDateTime.DaysInYear = function (_year) {
        return dDateTime.IsLeapYear(_year) ? 366 : 365;
    };
    dDateTime.DaysInMonth = function (_month, _year) {
        if (_month < 1)
            _month = 1;
        else if (_month > 12)
            _month = 12;
        var days = dDateTime.DaysInYear(_year);
        if (days == 366)
            return dDateTime.m2[_month - 1];
        return dDateTime.m1[_month - 1];
    };
    dDateTime.DateToSeconds = function (year, month, day) {
        if (year < 1)
            year = 1;
        if (month < 1)
            month = 1;
        else if (month > 12)
            month = 12;
        var daysToMonth = dDateTime.IsLeapYear(year) ? dDateTime.DaysToMonth366 : dDateTime.DaysToMonth365;
        if (day < 1)
            day = 1;
        else if (day > daysToMonth[month] - daysToMonth[month - 1])
            day = daysToMonth[month] - daysToMonth[month - 1];
        var previousYear = year - 1;
        var daysInPreviousYears = ((((previousYear * 365) + dMath.ToInt(previousYear / 4)) - dMath.ToInt(previousYear / 100)) + dMath.ToInt(previousYear / 400));
        var totalDays = ((daysInPreviousYears + daysToMonth[month - 1]) + day) - 1;
        return totalDays * 86400;
    };
    dDateTime.TimeToSeconds = function (_hour, _minute, _second) {
        if (_hour < 0)
            _hour = 0;
        else if (_hour > 24)
            _hour = 24;
        if (_minute < 0)
            _minute = 0;
        else if (_minute > 60)
            _minute = 60;
        if (_second < 0)
            _second = 0;
        else if (_second > 60)
            _second = 60;
        var totalSeconds = ((_hour * 3600) + (_minute * 60)) + _second;
        return totalSeconds;
    };
    dDateTime.prototype.FromLongTime = function (value) {
        this.milliseconds = value % 1000;
        value = dMath.ToInt(value / 1000);
        this.second = value % 60;
        value = dMath.ToInt(value / 60);
        this.minute = value % 60;
        value = dMath.ToInt(value / 60);
        this.hour = value % 24;
        value = dMath.ToInt(value / 24);
        var year, month, day;
        year = dMath.ToInt(value / 366) + 1;
        value -= dMath.ToInt(dDateTime.DateToSeconds(year, 1, 1) / 86400);
        if (value < 0)
            value = 0;
        for (; value >= dDateTime.DaysInYear(year); year++)
            value -= dDateTime.DaysInYear(year);
        for (month = 1; value >= dDateTime.DaysInMonth(month, year); month++)
            value -= dDateTime.DaysInMonth(month, year);
        day = value + 1;
        if (day < 1)
            day = 1;
        this.year = year;
        this.month = month;
        this.day = day;
        return this;
    };
    dDateTime.prototype.ToLongTime = function () {
        var timestamp = dDateTime.DateToSeconds(this.year, this.month, this.day)
            + dDateTime.TimeToSeconds(this.hour, this.minute, this.second);
        return timestamp * 1000 + this.milliseconds;
    };
    dDateTime.prototype.ToMinuteSecond = function () {
        return dStringUtils.FormatInt(this.minute, 2) + ":" +
            dStringUtils.FormatInt(this.second, 2);
    };
    dDateTime.prototype.ToHourMinute = function () {
        var h = (dMath.Min(1, this.day) - 1) * 24 + this.hour;
        return dStringUtils.FormatInt(h, 2) + ":" +
            dStringUtils.FormatInt(this.minute, 2);
    };
    dDateTime.prototype.ToHourMinuteSecond = function () {
        var h = (dMath.Min(1, this.day) - 1) * 24 + this.hour;
        return dStringUtils.FormatInt(h, 2) + ":" +
            dStringUtils.FormatInt(this.minute, 2) + ":" +
            dStringUtils.FormatInt(this.second, 2);
    };
    dDateTime.prototype.ToStringBuffer = function (split, bWithMilliseconds) {
        if (split === void 0) { split = "- :"; }
        if (bWithMilliseconds === void 0) { bWithMilliseconds = false; }
        var split0 = split.charAt(0);
        var split1 = split.charAt(1);
        var split2 = split.charAt(2);
        if (split0 == null)
            split0 = "";
        if (split1 == null)
            split1 = "";
        if (split2 == null)
            split2 = "";
        var str = dStringUtils.FormatInt(this.year, 4) + split0 +
            dStringUtils.FormatInt(this.month, 2) + split0 +
            dStringUtils.FormatInt(this.day, 2) + split1 +
            dStringUtils.FormatInt(this.hour, 2) + split2 +
            dStringUtils.FormatInt(this.minute, 2) + split2 +
            dStringUtils.FormatInt(this.second, 2);
        if (bWithMilliseconds)
            str += split2 + dStringUtils.FormatInt(this.milliseconds, 3);
        return str;
    };
    dDateTime.prototype.GetDays = function () {
        return dMath.ToInt(dDateTime.DateToSeconds(this.year, this.month, this.day) / 86400);
    };
    dDateTime.prototype.GetWeek = function () {
        var C = dMath.ToInt(this.year / 100);
        var Y = this.year % 100;
        var M = this.month;
        if (M == 1 || M == 2) {
            M += 12;
            Y--;
        }
        var D = this.day;
        var W = (Y + dMath.ToInt(Y / 4) + dMath.ToInt(C / 4) - 2 * C + (26 * dMath.ToInt((M + 1) / 10)) + D - 1) % 7;
        if (W < 0)
            W = (W + 7) % 7;
        if (W == 0)
            W = 7;
        return W;
    };
    dDateTime.prototype.GetWeeks = function (offsetStartAtSunday) {
        if (offsetStartAtSunday === void 0) { offsetStartAtSunday = 0; }
        var days = this.GetDays() + 4 + 8 - offsetStartAtSunday;
        var ret = dMath.ToInt(days / 7);
        return ret;
    };
    dDateTime.prototype.AddMilliseconds = function (add) {
        var now = this.ToLongTime();
        now += add;
        this.FromLongTime(now);
        return this;
    };
    dDateTime.prototype.AddSecond = function (add) {
        this.second += add;
        if (this.second >= 60) {
            this.AddMinute(dMath.ToInt(this.second / 60));
            this.second %= 60;
        }
        else if (this.second < 0) {
            this.AddMinute(dMath.ToInt(this.second / 60) - 1);
            this.second %= 60;
            this.second += 60;
        }
        return this;
    };
    dDateTime.prototype.AddMinute = function (add) {
        this.minute += add;
        if (this.minute >= 60) {
            this.AddHour(dMath.ToInt(this.minute / 60));
            this.minute %= 60;
        }
        else if (this.minute < 0) {
            this.AddHour(dMath.ToInt(this.minute / 60) - 1);
            this.minute %= 60;
            this.minute += 60;
        }
        return this;
    };
    dDateTime.prototype.AddHour = function (add) {
        this.hour += add;
        if (this.hour >= 24) {
            this.AddDay(dMath.ToInt(this.hour / 24));
            this.hour %= 24;
        }
        else if (this.hour < 0) {
            this.AddDay(dMath.ToInt(this.hour / 24) - 1);
            this.hour %= 24;
            this.hour += 24;
        }
        return this;
    };
    dDateTime.prototype.AddDay = function (add) {
        this.day += add;
        var maxDays = dDateTime.DaysInMonth(this.month, this.year);
        while (this.day > maxDays) {
            this.day -= maxDays;
            this.AddMonth(1);
            maxDays = dDateTime.DaysInMonth(this.month, this.year);
        }
        while (this.day <= 0) {
            this.AddMonth(-1);
            maxDays = dDateTime.DaysInMonth(this.month, this.year);
            this.day += maxDays;
        }
        return this;
    };
    dDateTime.prototype.AddMonth = function (add) {
        this.month += add;
        while (this.month > 12) {
            this.AddYear(1);
            this.month -= 12;
        }
        while (this.month <= 0) {
            this.AddYear(-1);
            this.month += 12;
        }
        return this;
    };
    dDateTime.prototype.AddYear = function (add) {
        this.year += add;
        return this;
    };
    dDateTime.prototype.Compare = function (time) {
        var a1 = this.ToLongTime();
        var a2 = time.ToLongTime();
        if (a1 < a2)
            return -1;
        if (a1 == a2)
            return 0;
        return 1;
    };
    dDateTime.prototype.CompareYearMonthDay = function (time) {
        if (time == null)
            return 1;
        if (this.year < time.year)
            return -1;
        if (this.year > time.year)
            return 1;
        if (this.month < time.month)
            return -1;
        if (this.month > time.month)
            return 1;
        if (this.day < time.day)
            return -1;
        if (this.day > time.day)
            return 1;
        return 0;
    };
    dDateTime.prototype.Sub = function (other) {
        var sub = this.ToLongTime() - other.ToLongTime();
        return new dDateTime().FromLongTime(sub);
    };
    dDateTime.prototype.Add = function (other) {
        var add = this.ToLongTime() + other.ToLongTime();
        return new dDateTime().FromLongTime(add);
    };
    dDateTime.DaysToMonth365 = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365];
    dDateTime.DaysToMonth366 = [0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335, 366];
    dDateTime.m1 = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    dDateTime.m2 = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
    return dDateTime;
}(dObject));
var dFilePacker = (function () {
    function dFilePacker() {
        this.m_strFromFileName = "";
        this.m_pFromBin = null;
        this.m_nHeaderSize = 0;
        this.m_mapFile = new Map();
        this.m_pPasswordKey = null;
    }
    dFilePacker.prototype.LoadFromFile = function (fileName, onComplete) {
        var _this = this;
        var arr = new dByteArray();
        arr.LoadFromFile(fileName, function () {
            _this.LoadFromBin(arr);
            _this.m_pFromBin = null;
            _this.m_strFromFileName = fileName;
            if (onComplete)
                onComplete(_this);
        });
    };
    dFilePacker.prototype.SetPassword = function (password) {
        if (password == null)
            this.m_pPasswordKey = null;
        else {
            var arr = new dByteArray();
            arr.WriteStringEx(password, false);
            this.m_pPasswordKey = new Array(arr.Size());
            for (var i = 0; i < arr.Size(); i++)
                this.m_pPasswordKey[i] = arr.GetByte(i) & 0xff;
        }
    };
    dFilePacker.prototype.LoadFromBin = function (bin) {
        this.m_strFromFileName = null;
        this.m_pFromBin = bin;
        var pos = 0;
        var magic = this.m_pFromBin.ReadInt();
        if (magic == dStringUtils.FourCC("D", "G", "F", "P")) {
            var version = this.m_pFromBin.ReadInt();
            this.m_nHeaderSize = this.m_pFromBin.ReadInt();
            var fileCount = this.m_pFromBin.ReadInt();
            for (var i = 0; i < fileCount; ++i) {
                var obj = new dFilePacker_FILE_OBJ();
                obj.fileName = this.m_pFromBin.ReadString();
                obj.size = this.m_pFromBin.ReadInt();
                obj.startOffset = this.m_pFromBin.ReadInt();
                obj.fileCrc = this.m_pFromBin.ReadInt();
                obj.fileDate = this.m_pFromBin.ReadInt();
                obj.fileExt = this.m_pFromBin.ReadInt();
                obj.fileFlag = this.m_pFromBin.ReadInt();
                obj.buffer = this.GetBuffer(this.m_pFromBin, obj.startOffset + this.m_nHeaderSize, obj.size);
                obj.fromType = dFilePacker.FROM_PACKAGE;
                this.m_mapFile.set(obj.fileName, obj);
            }
            return true;
        }
        return false;
    };
    dFilePacker.prototype.GetBuffer = function (arr, startOffset, maxLength) {
        var oldPos = arr.GetPosition();
        arr.SetPosition(startOffset);
        var arr2 = arr.ReadBinEx(maxLength);
        arr.SetPosition(oldPos);
        return arr2;
    };
    dFilePacker.prototype.GetFile = function (fileName, startOffset, maxLength) {
        if (startOffset === void 0) { startOffset = 0; }
        if (maxLength === void 0) { maxLength = -1; }
        if (!this.m_mapFile.has(fileName))
            fileName = fileName.toLowerCase();
        if (!this.m_mapFile.has(fileName))
            return null;
        var pObj = this.m_mapFile.get(fileName);
        if (pObj.buffer != null)
            return pObj.buffer;
        if (maxLength == -1)
            maxLength = pObj.size;
        else if (maxLength > pObj.size)
            maxLength = pObj.size;
        if (pObj.fromType == dFilePacker.FROM_PACKAGE) {
            if (pObj.buffer != null)
                return pObj.buffer;
            if (this.m_pFromBin != null) {
                this.m_pFromBin.SetPosition(pObj.startOffset + this.m_nHeaderSize + startOffset);
                return this.m_pFromBin.ReadBinEx(maxLength);
            }
            if (this.m_strFromFileName != null) {
                var arr = new dByteArray();
                arr.LoadFromFile(this.m_strFromFileName, null, null, null, pObj.startOffset + this.m_nHeaderSize + startOffset, maxLength);
                return arr;
            }
        }
        else if (pObj.fromType == dFilePacker.FROM_FILE) {
            var arr = new dByteArray();
            var pathFile = "";
            if (pObj.path != null)
                pathFile = pObj.path + "/";
            pathFile += pObj.fileName;
            arr.LoadFromFile(pathFile, null, null, null, startOffset, maxLength);
            return arr;
        }
        else if (pObj.fromType == dFilePacker.FROM_MEMORY) {
            if (startOffset == 0)
                return pObj.buffer;
            if (pObj.buffer == null)
                return null;
            pObj.buffer.SetPosition(startOffset);
            var arr = pObj.buffer.ReadBinEx(maxLength);
            return arr;
        }
        return null;
    };
    dFilePacker.prototype.GetFileS = function (fileName, code_page) {
        if (code_page === void 0) { code_page = dStringUtils.CODE_PAGE_UTF8; }
        var arr = this.GetFile(fileName);
        if (arr != null)
            return arr.ToStringBuffer(code_page);
        return null;
    };
    dFilePacker.prototype.AddFileFromMemory = function (fileName, data) {
        var obj = new dFilePacker_FILE_OBJ();
        obj.fileName = fileName;
        obj.buffer = data;
        obj.fromType = dFilePacker.FROM_MEMORY;
        obj.size = data.Size();
        this.m_mapFile.set(fileName, obj);
    };
    dFilePacker.prototype.GetFileCount = function () {
        return this.m_mapFile.size;
    };
    dFilePacker.prototype.SaveToBin = function (outData) {
        var e_5, _a, e_6, _b;
        outData.WriteInt(dStringUtils.FourCC("D", "G", "F", "P"));
        outData.WriteInt(1);
        outData.WriteInt(0);
        outData.WriteInt(this.m_mapFile.size);
        var startOffset = 0;
        try {
            for (var _c = __values(this.m_mapFile.keys()), _d = _c.next(); !_d.done; _d = _c.next()) {
                var key = _d.value;
                var pObj = this.m_mapFile.get(key);
                outData.WriteString(pObj.fileName.toLowerCase());
                outData.WriteInt(pObj.size);
                pObj.startOffset = startOffset;
                startOffset += pObj.size;
                outData.WriteInt(pObj.startOffset);
                outData.WriteInt(pObj.fileCrc);
                outData.WriteInt(pObj.fileDate);
                outData.WriteInt(pObj.fileExt);
                outData.WriteInt(pObj.fileFlag);
            }
        }
        catch (e_5_1) { e_5 = { error: e_5_1 }; }
        finally {
            try {
                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
            }
            finally { if (e_5) throw e_5.error; }
        }
        this.m_nHeaderSize = outData.GetPosition();
        outData.SetPosition(8);
        outData.WriteInt(this.m_nHeaderSize);
        outData.SetPosition(this.m_nHeaderSize);
        var crc = 0;
        try {
            for (var _e = __values(this.m_mapFile.keys()), _f = _e.next(); !_f.done; _f = _e.next()) {
                var key = _f.value;
                var pObj = this.m_mapFile.get(key);
                var arr = this.GetFile(pObj.fileName);
                if (this.m_pPasswordKey != null) {
                    arr.SetPosition(0);
                    var arr2 = new dByteArray();
                    for (var i = 0, n = arr.AvailableSize(); i < n; i++)
                        arr2.WriteByte((arr.ReadByte() ^ this.m_pPasswordKey[i % this.m_pPasswordKey.length]) & 0xff);
                    arr2.SetPosition(0);
                    arr = arr2;
                }
                outData.WriteBin(arr, 0, arr.Size());
            }
        }
        catch (e_6_1) { e_6 = { error: e_6_1 }; }
        finally {
            try {
                if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
            }
            finally { if (e_6) throw e_6.error; }
        }
        outData.WriteInt(crc);
    };
    dFilePacker.FROM_PACKAGE = 0;
    dFilePacker.FROM_FILE = 1;
    dFilePacker.FROM_MEMORY = 2;
    return dFilePacker;
}());
var dFilePacker_FILE_OBJ = (function () {
    function dFilePacker_FILE_OBJ() {
        this.fileName = "";
        this.path = "";
        this.buffer = null;
        this.size = 0;
        this.startOffset = 0;
        this.fileCrc = 0;
        this.fileDate = 0;
        this.fileExt = 0;
        this.fileFlag = 0;
        this.fromType = 0;
    }
    return dFilePacker_FILE_OBJ;
}());
var dInterface = (function () {
    function dInterface() {
        var _this = this;
        this.m_mainCanvas = null;
        this.m_pMainThread = null;
        this.m_vecTimer = new Array();
        this.m_vecTimerWillDelete = new Array();
        this.m_vecShaders = new Array();
        this.m_nLastTick = 0;
        this.webgl = null;
        this.m_nLastWidth = 0;
        this.m_nLastHeight = 0;
        this.m_nMaxMultiTouchPointCount = 1;
        this.m_nGlobalMouseX = 0;
        this.m_nGlobalMouseY = 0;
        this.m_mapSpriteMouseEvent = new Map();
        this.m_nGCTimeAdd = 0;
        this.m_nRenderTick = 0;
        this.m_arrBitmapBuffer = new Map();
        this.m_arrTextureBuffer = new Map();
        this.m_pLastUseShader = null;
        this.m_nLastInnerWidth = 0;
        this.m_nLastInnerHeight = 0;
        this.m_pInputBox = null;
        this.m_pInputBoxOnCanel = null;
        this.m_pInputBoxOnConfirm = null;
        this.m_bWindowActive = true;
        this.m_pixelRatio = 1;
        this.m_onRewardedCallback = null;
        this.m_bRewardedVideoShowing = false;
        this.m_bRewardedVideoVerifyed = false;
        this.m_arrAudios = new Array();
        this.m_bannerAd = null;
        this.m_banderAdShowing = false;
        this.m_boxPortalAd = null;
        this.m_rewardedAd = null;
        this.m_rewardedCompleteCallback = null;
        this.api = null;
        this.m_globalAudioVolume = 1;
        this.m_vecSubPackageData = null;
        this.m_onErrCallback = null;
        this.m_bHideRender = false;
        this.m_audioContext = null;
        this.m_arrAudioDataBuffer = null;
        this.m_recordVideoPath = "";
        this.m_bRecording = false;
        this.m_arrCurMouseDownList = new Map();
        this.m_userdeviceId = "";
        if (window && window.sdkName)
            dInterface.sdkName = window.sdkName;
        if (window && window.wx)
            this.api = window.wx;
        if (window && window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.InitSdk)
            window.webkit.messageHandlers.InitSdk.postMessage("");
        console.log("sdkName: " + dInterface.sdkName + " channel: " + this.GetChannelName());
        if (dInterface.sdkName == "node") {
        }
        else {
            if (dInterface.sdkName == "web" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg" || dInterface.sdkName == "hw") {
                this.m_pixelRatio = window.devicePixelRatio;
                this.m_mainCanvas = window.canvas || document.createElement("canvas");
                document.body.appendChild(this.m_mainCanvas);
                this.m_mainCanvas.style.width = String(window.innerWidth);
                this.m_mainCanvas.style.height = String(window.innerHeight);
                this.m_mainCanvas.style.position = "absolute";
                this.m_mainCanvas.width = window.innerWidth * window.devicePixelRatio;
                this.m_mainCanvas.height = window.innerHeight * window.devicePixelRatio;
            }
            else {
                if (dInterface.sdkName == "vivo")
                    this.m_pixelRatio = 1;
                else
                    this.m_pixelRatio = this.api.getSystemInfoSync().pixelRatio;
                if (dInterface.sdkName == "oppo")
                    this.m_mainCanvas = document.getElementById('canvas');
                else
                    this.m_mainCanvas = window.canvas || this.CreateCanvas();
                window.innerWidth = this.api.getSystemInfoSync().screenWidth;
                window.innerHeight = this.api.getSystemInfoSync().screenHeight;
                this.m_mainCanvas.width = window.innerWidth * this.m_pixelRatio;
                this.m_mainCanvas.height = window.innerHeight * this.m_pixelRatio;
                if (dInterface.sdkName == "vivo" || dInterface.sdkName == "oppo" || dInterface.sdkName == "mi" || dInterface.sdkName == "hw") {
                    window.resize = function () {
                        window.innerWidth = _this.api.getSystemInfoSync().screenWidth;
                        window.innerHeight = _this.api.getSystemInfoSync().screenHeight;
                        _this.m_mainCanvas.width = window.innerWidth * _this.m_pixelRatio;
                        _this.m_mainCanvas.height = window.innerHeight * _this.m_pixelRatio;
                    };
                }
            }
            this.m_nLastInnerWidth = window.innerWidth;
            this.m_nLastInnerHeight = window.innerHeight;
            this.webgl = this.m_mainCanvas.getContext("experimental-webgl", { preserveDrawingBuffer: false }) || this.m_mainCanvas.getContext("webgl", { preserveDrawingBuffer: false });
            if (!this.webgl)
                alert("webgl not support!");
            if (dInterface.sdkName == "web" || dInterface.sdkName == "oppo" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg" || dInterface.sdkName == "hw") {
                this.m_mainCanvas.addEventListener('touchstart', function (e) {
                    e.preventDefault();
                    if (dInterface.sdkName == "hw") {
                        if (window && window.onTouchFun)
                            window.onTouchFun();
                    }
                });
                this.m_mainCanvas.addEventListener('touchend', function (e) {
                    e.preventDefault();
                });
                this.m_mainCanvas.addEventListener('touchmove', function (e) {
                    e.preventDefault();
                });
                var touch = function (event) {
                    if ((!_this.m_pInputBox || _this.m_pInputBox.style.visibility == "hidden")) {
                        var multiTouch = _this.GetMultiTouchPointCount() != 1;
                        var event = event || window.event;
                        switch (event.type) {
                            case "touchstart":
                                for (var i = 0; i < event.touches.length; i++)
                                    _this.FrameMouseEvent(dSprite.MOUSE_LBUTTONDOWN, multiTouch ? event.touches[i].identifier : 0, event.touches[i].clientX * _this.m_pixelRatio, event.touches[i].clientY * _this.m_pixelRatio, 1.0);
                                break;
                            case "touchend":
                            case "touchcancel":
                                for (var i = 0; i < event.changedTouches.length; i++)
                                    _this.FrameMouseEvent(dSprite.MOUSE_LBUTTONUP, multiTouch ? event.changedTouches[i].identifier : 0, event.changedTouches[i].clientX * _this.m_pixelRatio, event.changedTouches[i].clientY * _this.m_pixelRatio, 1.0);
                                break;
                            case "touchmove":
                                for (var i = 0; i < event.touches.length; i++)
                                    _this.FrameMouseEvent(dSprite.MOUSE_MOVE, multiTouch ? event.touches[i].identifier : 0, event.touches[i].clientX * _this.m_pixelRatio, event.touches[i].clientY * _this.m_pixelRatio, 1.0);
                                break;
                        }
                    }
                    else if (_this.m_pInputBox && event.type == "touchstart")
                        _this.HideInputBox(true);
                };
                document.addEventListener("touchstart", touch, false);
                document.addEventListener("touchmove", touch, false);
                document.addEventListener("touchend", touch, false);
                document.addEventListener("touchcancel", touch, false);
                this.m_mainCanvas.onmousedown = function (e) {
                    if (!_this.m_pInputBox || _this.m_pInputBox.style.visibility == "hidden") {
                        _this.FrameMouseEvent(dSprite.MOUSE_LBUTTONDOWN, 0, e.clientX * _this.m_pixelRatio, e.clientY * _this.m_pixelRatio, 1.0);
                        e.preventDefault();
                    }
                    else if (_this.m_pInputBox)
                        _this.HideInputBox(true);
                };
                this.m_mainCanvas.onmouseup = function (e) {
                    if (!_this.m_pInputBox || _this.m_pInputBox.style.visibility == "hidden") {
                        _this.FrameMouseEvent(dSprite.MOUSE_LBUTTONUP, 0, e.clientX * _this.m_pixelRatio, e.clientY * _this.m_pixelRatio, 1.0);
                        e.preventDefault();
                    }
                };
                this.m_mainCanvas.onmousemove = function (e) {
                    if (!_this.m_pInputBox || _this.m_pInputBox.style.visibility == "hidden") {
                        _this.FrameMouseEvent(dSprite.MOUSE_MOVE, 0, e.clientX * _this.m_pixelRatio, e.clientY * _this.m_pixelRatio, 1.0);
                        e.preventDefault();
                    }
                };
                if (dInterface.sdkName == "mg" && this.api.volumeEventListener) {
                    this.api.volumeEventListener(function (res) {
                        var volume = 0;
                        if (res.type = 0) {
                            volume = 1;
                        }
                        else {
                            volume = Number(res.ratio);
                        }
                        _this.m_globalAudioVolume = volume;
                        for (var i = 0; i < _this.m_arrAudios.length; i++) {
                            var audio = _this.m_arrAudios[i];
                            audio.volume = (audio.srcVolume != undefined ? audio.srcVolume : 1) * _this.m_globalAudioVolume;
                        }
                    });
                }
                var hidden = "hidden";
                var pThis = this;
                var onchange = function (evt) {
                    var v = 'visible', h = 'hidden', evtMap = {
                        focus: v, focusin: v, pageshow: v, blur: h, focusout: h, pagehide: h
                    };
                    evt = evt || window.event;
                    var active;
                    if (evt.type in evtMap)
                        active = evtMap[evt.type];
                    else if (Object(this).visibilityState)
                        active = Object(this).visibilityState == "hidden" ? "hidden" : "visible";
                    else
                        active = Object(this)[hidden] ? "hidden" : "visible";
                    if (active == "hidden") {
                        dInterface.ptr.m_bWindowActive = false;
                        pThis.OnFrameActive(false);
                    }
                    else {
                        dInterface.ptr.m_bWindowActive = true;
                        pThis.OnFrameActive(true);
                    }
                };
                if (hidden in document)
                    document.addEventListener("visibilitychange", onchange);
                else if ((hidden = "mozHidden") in document)
                    document.addEventListener("mozvisibilitychange", onchange);
                else if ((hidden = "webkitHidden") in document)
                    document.addEventListener("webkitvisibilitychange", onchange);
                else if ((hidden = "msHidden") in document)
                    document.addEventListener("msvisibilitychange", onchange);
                else
                    window.onpageshow = window.onpagehide = window.onfocus = window.onblur = onchange;
            }
            else {
                if (dInterface.sdkName == "mi") {
                    this.m_mainCanvas.addEventListener('touchstart', function (e) {
                        e.preventDefault();
                    });
                    this.m_mainCanvas.addEventListener('touchend', function (e) {
                        e.preventDefault();
                    });
                    this.m_mainCanvas.addEventListener('touchmove', function (e) {
                        e.preventDefault();
                    });
                }
                this.api.onTouchStart(function (event) {
                    if (!_this.m_pInputBox || _this.m_pInputBox.style.visibility == "hidden") {
                        var multiTouch = _this.GetMultiTouchPointCount() != 1;
                        for (var i = 0; i < event.touches.length; i++)
                            _this.FrameMouseEvent(dSprite.MOUSE_LBUTTONDOWN, multiTouch ? event.touches[i].identifier : 0, event.touches[i].clientX * _this.m_pixelRatio, event.touches[i].clientY * _this.m_pixelRatio, 1.0);
                    }
                    else if (_this.m_pInputBox)
                        _this.HideInputBox(true);
                });
                this.api.onTouchMove(function (event) {
                    if (!_this.m_pInputBox || _this.m_pInputBox.style.visibility == "hidden") {
                        var multiTouch = _this.GetMultiTouchPointCount() != 1;
                        for (var i = 0; i < event.touches.length; i++)
                            _this.FrameMouseEvent(dSprite.MOUSE_MOVE, multiTouch ? event.touches[i].identifier : 0, event.touches[i].clientX * _this.m_pixelRatio, event.touches[i].clientY * _this.m_pixelRatio, 1.0);
                    }
                });
                this.api.onTouchEnd(function (event) {
                    if (!_this.m_pInputBox || _this.m_pInputBox.style.visibility == "hidden") {
                        var multiTouch = _this.GetMultiTouchPointCount() != 1;
                        for (var i = 0; i < event.changedTouches.length; i++)
                            _this.FrameMouseEvent(dSprite.MOUSE_LBUTTONUP, multiTouch ? event.changedTouches[i].identifier : 0, event.changedTouches[i].clientX * _this.m_pixelRatio, event.changedTouches[i].clientY * _this.m_pixelRatio, 1.0);
                    }
                });
                this.api.onTouchCancel(function (event) {
                    if (!_this.m_pInputBox || _this.m_pInputBox.style.visibility == "hidden") {
                        var multiTouch = _this.GetMultiTouchPointCount() != 1;
                        for (var i = 0; i < event.changedTouches.length; i++)
                            _this.FrameMouseEvent(dSprite.MOUSE_LBUTTONUP, multiTouch ? event.changedTouches[i].identifier : 0, event.changedTouches[i].clientX * _this.m_pixelRatio, event.changedTouches[i].clientY * _this.m_pixelRatio, 1.0);
                    }
                });
                this.api.onShow(function (options) {
                    if (options && options.scene) {
                    }
                    dInterface.ptr.m_bWindowActive = true;
                    _this.OnFrameActive(true);
                });
                this.api.onHide(function () {
                    dInterface.ptr.m_bWindowActive = false;
                    _this.OnFrameActive(false);
                });
            }
        }
        if (this.GetSdkName() == "node") {
            setInterval(function () {
                _this.MainFrameMove();
            }, 16);
        }
        else {
            setTimeout(function () {
                var animloop = function () {
                    if (dInterface.ptr.m_pMainThread) {
                        if (!_this.m_onErrCallback)
                            _this.MainFrameMove();
                        else {
                            try {
                                _this.MainFrameMove();
                            }
                            catch (err) {
                                if (_this.m_onErrCallback)
                                    _this.m_onErrCallback(err);
                            }
                        }
                    }
                    requestAnimationFrame(animloop);
                };
                requestAnimationFrame(animloop);
            });
        }
    }
    Object.defineProperty(dInterface, "ptr", {
        get: function () {
            if (!dInterface.s_ptr)
                dInterface.s_ptr = new dInterface();
            return dInterface.s_ptr;
        },
        enumerable: false,
        configurable: true
    });
    dInterface.prototype.OnFrameActive = function (bActive) {
        if (dInterface.sdkName == "web" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg" ||
            dInterface.sdkName == "bd" || dInterface.sdkName == "mi") {
            if (bActive)
                this.ResumeAllSound();
            else
                this.PauseAllSound();
        }
        if (this.m_pMainThread)
            this.m_pMainThread.OnFrameActive(bActive);
    };
    dInterface.prototype.PauseAllSound = function () {
        if (this.m_audioContext && this.m_audioContext.suspend && this.m_audioContext.resume)
            this.m_audioContext.suspend();
        else {
            for (var i = 0; i < this.m_arrAudios.length; i++) {
                var audio = this.m_arrAudios[i];
                audio.volume = 0;
                audio.pause();
            }
        }
    };
    dInterface.prototype.ResumeAllSound = function () {
        if (!this.m_bWindowActive)
            return;
        if (this.m_audioContext && this.m_audioContext.suspend && this.m_audioContext.resume)
            this.m_audioContext.resume();
        else {
            for (var i = 0; i < this.m_arrAudios.length; i++) {
                var audio = this.m_arrAudios[i];
                audio.volume = audio.srcVolume * this.m_globalAudioVolume;
                audio.play();
            }
        }
    };
    dInterface.prototype.SetMultiTouchPointCount = function (count) {
        this.m_nMaxMultiTouchPointCount = count;
    };
    dInterface.prototype.GetMultiTouchPointCount = function () {
        return this.m_nMaxMultiTouchPointCount;
    };
    dInterface.FrameSetClipboard = function (str) {
        navigator.clipboard.writeText(str);
    };
    dInterface.prototype.GetRenderTick = function () {
        return this.m_nRenderTick;
    };
    dInterface.prototype.MainFrameMove = function () {
        var e_7, _a, e_8, _b;
        if (this.m_bHideRender)
            return;
        if (this.m_mainCanvas) {
            if (this.m_nLastInnerWidth != window.innerWidth || this.m_nLastInnerHeight != window.innerHeight) {
                this.m_nLastInnerWidth = window.innerWidth;
                this.m_nLastInnerHeight = window.innerHeight;
                this.m_mainCanvas.style.width = String(window.innerWidth);
                this.m_mainCanvas.style.height = String(window.innerHeight);
                this.m_mainCanvas.width = window.innerWidth * this.m_pixelRatio;
                this.m_mainCanvas.height = window.innerHeight * this.m_pixelRatio;
            }
            var windowWidth = this.GetWindowWidth();
            var windowHeight = this.GetWindowHeight();
            if (this.m_nLastWidth != windowWidth || this.m_nLastHeight != windowHeight) {
                this.m_nLastWidth = windowWidth;
                this.m_nLastHeight = windowHeight;
                this.OnResize(windowWidth, windowHeight);
            }
        }
        if (this.webgl) {
            this.webgl.viewport(0, 0, windowWidth, windowHeight);
            this.webgl.clearDepth(1.0);
            this.webgl.clearStencil(0);
            this.webgl.clearColor(0, 0, 0, 1);
            this.webgl.clear(this.webgl.COLOR_BUFFER_BIT | this.webgl.DEPTH_BUFFER_BIT | this.webgl.STENCIL_BUFFER_BIT);
        }
        var curTick = dTimer.GetTickCount();
        this.m_nRenderTick = curTick;
        var elapse = curTick - this.m_nLastTick;
        for (var i = 0; i < this.m_vecTimer.length; i++) {
            this.m_vecTimer[i](elapse, curTick);
        }
        if (this.m_vecTimerWillDelete.length > 0) {
            for (var i = 0; i < this.m_vecTimerWillDelete.length; i++) {
                this.m_vecTimer.remove(this.m_vecTimerWillDelete[i]);
            }
            this.m_vecTimerWillDelete.clear();
        }
        if (dInterface.s_onFrameEnd.length > 0) {
            for (var i = 0, n = dInterface.s_onFrameEnd.length; i < n; i++)
                dInterface.s_onFrameEnd[i](this);
        }
        this.m_pLastUseShader = null;
        var rootSprite = dThread.GetRootBackgroudSprite();
        if (rootSprite && this.webgl) {
            dSprite.EnableScissorTest(true, 0, 0, windowWidth, windowHeight, windowWidth, windowHeight, null, false);
            rootSprite.Render(windowWidth, windowHeight);
            this.m_nGCTimeAdd += elapse;
            if (this.m_nGCTimeAdd > 1000) {
                this.m_nGCTimeAdd = 0;
                var markFlag = this.m_nRenderTick;
                this._MarkUsingBitmapData(rootSprite, markFlag);
                try {
                    for (var _c = __values(this.m_arrBitmapBuffer.keys()), _d = _c.next(); !_d.done; _d = _c.next()) {
                        var key = _d.value;
                        var pBitmapDataBuffer = this.m_arrBitmapBuffer.get(key);
                        if (pBitmapDataBuffer.m_markFlag != markFlag) {
                            this.m_arrBitmapBuffer.delete(key);
                        }
                        else
                            pBitmapDataBuffer.m_lLastUsingTextureTime = this.m_nRenderTick;
                    }
                }
                catch (e_7_1) { e_7 = { error: e_7_1 }; }
                finally {
                    try {
                        if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
                    }
                    finally { if (e_7) throw e_7.error; }
                }
                try {
                    for (var _e = __values(this.m_arrTextureBuffer.keys()), _f = _e.next(); !_f.done; _f = _e.next()) {
                        var key2 = _f.value;
                        var pBufferData = this.m_arrTextureBuffer.get(key2);
                        if (!pBufferData.m_bLoading && this.m_nRenderTick > pBufferData.m_lLastUsingTextureTime + 1000) {
                            pBufferData.Release();
                            this.m_arrTextureBuffer.delete(key2);
                        }
                    }
                }
                catch (e_8_1) { e_8 = { error: e_8_1 }; }
                finally {
                    try {
                        if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                    }
                    finally { if (e_8) throw e_8.error; }
                }
            }
        }
        this.m_nLastTick = curTick;
        dInterface.s_renderCount++;
    };
    dInterface.prototype._MarkUsingBitmapData = function (pSprite, markFlag) {
        for (var i = 0, n = pSprite.m_pSetBitmapData.length; i < n; i++) {
            if (pSprite.m_pSetBitmapData[i] && pSprite.m_pSetBitmapData[i].m_pBufferData) {
                pSprite.m_pSetBitmapData[i].m_pBufferData.m_markFlag = markFlag;
            }
        }
        for (var i = 0, n = pSprite.m_vecChildSprite.length; i < n; i++)
            this._MarkUsingBitmapData(pSprite.m_vecChildSprite[i], markFlag);
    };
    dInterface.prototype.OnResize = function (width, height) {
        for (var i = 0; i < this.m_vecShaders.length; i++)
            this.m_vecShaders[i].SetWindowSize(width, height);
        if (this.m_pMainThread)
            this.m_pMainThread.FrameWindowResize(width, height);
    };
    dInterface.prototype.GetWindowWidth = function () {
        if (!this.m_mainCanvas)
            return 0;
        return this.m_mainCanvas.width;
    };
    dInterface.prototype.GetWindowHeight = function () {
        if (!this.m_mainCanvas)
            return 0;
        return this.m_mainCanvas.height;
    };
    dInterface.prototype.CreateCanvas = function () {
        if (dInterface.sdkName == "web" || dInterface.sdkName == "oppo" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg" || dInterface.sdkName == "mi" || dInterface.sdkName == "hw")
            return document.createElement('canvas');
        else
            return this.api.createCanvas();
    };
    dInterface.prototype.ShowInputBox = function (strText, x, y, width, height, spriteColor, fontSize, maxLength, multyLine, onInput, onInputCancel) {
        var _this = this;
        if (this.m_pInputBox != null)
            return;
        this.m_mapSpriteMouseEvent.clear();
        if (dInterface.sdkName == "web" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg" || dInterface.sdkName == "hw") {
            this.m_pInputBox = document.createElement("input");
            this.m_pInputBox.type = strText;
            this.m_pInputBox.style.position = "absolute";
            this.m_pInputBox.style.left = String(x / this.m_pixelRatio);
            this.m_pInputBox.style.top = String(y / this.m_pixelRatio);
            this.m_pInputBox.style.width = String(width / this.m_pixelRatio);
            this.m_pInputBox.style.height = String(height / this.m_pixelRatio);
            var r = (spriteColor & 0x00ff0000) >> 16;
            var g = (spriteColor & 0x0000ff00) >> 8;
            var b = (spriteColor & 0x000000ff);
            var a = (spriteColor & 0xff000000) >>> 24;
            this.m_pInputBox.style.color = "rgb(" + r + "," + g + "," + b + ")";
            this.m_pInputBox.style.background = "rgba(255,255,255,0)";
            this.m_pInputBox.style.fontSize = String(fontSize / this.m_pixelRatio);
            this.m_pInputBox.value = strText;
            this.m_pInputBox.style.visibility = "visible";
            this.m_pInputBox.style.border = "0";
            this.m_pInputBoxOnConfirm = onInput;
            this.m_pInputBoxOnCanel = onInputCancel;
            this.m_pInputBox.onblur = function (e) {
                if (_this.m_pInputBox != null) {
                    var text = _this.m_pInputBox.value;
                    _this.HideInputBox(true);
                }
            };
            this.m_pInputBox.onkeyup = function (e) {
                if (!e)
                    e = window.event;
                var keyCode = e.keyCode || e.which;
                if (!multyLine && keyCode == '13') {
                    if (_this.m_pInputBox != null) {
                        var text = _this.m_pInputBox.value;
                        _this.HideInputBox(true);
                        return false;
                    }
                }
                return true;
            };
            document.body.appendChild(this.m_pInputBox);
            this.m_pInputBox.focus();
        }
        else {
            if (maxLength <= 0)
                maxLength = 10000;
            this.api.showKeyboard({
                defaultValue: strText,
                maxLength: maxLength,
                multiple: multyLine,
                confirmHold: true,
                confirmType: "done"
            });
            var onKeyboardConfirm = function (data) {
                onInput(data.value);
                _this.api.hideKeyboard();
                _this.api.offKeyboardConfirm(onKeyboardConfirm);
            };
            this.api.onKeyboardConfirm(onKeyboardConfirm);
            var onKeyboardComplete = function (data) {
                onInput(data.value);
                _this.api.hideKeyboard();
                _this.api.offKeyboardComplete(onKeyboardComplete);
            };
            this.api.onKeyboardComplete(onKeyboardComplete);
        }
    };
    dInterface.prototype.HideInputBox = function (sendConfirm) {
        if (dInterface.sdkName == "web" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg" || dInterface.sdkName == "hw") {
            if (this.m_pInputBox) {
                if (sendConfirm) {
                    var text = this.m_pInputBox.value;
                    if (this.m_pInputBoxOnConfirm)
                        this.m_pInputBoxOnConfirm(text);
                }
                this.m_pInputBoxOnConfirm = null;
                this.m_pInputBoxOnCanel = null;
                this.m_pInputBox.style.visibility = "hidden";
                var p = this.m_pInputBox;
                setTimeout(function () { document.body.removeChild(p); }, 100);
                this.m_pInputBox = null;
                this.m_arrCurMouseDownList.clear();
            }
        }
    };
    dInterface.prototype.RequestHttp = function (url, pResponse, method, postData) {
        var _this = this;
        if (pResponse === void 0) { pResponse = null; }
        if (method === void 0) { method = "get"; }
        if (postData === void 0) { postData = null; }
        if (dInterface.sdkName == "web" || dInterface.sdkName == "oppo" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg" || dInterface.sdkName == "hw") {
            var xhr = new XMLHttpRequest();
            xhr.open(method.toLowerCase(), url, true);
            xhr.responseType = "arraybuffer";
            xhr.onload = function () {
                if (xhr.status == 200) {
                    if (pResponse) {
                        var p = new dByteArray();
                        p.m_pArraybuffer = xhr.response;
                        p.m_pDataView = new DataView(p.m_pArraybuffer);
                        p.m_bLoadOK = true;
                        p.m_nSize = p.m_nSysSize = p.m_pDataView.byteLength;
                        p.m_nPosition = 0;
                        if (!_this.m_onErrCallback)
                            pResponse(p, xhr.status);
                        else {
                            try {
                                pResponse(p, xhr.status);
                            }
                            catch (err) {
                                if (_this.m_onErrCallback)
                                    _this.m_onErrCallback(err);
                            }
                        }
                    }
                }
                else {
                    if (pResponse) {
                        if (!_this.m_onErrCallback)
                            pResponse(null, xhr.status);
                        else {
                            try {
                                pResponse(null, xhr.status);
                            }
                            catch (err) {
                                if (_this.m_onErrCallback)
                                    _this.m_onErrCallback(err);
                            }
                        }
                    }
                }
            };
            xhr.onerror = function () {
                if (pResponse) {
                    if (!_this.m_onErrCallback)
                        pResponse(null, 0);
                    else {
                        try {
                            pResponse(null, 0);
                        }
                        catch (err) {
                            if (_this.m_onErrCallback)
                                _this.m_onErrCallback(err);
                        }
                    }
                }
            };
            if (postData != null) {
                xhr.send(postData.m_pArraybuffer);
            }
            else
                xhr.send();
        }
        else {
            var requestObj = {
                url: url,
                method: method,
                dataType: 'arraybuffer',
                responseType: 'arraybuffer',
                success: function (ret) {
                    if (pResponse) {
                        var p = new dByteArray();
                        p.m_pArraybuffer = ret.data;
                        p.m_pDataView = new DataView(p.m_pArraybuffer);
                        p.m_bLoadOK = true;
                        p.m_nSize = p.m_nSysSize = p.m_pDataView.byteLength;
                        p.m_nPosition = 0;
                        if (!_this.m_onErrCallback)
                            pResponse(p, ret.statusCode);
                        else {
                            try {
                                pResponse(p, ret.statusCode);
                            }
                            catch (err) {
                                if (_this.m_onErrCallback)
                                    _this.m_onErrCallback(err);
                            }
                        }
                    }
                },
                fail: function (error, code) {
                    if (pResponse) {
                        if (!_this.m_onErrCallback)
                            pResponse(null, code);
                        else {
                            try {
                                pResponse(null, code);
                            }
                            catch (err) {
                                if (_this.m_onErrCallback)
                                    _this.m_onErrCallback(err);
                            }
                        }
                    }
                }
            };
            if (postData)
                requestObj.data = postData.ToStringBuffer();
            this.api.request(requestObj);
        }
        return true;
    };
    dInterface.prototype.LoadSubPackage = function (subName, onComplete) {
        var _this = this;
        if (subName.length == 1)
            return this._LoadSubPackage(subName[0], onComplete);
        else {
            if (dInterface.sdkName == "tt") {
                this._LoadSubPackage(subName[0], function () {
                    subName.erase(0);
                    if (subName.length == 0)
                        onComplete();
                    else
                        _this.LoadSubPackage(subName, onComplete);
                });
            }
            else {
                var callback = new dCompleteCallback(this);
                for (var i = 0; i < subName.length; i++)
                    this._LoadSubPackage(subName[i], callback.CreateCompleteFun_Normal());
                callback.SetCompleteFun(onComplete);
            }
        }
    };
    dInterface.prototype._LoadSubPackage = function (subName, onComplete) {
        var _this = this;
        if (dInterface.sdkName == "web" && this.GetChannelName() != "7k7kh5" || dInterface.sdkName == "hw") {
            onComplete(100);
        }
        else if (dInterface.sdkName == "mg" || dInterface.sdkName == "uc" || dInterface.sdkName == "web" && this.GetChannelName() == "7k7kh5") {
            if (dInterface.sdkName == "mg") {
                if (this.api.loadResouceStart)
                    this.api.loadResouceStart();
            }
            var arr = new dByteArray();
            arr.LoadFromFile(subName + ".bin", function () {
                var filePacker = new dFilePacker();
                filePacker.LoadFromBin(arr);
                if (!_this.m_vecSubPackageData)
                    _this.m_vecSubPackageData = new Array();
                _this.m_vecSubPackageData.push(filePacker);
                onComplete(100);
                if (dInterface.sdkName == "mg") {
                    _this.api.loadResouceComplete();
                    if (window.onEnterGame)
                        window.onEnterGame();
                }
            });
        }
        else {
            var list = this.GetSubFileList(subName);
            var callback = new dCompleteCallback(this);
            for (var i = 0; i < list.length; i++) {
                callback.Add();
                if (dInterface.sdkName == "hw") {
                    this.api.loadSubpackage({
                        subpackage: list[i],
                        success: function (info) {
                            if (!_this.m_onErrCallback)
                                callback.DoComplete();
                            else {
                                try {
                                    callback.DoComplete();
                                }
                                catch (err) {
                                    new dTimer().Create(500, 1, function () {
                                        _this._LoadSubPackage(subName, onComplete);
                                    });
                                }
                            }
                        },
                        fail: function (info) {
                            console.log(info && info.errMsg ? info.errMsg : "LoadSubpackage Failed " + list[i]);
                            new dTimer().Create(500, 1, function () {
                                _this._LoadSubPackage(subName, onComplete);
                            });
                        },
                        complete: function () {
                        }
                    });
                }
                else {
                    this.api.loadSubpackage({
                        name: list[i],
                        success: function (info) {
                            if (!_this.m_onErrCallback)
                                callback.DoComplete();
                            else {
                                try {
                                    callback.DoComplete();
                                }
                                catch (err) {
                                    new dTimer().Create(500, 1, function () {
                                        _this._LoadSubPackage(subName, onComplete);
                                    });
                                }
                            }
                        },
                        fail: function (info) {
                            if (dInterface.sdkName == "ks") {
                                if (info.data == list[i]) {
                                    if (!_this.m_onErrCallback)
                                        callback.DoComplete();
                                    else {
                                        try {
                                            callback.DoComplete();
                                        }
                                        catch (err) {
                                            new dTimer().Create(500, 1, function () {
                                                _this._LoadSubPackage(subName, onComplete);
                                            });
                                        }
                                    }
                                }
                                else
                                    console.log(info);
                            }
                            else {
                                console.log(info && info.errMsg ? info.errMsg : "LoadSubpackage Failed " + list[i]);
                                new dTimer().Create(500, 1, function () {
                                    _this._LoadSubPackage(subName, onComplete);
                                });
                            }
                        },
                        complete: function () {
                        }
                    });
                }
            }
            callback.SetCompleteFun(function () {
                onComplete(100);
            });
        }
    };
    dInterface.prototype.LoadArrayBuffer = function (url, callback) {
        var _this = this;
        if (dInterface.sdkName == "web" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg") {
            if (this.GetChannelName() == "7k7kh5") {
                if (url.indexOf(".bin") == url.length - 4) {
                    var split = dStringUtils.SplitFileName(url);
                    url = "img/hanzi-mz/"+split[0] + split[1] + split[2] + ".dat";
                }
            }
            if (this.m_vecSubPackageData) {
                var data = this.GetSubPackageData(url);
                if (data) {
                    callback(data.m_pArraybuffer);
                    return;
                }
            }
            var xhr = new XMLHttpRequest();
            xhr.open("get", this.MakeFileUrl(url), true);
            xhr.responseType = "arraybuffer";
            xhr.onload = function () {
                var ret = null;
                if (xhr.status == 200 || xhr.status == 0) {
                    ret = xhr.response;
                }
                else {
                    console.log("failed loading " + url);
                }
                if (!_this.m_onErrCallback)
                    callback(ret);
                else {
                    try {
                        callback(ret);
                    }
                    catch (err) {
                        if (_this.m_onErrCallback)
                            _this.m_onErrCallback(err);
                    }
                }
            };
            xhr.onerror = function () {
                console.log("failed loading " + url);
                if (!_this.m_onErrCallback)
                    callback(null);
                else {
                    try {
                        callback(null);
                    }
                    catch (err) {
                        if (_this.m_onErrCallback)
                            _this.m_onErrCallback(err);
                    }
                }
            };
            xhr.send();
        }
        else {
            this.api.getFileSystemManager().readFile({
                filePath: this.MakeFileUrl(url),
                success: function (res) {
                    if (res.data instanceof ArrayBuffer)
                        callback(res.data);
                    else {
                        var uint8 = res.data;
                        var data2 = uint8.buffer.slice(uint8.byteOffset, uint8.byteOffset + uint8.byteLength);
                        callback(data2);
                    }
                },
                fail: function () {
                    callback(null);
                }
            });
        }
    };
    dInterface.prototype.MakeFileUrl = function (url) {
        if (window.MakeFileUrl)
            return window.MakeFileUrl(url);
        return url;
    };
    dInterface.prototype.GetSubFileList = function (name) {
        if (window.GetSubFileList)
            return window.GetSubFileList(name);
        return [name];
    };
    dInterface.prototype.CreateImage = function () {
        var img = null;
        if (dInterface.sdkName == "web" || dInterface.sdkName == "oppo" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg")
            img = new Image();
        else
            img = this.api.createImage();
        return img;
    };
    dInterface.prototype.LoadImage = function (url, callback) {
        var _this = this;
        var img = this.CreateImage();
        img.onload = function () {
            if (!_this.m_onErrCallback)
                callback(img);
            else {
                try {
                    callback(img);
                }
                catch (err) {
                    if (_this.m_onErrCallback)
                        _this.m_onErrCallback(err);
                }
            }
        };
        img.onerror = function () {
            console.log("failed loading " + url);
            if (!_this.m_onErrCallback)
                callback(null);
            else {
                try {
                    callback(null);
                }
                catch (err) {
                    if (_this.m_onErrCallback)
                        _this.m_onErrCallback(err);
                }
            }
        };
        try {
            img.setAttribute('crossorigin', 'anonymous');
        }
        catch (err) {
        }
        if (this.m_vecSubPackageData) {
            var data = this.GetSubPackageData(url);
            if (!data) {
                img.src = this.MakeFileUrl(url);
            }
            else {
                var ext = dStringUtils.GetFileNameExt(url, false).toLocaleLowerCase();
                var arrayBufferView = new Uint8Array(data.m_pArraybuffer);
                var blob = new Blob([arrayBufferView], { type: "image/" + ext });
                var urlCreator = window.URL || window.webkitURL;
                var imageUrl = urlCreator.createObjectURL(blob);
                img.src = imageUrl;
            }
        }
        else
            img.src = this.MakeFileUrl(url);
    };
    dInterface.prototype.GetSubPackageData = function (fileName) {
        if (!this.m_vecSubPackageData)
            return null;
        for (var i = 0; i < this.m_vecSubPackageData.length; i++) {
            var ret = this.m_vecSubPackageData[i].GetFile(fileName);
            if (ret)
                return ret;
        }
        return null;
    };
    dInterface.prototype.PlayAudio = function (fileName, position, loop, volume) {
        var _this = this;
        if (dInterface.sdkName == "web" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg") {
            var audioContext = window.AudioContext || window.webkitAudioContext;
            if (!audioContext) {
                console.log('not support web audio api');
                var audio = document.createElement("audio");
                this.m_arrAudios.push(audio);
                audio.stop = function () {
                    audio.pause();
                    audio.currentTime = 0;
                    _this.m_arrAudios.remove(audio);
                };
                audio.onerror = function () {
                    console.log("failed loading " + fileName);
                };
                audio.addEventListener('ended', function () {
                    _this.m_arrAudios.remove(audio);
                });
                if (this.m_vecSubPackageData) {
                    var data = this.GetSubPackageData(fileName);
                    if (!data) {
                        audio.src = this.MakeFileUrl(fileName);
                    }
                    else {
                        var ext = dStringUtils.GetFileNameExt(fileName, false).toLocaleLowerCase();
                        var arrayBufferView = new Uint8Array(data.m_pArraybuffer);
                        var blob = new Blob([arrayBufferView], { type: "audio/" + ext });
                        var urlCreator = window.URL || window.webkitURL;
                        var imageUrl = urlCreator.createObjectURL(blob);
                        audio.src = imageUrl;
                    }
                }
                else
                    audio.src = this.MakeFileUrl(fileName);
                audio.volume = volume * this.m_globalAudioVolume;
                audio.loop = loop;
                audio.autoplay = true;
                console.log("play " + fileName + " " + audio.volume);
                audio.play();
                audio.srcVolume = volume;
                return audio;
            }
            else {
                if (!this.m_audioContext)
                    this.m_audioContext = new audioContext();
                var audio = {};
                audio.isPlaying = false;
                audio.isPausing = false;
                audio.loop = loop;
                audio.fileName = fileName;
                audio.startedAt = Date.now();
                audio.pausedAt = 0;
                audio.srcVolume = volume;
                audio.play = function () {
                    if (audio.isPlaying)
                        return;
                    if (audio.destination) {
                        audio.isPlaying = true;
                        audio.source = _this.m_audioContext.createBufferSource();
                        audio.source.buffer = audio.buffer;
                        audio.source.loop = audio.loop;
                        audio.isPlaying = true;
                        audio.gainNode = _this.m_audioContext.createGain();
                        audio.source.connect(audio.gainNode);
                        audio.gainNode.connect(audio.destination);
                        audio.gainNode.gain.value = volume * _this.m_globalAudioVolume;
                        audio.source.onended = function () {
                            audio.isPlaying = false;
                            if (!audio.isPausing)
                                _this.m_arrAudios.remove(audio);
                            audio.source = null;
                            audio.gainNode = null;
                        };
                        if (audio.isPausing) {
                            audio.startedAt = Date.now() - audio.pausedAt;
                            audio.source.start(0, audio.pausedAt / 1000);
                        }
                        else {
                            audio.startedAt = Date.now();
                            audio.source.start(0);
                        }
                        audio.isPausing = false;
                    }
                };
                audio.pause = function () {
                    audio.isPausing = true;
                    audio.pausedAt = Date.now() - audio.startedAt;
                    audio.stop();
                };
                audio.stop = function () {
                    if (!audio.isPlaying)
                        return;
                    if (audio.source) {
                        audio.isPlaying = false;
                        try {
                            audio.source.stop();
                        }
                        catch (err) { }
                        audio.source = null;
                        audio.gainNode = null;
                    }
                };
                Object.defineProperty(audio, "volume", {
                    get: function () {
                        if (audio.gainNode.gain)
                            return audio.gainNode.gain.value;
                        return 1;
                    },
                    set: function (v) {
                        if (audio.gainNode && audio.gainNode.gain)
                            audio.gainNode.gain.value = v;
                    }
                });
                this.m_arrAudios.push(audio);
                if (this.m_arrAudioDataBuffer == null)
                    this.m_arrAudioDataBuffer = new Map();
                if (this.m_arrAudioDataBuffer.has(fileName)) {
                    var audioBuffer = this.m_arrAudioDataBuffer.get(fileName);
                    if (audioBuffer.isDecodeFinish) {
                        audio.buffer = audioBuffer.buffer;
                        audio.destination = audioBuffer.destination;
                        audio.play();
                    }
                    else {
                        if (!audioBuffer.onComplete)
                            audioBuffer.onComplete = [];
                        audioBuffer.onComplete.push(function () {
                            audio.buffer = audioBuffer.buffer;
                            audio.destination = audioBuffer.destination;
                            audio.play();
                        });
                    }
                }
                else {
                    var audioBuffer = {};
                    this.m_arrAudioDataBuffer.set(fileName, audioBuffer);
                    audioBuffer.onComplete = [];
                    audioBuffer.onComplete.push(function () {
                        audio.buffer = audioBuffer.buffer;
                        audio.destination = audioBuffer.destination;
                        audio.play();
                    });
                    this.LoadArrayBuffer(fileName, function (res) {
                        if (res) {
                            _this.m_audioContext.decodeAudioData(res, function (buffer) {
                                audioBuffer.buffer = buffer;
                                audioBuffer.destination = _this.m_audioContext.destination;
                                audioBuffer.isDecodeFinish = true;
                                if (audioBuffer.onComplete) {
                                    for (var i = 0; i < audioBuffer.onComplete.length; i++)
                                        audioBuffer.onComplete[i]();
                                    audioBuffer.onComplete = null;
                                }
                            });
                        }
                    });
                }
                return audio;
            }
        }
        else {
            var audio = this.api.createInnerAudioContext();
            audio.autoplay = true;
            audio.loop = loop;
            audio.volume = volume * this.m_globalAudioVolume;
            audio.srcVolume = volume;
            audio.src = this.MakeFileUrl(fileName);
            audio._stop = audio.stop;
            audio.stop = function () {
                audio._stop();
                if (dInterface.sdkName == "mi")
                    audio.destroy();
                if (_this.m_arrAudios.indexOf(audio) != -1)
                    _this.m_arrAudios.remove(audio);
            };
            if (dInterface.sdkName == "wx" || dInterface.sdkName == "qq" || dInterface.sdkName == "tt" || dInterface.sdkName == "bd" || dInterface.sdkName == "mi" || dInterface.sdkName == "ks") {
                this.m_arrAudios.push(audio);
                var onEnd = function () {
                    audio.offEnded(onEnd);
                    _this.m_arrAudios.remove(audio);
                };
                audio.onEnded(onEnd);
            }
            if (dInterface.sdkName == "bd") {
                audio.autoplay = false;
                audio.play();
            }
            return audio;
        }
    };
    dInterface.prototype.OpenWebPage = function (url) {
        if (dInterface.sdkName == "web" || dInterface.sdkName == "oppo" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg") {
            if (window && window.androidJSApis && window.androidJSApis.OpenWebPage) {
                return window.androidJSApis.OpenWebPage(url);
            }
            window.open(url);
        }
    };
    dInterface.prototype.ShowHtmlDialog = function (fileName) {
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis && window.androidJSApis.ShowHtmlDialog)
                window.androidJSApis.ShowHtmlDialog(fileName);
        }
    };
    dInterface.prototype.OpenMiniProgram = function (appId) {
        if (dInterface.sdkName == "wx" || dInterface.sdkName == "qq" || dInterface.sdkName == "tt" || dInterface.sdkName == "ks") {
            this.api.navigateToMiniProgram({
                appId: appId,
                path: "",
                extraData: {
                    foo: ''
                },
                envVersion: 'release',
                success: function (res) {
                    console.log("navigate to " + appId);
                }
            });
        }
        else if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis && window.androidJSApis.OpenApp)
                window.androidJSApis.OpenApp(appId);
            else if (window && window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.OpenApp)
                window.webkit.messageHandlers.OpenApp.postMessage(appId);
        }
    };
    dInterface.prototype.GetSafeAreaTop = function () {
        if (dInterface.sdkName == "web") {
            if (window && window.SafeAreaTop)
                return window.SafeAreaTop;
            if (window && window.androidJSApis) {
                return window.androidJSApis.GetSafeAreaTop();
            }
            return 0;
        }
        else if (dInterface.sdkName == "oppo") {
            return 100 * this.m_pixelRatio;
        }
        else if (dInterface.sdkName == "m7k7k") {
            return 60 * this.m_pixelRatio;
        }
        else if (dInterface.sdkName == "vivo") {
            var res = this.api.getSystemInfoSync();
            var statusBarHeight = res.safeArea.top;
            var data_1 = this.api.getMenuButtonBoundingClientRect();
            return Math.max((data_1.bottom || 0) * this.m_pixelRatio, statusBarHeight * this.m_pixelRatio);
        }
        else if (dInterface.sdkName == "qq") {
            var res = this.api.getSystemInfoSync();
            var statusBarHeight = res.statusBarHeight;
            var data_2 = this.api.getMenuButtonBoundingClientRect();
            return Math.max((data_2.bottom || 0) * this.m_pixelRatio, statusBarHeight * this.m_pixelRatio);
        }
        else if (dInterface.sdkName == "wx" || dInterface.sdkName == "tt" || dInterface.sdkName == "mi") {
            var res = this.api.getSystemInfoSync();
            var statusBarHeight = res.safeArea.top;
            var data;
            if (dInterface.sdkName == "mi")
                data = qg.getMenuButtonBoundingClientRect();
            else
                data = this.api.getMenuButtonBoundingClientRect();
            return Math.max(data.bottom * this.m_pixelRatio, statusBarHeight * this.m_pixelRatio);
        }
        else if (dInterface.sdkName == "bd" || dInterface.sdkName == "hw") {
            var res = this.api.getSystemInfoSync();
            var statusBarHeight = res.statusBarHeight;
            return Math.max(res.navigationBarHeight * this.m_pixelRatio, statusBarHeight * this.m_pixelRatio);
        }
        else if (dInterface.sdkName == "uc") {
            var systemInfo = this.api.getSystemInfoSync();
            if (typeof systemInfo === 'string') {
                try {
                    systemInfo = JSON.parse(systemInfo);
                    return Math.max(dMath.ParseInt(systemInfo.safeArea.top), dMath.ParseInt(systemInfo.statusBarHeight));
                }
                catch (e) { }
            }
        }
        else if (dInterface.sdkName == "mg") {
            return 60 * this.m_pixelRatio;
        }
        else if (dInterface.sdkName == "ks") {
            var res = this.api.getSystemInfoSync();
            var statusBarHeight = res.statusBarHeight + 32;
            return statusBarHeight * this.m_pixelRatio;
        }
        return 0;
    };
    dInterface.prototype.GetSafeAreaBottom = function () {
        if (dInterface.sdkName == "web" || dInterface.sdkName == "oppo" || dInterface.sdkName == "m7k7k") {
            if (window && window.SafeAreaBottom)
                return window.SafeAreaBottom;
            if (window && window.androidJSApis) {
                return window.androidJSApis.GetSafeAreaBottom();
            }
            return 0;
        }
        else if (dInterface.sdkName == "vivo") {
            var res = this.api.getSystemInfoSync();
            return (res.screenHeight - res.safeArea.bottom * this.m_pixelRatio);
        }
        else if (dInterface.sdkName == "qq") {
            return 0;
        }
        else if (dInterface.sdkName == "wx" || dInterface.sdkName == "tt" || dInterface.sdkName == "mi" || dInterface.sdkName == "hw" || dInterface.sdkName == "ks") {
            var res = this.api.getSystemInfoSync();
            return (res.screenHeight - res.safeArea.bottom);
        }
        else if (dInterface.sdkName == "uc") {
            var systemInfo = this.api.getSystemInfoSync();
            if (typeof systemInfo === 'string') {
                try {
                    systemInfo = JSON.parse(systemInfo);
                    return dMath.ParseInt(systemInfo.screenHeight) - dMath.ParseInt(systemInfo.safeArea.bottom);
                }
                catch (e) { }
            }
        }
        return 0;
    };
    dInterface.prototype.GetAppList = function () {
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis) {
                return window.androidJSApis.GetAppList();
            }
        }
        return "";
    };
    dInterface.prototype.GetPackageVersionCode = function () {
        if (dInterface.sdkName == "web") {
            if (window && window.AppVersionCode)
                return window.AppVersionCode;
            if (window && window.androidJSApis)
                return window.androidJSApis.GetPackageVersionCode();
        }
        else if (dInterface.sdkName == "vivo") {
            var res = this.api.getSystemInfoSync();
            if (res && res.miniGame && res.miniGame.version)
                return Number(res.miniGame.version);
        }
        else if (dInterface.sdkName == "oppo") {
            var res = this.api.getSystemInfoSync();
            if (res && res.COREVersion)
                return dMath.ParseFloat(res.COREVersion);
        }
        return 0;
    };
    dInterface.prototype.GetPackageAppId = function () {
        if (window && window.PackageAppId)
            return window.PackageAppId;
        return "";
    };
    dInterface.prototype.GetPackageName = function () {
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis)
                return window.androidJSApis.GetPackageName();
        }
        else if (dInterface.sdkName == "vivo") {
            var res = this.api.getSystemInfoSync();
            if (res && res.miniGame && res.miniGame.package)
                return String(res.miniGame.package);
        }
        return "";
    };
    dInterface.prototype.GetPackageSha1 = function () {
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis && window.androidJSApis.GetPackageSha1)
                return window.androidJSApis.GetPackageSha1();
        }
        return "";
    };
    dInterface.prototype.GetLocalLanguage = function () {
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis && window.androidJSApis.GetLocalLanguage)
                return window.androidJSApis.GetLocalLanguage();
        }
        return dStringUtils.dLANG_CHINESE_SIMPLIFIED;
    };
    dInterface.prototype.ReadStorage = function (key, onComplete, defaultRet) {
        if (dInterface.sdkName == "web" || dInterface.sdkName == "oppo" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg" || dInterface.sdkName == "hw") {
            var data = localStorage.getItem(key);
            if (!data)
                onComplete(defaultRet);
            else
                onComplete(data);
        }
        else if (dInterface.sdkName == "vivo" || dInterface.sdkName == "mi" || dInterface.sdkName == "hw" || dInterface.sdkName == "ks") {
            this.api.getStorage({
                key: key,
                success: function (res) {
                    onComplete(res);
                },
                fail: function () {
                    onComplete(defaultRet);
                }
            });
        }
        else {
            this.api.getStorage({
                key: key,
                success: function (res) {
                    onComplete(res.data);
                },
                fail: function () {
                    onComplete(defaultRet);
                }
            });
        }
    };
    dInterface.prototype.WriteStorage = function (key, value) {
        if (dInterface.sdkName == "web" || dInterface.sdkName == "oppo" || dInterface.sdkName == "uc" || dInterface.sdkName == "mg" || dInterface.sdkName == "hw") {
            localStorage.setItem(key, value);
        }
        else if (dInterface.sdkName == "vivo") {
            this.api.setStorage({ key: key, value: value });
        }
        else {
            this.api.setStorage({ key: key, data: value });
        }
    };
    dInterface.prototype.ShowAdRewardedVideo = function (onComplete) {
        var _this = this;
        var showTime = dTimer.GetTickCount();
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis) {
                if (window.androidJSApis.isRewardedVideoReady()) {
                    this.PauseAllSound();
                    this.m_bRewardedVideoShowing = true;
                    window.rewardedVideoVerifyed = function (bVerify) {
                        try {
                            _this.m_bRewardedVideoShowing = false;
                            _this.ResumeAllSound();
                            window.rewardedVideoVerifyed = null;
                            if (bVerify) {
                                onComplete(_this);
                            }
                        }
                        catch (err) {
                            if (_this.m_onErrCallback)
                                _this.m_onErrCallback(err);
                        }
                    };
                    window.androidJSApis.ShowAdRewardedVideo();
                }
                else
                    window.androidJSApis.showToast("");
            }
            else if (this.GetChannelName() == "ios" && window && window.webkit && window.webkit.messageHandlers) {
                window.isRewardedVideoReadyResult = function (isReady) {
                    if (isReady) {
                        _this.PauseAllSound();
                        _this.m_bRewardedVideoShowing = true;
                        window.rewardedVideoVerifyed = function (bVerify) {
                            try {
                                _this.m_bRewardedVideoShowing = false;
                                _this.ResumeAllSound();
                                window.rewardedVideoVerifyed = null;
                                if (bVerify) {
                                    onComplete(_this);
                                }
                            }
                            catch (err) {
                                if (_this.m_onErrCallback)
                                    _this.m_onErrCallback(err);
                            }
                        };
                        window.webkit.messageHandlers.ShowAdRewardedVideo.postMessage("");
                    }
                    else
                        _this.ShowToast("");
                };
                window.webkit.messageHandlers.isRewardedVideoReady.postMessage("");
            }
            else if (this.GetChannelName() == "7k7kh5" && window && window.h5api && window.h5api.canPlayAd) {
                window.h5api.canPlayAd(function (data) {
                    {
                        window.h5api.playAd(function (obj) {
                            console.log(":" + obj.code + ",:" + obj.message);
                            if (obj.code === 10000) {
                                console.log("");
                            }
                            else if (obj.code === 10001) {
                                console.log("");
                                _this.ClearMouseHook();
                                if (dTimer.GetTickCount() > showTime + 500)
                                    onComplete(_this);
                            }
                            else {
                                _this.ClearMouseHook();
                                console.log("");
                            }
                        });
                    }
                });
            }
            else {
                this.PauseAllSound();
                new dTimer().Create(100, 1, function () {
                    _this.ResumeAllSound();
                    onComplete(_this);
                });
            }
        }
        else if ((dInterface.sdkName == "vivo" || dInterface.sdkName == "oppo" || dInterface.sdkName == "m7k7k") && window.adid_rewarded) {
            var rewardedAd_1 = this.api.createRewardedVideoAd({ posId: window.adid_rewarded });
            this.m_bRewardedVideoShowing = true;
            rewardedAd_1.onError(function (err) {
                console.log("", err);
                _this.m_bRewardedVideoShowing = false;
                _this.api.showToast({
                    title: '',
                    message: '',
                    duration: 1500
                });
                rewardedAd_1.destroy();
            });
            rewardedAd_1.onLoad(function (res) {
                console.log('-onload', JSON.stringify(res));
                rewardedAd_1.show().then(function () {
                    console.log('');
                }).catch(function (err) {
                    console.log('', JSON.stringify(err));
                });
            });
            rewardedAd_1.onClose(function (res) {
                _this.m_bRewardedVideoShowing = false;
                console.log('');
                rewardedAd_1.destroy();
                if (res && res.isEnded) {
                    console.log("");
                    onComplete(_this);
                }
                else {
                    console.log("");
                }
            });
            if (dInterface.sdkName == "oppo")
                rewardedAd_1.load();
        }
        else if ((dInterface.sdkName == "wx" || dInterface.sdkName == "qq" || dInterface.sdkName == "tt" || dInterface.sdkName == "uc" || dInterface.sdkName == "mi" || dInterface.sdkName == "ks") && window.adid_rewarded) {
            this.m_rewardedCompleteCallback = onComplete;
            this.m_bRewardedVideoShowing = true;
            if (!this.m_rewardedAd) {
                if (dInterface.sdkName == "uc")
                    this.m_rewardedAd = this.api.createRewardVideoAd();
                else
                    this.m_rewardedAd = this.api.createRewardedVideoAd({ adUnitId: window.adid_rewarded });
                this.m_rewardedAd.onClose(function (res) {
                    _this.ResumeAllSound();
                    _this.m_bRewardedVideoShowing = false;
                    if (res && res.isEnded || res === undefined) {
                        console.log("");
                        if (_this.m_rewardedCompleteCallback)
                            _this.m_rewardedCompleteCallback(_this);
                    }
                    else {
                        console.log("");
                    }
                    _this.m_rewardedCompleteCallback = null;
                });
                this.m_rewardedAd.onError(function (err) {
                    if (_this.m_bRewardedVideoShowing) {
                        _this.ResumeAllSound();
                        _this.m_bRewardedVideoShowing = false;
                        console.log('onError ' + err.errCode + " " + err.errMsg);
                        _this.m_rewardedCompleteCallback = null;
                        _this.api.showToast({
                            title: '',
                            message: '',
                            duration: 1500
                        });
                    }
                });
            }
            this.m_rewardedAd.load().then(function () {
                _this.PauseAllSound();
                console.log(' ');
                _this.m_rewardedAd.show();
            });
        }
        else if (dInterface.sdkName == "bd" && window.adid_rewarded) {
            this.m_rewardedCompleteCallback = onComplete;
            if (!this.m_rewardedAd) {
                this.m_rewardedAd = this.api.createRewardedVideoAd({ adUnitId: window.adid_rewarded,
                    appSid: window.appSid });
                this.m_rewardedAd.onClose(function (res) {
                    _this.ResumeAllSound();
                    _this.m_bRewardedVideoShowing = false;
                    if (res && res.isEnded || res === undefined) {
                        console.log("");
                        if (_this.m_rewardedCompleteCallback)
                            _this.m_rewardedCompleteCallback(_this);
                    }
                    else {
                        console.log("");
                    }
                    _this.m_rewardedCompleteCallback = null;
                });
                this.m_rewardedAd.onError(function (err) {
                    _this.ResumeAllSound();
                    _this.m_bRewardedVideoShowing = false;
                    console.log('onError ' + err.errCode + " " + err.errMsg);
                    _this.m_rewardedCompleteCallback = null;
                    _this.api.showToast({
                        title: '',
                        message: '',
                        duration: 1500
                    });
                });
            }
            this.m_rewardedAd.load().then(function () {
                _this.PauseAllSound();
                console.log(' ');
                _this.m_rewardedAd.show();
            });
        }
        else if (dInterface.sdkName == "mg") {
            if (window.adid_rewarded) {
                console.log("onADShow " + window.adid_rewarded + " " + this.api.mgAd);
                this.api.mgAd.getReward(window.adid_rewarded, {
                    onADExposure: function (data) {
                        console.log('onADExposure ', data);
                    },
                    onADClick: function (data) {
                        console.log('onADClick ', data);
                    },
                    onADClose: function (data) {
                        console.log('onADClose ', data);
                        _this.m_bRewardedVideoShowing = false;
                        if (_this.m_bRewardedVideoVerifyed)
                            onComplete(_this);
                        _this.m_bRewardedVideoVerifyed = false;
                        _this.ResumeAllSound();
                    },
                    onError: function (data) {
                        console.log('onError ', data);
                    },
                    onADStart: function (data) {
                        console.log('onADStart ', data);
                        _this.m_bRewardedVideoShowing = true;
                        _this.m_bRewardedVideoVerifyed = false;
                        _this.PauseAllSound();
                    },
                    onADComplete: function (data) {
                        console.log('onADComplete ', data);
                        _this.m_bRewardedVideoVerifyed = true;
                    },
                    onADUpdateTime: function (data) {
                        console.log('onADUpdateTime ', data);
                    }
                }, {
                    rewardTxt: "",
                    completeTxt: ""
                }).then(function (hasAD) {
                    console.log("hasAD:", hasAD);
                });
            }
        }
        else if (dInterface.sdkName == "hw" && window.adid_rewarded) {
            this.m_rewardedCompleteCallback = onComplete;
            this.m_bRewardedVideoShowing = true;
            if (!this.m_rewardedAd) {
                this.m_rewardedAd = this.api.createRewardedVideoAd({
                    adUnitId: window.adid_rewarded,
                    success: function (code) {
                        console.log("ad demo : loadAndShowVideoAd createRewardedVideoAd: success");
                    },
                    fail: function (data, code) {
                        console.log("ad demo : loadAndShowVideoAd createRewardedVideoAd fail: " + data + "," + code);
                    },
                    complete: function () {
                        console.log("ad demo : loadAndShowVideoAd createRewardedVideoAd complete");
                    }
                });
                this.m_rewardedAd.onClose(function (res) {
                    _this.ResumeAllSound();
                    _this.m_bRewardedVideoShowing = false;
                    if (res && res.isEnded || res === undefined) {
                        console.log("");
                        if (_this.m_rewardedCompleteCallback)
                            _this.m_rewardedCompleteCallback(_this);
                    }
                    else {
                        console.log("");
                    }
                    _this.m_rewardedCompleteCallback = null;
                });
                this.m_rewardedAd.onError(function (err) {
                    if (_this.m_bRewardedVideoShowing) {
                        _this.ResumeAllSound();
                        _this.m_bRewardedVideoShowing = false;
                        console.log('onError ' + err.errCode + " " + err.errMsg);
                        _this.m_rewardedCompleteCallback = null;
                        _this.api.showToast({
                            title: '',
                            message: '',
                            duration: 1500
                        });
                    }
                });
                this.m_rewardedAd.onLoad(function (res) {
                    console.log('-onload', JSON.stringify(res));
                    _this.m_rewardedAd.show();
                });
            }
            this.m_rewardedAd.load();
        }
        else {
            this.api.showToast({
                title: '',
                message: '',
                duration: 1500
            });
        }
    };
    dInterface.prototype.ClearMouseHook = function () {
        var e_9, _a;
        try {
            for (var _b = __values(this.m_mapSpriteMouseEvent.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {
                var key = _c.value;
                if (this.m_mapSpriteMouseEvent.get(key).pSprite) {
                    this.m_mapSpriteMouseEvent.get(key).pSprite.OnTouchUp(0, 0);
                }
            }
        }
        catch (e_9_1) { e_9 = { error: e_9_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_9) throw e_9.error; }
        }
        this.m_mapSpriteMouseEvent.clear();
        this.m_arrCurMouseDownList.clear();
    };
    dInterface.prototype.ShowToast = function (text) {
        var bmp = new dBitmapData();
        bmp.FillText(text, 48, 0xffffffff);
        var p = new dSprite();
        p.SetBitmapData(bmp);
        p.SetSize(bmp.GetWidth(), bmp.GetHeight());
        var back = new dSprite();
        back.spriteColor = 0xff000000;
        back.SetSize(p.width + 20, p.height + 20);
        p.SetPos(10, 10);
        back.AddChild(p);
        back.SetBitmapData(dBitmapData.WHITE_BITMAPDATA);
        back.SetPos((dThread.GetWindowWidth() - back.width) / 2, dThread.GetWindowHeight() - 200);
        dThread.GetRootSprite().AddChild(back);
        new dTimer().Create(2000, 1, function () {
            back.RemoveParent();
        });
    };
    dInterface.prototype.isAdRewardedShowing = function () {
        return this.m_bRewardedVideoShowing;
    };
    dInterface.prototype.isAdRewardedReady = function () {
        if (window && window.androidJSApis) {
            if (window.androidJSApis.isRewardedVideoReady())
                return true;
        }
        return true;
    };
    dInterface.prototype.isAdInterstitialVideoReady = function () {
        if (window && window.androidJSApis) {
            if (window.androidJSApis.isInterstitialVideoReady())
                return true;
        }
        return true;
    };
    dInterface.prototype.ShowAdInterstitialImage = function (onComplete) {
        var _this = this;
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis) {
                if (window.androidJSApis.isInterstitialImageReady()) {
                    window.interstitialImageClosed = function () {
                        window.interstitialImageClosed = null;
                        if (onComplete)
                            onComplete(_this);
                    };
                    window.androidJSApis.ShowAdInterstitialImage();
                }
            }
        }
        else if (dInterface.sdkName == "vivo") {
            if (window.adid_interstitial) {
                var interstitialAd = this.api.createInterstitialAd({ posId: window.adid_interstitial });
                interstitialAd.onError(function (err) {
                    console.log("", err);
                });
                interstitialAd.show().then(function () {
                    console.log('');
                }).catch(function (err) {
                    console.log('', JSON.stringify(err));
                });
                interstitialAd.onClose(function () {
                    interstitialAd.destroy();
                    if (onComplete)
                        onComplete(_this);
                });
            }
        }
    };
    dInterface.prototype.ShowAdInterstitialVideo = function (onComplete) {
        var _this = this;
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis) {
                if (window.androidJSApis.isInterstitialVideoReady()) {
                    this.PauseAllSound();
                    this.m_bRewardedVideoShowing = true;
                    window.interstitialVideoClosed = function () {
                        _this.m_bRewardedVideoShowing = false;
                        _this.ResumeAllSound();
                        window.interstitialVideoClosed = null;
                        if (onComplete)
                            onComplete(_this);
                    };
                    window.androidJSApis.ShowAdInterstitialVideo();
                }
            }
        }
    };
    dInterface.prototype.ShowAdBanner = function (bShow, flag) {
        var _this = this;
        this.m_banderAdShowing = bShow;
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis) {
                window.androidJSApis.ShowAdBanner(bShow, flag);
            }
        }
        else if (dInterface.sdkName == "vivo") {
            if (window.adid_banner) {
                if (bShow) {
                    if (!this.m_bannerAd) {
                        var bannerAd = this.m_bannerAd = this.api.createBannerAd({ posId: window.adid_banner });
                        this.m_bannerAd.show().then(function () {
                            console.log('banner');
                            if (_this.m_bannerAd != bannerAd)
                                bannerAd.hide();
                        }).catch(function (err) {
                            console.log('banner', JSON.stringify(err));
                        });
                    }
                }
                else {
                    if (this.m_bannerAd) {
                        this.m_bannerAd.hide();
                        this.m_bannerAd = null;
                    }
                }
            }
        }
        else if (dInterface.sdkName == "m7k7k") {
            if (window.adid_banner) {
                if (bShow) {
                    if (!this.m_bannerAd) {
                        var screenHeight = this.api.getSystemInfoSync().screenHeight * this.m_pixelRatio;
                        var screenWidth = this.api.getSystemInfoSync().screenWidth * this.m_pixelRatio;
                        var bottomOff = 0;
                        var bannerWidth = 0;
                        var bannerHeight = 0;
                        var res = this.api.getSystemInfoSync();
                        bannerWidth = res.screenWidth * this.m_pixelRatio;
                        bannerHeight = 80 * this.m_pixelRatio;
                        bottomOff = 0;
                        var bannerAd = this.m_bannerAd = this.api.createBannerAd({
                            style: {
                                left: (screenWidth - bannerWidth) / 2,
                                top: (screenHeight - bannerHeight - bottomOff),
                                width: bannerWidth,
                                height: bannerHeight
                            }
                        });
                        this.m_bannerAd.show().then(function () {
                            console.log('banner');
                            if (_this.m_bannerAd != bannerAd)
                                bannerAd.hide();
                        }).catch(function (err) {
                            console.log('banner', JSON.stringify(err));
                        });
                    }
                }
                else {
                    if (this.m_bannerAd) {
                        this.m_bannerAd.hide();
                        this.m_bannerAd = null;
                    }
                }
            }
        }
        else if (dInterface.sdkName == "wx" || dInterface.sdkName == "qq") {
            if (window.adid_banner) {
                if (!this.m_bannerAd) {
                    var screenHeight = this.api.getSystemInfoSync().screenHeight;
                    var screenWidth = this.api.getSystemInfoSync().screenWidth;
                    var bottomOff = 0;
                    var bannerWidth = 0;
                    var bannerHeight = 0;
                    var res = this.api.getSystemInfoSync();
                    bannerWidth = res.screenWidth;
                    bannerHeight = 80;
                    bottomOff = 0;
                    if (dInterface.sdkName == "wx")
                        bottomOff = res.screenHeight - res.safeArea.bottom;
                    this.m_bannerAd = this.api.createBannerAd({
                        adUnitId: window.adid_banner,
                        style: {
                            left: (screenWidth - bannerWidth) / 2,
                            top: screenHeight - bannerHeight - bottomOff,
                            width: bannerWidth,
                        }
                    });
                    this.m_bannerAd.onResize(function (res) {
                        if (_this.m_bannerAd.style.realHeight)
                            _this.m_bannerAd.style.top = screenHeight - _this.m_bannerAd.style.realHeight - bottomOff;
                    });
                    this.m_bannerAd.onLoad(function () {
                        if (_this.m_banderAdShowing)
                            _this.m_bannerAd.show();
                        else
                            _this.m_bannerAd.hide();
                    });
                    this.m_bannerAd.onError(function (err) {
                        console.log(err);
                    });
                }
                if (bShow) {
                    this.m_bannerAd.show();
                }
                else {
                    this.m_bannerAd.hide();
                }
            }
        }
        else if (dInterface.sdkName == "tt") {
            if (window.adid_banner) {
                if (!this.m_bannerAd) {
                    var _a = this.api.getSystemInfoSync(), windowWidth_1 = _a.windowWidth, windowHeight_1 = _a.windowHeight;
                    var targetBannerAdWidth = 200;
                    var bannerAd_1 = this.api.createBannerAd({
                        adUnitId: window.adid_banner,
                        style: {
                            width: targetBannerAdWidth,
                            top: windowHeight_1 - (targetBannerAdWidth / 16) * 9,
                        },
                    });
                    bannerAd_1.style.left = (windowWidth_1 - targetBannerAdWidth) / 2;
                    bannerAd_1.onResize(function (size) {
                        console.log(size.width, size.height);
                        bannerAd_1.style.top = windowHeight_1 - size.height;
                        bannerAd_1.style.left = (windowWidth_1 - size.width) / 2;
                    });
                    this.m_bannerAd = bannerAd_1;
                    this.m_bannerAd.onLoad(function () {
                        if (_this.m_banderAdShowing)
                            _this.m_bannerAd.show();
                        else
                            _this.m_bannerAd.hide();
                    });
                }
                if (this.m_bannerAd) {
                    if (bShow)
                        this.m_bannerAd.show();
                    else
                        this.m_bannerAd.hide();
                }
            }
        }
        else if (dInterface.sdkName == "uc" && window.adid_banner) {
            if (!this.m_bannerAd) {
                var screenWidth = 0;
                var screenHeight = 0;
                var systemInfo = this.api.getSystemInfoSync();
                if (typeof systemInfo === 'string') {
                    try {
                        systemInfo = JSON.parse(systemInfo);
                        screenWidth = dMath.ParseInt(systemInfo.screenWidth);
                        screenHeight = dMath.ParseInt(systemInfo.screenHeight);
                    }
                    catch (e) { }
                }
                var opts = {};
                opts.style = {};
                opts.style.width = screenWidth;
                opts.style.height = screenWidth * 150 / 600;
                opts.style.gravity = 7;
                this.m_bannerAd = this.api.createBannerAd(opts);
                this.m_bannerAd.onLoad(function () {
                    console.log('Banner');
                });
                this.m_bannerAd.onError(function (err) {
                    console.log('Banner err ' + err);
                });
            }
            if (bShow)
                this.m_bannerAd.show();
            else
                this.m_bannerAd.hide();
            return;
        }
    };
    dInterface.prototype.ShowAdBox = function (onShow) {
        var _this = this;
        console.log("ShowAdBox");
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis && window.androidJSApis.ShowAdBox) {
                window.androidJSApis.ShowAdBox();
            }
        }
        else if (dInterface.sdkName == "vivo") {
            if (this.api.createBoxPortalAd && window.adid_box) {
                this.m_boxPortalAd = this.api.createBoxPortalAd({ posId: window.adid_box });
                this.m_boxPortalAd.onError(function (err) { console.log("", err); });
                this.m_boxPortalAd.onClose(function () {
                    console.log('boxPortalAd close');
                    if (_this.m_boxPortalAd.isDestroyed) {
                        return;
                    }
                    _this.HideAdMoreGameIcon();
                });
                this.m_boxPortalAd.show().then(function () { console.log('show success'); });
                this.m_boxPortalAd.onShow(function () {
                    if (onShow)
                        onShow();
                });
            }
            else if (this.api.createBoxBannerAd && window.adid_boxbanner) {
                this.m_bannerAd = this.api.createBoxBannerAd({ posId: window.adid_boxbanner });
                this.m_bannerAd.onError(function (err) { console.log("", err); });
                this.m_bannerAd.show().then(function () {
                    console.log('show success');
                    if (onShow)
                        onShow();
                });
            }
            else {
                console.log(' API');
            }
        }
        else if (dInterface.sdkName == "oppo" && window.adid_box) {
            if (this.api.getSystemInfoSync().platformVersionCode >= 1076) {
                var gamePortalAd = this.api.createGamePortalAd({
                    adUnitId: window.adid_box
                });
                gamePortalAd.load().then(function () {
                    console.log('load success');
                    gamePortalAd.show();
                    if (onShow)
                        onShow();
                }).catch(function (error) {
                    console.log('load fail with:' + error.errCode + ',' + error.errMsg);
                    _this.api.showToast({
                        title: '',
                        message: '',
                        duration: 1500
                    });
                });
            }
            else {
                console.log('1076 API');
            }
        }
        else if (dInterface.sdkName == "qq" && window.adid_box) {
            if (!this.m_boxPortalAd) {
                this.m_boxPortalAd = this.api.createAppBox({ adUnitId: window.adid_box });
            }
            this.m_boxPortalAd.load().then(function () {
                _this.m_boxPortalAd.show();
                if (onShow)
                    onShow();
            });
        }
        else if (dInterface.sdkName == "wx" && window.adid_box) {
            var customAd = this.api.createCustomAd({
                adUnitId: window.adid_box,
                adIntervals: 30,
                style: {
                    left: 0,
                    top: 100,
                    fixed: 0
                }
            });
            customAd.onLoad(function () {
                console.log(' ');
                customAd.show().then(function () {
                    if (onShow)
                        onShow();
                });
            });
        }
        else if (dInterface.sdkName == "tt") {
            try {
                var nineGridGamePanel = this.api.createGridGamePanel({
                    gridCount: "nine"
                });
                nineGridGamePanel.show();
            }
            catch (error) {
                console.error("", error);
            }
        }
        else if (dInterface.sdkName == "mi" && window.adid_box) {
            qg.displayAd({
                type: 100,
                upid: window.adid_box,
                success: function (res) {
                    if (onShow)
                        onShow();
                },
                fail: function (res) {
                    console.log(res);
                    _this.api.showToast({
                        title: '',
                        message: '',
                        duration: 1500
                    });
                }
            });
        }
    };
    dInterface.prototype.hasMoreGame = function () {
        if (dInterface.sdkName == "web") {
            if (this.GetChannelName() == "windows" || this.GetChannelName() == "oppo")
                return true;
        }
        else if (dInterface.sdkName == "oppo" && window.adid_box) {
            if (this.api.getSystemInfoSync().platformVersionCode >= 1076)
                return true;
        }
        else if (dInterface.sdkName == "vivo" && window.adid_box) {
            return true;
        }
        else if ((dInterface.sdkName == "wx" || dInterface.sdkName == "qq" || dInterface.sdkName == "tt" || dInterface.sdkName == "mi") && window.adid_box) {
            return true;
        }
        else if (dInterface.sdkName == "tt") {
            if (this.api.createGridGamePanel)
                return true;
        }
        return false;
    };
    dInterface.prototype.GetMoreGameList = function () {
        if (window && window.moreGameList)
            return window.moreGameList;
        return null;
    };
    dInterface.prototype.ShowAdMoreGameIcon = function (icon, y, flag, onShowAd) {
        if (dInterface.sdkName == "vivo") {
            if (this.api.createBoxPortalAd && window.adid_box) {
                this.m_boxPortalAd = this.api.createBoxPortalAd({ posId: window.adid_box, image: icon, marginTop: y });
                this.m_boxPortalAd.onError(function (err) { console.log("", err); });
                this.m_boxPortalAd.onClose(function () {
                    console.log('boxPortalAd close');
                    if (this.m_boxPortalAd.isDestroyed) {
                        return;
                    }
                    this.m_boxPortalAd.show();
                });
                this.m_boxPortalAd.show().then(function () { console.log('show success'); });
                this.m_boxPortalAd.onShow(function () {
                    if (onShowAd)
                        onShowAd();
                });
            }
            else {
                console.log(' API');
            }
        }
    };
    dInterface.prototype.HideAdMoreGameIcon = function () {
        if (dInterface.sdkName == "vivo") {
            if (this.api.createBoxPortalAd && window.adid_box) {
                if (this.m_boxPortalAd != null) {
                    this.m_boxPortalAd.isDestroyed = true;
                    this.m_boxPortalAd.destroy();
                    this.m_boxPortalAd = null;
                }
            }
        }
    };
    dInterface.prototype.StartShareRecord = function () {
        var _this = this;
        if (dInterface.sdkName == "tt") {
            try {
                var recorder = this.api.getGameRecorderManager();
                recorder.onStart(function (res) {
                    console.log("");
                    _this.m_bRecording = true;
                });
                recorder.onStop(function (res) {
                    _this.m_bRecording = false;
                    console.log(res.videoPath);
                    _this.m_recordVideoPath = res.videoPath;
                    console.log("");
                });
                recorder.onError(function (res) {
                    console.log(res);
                });
                recorder.start({
                    duration: 120
                });
                return true;
            }
            catch (err) {
            }
        }
        return false;
    };
    dInterface.prototype.StopShareRecord = function (onComplete) {
        if (onComplete === void 0) { onComplete = null; }
        if (dInterface.sdkName == "tt") {
            try {
                this.api.getGameRecorderManager().stop();
                if (onComplete)
                    onComplete();
            }
            catch (err) {
                console.log(err);
            }
        }
    };
    dInterface.prototype.ShareRecord = function () {
        var _this = this;
        if (dInterface.sdkName == "tt") {
            console.log("Share " + this.m_recordVideoPath);
            this.api.shareVideo({
                videoPath: this.m_recordVideoPath,
                success: function () {
                    console.log("");
                },
                fail: function (e) {
                    console.log("" + e.errMsg);
                    var msg = e.errMsg;
                    if (msg && msg.indexOf("too short") != -1)
                        msg = "3";
                    else if (msg && msg.indexOf("fail cancel") != -1)
                        msg = "";
                    if (msg && msg.length > 0) {
                        _this.api.showModal({
                            title: '',
                            content: msg
                        });
                    }
                }
            });
        }
    };
    dInterface.prototype.isPrivacyAgree = function () {
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis) {
                if (window.androidJSApis.isPrivacyAgree())
                    return true;
                return false;
            }
            return true;
        }
        else if (dInterface.sdkName == "hw") {
            if (window && window.userLogined)
                return true;
            return false;
        }
        return true;
    };
    dInterface.prototype.ExitApp = function (isForce) {
        if (isForce === void 0) { isForce = false; }
        if (isForce)
            this.m_bHideRender = true;
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis && window.androidJSApis.ExitApp) {
                window.androidJSApis.ExitApp();
            }
        }
        else if (dInterface.sdkName == "oppo" || dInterface.sdkName == "vivo" || dInterface.sdkName == "hw") {
            this.api.exitApplication({});
        }
        else if (dInterface.sdkName == "wx" || dInterface.sdkName == "qq" || dInterface.sdkName == "tt" || dInterface.sdkName == "mi" || dInterface.sdkName == "ks") {
            this.api.exitMiniProgram({});
        }
        else if (dInterface.sdkName == "mg") {
            if (window.exitMiniProgram)
                window.exitMiniProgram();
        }
    };
    dInterface.prototype.isBlockLButtonDown = function () {
        if (dInterface.sdkName == "mg" && this.m_bRewardedVideoShowing)
            return true;
        return false;
    };
    dInterface.prototype.FrameMouseEvent = function (type, id, x, y, delta) {
        if (type == dSprite.MOUSE_LBUTTONDOWN) {
            if (this.m_arrCurMouseDownList.has(id))
                return;
            this.m_arrCurMouseDownList.set(id, 1);
        }
        else if (type == dSprite.MOUSE_LBUTTONUP) {
            this.m_arrCurMouseDownList.remove(id);
        }
        if (!this.m_onErrCallback)
            this._FrameMouseEvent(type, id, x, y, delta);
        else {
            try {
                this._FrameMouseEvent(type, id, x, y, delta);
            }
            catch (err) {
                if (this.m_onErrCallback)
                    this.m_onErrCallback(err);
            }
        }
    };
    dInterface.prototype._FrameMouseEvent = function (type, id, x, y, delta) {
        var e_10, _a;
        var pMainThread = this.m_pMainThread;
        switch (type) {
            case dSprite.MOUSE_MOVE:
            case dSprite.MOUSE_LBUTTONDOWN:
            case dSprite.MOUSE_LBUTTONUP:
            case dSprite.MOUSE_MBUTTONDOWN:
            case dSprite.MOUSE_MBUTTONUP:
            case dSprite.MOUSE_RBUTTONDOWN:
            case dSprite.MOUSE_RBUTTONUP:
            case dSprite.MOUSE_WHEEL:
                this.m_nGlobalMouseX = x;
                this.m_nGlobalMouseY = y;
                if (this.m_pMainThread != null && dThread.GetRootSprite() != null) {
                    var pRootSprite = dThread.GetRootSprite();
                    this.m_pMainThread.OnFrameTouchEvent(type, id, x - pRootSprite.positionX, y - pRootSprite.positionY, delta);
                    if ((type == dSprite.MOUSE_LBUTTONDOWN || type == dSprite.MOUSE_MBUTTONDOWN || type == dSprite.MOUSE_RBUTTONDOWN) && !this.isBlockLButtonDown()) {
                        if (!dSprite.s_pCurrentInputingBox) {
                            var pCol = pRootSprite.CollectionChild(x, y, true);
                            if (pCol != null) {
                                var eve = null;
                                try {
                                    for (var _b = __values(this.m_mapSpriteMouseEvent.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {
                                        var key = _c.value;
                                        if (this.m_mapSpriteMouseEvent.get(key).pSprite == pCol) {
                                            eve = this.m_mapSpriteMouseEvent.get(key);
                                            break;
                                        }
                                    }
                                }
                                catch (e_10_1) { e_10 = { error: e_10_1 }; }
                                finally {
                                    try {
                                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                                    }
                                    finally { if (e_10) throw e_10.error; }
                                }
                                var mat = pCol.GetMatrixWorld();
                                var x2 = x - mat._41;
                                var y2 = y - mat._42;
                                var scaleWorld = new dVector2(1, 1);
                                this._GetScale_World(pCol, scaleWorld);
                                x2 /= dMath.Abs(scaleWorld.x);
                                y2 /= dMath.Abs(scaleWorld.y);
                                if (eve == null) {
                                    this.m_mapSpriteMouseEvent.set(id, new SpriteMouseEvent(pCol, x2, y2, type, false));
                                    if (type == dSprite.MOUSE_LBUTTONDOWN)
                                        pCol.OnTouchDown(x2, y2, delta);
                                    else if (type == dSprite.MOUSE_MBUTTONDOWN)
                                        pCol.OnMButtonTouchDown(x2, y2, delta);
                                    else if (type == dSprite.MOUSE_RBUTTONDOWN)
                                        pCol.OnRButtonTouchDown(x2, y2, delta);
                                }
                                else {
                                    this.m_mapSpriteMouseEvent.set(id, new SpriteMouseEvent(pCol, x2, y2, type, true));
                                    if (type == dSprite.MOUSE_LBUTTONDOWN)
                                        pCol.OnMultyTouchDown(id, x2, y2, delta);
                                }
                            }
                        }
                    }
                    else if (type == dSprite.MOUSE_MOVE) {
                        var pCol2 = this.m_mapSpriteMouseEvent.get(id);
                        if (pCol2) {
                            var mat = pCol2.pSprite.GetMatrixWorld();
                            var x2 = x - mat._41;
                            var y2 = y - mat._42;
                            var scaleWorld = new dVector2(1, 1);
                            this._GetScale_World(pCol2.pSprite, scaleWorld);
                            x2 /= dMath.Abs(scaleWorld.x);
                            y2 /= dMath.Abs(scaleWorld.y);
                            if (pCol2.pSprite.isHandleMouse() && (x2 != pCol2.x || y2 != pCol2.y)) {
                                var offx = x2 - pCol2.x;
                                var offy = y2 - pCol2.y;
                                if (pCol2.type == dSprite.MOUSE_LBUTTONDOWN) {
                                    if (pCol2.bMulty)
                                        pCol2.pSprite.OnMultyTouchMove(id, x2, y2, offx, offy, delta);
                                    else
                                        pCol2.pSprite.OnTouchMove(x2, y2, offx, offy, delta);
                                }
                                else if (pCol2.type == dSprite.MOUSE_MBUTTONDOWN)
                                    pCol2.pSprite.OnMButtonTouchMove(x2, y2, offx, offy, delta);
                                else if (pCol2.type == dSprite.MOUSE_RBUTTONDOWN)
                                    pCol2.pSprite.OnRButtonTouchMove(x2, y2, offx, offy, delta);
                            }
                            mat = pCol2.pSprite.GetMatrixWorld();
                            x2 = x - mat._41;
                            y2 = y - mat._42;
                            scaleWorld = new dVector2(1, 1);
                            this._GetScale_World(pCol2.pSprite, scaleWorld);
                            x2 /= dMath.Abs(scaleWorld.x);
                            y2 /= dMath.Abs(scaleWorld.y);
                            pCol2.x = x2;
                            pCol2.y = y2;
                        }
                    }
                    else if (type == dSprite.MOUSE_LBUTTONUP || type == dSprite.MOUSE_MBUTTONUP || type == dSprite.MOUSE_RBUTTONUP) {
                        var pCol2 = this.m_mapSpriteMouseEvent.get(id);
                        if (pCol2) {
                            this.m_mapSpriteMouseEvent.remove(id);
                            if (pCol2.pSprite.isHandleMouse()) {
                                var x2 = x - pCol2.pSprite.GetPosX_World();
                                var y2 = y - pCol2.pSprite.GetPosY_World();
                                var scaleWorld = new dVector2(1, 1);
                                this._GetScale_World(pCol2.pSprite, scaleWorld);
                                x2 /= dMath.Abs(scaleWorld.x);
                                y2 /= dMath.Abs(scaleWorld.y);
                                if (pCol2.type == dSprite.MOUSE_LBUTTONDOWN) {
                                    if (pCol2.bMulty)
                                        pCol2.pSprite.OnMultyTouchUp(id, x2, y2);
                                    else
                                        pCol2.pSprite.OnTouchUp(x2, y2);
                                }
                                else if (pCol2.type == dSprite.MOUSE_MBUTTONDOWN)
                                    pCol2.pSprite.OnMButtonTouchUp(x2, y2);
                                else if (pCol2.type == dSprite.MOUSE_RBUTTONDOWN)
                                    pCol2.pSprite.OnRButtonTouchUp(x2, y2);
                            }
                        }
                    }
                    else if (type == dSprite.MOUSE_WHEEL) {
                        var pCol = pRootSprite.CollectionChild(x, y, true);
                        if (pCol != null) {
                            if (pCol.isHandleMouse()) {
                                var x2 = x - pCol.GetPosX_World();
                                var y2 = y - pCol.GetPosY_World();
                                var scaleWorld = new dVector2(1, 1);
                                this._GetScale_World(pCol, scaleWorld);
                                x2 /= dMath.Abs(scaleWorld.x);
                                y2 /= dMath.Abs(scaleWorld.y);
                                x2 += pCol.anchorU * pCol.width;
                                y2 += pCol.anchorV * pCol.height;
                                pCol.OnMouseWheel(x2, y2, delta);
                            }
                        }
                    }
                }
                break;
            case dSprite.KEY_DOWN:
            case dSprite.KEY_UP:
                break;
            default:
                throw "MainEvent type error";
        }
    };
    dInterface.prototype._GetScale_World = function (p, outData) {
        outData.x *= p.scaleX;
        outData.y *= p.scaleY;
        if (p.GetParent() != null)
            this._GetScale_World(p.GetParent(), outData);
    };
    dInterface.prototype.GetSdkName = function () {
        if (!dInterface.sdkName)
            return "";
        return dInterface.sdkName;
    };
    dInterface.prototype.GetChannelName = function () {
        if (window && window.channelName)
            return window.channelName;
        if (dInterface.sdkName == "web") {
            if (window && window.androidJSApis) {
                return window.androidJSApis.GetChannelName();
            }
            return "windows";
        }
        return "";
    };
    dInterface.prototype.InitUserDeviceId = function (callback) {
        var _this = this;
        this.ReadStorage("__userdeviceid__", function (res) {
            if (res)
                _this.m_userdeviceId = res;
            else {
                var s = [];
                var hexDigits = "0123456789abcdef";
                for (var i = 0; i < 36; i++) {
                    s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
                }
                s[14] = "4";
                s[19] = hexDigits.substr((dMath.ParseInt(s[19]) & 0x3) | 0x8, 1);
                s[8] = s[13] = s[18] = s[23] = "-";
                _this.m_userdeviceId = s.join("").replace("-", "");
                _this.WriteStorage("__userdeviceid__", _this.m_userdeviceId);
            }
            if (callback)
                callback(_this.m_userdeviceId);
        }, null);
    };
    dInterface.prototype.GetUserDeviceId = function () {
        return this.m_userdeviceId;
    };
    dInterface.s_ptr = null;
    dInterface.sdkName = "";
    dInterface.s_onFrameEnd = new Array();
    dInterface.s_renderCount = 0;
    return dInterface;
}());
Array.prototype.remove = function (val) {
    var index = this.indexOf(val);
    if (index > -1) {
        this.splice(index, 1);
    }
};
Array.prototype.erase = function (at) {
    return this.splice(at, 1)[0];
};
Array.prototype.clear = function () {
    this.length = 0;
};
Array.prototype.insert = function (at, p) {
    this.splice(at, 0, p);
};
Array.prototype.copy = function (src) {
    this.clear();
    for (var i = 0; i < src.length; i++)
        this.push(src[i]);
};
Array.prototype.last = function () {
    return this[this.length - 1];
};
Array.prototype.resize = function (count) {
    this.length = count;
    for (var i = 0; i < count; i++)
        if (!this[i])
            this[i] = null;
};
Array.prototype.pushVector = function (arr) {
    for (var i = 0; i < arr.length; i++)
        this.push(arr[i]);
    return this;
};
Array.prototype.randomSort = function () {
    for (var i = 0; i < this.length; i++) {
        this.swap(dMath.RandomI() % this.length, dMath.RandomI() % this.length);
    }
};
Array.prototype.swap = function (at1, at2) {
    if (at1 == at2 || at1 < 0 || at2 < 0 || at1 >= this.length || at2 >= this.length)
        return;
    var tmp = this[at1];
    this[at1] = this[at2];
    this[at2] = tmp;
};
Map.prototype.remove = function (key) {
    this.delete(key);
};
var SpriteMouseEvent = (function () {
    function SpriteMouseEvent(pSprite, x, y, type, bMulty) {
        if (pSprite === void 0) { pSprite = null; }
        if (x === void 0) { x = 0; }
        if (y === void 0) { y = 0; }
        if (type === void 0) { type = 0; }
        if (bMulty === void 0) { bMulty = false; }
        this.pSprite = pSprite;
        this.x = x;
        this.y = y;
        this.type = type;
        this.bMulty = bMulty;
    }
    return SpriteMouseEvent;
}());
var dMath = (function (_super) {
    __extends(dMath, _super);
    function dMath() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    dMath.Random = function () {
        return Math.random();
    };
    dMath.RandomI = function () {
        return dMath.ToInt(dMath.Random() * 32767.0);
    };
    dMath.RandomRange = function (min, max) {
        return dMath.Random() * (max - min) + min;
    };
    dMath.RandomRangeI = function (min, max) {
        min = dMath.ToInt(min);
        max = dMath.ToInt(max);
        if (max <= min)
            return min;
        return (dMath.RandomI() % (max - min)) + min;
    };
    dMath.RandomM = function () {
        return dMath.Random() * 2.0 - 1.0;
    };
    dMath.RandomWeight = function (vecWeight) {
        if (vecWeight.length == 0)
            return -1;
        var total = 0;
        for (var i = 0; i < vecWeight.length; i++)
            total += vecWeight[i];
        var r = dMath.Random() * total;
        for (var i = 0; i < vecWeight.length; i++) {
            if (vecWeight[i] != 0 && r < vecWeight[i])
                return i;
            r -= vecWeight[i];
        }
        return 0;
    };
    dMath.RandomToWeight = function (count, min, max) {
        var ret = new Array(count);
        for (var i = 0; i < count; i++) {
            ret[i] = min;
            max -= min;
        }
        while (max > 2000) {
            ret[dMath.RandomI() % count] += 1000;
            max -= 1000;
        }
        while (max > 200) {
            ret[dMath.RandomI() % count] += 100;
            max -= 100;
        }
        while (max > 20) {
            ret[dMath.RandomI() % count] += 10;
            max -= 10;
        }
        while (max > 0) {
            ret[dMath.RandomI() % count]++;
            max--;
        }
        return ret;
    };
    dMath.FloatEquals = function (a, b, fIgnore) {
        if (fIgnore === void 0) { fIgnore = 0.0001; }
        return dMath.Abs(a - b) < fIgnore;
    };
    dMath.Log = function (x) {
        return Math.log(x);
    };
    dMath.Sin = function (r) {
        return Math.sin(r);
    };
    dMath.Cos = function (r) {
        return Math.cos(r);
    };
    dMath.Tan = function (r) {
        return Math.tan(r);
    };
    dMath.Asin = function (r) {
        return Math.asin(r);
    };
    dMath.Acos = function (r) {
        return Math.acos(r);
    };
    dMath.Atan = function (r) {
        return Math.atan(r);
    };
    dMath.Atan2 = function (y, x) {
        return Math.atan2(y, x);
    };
    dMath.Sqrt = function (r) {
        return Math.sqrt(r);
    };
    dMath.Pow = function (r, x) {
        if (x == 1)
            return r;
        if (x == 2)
            return r * r;
        if (x == 3)
            return r * r * r;
        return Math.pow(r, x);
    };
    dMath.Abs = function (a) {
        if (a < 0)
            return -a;
        return a;
    };
    dMath.Signum = function (a) {
        if (a < 0)
            return -1;
        if (a > 0)
            return 1;
        return 0;
    };
    dMath.EqualsZero = function (f, ignore) {
        if (ignore === void 0) { ignore = 0.00001; }
        return dMath.Abs(f) < ignore;
    };
    dMath.Exp = function (x) {
        return Math.exp(x);
    };
    dMath.ToInt = function (f) {
        return Math.trunc(f);
    };
    dMath.ParseInt = function (str, radix) {
        if (radix === void 0) { radix = 10; }
        var ret = parseInt(str, radix);
        if (Number.isNaN(ret))
            ret = 0;
        return ret;
    };
    dMath.ParseFloat = function (str) {
        var ret = parseFloat(str);
        if (Number.isNaN(ret))
            ret = 0;
        return ret;
    };
    dMath.Floor = function (f) {
        return Math.floor(f);
    };
    dMath.Ceil = function (f) {
        return Math.ceil(f);
    };
    dMath.Round = function (r) {
        return Math.round(r);
    };
    dMath.Max = function (a, b) {
        return a > b ? a : b;
    };
    dMath.Max3 = function (a, b, c) {
        a = dMath.Max(a, b);
        return dMath.Max(a, c);
    };
    dMath.Min = function (a, b) {
        return a < b ? a : b;
    };
    dMath.Min3 = function (a, b, c) {
        a = dMath.Min(a, b);
        return dMath.Min(a, c);
    };
    dMath.MaxArray = function (vec) {
        var ret;
        for (var i = 0; i < vec.length; i++)
            if (i == 0 || ret < vec[i])
                ret = vec[i];
        return ret;
    };
    dMath.MinArray = function (vec) {
        var ret;
        for (var i = 0; i < vec.length; i++)
            if (i == 0 || ret > vec[i])
                ret = vec[i];
        return ret;
    };
    dMath.MaxArrayIndex = function (vec) {
        var ret = 0;
        for (var i = 0; i < vec.length; i++)
            if (i == 0 || vec[ret] < vec[i])
                ret = i;
        return ret;
    };
    dMath.MinArrayIndex = function (vec) {
        var ret = 0;
        for (var i = 0; i < vec.length; i++)
            if (i == 0 || vec[ret] > vec[i])
                ret = i;
        return ret;
    };
    dMath.Clamp = function (value, min, max) {
        if (value < min)
            return min;
        if (value > max)
            return max;
        return value;
    };
    dMath.Distance = function (sx, sy, ex, ey) {
        var d = dMath.Sqrt((ex - sx) * (ex - sx) + (ey - sy) * (ey - sy));
        return d;
    };
    dMath.Mod = function (v, mod) {
        if (mod == 0)
            return v;
        var mod2 = dMath.Abs(mod);
        var r = v % mod2;
        if (r < 0)
            r = r + mod2;
        if (mod < 0)
            return -r;
        return r;
    };
    dMath.LerpAngle = function (from, to, frac, bLimitTo360) {
        if (bLimitTo360 === void 0) { bLimitTo360 = false; }
        var from2 = dMath.AngleToRadian(from);
        var to2 = dMath.AngleToRadian(to);
        var ret = dMath.RadianToAngle(dMath.LerpRadian(from2, to2, frac, bLimitTo360));
        return ret;
    };
    dMath.LerpRadian = function (from, to, frac, bLimitAngle) {
        if (bLimitAngle === void 0) { bLimitAngle = false; }
        if (bLimitAngle) {
            while (from < 0 || to < 0) {
                from += dMath.dPI * 2;
                to += dMath.dPI * 2;
            }
        }
        var a;
        if (to - from > dMath.dPI) {
            to -= dMath.dPI * 2;
        }
        if (to - from < -dMath.dPI) {
            to += dMath.dPI * 2;
        }
        a = from + frac * (to - from);
        if (bLimitAngle)
            a %= (dMath.dPI * 2);
        return a;
    };
    dMath.Lerp = function (a1, a2, lerp) {
        return a1 * (1.0 - lerp) + a2 * lerp;
    };
    dMath.LerpArray = function (data, lerp) {
        if (data.length == 0)
            return 0;
        if (data.length == 1)
            return data[0];
        var index = lerp * (data.length - 1);
        if (index == data.length - 1)
            return data[data.length - 1];
        return dMath.Lerp(data[index], data[index + 1], lerp * (data.length - 1) - index);
    };
    dMath.LerpColor = function (a1, a2, lerp) {
        var c1 = dMath.ColorToValue(a1);
        var c2 = dMath.ColorToValue(a2);
        var r = dMath.Lerp(c1.x, c2.x, lerp);
        var g = dMath.Lerp(c1.y, c2.y, lerp);
        var b = dMath.Lerp(c1.z, c2.z, lerp);
        var a = dMath.Lerp(c1.w, c2.w, lerp);
        return dMath.ColorFromValue(a, r, g, b);
    };
    dMath.ColorFromVector4 = function (v) {
        return dMath.ColorFromValue(v.w, v.x, v.y, v.z);
    };
    dMath.ColorFromValue = function (a, r, g, b) {
        return ((dMath.ToInt(a * 255)) << 24) | ((dMath.ToInt(r * 255)) << 16) | ((dMath.ToInt(g * 255)) << 8) | (dMath.ToInt(b * 255));
    };
    dMath.ColorMulty = function (a, b) {
        var c1 = dMath.ColorToValue(a);
        var c2 = dMath.ColorToValue(b);
        c1.MulAppend(c2);
        return dMath.ColorFromVector4(c1);
    };
    dMath.ColorToValue = function (color) {
        var v = new dVector4();
        v.w = ((color & 0xFF000000) >>> 24) / 255.0;
        v.x = ((color & 0x00FF0000) >> 16) / 255.0;
        v.y = ((color & 0x0000FF00) >> 8) / 255.0;
        v.z = ((color & 0x000000FF)) / 255.0;
        return v;
    };
    dMath.ColorToValue3 = function (color) {
        var v = new dVector3();
        v.x = ((color & 0x00FF0000) >> 16) / 255.0;
        v.y = ((color & 0x0000FF00) >> 8) / 255.0;
        v.z = ((color & 0x000000FF)) / 255.0;
        return v;
    };
    dMath.ColorBlend = function (dest, src) {
        if (dest == 0)
            return src;
        var a1 = (dest & 0xFF000000) >>> 24;
        var a2 = (src & 0xFF000000) >>> 24;
        if (a1 == 255 && a2 == 255)
            return src;
        else {
            var r1 = (dest & 0x00FF0000) >>> 16;
            var g1 = (dest & 0x0000FF00) >>> 8;
            var b1 = (dest & 0x000000FF);
            var r2 = (src & 0x00FF0000) >>> 16;
            var g2 = (src & 0x0000FF00) >>> 8;
            var b2 = (src & 0x000000FF);
            var a3 = a1 + a2;
            if (a3 > 255)
                a3 = 255;
            var r3 = (r1 * (255 - a2) + r2 * a2) / 255;
            var g3 = (g1 * (255 - a2) + g2 * a2) / 255;
            var b3 = (b1 * (255 - a2) + b2 * a2) / 255;
            return a3 << 24 | r3 << 16 | g3 << 8 | b3;
        }
        return 0;
    };
    dMath.AngleToRadian = function (x) {
        return (x / 360.0 * dMath.dPI * 2);
    };
    dMath.RadianToAngle = function (x) {
        return (x * 360.0 / (dMath.dPI * 2));
    };
    dMath.SubAngle = function (a1, a2) {
        a1 %= 360;
        a2 %= 360;
        if (a1 < 0)
            a1 = 360 + (a1 % 360);
        if (a2 < 0)
            a2 = 360 + (a2 % 360);
        var d1, d2;
        d1 = a1 - a2;
        d2 = 360 - dMath.Abs(d1);
        if (d1 > 0)
            d2 *= -1.0;
        if (dMath.Abs(d1) < dMath.Abs(d2))
            return (d1);
        else
            return (d2);
    };
    dMath.isCircleIntersectLineSeg = function (x, y, r, x1, y1, x2, y2) {
        var vx1 = x - x1;
        var vy1 = y - y1;
        var vx2 = x2 - x1;
        var vy2 = y2 - y1;
        if (dMath.Abs(vx2) < 0.00001 && dMath.Abs(vy2) < 0.00001)
            return false;
        var len = dMath.Sqrt(vx2 * vx2 + vy2 * vy2);
        vx2 /= len;
        vy2 /= len;
        var u = vx1 * vx2 + vy1 * vy2;
        var x0 = 0.0;
        var y0 = 0.0;
        if (u <= 0) {
            x0 = x1;
            y0 = y1;
        }
        else if (u >= len) {
            x0 = x2;
            y0 = y2;
        }
        else {
            x0 = x1 + vx2 * u;
            y0 = y1 + vy2 * u;
        }
        return (x - x0) * (x - x0) + (y - y0) * (y - y0) <= r * r;
    };
    dMath.PointInTriangle2D = function (A, B, C, P) {
        return dMath.PointInTriangle(A.ToVector3(), B.ToVector3(), C.ToVector3(), P.ToVector3());
    };
    dMath.PointInTriangle = function (A, B, C, P) {
        if (A.EqualsIgnore(B) || A.EqualsIgnore(C) || B.EqualsIgnore(C))
            return false;
        var v0 = dMath.v0;
        var v1 = dMath.v1;
        var v2 = dMath.v2;
        dVector3.Vec3Sub(v0, C, A);
        dVector3.Vec3Sub(v1, B, A);
        dVector3.Vec3Sub(v2, P, A);
        var dot00 = dVector3.Vec3Dot(v0, v0);
        var dot01 = dVector3.Vec3Dot(v0, v1);
        var dot02 = dVector3.Vec3Dot(v0, v2);
        var dot11 = dVector3.Vec3Dot(v1, v1);
        var dot12 = dVector3.Vec3Dot(v1, v2);
        var inverDeno = 1 / (dot00 * dot11 - dot01 * dot01);
        var u = (dot11 * dot02 - dot01 * dot12) * inverDeno;
        if (u < 0 || u > 1) {
            return false;
        }
        var v = (dot00 * dot12 - dot01 * dot02) * inverDeno;
        if (v < 0 || v > 1) {
            return false;
        }
        return u + v <= 1;
    };
    dMath.isPower2N = function (x) {
        return (x & (x - 1)) == 0;
    };
    dMath.CircleCircleIntersection2D = function (x1, y1, radio1, x2, y2, radio2) {
        return (x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2) < (radio1 + radio2) * (radio1 + radio2);
    };
    dMath.CirclePointCollection2D = function (px, py, x, y, radio) {
        var length = dMath.Sqrt((px - x) * (px - x) + (py - y) * (py - y));
        return length < radio;
    };
    dMath.SpriteSpriteCollection = function (p1, p2, root) {
        if (p1.rotation == 0 && p2.rotation == 0) {
            var parentSame = p1.GetParent() == p2.GetParent();
            var rc1 = new dRect().SetPosSize(parentSame ? p1.positionX : p1.GetPosX_World(root, false) - p1.width * p1.scaleX * p1.anchorU, parentSame ? p1.positionY : p1.GetPosY_World(root, false) - p1.height * p1.scaleY * p1.anchorV, p1.width * p1.scaleX, p1.height * p1.scaleY);
            var rc2 = new dRect().SetPosSize(parentSame ? p2.positionX : p2.GetPosX_World(root, false) - p2.width * p2.scaleX * p2.anchorU, parentSame ? p2.positionY : p2.GetPosY_World(root, false) - p2.height * p2.scaleY * p2.anchorV, p2.width * p2.scaleX, p2.height * p2.scaleY);
            return rc1.Collect(rc2);
        }
        var rc1 = new dRect().SetPosSize(-p1.width * p1.anchorU, -p1.height * p1.anchorV, p1.width, p1.height);
        var rc2 = new dRect().SetPosSize(-p2.width * p2.anchorU, -p2.height * p2.anchorV, p2.width, p2.height);
        var a1 = new dVector2(rc1.left, rc1.top);
        var a2 = new dVector2(rc1.right, rc1.bottom);
        var a3 = new dVector2(rc1.left, rc1.bottom);
        var a4 = new dVector2(rc1.right, rc1.top);
        var b1 = new dVector2(rc2.left, rc2.top);
        var b2 = new dVector2(rc2.right, rc2.bottom);
        var b3 = new dVector2(rc2.left, rc2.bottom);
        var b4 = new dVector2(rc2.right, rc2.top);
        var m1 = p1.GetMatrixWorld(root, false);
        var m2 = p2.GetMatrixWorld(root, false);
        a1.Transform(m1);
        a2.Transform(m1);
        a3.Transform(m1);
        a4.Transform(m1);
        b1.Transform(m2);
        b2.Transform(m2);
        b3.Transform(m2);
        b4.Transform(m2);
        if (dMath.TriTriCollection2D(a1, a2, a3, b1, b2, b3) ||
            dMath.TriTriCollection2D(a1, a2, a3, b2, b1, b4) ||
            dMath.TriTriCollection2D(a2, a1, a4, b1, b2, b3) ||
            dMath.TriTriCollection2D(a2, a1, a4, b2, b1, b4))
            return true;
        return false;
    };
    dMath.TriTriCollection2D = function (a1, a2, a3, b1, b2, b3) {
        if (dMath.PointInTriangle2D(a1, a2, a3, b1) ||
            dMath.PointInTriangle2D(a1, a2, a3, b2) ||
            dMath.PointInTriangle2D(a1, a2, a3, b3) ||
            dMath.PointInTriangle2D(b1, b2, b3, a1) ||
            dMath.PointInTriangle2D(b1, b2, b3, a2) ||
            dMath.PointInTriangle2D(b1, b2, b3, a3))
            return true;
        if (dMath.LineLineIntersection2D(a1.x, a1.y, a2.x, a2.y, b1.x, b1.y, b2.x, b2.y) ||
            dMath.LineLineIntersection2D(a1.x, a1.y, a2.x, a2.y, b2.x, b2.y, b3.x, b3.y) ||
            dMath.LineLineIntersection2D(a1.x, a1.y, a2.x, a2.y, b3.x, b3.y, b1.x, b1.y) ||
            dMath.LineLineIntersection2D(a2.x, a2.y, a3.x, a3.y, b1.x, b1.y, b2.x, b2.y) ||
            dMath.LineLineIntersection2D(a2.x, a2.y, a3.x, a3.y, b2.x, b2.y, b3.x, b3.y) ||
            dMath.LineLineIntersection2D(a2.x, a2.y, a3.x, a3.y, b3.x, b3.y, b1.x, b1.y) ||
            dMath.LineLineIntersection2D(a3.x, a3.y, a1.x, a1.y, b1.x, b1.y, b2.x, b2.y) ||
            dMath.LineLineIntersection2D(a3.x, a3.y, a1.x, a1.y, b2.x, b2.y, b3.x, b3.y) ||
            dMath.LineLineIntersection2D(a3.x, a3.y, a1.x, a1.y, b3.x, b3.y, b1.x, b1.y))
            return true;
        return false;
    };
    dMath.TriangleCircleCollect2D = function (p1, p2, p3, c, radio) {
        return dMath.LineCircleCollect2D(p1, p2, c, radio) ||
            dMath.LineCircleCollect2D(p2, p3, c, radio) ||
            dMath.LineCircleCollect2D(p3, p1, c, radio);
    };
    dMath.LineCircleCollect2D = function (p1, p2, c, radio) {
        var flag1 = (p1.x - c.x) * (p1.x - c.x) + (p1.y - c.y) * (p1.y - c.y) <= radio * radio;
        var flag2 = (p2.x - c.x) * (p2.x - c.x) + (p2.y - c.y) * (p2.y - c.y) <= radio * radio;
        if (flag1 || flag2)
            return true;
        return dMath.LineCircleIntersect2D(c.x, c.y, radio, p1.x, p1.y, p2.x, p2.y);
    };
    dMath.DistanceBetweenTwoPoints = function (x1, y1, x2, y2) {
        return dMath.Sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));
    };
    dMath.DistanceFromPointToLine = function (x, y, x1, y1, x2, y2) {
        var a = y2 - y1;
        var b = x1 - x2;
        var c = x2 * y1 - x1 * y2;
        return dMath.Abs(a * x + b * y + c) / dMath.Sqrt(a * a + b * b);
    };
    dMath.CircleRectangleIntersection = function (rx, ry, radio, left, top, right, bottom) {
        return dMath._CircleRectangleIntersection(rx, ry, radio, (right - left) * 0.5 + left, (bottom - top) * 0.5 + top, (right - left) * 0.5 + left, top, right, (bottom - top) * 0.5 + top);
    };
    dMath._CircleRectangleIntersection = function (x, y, r, x0, y0, x1, y1, x2, y2) {
        var w1 = dMath.DistanceBetweenTwoPoints(x0, y0, x2, y2);
        var h1 = dMath.DistanceBetweenTwoPoints(x0, y0, x1, y1);
        var w2 = dMath.DistanceFromPointToLine(x, y, x0, y0, x1, y1);
        var h2 = dMath.DistanceFromPointToLine(x, y, x0, y0, x2, y2);
        if (w2 > w1 + r)
            return false;
        if (h2 > h1 + r)
            return false;
        if (w2 <= w1)
            return true;
        if (h2 <= h1)
            return true;
        return (w2 - w1) * (w2 - w1) + (h2 - h1) * (h2 - h1) <= r * r;
    };
    dMath.TriangleAABBIntersection2D = function (left, top, right, bottom, x0, y0, x1, y1, x2, y2) {
        return dMath.LineAABBIntersect2D(left, top, right, bottom, x0, y0, x1, y1)
            || dMath.LineAABBIntersect2D(left, top, right, bottom, x1, y1, x2, y2)
            || dMath.LineAABBIntersect2D(left, top, right, bottom, x2, y2, x0, y0);
    };
    dMath.RectangleAABBIntersection2D = function (left, top, right, bottom, x0, y0, x1, y1, x2, y2, x3, y3) {
        return dMath.LineAABBIntersect2D(left, top, right, bottom, x0, y0, x1, y1)
            || dMath.LineAABBIntersect2D(left, top, right, bottom, x1, y1, x2, y2)
            || dMath.LineAABBIntersect2D(left, top, right, bottom, x2, y2, x3, y3)
            || dMath.LineAABBIntersect2D(left, top, right, bottom, x3, y3, x0, y0);
    };
    dMath.LineAABBIntersect2D = function (left, top, right, bottom, linePointX1, linePointY1, linePointX2, linePointY2) {
        var lineHeight = linePointY1 - linePointY2;
        var lineWidth = linePointX2 - linePointX1;
        var c = linePointX1 * linePointY2 - linePointX2 * linePointY1;
        if ((lineHeight * left + lineWidth * top + c >= 0 && lineHeight * right + lineWidth * bottom + c <= 0)
            || (lineHeight * left + lineWidth * top + c <= 0 && lineHeight * right + lineWidth * bottom + c >= 0)
            || (lineHeight * left + lineWidth * bottom + c >= 0 && lineHeight * right + lineWidth * top + c <= 0)
            || (lineHeight * left + lineWidth * bottom + c <= 0 && lineHeight * right + lineWidth * top + c >= 0)) {
            if (left > right) {
                var temp = left;
                left = right;
                right = temp;
            }
            if (top < bottom) {
                var temp1 = top;
                top = bottom;
                bottom = temp1;
            }
            if ((linePointX1 < left && linePointX2 < left)
                || (linePointX1 > right && linePointX2 > right)
                || (linePointY1 > top && linePointY2 > top)
                || (linePointY1 < bottom && linePointY2 < bottom)) {
                return false;
            }
            else {
                return true;
            }
        }
        else {
            return false;
        }
    };
    dMath.LineCircleIntersect2D = function (x, y, r, x1, y1, x2, y2) {
        var vx1 = x - x1;
        var vy1 = y - y1;
        var vx2 = x2 - x1;
        var vy2 = y2 - y1;
        var len = dMath.Sqrt(vx2 * vx2 + vy2 * vy2);
        vx2 /= len;
        vy2 /= len;
        var u = vx1 * vx2 + vy1 * vy2;
        var x0 = 0.0;
        var y0 = 0.0;
        if (u <= 0) {
            x0 = x1;
            y0 = y1;
        }
        else if (u >= len) {
            x0 = x2;
            y0 = y2;
        }
        else {
            x0 = x1 + vx2 * u;
            y0 = y1 + vy2 * u;
        }
        return (x - x0) * (x - x0) + (y - y0) * (y - y0) <= r * r;
    };
    dMath.LineLineIntersection2D = function (l1x1, l1y1, l1x2, l1y2, l2x1, l2y1, l2x2, l2y2) {
        if ((l1x1 > l1x2 ? l1x1 : l1x2) < (l2x1 < l2x2 ? l2x1 : l2x2) ||
            (l1y1 > l1y2 ? l1y1 : l1y2) < (l2y1 < l2y2 ? l2y1 : l2y2) ||
            (l2x1 > l2x2 ? l2x1 : l2x2) < (l1x1 < l1x2 ? l1x1 : l1x2) ||
            (l2y1 > l2y2 ? l2y1 : l2y2) < (l1y1 < l1y2 ? l1y1 : l1y2)) {
            return false;
        }
        if ((((l1x1 - l2x1) * (l2y2 - l2y1) - (l1y1 - l2y1) * (l2x2 - l2x1)) *
            ((l1x2 - l2x1) * (l2y2 - l2y1) - (l1y2 - l2y1) * (l2x2 - l2x1))) > 0 ||
            (((l2x1 - l1x1) * (l1y2 - l1y1) - (l2y1 - l1y1) * (l1x2 - l1x1)) *
                ((l2x2 - l1x1) * (l1y2 - l1y1) - (l2y2 - l1y1) * (l1x2 - l1x1))) > 0) {
            return false;
        }
        return true;
    };
    dMath.PointLineDistance2D = function (lineStartX, lineStartY, lineEndX, lineEndY, pointX, pointY) {
        if (lineStartX == lineEndX && lineStartY == lineEndY) {
            return new dVector2(lineStartX, lineStartY).LengthTo(new dVector2(pointX, pointY));
        }
        var a = new dVector2(lineStartX, lineStartY);
        var b = new dVector2(lineEndX, lineEndY);
        var c = new dVector2(pointX, pointY);
        var ab = b.Sub(a);
        var ac = c.Sub(a);
        var f = ab.Dot(ac);
        if (f < 0)
            return a.LengthTo(c);
        var ab2 = a.Sub(b);
        var ac2 = c.Sub(b);
        f = ab2.Dot(ac2);
        if (f < 0)
            return b.LengthTo(c);
        if (lineStartX == lineEndX)
            return dMath.Abs(lineStartX - pointX);
        else if (lineStartY == lineEndY)
            return dMath.Abs(lineStartY - pointY);
        else {
            var k = (lineEndY - lineStartY) / (lineEndX - lineStartX);
            var ka = -1 / k;
            var intersectX = (lineStartY - k * lineStartX - pointY + ka * pointX) / (ka - k);
            var intersectY = k * intersectX + lineStartY - k * lineStartX;
            return dMath.Sqrt(dMath.Pow(pointX - intersectX, 2) + dMath.Pow(pointY - intersectY, 2));
        }
    };
    dMath.PointVectorDistance = function (point, v) {
        var dot = v.Dot(point);
        var distance = new dVector3();
        distance.x = point.x - dot * v.x;
        distance.y = point.y - dot * v.y;
        distance.z = point.z - dot * v.z;
        return distance.Length();
    };
    dMath.RayTriangleIntersection = function (orig, dir, v0, v1, v2, tuvOut) {
        if (tuvOut === void 0) { tuvOut = null; }
        dVector3.Vec3Sub(dMath.v0, v1, v0);
        var E1 = dMath.v0;
        dVector3.Vec3Sub(dMath.v1, v2, v0);
        var E2 = dMath.v1;
        dVector3.Vec3Cross(dMath.v2, dir, E2);
        var P = dMath.v2;
        var det = E1.Dot(P);
        var T = dMath.AB;
        if (det > 0) {
            dVector3.Vec3Sub(T, orig, v0);
        }
        else {
            dVector3.Vec3Sub(T, v0, orig);
            det = -det;
        }
        if (det < 0.0001)
            return false;
        var u = T.Dot(P);
        if (u < 0.0 || u > det)
            return false;
        var Q = dMath.AC;
        dVector3.Vec3Cross(Q, T, E1);
        var v = dir.Dot(Q);
        if (v < 0.0 || u + v > det)
            return false;
        var t = E2.Dot(Q);
        var fInvDet = 1.0 / det;
        if (tuvOut != null) {
            t *= fInvDet;
            u *= fInvDet;
            v *= fInvDet;
            tuvOut.x = u;
            tuvOut.y = v;
            tuvOut.z = t;
        }
        return true;
    };
    dMath.RayPlaneIntersection = function (vRayOrig, vRayDir, planeNormal, planeOffset) {
        var t = -(planeNormal.Dot(vRayOrig) + planeOffset) / (planeNormal.Dot(vRayDir));
        if (t < 0)
            return null;
        return vRayOrig.Add(vRayDir.MulF(t));
    };
    dMath.SphereAABBOverlap = function (pSphereCenter, radius2, center, extents) {
        var d = 0.0;
        var tmp, s;
        tmp = pSphereCenter.x - center.x;
        s = tmp + extents.x;
        if (s < 0.0) {
            d += s * s;
            if (d > radius2)
                return false;
        }
        else {
            s = tmp - extents.x;
            if (s > 0.0) {
                d += s * s;
                if (d > radius2)
                    return false;
            }
        }
        tmp = pSphereCenter.y - center.y;
        s = tmp + extents.y;
        if (s < 0.0) {
            d += s * s;
            if (d > radius2)
                return false;
        }
        else {
            s = tmp - extents.y;
            if (s > 0.0) {
                d += s * s;
                if (d > radius2)
                    return false;
            }
        }
        tmp = pSphereCenter.z - center.z;
        s = tmp + extents.z;
        if (s < 0.0) {
            d += s * s;
            if (d > radius2)
                return false;
        }
        else {
            s = tmp - extents.z;
            if (s > 0.0) {
                d += s * s;
                if (d > radius2)
                    return false;
            }
        }
        return d <= radius2;
    };
    dMath.EnumSequnce = function (inData, maxNum, onCallback) {
        for (var i = 0; i < inData.length; i++)
            inData[i] = i;
        while (true) {
            var last = inData.length - 1;
            onCallback(inData);
            inData[last]++;
            var find = 0;
            while (inData[last] >= maxNum) {
                find = -1;
                for (var i = last - 1; i >= 0; i--) {
                    if (inData[i] < inData[i + 1] - 1) {
                        find = i;
                        break;
                    }
                }
                if (find == -1)
                    break;
                inData[find]++;
                for (var i = 1; i <= last - find; i++)
                    inData[i + find] = inData[i + find - 1] + 1;
            }
            if (find == -1)
                break;
        }
    };
    dMath.dPI = 3.141592653589793;
    dMath.dFLOAT_MAX = 3.402823466e+38;
    dMath.dFLOAT_MIN = 1.175494351e-38;
    dMath.dFLOAT_EPSILON = 0.000001;
    dMath.dINT_MAX = 2147483647;
    dMath.dINT_MIN = -2147483648;
    dMath.dLONG_MAX = 9223372036854775807;
    dMath.dLONG_MIN = -9223372036854775808;
    dMath.dDOUBLE_EPSILON = 0.000001;
    dMath.dDOUBLE_MAX = 1.7976931348623e+308;
    dMath.dDOUBLE_MIN = -1.7976931348623e+308;
    dMath.dE = 2.7182818284590452354;
    dMath.dLN10 = 2.302585092994046;
    dMath.dLN2 = 0.6931471805599453;
    dMath.dLOG10E = 0.4342944819032518;
    dMath.dLOG2E = 1.442695040888963387;
    dMath.dSQRT1_2 = 0.7071067811865476;
    dMath.dSQRT2 = 1.4142135623730951;
    return dMath;
}(dObject));
dObject.InitStatic(function () {
    dMath.AB = new dVector3();
    dMath.AC = new dVector3();
    dMath.AP = new dVector3();
    dMath.v0 = new dVector3();
    dMath.v1 = new dVector3();
    dMath.v2 = new dVector3();
});
var dMatrix = (function (_super) {
    __extends(dMatrix, _super);
    function dMatrix() {
        var _this = _super.call(this) || this;
        _this._11 = 1;
        _this._12 = 0;
        _this._13 = 0;
        _this._14 = 0;
        _this._21 = 0;
        _this._22 = 1;
        _this._23 = 0;
        _this._24 = 0;
        _this._31 = 0;
        _this._32 = 0;
        _this._33 = 1;
        _this._34 = 0;
        _this._41 = 0;
        _this._42 = 0;
        _this._43 = 0;
        _this._44 = 1;
        return _this;
    }
    dMatrix.prototype.Clear = function () {
        var p = this;
        p._11 = 0;
        p._12 = 0;
        p._13 = 0;
        p._14 = 0;
        p._21 = 0;
        p._22 = 0;
        p._23 = 0;
        p._24 = 0;
        p._31 = 0;
        p._32 = 0;
        p._33 = 0;
        p._34 = 0;
        p._41 = 0;
        p._42 = 0;
        p._43 = 0;
        p._44 = 0;
    };
    dMatrix.prototype.Equals = function (p) {
        if (p == null)
            return false;
        var a = this;
        return a._11 == p._11 && a._12 == p._12 && a._13 == p._13 && a._14 == p._14 &&
            a._21 == p._21 && a._22 == p._22 && a._23 == p._23 && a._24 == p._24 &&
            a._31 == p._31 && a._32 == p._32 && a._33 == p._33 && a._34 == p._34 &&
            a._41 == p._41 && a._42 == p._42 && a._43 == p._43 && a._44 == p._44;
    };
    dMatrix.prototype.EqualsIgnore = function (p, ignore) {
        if (ignore === void 0) { ignore = 0.0001; }
        if (p == null)
            return false;
        var a = this;
        return dMath.FloatEquals(a._11, p._11, ignore) &&
            dMath.FloatEquals(a._12, p._12, ignore) &&
            dMath.FloatEquals(a._13, p._13, ignore) &&
            dMath.FloatEquals(a._14, p._14, ignore) &&
            dMath.FloatEquals(a._21, p._21, ignore) &&
            dMath.FloatEquals(a._22, p._22, ignore) &&
            dMath.FloatEquals(a._23, p._23, ignore) &&
            dMath.FloatEquals(a._24, p._24, ignore) &&
            dMath.FloatEquals(a._31, p._31, ignore) &&
            dMath.FloatEquals(a._32, p._32, ignore) &&
            dMath.FloatEquals(a._33, p._33, ignore) &&
            dMath.FloatEquals(a._34, p._34, ignore) &&
            dMath.FloatEquals(a._41, p._41, ignore) &&
            dMath.FloatEquals(a._42, p._42, ignore) &&
            dMath.FloatEquals(a._43, p._43, ignore) &&
            dMath.FloatEquals(a._44, p._44, ignore);
    };
    dMatrix.prototype.Copy = function (m) {
        if (m == this)
            return this;
        var a = this;
        a._11 = m._11;
        a._12 = m._12;
        a._13 = m._13;
        a._14 = m._14;
        a._21 = m._21;
        a._22 = m._22;
        a._23 = m._23;
        a._24 = m._24;
        a._31 = m._31;
        a._32 = m._32;
        a._33 = m._33;
        a._34 = m._34;
        a._41 = m._41;
        a._42 = m._42;
        a._43 = m._43;
        a._44 = m._44;
        return this;
    };
    dMatrix.prototype.Identity = function () {
        var a = this;
        a._11 = 1.0;
        a._12 = 0.0;
        a._13 = 0.0;
        a._14 = 0.0;
        a._21 = 0.0;
        a._22 = 1.0;
        a._23 = 0.0;
        a._24 = 0.0;
        a._31 = 0.0;
        a._32 = 0.0;
        a._33 = 1.0;
        a._34 = 0.0;
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = 0.0;
        a._44 = 1.0;
        return this;
    };
    dMatrix.prototype.TranslationVector3 = function (v) {
        return this.Translation(v.x, v.y, v.z);
    };
    dMatrix.prototype.Translation = function (x, y, z) {
        var a = this;
        a._11 = 1.0;
        a._12 = 0.0;
        a._13 = 0.0;
        a._14 = 0.0;
        a._21 = 0.0;
        a._22 = 1.0;
        a._23 = 0.0;
        a._24 = 0.0;
        a._31 = 0.0;
        a._32 = 0.0;
        a._33 = 1.0;
        a._34 = 0.0;
        a._41 = x;
        a._42 = y;
        a._43 = z;
        a._44 = 1.0;
        return this;
    };
    dMatrix.prototype.TranslationFast = function (x, y, z) {
        this._41 = x;
        this._42 = y;
        this._43 = z;
        return this;
    };
    dMatrix.prototype.TranslationAppend = function (x, y, z) {
        dMatrix.s_pMatrixForAppend.Translation(x, y, z);
        this.MulAppend(dMatrix.s_pMatrixForAppend);
        return this;
    };
    dMatrix.prototype.TranslationAppendFast = function (x, y, z) {
        this._41 += x;
        this._42 += y;
        this._43 += z;
        return this;
    };
    dMatrix.prototype.SetTranslationToZero = function () {
        this._41 = this._42 = this._43 = 0;
        return this;
    };
    dMatrix.prototype.ToTranslation = function () {
        return new dVector3(this._41, this._42, this._43);
    };
    dMatrix.prototype.Scaling = function (x, y, z) {
        var a = this;
        a._11 = x;
        a._12 = 0.0;
        a._13 = 0.0;
        a._14 = 0.0;
        a._21 = 0.0;
        a._22 = y;
        a._23 = 0.0;
        a._24 = 0.0;
        a._31 = 0.0;
        a._32 = 0.0;
        a._33 = z;
        a._34 = 0.0;
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = 0.0;
        a._44 = 1.0;
        return this;
    };
    dMatrix.prototype.ScalingFast = function (x, y, z) {
        this._11 = x;
        this._22 = y;
        this._33 = z;
        return this;
    };
    dMatrix.prototype.ScalingAppend = function (x, y, z) {
        dMatrix.s_pMatrixForAppend.Scaling(x, y, z);
        this.MulAppend(dMatrix.s_pMatrixForAppend);
        return this;
    };
    dMatrix.prototype.RotationX = function (r) {
        var a = this;
        a._11 = 1.0;
        a._12 = 0.0;
        a._13 = 0.0;
        a._14 = 0.0;
        a._21 = 0.0;
        a._22 = dMath.Cos(r);
        a._23 = dMath.Sin(r);
        a._24 = 0.0;
        a._31 = 0.0;
        a._32 = -dMath.Sin(r);
        a._33 = dMath.Cos(r);
        a._34 = 0.0;
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = 0.0;
        a._44 = 1.0;
        return this;
    };
    dMatrix.prototype.RotationXAppend = function (r) {
        dMatrix.s_pMatrixForAppend.RotationX(r);
        this.MulAppend(dMatrix.s_pMatrixForAppend);
        return this;
    };
    dMatrix.prototype.RotationY = function (r) {
        var a = this;
        a._11 = dMath.Cos(r);
        a._12 = 0.0;
        a._13 = -dMath.Sin(r);
        a._14 = 0.0;
        a._21 = 0.0;
        a._22 = 1.0;
        a._23 = 0.0;
        a._24 = 0.0;
        a._31 = dMath.Sin(r);
        a._32 = 0.0;
        a._33 = dMath.Cos(r);
        a._34 = 0.0;
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = 0.0;
        a._44 = 1.0;
        return this;
    };
    dMatrix.prototype.RotationYAppend = function (r) {
        dMatrix.s_pMatrixForAppend.RotationY(r);
        this.MulAppend(dMatrix.s_pMatrixForAppend);
        return this;
    };
    dMatrix.prototype.RotationZ = function (r) {
        var a = this;
        a._11 = dMath.Cos(r);
        a._12 = dMath.Sin(r);
        a._13 = 0.0;
        a._14 = 0.0;
        a._21 = -dMath.Sin(r);
        a._22 = dMath.Cos(r);
        a._23 = 0.0;
        a._24 = 0.0;
        a._31 = 0.0;
        a._32 = 0.0;
        a._33 = 1.0;
        a._34 = 0.0;
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = 0.0;
        a._44 = 1.0;
        return this;
    };
    dMatrix.prototype.RotationZAppend = function (r) {
        dMatrix.s_pMatrixForAppend.RotationZ(r);
        this.MulAppend(dMatrix.s_pMatrixForAppend);
        return this;
    };
    dMatrix.prototype.RotationAxis = function (r, _axis) {
        var a = this;
        var a1 = new dVector3(_axis.x, _axis.y, _axis.z);
        a1.Normalize();
        var c = dMath.Cos(r);
        var s = dMath.Sin(r);
        var t = 1.0 - c;
        a._11 = c + a1.x * a1.x * t;
        a._22 = c + a1.y * a1.y * t;
        a._33 = c + a1.z * a1.z * t;
        var tmp1 = a1.x * a1.y * t;
        var tmp2 = a1.z * s;
        a._21 = tmp1 + tmp2;
        a._12 = tmp1 - tmp2;
        tmp1 = a1.x * a1.z * t;
        tmp2 = a1.y * s;
        a._31 = tmp1 - tmp2;
        a._13 = tmp1 + tmp2;
        tmp1 = a1.y * a1.z * t;
        tmp2 = a1.x * s;
        a._32 = tmp1 + tmp2;
        a._23 = tmp1 - tmp2;
        a._14 = 0.0;
        a._24 = 0.0;
        a._34 = 0.0;
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = 0.0;
        a._44 = 1.0;
        return this;
    };
    dMatrix.prototype.RotationAxisAppend = function (r, _axis) {
        dMatrix.s_pMatrixForAppend.RotationAxis(r, _axis);
        this.MulAppend(dMatrix.s_pMatrixForAppend);
        return this;
    };
    dMatrix.Multiply = function (ret, a, b) {
        var _11 = a._11 * b._11 + a._12 * b._21 + a._13 * b._31 + a._14 * b._41;
        var _12 = a._11 * b._12 + a._12 * b._22 + a._13 * b._32 + a._14 * b._42;
        var _13 = a._11 * b._13 + a._12 * b._23 + a._13 * b._33 + a._14 * b._43;
        var _14 = a._11 * b._14 + a._12 * b._24 + a._13 * b._34 + a._14 * b._44;
        var _21 = a._21 * b._11 + a._22 * b._21 + a._23 * b._31 + a._24 * b._41;
        var _22 = a._21 * b._12 + a._22 * b._22 + a._23 * b._32 + a._24 * b._42;
        var _23 = a._21 * b._13 + a._22 * b._23 + a._23 * b._33 + a._24 * b._43;
        var _24 = a._21 * b._14 + a._22 * b._24 + a._23 * b._34 + a._24 * b._44;
        var _31 = a._31 * b._11 + a._32 * b._21 + a._33 * b._31 + a._34 * b._41;
        var _32 = a._31 * b._12 + a._32 * b._22 + a._33 * b._32 + a._34 * b._42;
        var _33 = a._31 * b._13 + a._32 * b._23 + a._33 * b._33 + a._34 * b._43;
        var _34 = a._31 * b._14 + a._32 * b._24 + a._33 * b._34 + a._34 * b._44;
        var _41 = a._41 * b._11 + a._42 * b._21 + a._43 * b._31 + a._44 * b._41;
        var _42 = a._41 * b._12 + a._42 * b._22 + a._43 * b._32 + a._44 * b._42;
        var _43 = a._41 * b._13 + a._42 * b._23 + a._43 * b._33 + a._44 * b._43;
        var _44 = a._41 * b._14 + a._42 * b._24 + a._43 * b._34 + a._44 * b._44;
        ret._11 = _11;
        ret._12 = _12;
        ret._13 = _13;
        ret._14 = _14;
        ret._21 = _21;
        ret._22 = _22;
        ret._23 = _23;
        ret._24 = _24;
        ret._31 = _31;
        ret._32 = _32;
        ret._33 = _33;
        ret._34 = _34;
        ret._41 = _41;
        ret._42 = _42;
        ret._43 = _43;
        ret._44 = _44;
        return ret;
    };
    dMatrix.prototype.Mul = function (b) {
        if (b == null)
            return this;
        var a = this;
        var ret = new dMatrix();
        ret._11 = a._11 * b._11 + a._12 * b._21 + a._13 * b._31 + a._14 * b._41;
        ret._12 = a._11 * b._12 + a._12 * b._22 + a._13 * b._32 + a._14 * b._42;
        ret._13 = a._11 * b._13 + a._12 * b._23 + a._13 * b._33 + a._14 * b._43;
        ret._14 = a._11 * b._14 + a._12 * b._24 + a._13 * b._34 + a._14 * b._44;
        ret._21 = a._21 * b._11 + a._22 * b._21 + a._23 * b._31 + a._24 * b._41;
        ret._22 = a._21 * b._12 + a._22 * b._22 + a._23 * b._32 + a._24 * b._42;
        ret._23 = a._21 * b._13 + a._22 * b._23 + a._23 * b._33 + a._24 * b._43;
        ret._24 = a._21 * b._14 + a._22 * b._24 + a._23 * b._34 + a._24 * b._44;
        ret._31 = a._31 * b._11 + a._32 * b._21 + a._33 * b._31 + a._34 * b._41;
        ret._32 = a._31 * b._12 + a._32 * b._22 + a._33 * b._32 + a._34 * b._42;
        ret._33 = a._31 * b._13 + a._32 * b._23 + a._33 * b._33 + a._34 * b._43;
        ret._34 = a._31 * b._14 + a._32 * b._24 + a._33 * b._34 + a._34 * b._44;
        ret._41 = a._41 * b._11 + a._42 * b._21 + a._43 * b._31 + a._44 * b._41;
        ret._42 = a._41 * b._12 + a._42 * b._22 + a._43 * b._32 + a._44 * b._42;
        ret._43 = a._41 * b._13 + a._42 * b._23 + a._43 * b._33 + a._44 * b._43;
        ret._44 = a._41 * b._14 + a._42 * b._24 + a._43 * b._34 + a._44 * b._44;
        return ret;
    };
    dMatrix.prototype.MulAppend = function (b) {
        if (b == null)
            return this;
        var a = this;
        var ret = dMatrix.s_mulAppendTemp;
        ret._11 = a._11 * b._11 + a._12 * b._21 + a._13 * b._31 + a._14 * b._41;
        ret._12 = a._11 * b._12 + a._12 * b._22 + a._13 * b._32 + a._14 * b._42;
        ret._13 = a._11 * b._13 + a._12 * b._23 + a._13 * b._33 + a._14 * b._43;
        ret._14 = a._11 * b._14 + a._12 * b._24 + a._13 * b._34 + a._14 * b._44;
        ret._21 = a._21 * b._11 + a._22 * b._21 + a._23 * b._31 + a._24 * b._41;
        ret._22 = a._21 * b._12 + a._22 * b._22 + a._23 * b._32 + a._24 * b._42;
        ret._23 = a._21 * b._13 + a._22 * b._23 + a._23 * b._33 + a._24 * b._43;
        ret._24 = a._21 * b._14 + a._22 * b._24 + a._23 * b._34 + a._24 * b._44;
        ret._31 = a._31 * b._11 + a._32 * b._21 + a._33 * b._31 + a._34 * b._41;
        ret._32 = a._31 * b._12 + a._32 * b._22 + a._33 * b._32 + a._34 * b._42;
        ret._33 = a._31 * b._13 + a._32 * b._23 + a._33 * b._33 + a._34 * b._43;
        ret._34 = a._31 * b._14 + a._32 * b._24 + a._33 * b._34 + a._34 * b._44;
        ret._41 = a._41 * b._11 + a._42 * b._21 + a._43 * b._31 + a._44 * b._41;
        ret._42 = a._41 * b._12 + a._42 * b._22 + a._43 * b._32 + a._44 * b._42;
        ret._43 = a._41 * b._13 + a._42 * b._23 + a._43 * b._33 + a._44 * b._43;
        ret._44 = a._41 * b._14 + a._42 * b._24 + a._43 * b._34 + a._44 * b._44;
        this.Copy(ret);
        return this;
    };
    dMatrix.prototype.AppendMul = function (a) {
        if (a == null)
            return this;
        var b = this;
        var ret = dMatrix.s_mulAppendTemp;
        ret._11 = a._11 * b._11 + a._12 * b._21 + a._13 * b._31 + a._14 * b._41;
        ret._12 = a._11 * b._12 + a._12 * b._22 + a._13 * b._32 + a._14 * b._42;
        ret._13 = a._11 * b._13 + a._12 * b._23 + a._13 * b._33 + a._14 * b._43;
        ret._14 = a._11 * b._14 + a._12 * b._24 + a._13 * b._34 + a._14 * b._44;
        ret._21 = a._21 * b._11 + a._22 * b._21 + a._23 * b._31 + a._24 * b._41;
        ret._22 = a._21 * b._12 + a._22 * b._22 + a._23 * b._32 + a._24 * b._42;
        ret._23 = a._21 * b._13 + a._22 * b._23 + a._23 * b._33 + a._24 * b._43;
        ret._24 = a._21 * b._14 + a._22 * b._24 + a._23 * b._34 + a._24 * b._44;
        ret._31 = a._31 * b._11 + a._32 * b._21 + a._33 * b._31 + a._34 * b._41;
        ret._32 = a._31 * b._12 + a._32 * b._22 + a._33 * b._32 + a._34 * b._42;
        ret._33 = a._31 * b._13 + a._32 * b._23 + a._33 * b._33 + a._34 * b._43;
        ret._34 = a._31 * b._14 + a._32 * b._24 + a._33 * b._34 + a._34 * b._44;
        ret._41 = a._41 * b._11 + a._42 * b._21 + a._43 * b._31 + a._44 * b._41;
        ret._42 = a._41 * b._12 + a._42 * b._22 + a._43 * b._32 + a._44 * b._42;
        ret._43 = a._41 * b._13 + a._42 * b._23 + a._43 * b._33 + a._44 * b._43;
        ret._44 = a._41 * b._14 + a._42 * b._24 + a._43 * b._34 + a._44 * b._44;
        this.Copy(ret);
        return this;
    };
    dMatrix.prototype.DecomposeQuaternion = function (pTransOut, pScaOut, pRotOut) {
        var rot = new dMatrix();
        this.Decompose(pTransOut, pScaOut, rot);
        if (pRotOut != null)
            pRotOut.Copy(rot.ToQuaternion());
    };
    dMatrix.prototype.DecomposeRotation = function () {
        var ret = new dMatrix();
        this.Decompose(null, null, ret);
        return ret;
    };
    dMatrix.prototype.Decompose = function (pTransOut, pScaOut, pRotOut) {
        var a = this;
        if (pTransOut) {
            pTransOut.x = a._41;
            pTransOut.y = a._42;
            pTransOut.z = a._43;
        }
        if (!pScaOut && !pRotOut)
            return;
        if (!pScaOut && pRotOut)
            pScaOut = new dVector3();
        if (pScaOut) {
            pScaOut.x = dMath.Sqrt(a._11 * a._11 + a._12 * a._12 + a._13 * a._13);
            pScaOut.y = dMath.Sqrt(a._21 * a._21 + a._22 * a._22 + a._23 * a._23);
            pScaOut.z = dMath.Sqrt(a._31 * a._31 + a._32 * a._32 + a._33 * a._33);
        }
        var mat3x3 = new dMatrix();
        mat3x3._11 = a._11;
        mat3x3._12 = a._12;
        mat3x3._13 = a._13;
        mat3x3._14 = 0.0;
        mat3x3._21 = a._21;
        mat3x3._22 = a._22;
        mat3x3._23 = a._23;
        mat3x3._24 = 0.0;
        mat3x3._31 = a._31;
        mat3x3._32 = a._32;
        mat3x3._33 = a._33;
        mat3x3._34 = 0.0;
        mat3x3._41 = 0.0;
        mat3x3._42 = 0.0;
        mat3x3._43 = 0.0;
        mat3x3._44 = 1.0;
        if (mat3x3.Determinant() < 0)
            pScaOut.x = -pScaOut.x;
        if (pScaOut != null) {
            if (pScaOut.x != 0.0) {
                mat3x3._11 /= pScaOut.x;
                mat3x3._12 /= pScaOut.x;
                mat3x3._13 /= pScaOut.x;
            }
            if (pScaOut.y != 0.0) {
                mat3x3._21 /= pScaOut.y;
                mat3x3._22 /= pScaOut.y;
                mat3x3._23 /= pScaOut.y;
            }
            if (pScaOut.z != 0.0) {
                mat3x3._31 /= pScaOut.z;
                mat3x3._32 /= pScaOut.z;
                mat3x3._33 /= pScaOut.z;
            }
        }
        if (pRotOut != null)
            pRotOut.Copy(mat3x3);
    };
    dMatrix.prototype.ToRotationEuler = function () {
        var a = this;
        var sy = dMath.Sqrt(a._11 * a._11 + a._12 * a._12);
        var singular = sy < 0.00001;
        var v = new dVector3();
        if (!singular) {
            v.x = dMath.Atan2(a._23, a._33);
            v.y = dMath.Atan2(-a._13, sy);
            v.z = dMath.Atan2(a._12, a._11);
        }
        else {
            v.x = dMath.Atan2(-a._32, a._22);
            v.y = dMath.Atan2(-a._13, sy);
            v.z = 0;
        }
        v.SetValue(dMath.RadianToAngle(v.x), dMath.RadianToAngle(v.y), dMath.RadianToAngle(v.z));
        return v;
    };
    dMatrix.prototype.ToAxisAngle = function (vAxisOut) {
        var a = this;
        var ret = 0;
        var epsilon = 0.0001;
        var epsilon2 = 0.001;
        if ((dMath.Abs(a._12 - a._21) < epsilon)
            && (dMath.Abs(a._13 - a._31) < epsilon)
            && (dMath.Abs(a._23 - a._32) < epsilon)) {
            if ((dMath.Abs(a._12 + a._21) < epsilon2)
                && (dMath.Abs(a._13 + a._31) < epsilon2)
                && (dMath.Abs(a._23 + a._32) < epsilon2)
                && (dMath.Abs(a._11 + a._22 + a._33 - 3) < epsilon2)) {
                vAxisOut.SetValue(0, 0, 0);
                return 0;
            }
            ret = dMath.dPI;
            var xx = (a._11 + 1.0) / 2.0;
            var yy = (a._22 + 1.0) / 2.0;
            var zz = (a._33 + 1.0) / 2.0;
            var xy = (a._12 + a._21) / 4.0;
            var xz = (a._13 + a._31) / 4.0;
            var yz = (a._23 + a._32) / 4.0;
            if ((xx >= yy) && (xx >= zz)) {
                if (xx < epsilon) {
                    vAxisOut.x = 0;
                    vAxisOut.y = 0.7071;
                    vAxisOut.z = 0.7071;
                }
                else {
                    vAxisOut.x = dMath.Sqrt(xx);
                    vAxisOut.y = xy / vAxisOut.x;
                    vAxisOut.z = xz / vAxisOut.x;
                }
            }
            else if (yy >= zz) {
                if (yy < epsilon) {
                    vAxisOut.x = 0.7071;
                    vAxisOut.y = 0;
                    vAxisOut.z = 0.7071;
                }
                else {
                    vAxisOut.y = dMath.Sqrt(yy);
                    vAxisOut.x = xy / vAxisOut.y;
                    vAxisOut.z = yz / vAxisOut.y;
                }
            }
            else {
                if (zz < epsilon) {
                    vAxisOut.x = 0.7071;
                    vAxisOut.y = 0.7071;
                    vAxisOut.z = 0;
                }
                else {
                    vAxisOut.z = dMath.Sqrt(zz);
                    vAxisOut.x = xz / vAxisOut.z;
                    vAxisOut.y = yz / vAxisOut.z;
                }
            }
            return ret;
        }
        var s = dMath.Sqrt((a._32 - a._23) * (a._32 - a._23)
            + (a._13 - a._31) * (a._13 - a._31)
            + (a._21 - a._12) * (a._21 - a._12));
        if (dMath.Abs(s) < 0.001)
            s = 1;
        ret = dMath.Acos((a._11 + a._22 + a._33 - 1.0) / 2.0);
        vAxisOut.x = (a._32 - a._23) / s;
        vAxisOut.y = (a._13 - a._31) / s;
        vAxisOut.z = (a._21 - a._12) / s;
        return ret;
    };
    dMatrix.prototype.RotationEuler = function (x, y, z) {
        var matX = new dMatrix().RotationX(dMath.AngleToRadian(x));
        var matY = new dMatrix().RotationY(dMath.AngleToRadian(y));
        var matZ = new dMatrix().RotationZ(dMath.AngleToRadian(z));
        dMatrix.Multiply(this, matX, matY);
        dMatrix.Multiply(this, this, matZ);
        return this;
    };
    dMatrix.prototype.RotationEulerAppend = function (x, y, z) {
        dMatrix.s_pMatrixForAppend.RotationEuler(x, y, z);
        this.MulAppend(dMatrix.s_pMatrixForAppend);
        return this;
    };
    dMatrix.prototype.RotationFromDirection = function (direction, up) {
        if (up === void 0) { up = null; }
        if (!up)
            up = new dVector3(0, 1, 0);
        if (direction.EqualsIgnore(up, 0.001))
            this.Identity();
        else if (direction.EqualsIgnore(up.MulAppendF(-1), 0.001))
            this.RotationAxis(dMath.dPI, new dVector3(up.y, up.z, up.x));
        else {
            up.MulAppendF(-1);
            var from = up;
            var to = direction;
            var c = from.Dot(to);
            var f = (c < 0 ? -c : c);
            var mat = new dMatrix().ToArray();
            if (1.0 - f < 0.0000001) {
                var x = new dVector3(0, 0, 0);
                if (dMath.Abs(from.x) < dMath.Abs(from.y)) {
                    if (dMath.Abs(from.x) < dMath.Abs(from.z))
                        x.x = 1;
                    else
                        x.z = 1;
                }
                else {
                    if (dMath.Abs(from.y) < dMath.Abs(from.z))
                        x.y = 1;
                    else
                        x.z = 1;
                }
                var u = x.Sub(from);
                var v = x.Sub(to);
                var c1 = 2 / u.Dot(u);
                var c2 = 2 / v.Dot(v);
                var c3 = c1 * c2 * u.Dot(v);
                for (var i = 0; i < 3; i++) {
                    for (var j = 0; j < 3; j++) {
                        mat[i * 4 + j] = c3 * v.GetAt(i) * u.GetAt(j)
                            - c2 * v.GetAt(i) * v.GetAt(j)
                            - c1 * u.GetAt(i) * u.GetAt(j);
                    }
                    mat[i * 4 + i] += 1;
                }
            }
            else {
                var v = from.Cross(to);
                var h = 1 / (1 + c);
                var hvx = h * v.x;
                var hvz = h * v.z;
                var hvxy = hvx * v.y;
                var hvxz = hvx * v.z;
                var hvyz = hvz * v.y;
                mat[0] = c + hvx * v.x;
                mat[1] = hvxy + v.z;
                mat[2] = hvxz - v.y;
                mat[4] = hvxy - v.z;
                mat[5] = c + h * v.y * v.y;
                mat[6] = hvyz + v.x;
                mat[8] = hvxz + v.y;
                mat[9] = hvyz - v.x;
                mat[10] = c + hvz * v.z;
            }
            this.FromArray(mat);
        }
        return this;
    };
    dMatrix.prototype.FromQuaternion = function (q) {
        if (q.x == 0 && q.y == 0 && q.z == 0 && q.w == 1) {
            this.Identity();
            return this;
        }
        var a = this;
        var xx, yy, zz, xy, wz, xz, wy, yz, wx;
        xx = q.x * q.x;
        yy = q.y * q.y;
        zz = q.z * q.z;
        a._11 = (1.0 - 2.0 * (yy + zz));
        a._22 = (1.0 - 2.0 * (zz + xx));
        a._33 = (1.0 - 2.0 * (xx + yy));
        xy = q.x * q.y;
        wz = q.w * q.z;
        a._21 = 2.0 * (xy - wz);
        a._12 = 2.0 * (xy + wz);
        xz = q.x * q.z;
        wy = q.w * q.y;
        a._31 = 2.0 * (xz + wy);
        a._13 = 2.0 * (xz - wy);
        yz = q.y * q.z;
        wx = q.w * q.x;
        a._32 = 2.0 * (yz - wx);
        a._23 = 2.0 * (yz + wx);
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = 0.0;
        a._44 = 1.0;
        a._14 = 0.0;
        a._24 = 0.0;
        a._34 = 0.0;
        return this;
    };
    dMatrix.prototype.ToQuaternion = function () {
        var a = this;
        if (dMath.FloatEquals(a._11, 0) && dMath.FloatEquals(a._22, 0) && dMath.FloatEquals(a._33, 0) &&
            dMath.FloatEquals(a._21, 0) && dMath.FloatEquals(a._22, 0) && dMath.FloatEquals(a._23, 0) &&
            dMath.FloatEquals(a._31, 0) && dMath.FloatEquals(a._32, 0) && dMath.FloatEquals(a._33, 0))
            return new dVector4(0, 0, 0, 1);
        var q = new dVector4();
        var tr, s;
        tr = a._11 + a._22 + a._33;
        if (tr >= 0) {
            q.w = dMath.Sqrt(tr + 1.0) * 0.5;
            s = 0.25 / q.w;
            q.x = (a._23 - a._32) * s;
            q.y = (a._31 - a._13) * s;
            q.z = (a._12 - a._21) * s;
            return q;
        }
        else {
            if (a._11 > a._22 && a._11 > a._33) {
                q.x = dMath.Sqrt(a._11 - (a._22 + a._33) + 1.0) * 0.5;
                s = 0.25 / q.x;
                q.y = (a._12 + a._21) * s;
                q.z = (a._13 + a._31) * s;
                q.w = (a._32 - a._23) * s;
            }
            else if (a._22 > a._11 && a._22 > a._33) {
                q.y = dMath.Sqrt(a._22 - (a._33 + a._11) + 1.0) * 0.5;
                s = 0.25 / q.y;
                q.z = (a._23 + a._32) * s;
                q.x = (a._21 + a._12) * s;
                q.w = (a._13 - a._31) * s;
            }
            else {
                q.z = dMath.Sqrt(a._33 - (a._11 + a._22) + 1.0) * 0.5;
                s = 0.25 / q.z;
                q.x = (a._31 + a._13) * s;
                q.y = (a._32 + a._23) * s;
                q.w = (a._21 - a._12) * s;
            }
        }
        q.w = -q.w;
        if (q.x < 0.0 && q.y < 0.0 && q.z < 0.0) {
            q.x = -q.x;
            q.y = -q.y;
            q.z = -q.z;
            q.w = -q.w;
        }
        return q;
    };
    dMatrix.prototype.Determinant = function () {
        var p = this;
        var a = p._22 * (p._33 * p._44 - p._43 * p._34) - p._23 * (p._32 * p._44 - p._34 * p._42) + p._24 * (p._32 * p._43 - p._33 * p._42);
        var b = p._21 * (p._33 * p._44 - p._34 * p._43) - p._23 * (p._31 * p._44 - p._34 * p._41) + p._24 * (p._31 * p._43 - p._33 * p._41);
        var c = p._21 * (p._32 * p._44 - p._34 * p._42) - p._22 * (p._31 * p._44 - p._34 * p._41) + p._24 * (p._31 * p._42 - p._32 * p._41);
        var d = p._21 * (p._32 * p._43 - p._33 * p._42) - p._22 * (p._31 * p._43 - p._33 * p._41) + p._23 * (p._31 * p._42 - p._32 * p._41);
        return p._11 * a - p._12 * b + p._13 * c - p._14 * d;
    };
    dMatrix.prototype.Inverse = function () {
        var a = this;
        if (dMath.FloatEquals(a._11, 0) && dMath.FloatEquals(a._12, 0) && dMath.FloatEquals(a._13, 0) &&
            dMath.FloatEquals(a._21, 0) && dMath.FloatEquals(a._22, 0) && dMath.FloatEquals(a._23, 0) &&
            dMath.FloatEquals(a._31, 0) && dMath.FloatEquals(a._32, 0) && dMath.FloatEquals(a._33, 0)) {
            a._11 = a._12 = a._13 = a._14 = 0;
            a._21 = a._22 = a._23 = a._24 = 0;
            a._31 = a._32 = a._33 = a._34 = 0;
            a._41 = a._42 = a._43 = 0;
            a._44 = 1;
            return this;
        }
        var d = this.Determinant();
        if (d == 0.0)
            d = 1.0;
        d = 1.0 / d;
        var m = new dMatrix();
        m._11 = (a._22 * (a._33 * a._44 - a._43 * a._34) - a._23 * (a._32 * a._44 - a._34 * a._42) + a._24 * (a._32 * a._43 - a._33 * a._42)) * d;
        m._21 = -(a._21 * (a._33 * a._44 - a._34 * a._43) - a._23 * (a._31 * a._44 - a._34 * a._41) + a._24 * (a._31 * a._43 - a._33 * a._41)) * d;
        m._31 = (a._21 * (a._32 * a._44 - a._34 * a._42) - a._22 * (a._31 * a._44 - a._34 * a._41) + a._24 * (a._31 * a._42 - a._32 * a._41)) * d;
        m._41 = -(a._21 * (a._32 * a._43 - a._33 * a._42) - a._22 * (a._31 * a._43 - a._33 * a._41) + a._23 * (a._31 * a._42 - a._32 * a._41)) * d;
        m._12 = -(a._12 * (a._33 * a._44 - a._43 * a._34) - a._32 * (a._13 * a._44 - a._43 * a._14) + a._42 * (a._13 * a._34 - a._33 * a._14)) * d;
        m._22 = (a._11 * (a._33 * a._44 - a._43 * a._34) - a._31 * (a._13 * a._44 - a._43 * a._14) + a._41 * (a._13 * a._34 - a._33 * a._14)) * d;
        m._32 = -(a._11 * (a._32 * a._44 - a._42 * a._34) - a._31 * (a._12 * a._44 - a._42 * a._14) + a._41 * (a._12 * a._34 - a._32 * a._14)) * d;
        m._42 = (a._11 * (a._32 * a._43 - a._42 * a._33) - a._31 * (a._12 * a._43 - a._42 * a._13) + a._41 * (a._12 * a._33 - a._32 * a._13)) * d;
        m._13 = (a._12 * (a._23 * a._44 - a._43 * a._24) - a._22 * (a._13 * a._44 - a._43 * a._14) + a._42 * (a._13 * a._24 - a._23 * a._14)) * d;
        m._23 = -(a._11 * (a._23 * a._44 - a._43 * a._24) - a._21 * (a._13 * a._44 - a._43 * a._14) + a._41 * (a._13 * a._24 - a._23 * a._14)) * d;
        m._33 = (a._11 * (a._22 * a._44 - a._42 * a._24) - a._21 * (a._12 * a._44 - a._42 * a._14) + a._41 * (a._12 * a._24 - a._22 * a._14)) * d;
        m._43 = -(a._11 * (a._22 * a._43 - a._42 * a._23) - a._21 * (a._12 * a._43 - a._42 * a._13) + a._41 * (a._12 * a._23 - a._22 * a._13)) * d;
        m._14 = -(a._12 * (a._23 * a._34 - a._33 * a._24) - a._22 * (a._13 * a._34 - a._33 * a._14) + a._32 * (a._13 * a._24 - a._23 * a._14)) * d;
        m._24 = (a._11 * (a._23 * a._34 - a._33 * a._24) - a._21 * (a._13 * a._34 - a._33 * a._14) + a._31 * (a._13 * a._24 - a._23 * a._14)) * d;
        m._34 = -(a._11 * (a._22 * a._34 - a._32 * a._24) - a._21 * (a._12 * a._34 - a._32 * a._14) + a._31 * (a._12 * a._24 - a._22 * a._14)) * d;
        m._44 = (a._11 * (a._22 * a._33 - a._32 * a._23) - a._21 * (a._12 * a._33 - a._32 * a._13) + a._31 * (a._12 * a._23 - a._22 * a._13)) * d;
        this.Copy(m);
        return this;
    };
    dMatrix.prototype.InverseToNewMatrix = function () {
        var ret = new dMatrix();
        ret.Copy(this);
        ret.Inverse();
        return ret;
    };
    dMatrix.prototype.PerspectiveFovLH = function (fovy, Aspect, zn, zf) {
        var a = this;
        var yScale = 1.0 / dMath.Tan(fovy / 2.0);
        var xScale = yScale / Aspect;
        a._11 = xScale;
        a._12 = 0.0;
        a._13 = 0.0;
        a._14 = 0.0;
        a._21 = 0.0;
        a._22 = yScale;
        a._23 = 0.0;
        a._24 = 0.0;
        a._31 = 0.0;
        a._32 = 0.0;
        a._33 = zf / (zf - zn);
        a._34 = 1.0;
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = -zn * zf / (zf - zn);
        a._44 = 0.0;
        return this;
    };
    dMatrix.prototype.PerspectiveFovRH = function (fovy, Aspect, zn, zf) {
        var a = this;
        var yScale = 1.0 / dMath.Tan(fovy / 2.0);
        var xScale = yScale / Aspect;
        a._11 = xScale;
        a._12 = 0.0;
        a._13 = 0.0;
        a._14 = 0.0;
        a._21 = 0.0;
        a._22 = yScale;
        a._23 = 0.0;
        a._24 = 0.0;
        a._31 = 0.0;
        a._32 = 0.0;
        a._33 = zf / (zn - zf);
        a._34 = -1.0;
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = zn * zf / (zn - zf);
        a._44 = 0.0;
        return this;
    };
    dMatrix.prototype.OrthoLH = function (w, h, zn, zf) {
        var a = this;
        a._11 = 2.0 / w;
        a._12 = 0.0;
        a._13 = 0.0;
        a._14 = 0.0;
        a._21 = 0.0;
        a._22 = 2.0 / h;
        a._23 = 0.0;
        a._24 = 0.0;
        a._31 = 0.0;
        a._32 = 0.0;
        a._33 = 1.0 / (zf - zn);
        a._34 = 0.0;
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = zn / (zn - zf);
        a._44 = 1.0;
        return this;
    };
    dMatrix.prototype.OrthoRH = function (w, h, zn, zf) {
        var a = this;
        a._11 = 2.0 / w;
        a._12 = 0.0;
        a._13 = 0.0;
        a._14 = 0.0;
        a._21 = 0.0;
        a._22 = 2.0 / h;
        a._23 = 0.0;
        a._24 = 0.0;
        a._31 = 0.0;
        a._32 = 0.0;
        a._33 = 1.0 / (zn - zf);
        a._34 = 0.0;
        a._41 = 0.0;
        a._42 = 0.0;
        a._43 = zn / (zn - zf);
        a._44 = 1.0;
        return this;
    };
    dMatrix.prototype.MatrixLookAtLH = function (vEye, vLookat, vUp) {
        var a = this;
        var zaxis = vLookat.Sub(vEye);
        zaxis.Normalize();
        var xaxis = vUp.Cross(zaxis);
        xaxis.Normalize();
        var yaxis = zaxis.Cross(xaxis);
        a._11 = xaxis.x;
        a._12 = yaxis.x;
        a._13 = zaxis.x;
        a._14 = 0.0;
        a._21 = xaxis.y;
        a._22 = yaxis.y;
        a._23 = zaxis.y;
        a._24 = 0.0;
        a._31 = xaxis.z;
        a._32 = yaxis.z;
        a._33 = zaxis.z;
        a._34 = 0.0;
        a._41 = -xaxis.Dot(vEye);
        a._42 = -yaxis.Dot(vEye);
        a._43 = -zaxis.Dot(vEye);
        a._44 = 1.0;
    };
    dMatrix.prototype.MatrixLookAtRH = function (vEye, vLookat, vUp) {
        var a = this;
        var zaxis = vEye.Sub(vLookat);
        zaxis.Normalize();
        var xaxis = vUp.Cross(zaxis);
        xaxis.Normalize();
        var yaxis = zaxis.Cross(xaxis);
        a._11 = xaxis.x;
        a._12 = yaxis.x;
        a._13 = zaxis.x;
        a._14 = 0.0;
        a._21 = xaxis.y;
        a._22 = yaxis.y;
        a._23 = zaxis.y;
        a._24 = 0.0;
        a._31 = xaxis.z;
        a._32 = yaxis.z;
        a._33 = zaxis.z;
        a._34 = 0.0;
        a._41 = -xaxis.Dot(vEye);
        a._42 = -yaxis.Dot(vEye);
        a._43 = -zaxis.Dot(vEye);
        a._44 = 1.0;
    };
    dMatrix.prototype.ReadFromBin = function (data) {
        var a = this;
        a._11 = data.ReadFloat();
        a._12 = data.ReadFloat();
        a._13 = data.ReadFloat();
        a._14 = data.ReadFloat();
        a._21 = data.ReadFloat();
        a._22 = data.ReadFloat();
        a._23 = data.ReadFloat();
        a._24 = data.ReadFloat();
        a._31 = data.ReadFloat();
        a._32 = data.ReadFloat();
        a._33 = data.ReadFloat();
        a._34 = data.ReadFloat();
        a._41 = data.ReadFloat();
        a._42 = data.ReadFloat();
        a._43 = data.ReadFloat();
        a._44 = data.ReadFloat();
        return this;
    };
    dMatrix.prototype.WriteToBin = function (data) {
        var a = this;
        data.WriteFloat(a._11);
        data.WriteFloat(a._12);
        data.WriteFloat(a._13);
        data.WriteFloat(a._14);
        data.WriteFloat(a._21);
        data.WriteFloat(a._22);
        data.WriteFloat(a._23);
        data.WriteFloat(a._24);
        data.WriteFloat(a._31);
        data.WriteFloat(a._32);
        data.WriteFloat(a._33);
        data.WriteFloat(a._34);
        data.WriteFloat(a._41);
        data.WriteFloat(a._42);
        data.WriteFloat(a._43);
        data.WriteFloat(a._44);
        return this;
    };
    dMatrix.prototype.GetAt = function (at) {
        switch (at) {
            case 0: return this._11;
            case 1: return this._12;
            case 2: return this._13;
            case 3: return this._14;
            case 4: return this._21;
            case 5: return this._22;
            case 6: return this._23;
            case 7: return this._24;
            case 8: return this._31;
            case 9: return this._32;
            case 10: return this._33;
            case 11: return this._34;
            case 12: return this._41;
            case 13: return this._42;
            case 14: return this._43;
            case 15: return this._44;
        }
        return 0;
    };
    dMatrix.prototype.toRow = function (bTranspose) {
        if (bTranspose === void 0) { bTranspose = false; }
        var a = this;
        var b = dMatrix.s_pRowBuffer;
        if (bTranspose) {
            b[0] = a._11;
            b[1] = a._21;
            b[2] = a._31;
            b[3] = a._41;
            b[4] = a._12;
            b[5] = a._22;
            b[6] = a._32;
            b[7] = a._42;
            b[8] = a._13;
            b[9] = a._23;
            b[10] = a._33;
            b[11] = a._43;
            b[12] = a._14;
            b[13] = a._24;
            b[14] = a._34;
            b[15] = a._44;
        }
        else {
            b[0] = a._11;
            b[1] = a._12;
            b[2] = a._13;
            b[3] = a._14;
            b[4] = a._21;
            b[5] = a._22;
            b[6] = a._23;
            b[7] = a._24;
            b[8] = a._31;
            b[9] = a._32;
            b[10] = a._33;
            b[11] = a._34;
            b[12] = a._41;
            b[13] = a._42;
            b[14] = a._43;
            b[15] = a._44;
        }
        return b;
    };
    dMatrix.prototype.Transpose = function () {
        var a = this;
        var m = new dMatrix();
        m._11 = a._11;
        m._12 = a._21;
        m._13 = a._31;
        m._14 = a._41;
        m._21 = a._12;
        m._22 = a._22;
        m._23 = a._32;
        m._24 = a._42;
        m._31 = a._13;
        m._32 = a._23;
        m._33 = a._33;
        m._34 = a._43;
        m._41 = a._14;
        m._42 = a._24;
        m._43 = a._34;
        m._44 = a._44;
        return m;
    };
    dMatrix.prototype.TransposeAppend = function () {
        var a = this;
        var t_12 = a._12;
        var t_13 = a._13;
        var t_14 = a._14;
        var t_21 = a._21;
        var t_23 = a._23;
        var t_24 = a._24;
        var t_31 = a._31;
        var t_32 = a._32;
        var t_34 = a._34;
        var t_41 = a._41;
        var t_42 = a._42;
        var t_43 = a._43;
        a._12 = t_21;
        a._13 = t_31;
        a._14 = t_41;
        a._21 = t_12;
        a._23 = t_32;
        a._24 = t_42;
        a._31 = t_13;
        a._32 = t_23;
        a._34 = t_43;
        a._41 = t_14;
        a._42 = t_24;
        a._43 = t_34;
        return this;
    };
    dMatrix.prototype.TransformFloatArray3 = function (buffer, startIndex) {
        var a = this;
        var x = buffer[startIndex];
        var y = buffer[startIndex + 1];
        var z = buffer[startIndex + 2];
        var _x = x * a._11 + y * a._21 + z * a._31 + a._41;
        var _y = x * a._12 + y * a._22 + z * a._32 + a._42;
        var _z = x * a._13 + y * a._23 + z * a._33 + a._43;
        var _w = x * a._14 + y * a._24 + z * a._34 + a._44;
        if (_w != 0.0) {
            buffer[startIndex] = _x / _w;
            buffer[startIndex + 1] = _y / _w;
            buffer[startIndex + 2] = _z / _w;
        }
        else {
            buffer[startIndex] = _x;
            buffer[startIndex + 1] = _y;
            buffer[startIndex + 2] = _z;
        }
        return this;
    };
    dMatrix.prototype.ToArray = function (buffer) {
        if (buffer === void 0) { buffer = null; }
        var a = this;
        if (buffer == null)
            buffer = dMatrix.s_pMatrixForToArray;
        buffer[0] = a._11;
        buffer[1] = a._12;
        buffer[2] = a._13;
        buffer[3] = a._14;
        buffer[4] = a._21;
        buffer[5] = a._22;
        buffer[6] = a._23;
        buffer[7] = a._24;
        buffer[8] = a._31;
        buffer[9] = a._32;
        buffer[10] = a._33;
        buffer[11] = a._34;
        buffer[12] = a._41;
        buffer[13] = a._42;
        buffer[14] = a._43;
        buffer[15] = a._44;
        return buffer;
    };
    dMatrix.prototype.FromArray = function (arr) {
        var a = this;
        a._11 = arr[0];
        a._12 = arr[1];
        a._13 = arr[2];
        a._14 = arr[3];
        a._21 = arr[4];
        a._22 = arr[5];
        a._23 = arr[6];
        a._24 = arr[7];
        a._31 = arr[8];
        a._32 = arr[9];
        a._33 = arr[10];
        a._34 = arr[11];
        a._41 = arr[12];
        a._42 = arr[13];
        a._43 = arr[14];
        a._44 = arr[15];
        return this;
    };
    dMatrix.prototype.FromArray3x3 = function (arr) {
        var a = this;
        a._11 = arr[0];
        a._12 = arr[1];
        a._13 = arr[2];
        a._14 = 0;
        a._21 = arr[3];
        a._22 = arr[4];
        a._23 = arr[5];
        a._24 = 0;
        a._31 = arr[6];
        a._32 = arr[7];
        a._33 = arr[8];
        a._34 = 0;
        a._41 = 0;
        a._42 = 0;
        a._43 = 0;
        a._44 = 1;
        return this;
    };
    dMatrix.s_pMatrixForAppend = new dMatrix();
    dMatrix.s_pMatrixForToArray = new Array(16);
    dMatrix.s_mulAppendTemp = new dMatrix();
    dMatrix.IDENTITY = new dMatrix();
    dMatrix.s_pRowBuffer = new Array(16);
    return dMatrix;
}(dObject));
var dMeshData = (function (_super) {
    __extends(dMeshData, _super);
    function dMeshData() {
        var _this = _super.call(this) || this;
        _this.m_verticesData = null;
        _this.m_verticesDataFloat = null;
        _this.m_indices = null;
        _this.m_vertexTypeList = null;
        _this.m_nVertexCount = 0;
        _this.m_nIndicesCount = 0;
        _this.vb = null;
        _this.ib = null;
        _this.m_vecDecl = null;
        _this.m_nTriNumber = 0;
        _this.m_nAccessWriteFlag = 0;
        return _this;
    }
    dMeshData.prototype.Release = function () {
        if (this.vb) {
            dInterface.ptr.webgl.deleteBuffer(this.vb);
            this.vb = null;
        }
        if (this.ib) {
            dInterface.ptr.webgl.deleteBuffer(this.ib);
            this.ib = null;
        }
        this.m_vecDecl = null;
    };
    dMeshData.prototype.GetVertexDataVector3 = function (vertexType, at) {
        this.m_verticesData.SetPosition(at * this.GetVertexStrideInByte());
        for (var i = 0; i < this.m_vertexTypeList.length; i++) {
            var type = this.m_vertexTypeList[i];
            if (type == vertexType) {
                var ret = new dVector3();
                ret.x = this.m_verticesData.ReadFloat();
                ret.y = this.m_verticesData.ReadFloat();
                ret.z = this.m_verticesData.ReadFloat();
                return ret;
            }
            else
                this.m_verticesData.Skip(this.GetStrideInByte(type));
        }
        return null;
    };
    dMeshData.prototype.SetVertexDataVector3 = function (vertexType, at, value) {
        this.m_verticesData.SetPosition(at * this.GetVertexStrideInByte());
        for (var i = 0; i < this.m_vertexTypeList.length; i++) {
            var type = this.m_vertexTypeList[i];
            if (type == vertexType) {
                this.m_verticesData.WriteFloat(value.x);
                this.m_verticesData.WriteFloat(value.y);
                this.m_verticesData.WriteFloat(value.z);
                return;
            }
            else
                this.m_verticesData.Skip(this.GetStrideInByte(type));
        }
    };
    dMeshData.prototype.GetVertexDataVector4 = function (vertexType, at) {
        this.m_verticesData.SetPosition(at * this.GetVertexStrideInByte());
        for (var i = 0; i < this.m_vertexTypeList.length; i++) {
            var type = this.m_vertexTypeList[i];
            if (type == vertexType) {
                var ret = new dVector4();
                ret.x = this.m_verticesData.ReadFloat();
                ret.y = this.m_verticesData.ReadFloat();
                ret.z = this.m_verticesData.ReadFloat();
                ret.w = this.m_verticesData.ReadFloat();
                return ret;
            }
            else
                this.m_verticesData.Skip(this.GetStrideInByte(type));
        }
        return null;
    };
    dMeshData.prototype.SetVertexDataVector4 = function (vertexType, at, value) {
        this.m_verticesData.SetPosition(at * this.GetVertexStrideInByte());
        for (var i = 0; i < this.m_vertexTypeList.length; i++) {
            var type = this.m_vertexTypeList[i];
            if (type == vertexType) {
                this.m_verticesData.WriteFloat(value.x);
                this.m_verticesData.WriteFloat(value.y);
                this.m_verticesData.WriteFloat(value.z);
                this.m_verticesData.WriteFloat(value.w);
                return;
            }
            else
                this.m_verticesData.Skip(this.GetStrideInByte(type));
        }
    };
    dMeshData.prototype.GetVertexDataInt = function (vertexType, at) {
        this.m_verticesData.SetPosition(at * this.GetVertexStrideInByte());
        for (var i = 0; i < this.m_vertexTypeList.length; i++) {
            var type = this.m_vertexTypeList[i];
            if (type == vertexType) {
                var ret = this.m_verticesData.ReadInt();
                return ret;
            }
            else
                this.m_verticesData.Skip(this.GetStrideInByte(type));
        }
        return 0;
    };
    dMeshData.prototype.SetVertexDataInt = function (vertexType, at, value) {
        this.m_verticesData.SetPosition(at * this.GetVertexStrideInByte());
        for (var i = 0; i < this.m_vertexTypeList.length; i++) {
            var type = this.m_vertexTypeList[i];
            if (type == vertexType) {
                this.m_verticesData.WriteInt(value);
                return;
            }
            else
                this.m_verticesData.Skip(this.GetStrideInByte(type));
        }
    };
    dMeshData.prototype.SetData = function (vertices, vertexCount, indices, vertexTypeList, AccessWriteFlag, verticesFloat, indexCount) {
        if (AccessWriteFlag === void 0) { AccessWriteFlag = dMeshData.ACCESS_WRITE_TYPE_STATIC_DRAW; }
        if (verticesFloat === void 0) { verticesFloat = null; }
        if (indexCount === void 0) { indexCount = 0; }
        this.m_verticesData = vertices;
        this.m_indices = indices;
        this.m_verticesDataFloat = verticesFloat;
        this.m_nVertexCount = vertexCount;
        this.m_vertexTypeList = vertexTypeList;
        this.m_nAccessWriteFlag = AccessWriteFlag;
        if (indexCount == 0)
            indexCount = indices.length;
        this.m_nIndicesCount = indexCount;
        this.UpdateData();
    };
    dMeshData.prototype.UpdateData = function () {
        if (this.m_verticesData != null)
            this.m_verticesData.SetPosition(0);
        this._SetData(this.m_verticesData == null ? null : this.m_verticesData, this.m_nVertexCount, this.m_indices, this.m_vertexTypeList, this.m_verticesDataFloat, this.m_nIndicesCount);
        if (this.m_verticesData != null)
            this.m_verticesData.SetPosition(0);
    };
    dMeshData.prototype._SetData = function (verticesByteArray, vertexCount, indices, vertexTypeList, verticesDataFloat, nIndicesCount) {
        if (vertexCount == 0)
            return;
        var webgl = dInterface.ptr.webgl;
        if (!webgl)
            return;
        var drawType = webgl.STATIC_DRAW;
        if (this.m_nAccessWriteFlag == dMeshData.ACCESS_WRITE_TYPE_STATIC_DRAW)
            drawType = webgl.STATIC_DRAW;
        else if (this.m_nAccessWriteFlag == dMeshData.ACCESS_WRITE_TYPE_STREAM_DRAW)
            drawType = webgl.STREAM_DRAW;
        else if (this.m_nAccessWriteFlag == dMeshData.ACCESS_WRITE_TYPE_DYNAMIC_DRAW)
            drawType = webgl.DYNAMIC_DRAW;
        if (!this.vb)
            this.vb = webgl.createBuffer();
        webgl.bindBuffer(webgl.ARRAY_BUFFER, this.vb);
        var stride = 0;
        for (var i = 0, n = vertexTypeList.length; i < n; i++) {
            stride += this.GetStrideInByte(vertexTypeList[i]);
        }
        if (verticesDataFloat) {
            if (vertexCount * stride / 4 != verticesDataFloat.length)
                verticesDataFloat = verticesDataFloat.slice(0, vertexCount * stride / 4);
            webgl.bufferData(webgl.ARRAY_BUFFER, new Float32Array(verticesDataFloat), drawType);
        }
        else
            webgl.bufferData(webgl.ARRAY_BUFFER, verticesByteArray.m_pArraybuffer, drawType);
        webgl.bindBuffer(webgl.ARRAY_BUFFER, null);
        if (!this.ib)
            this.ib = webgl.createBuffer();
        webgl.bindBuffer(webgl.ELEMENT_ARRAY_BUFFER, this.ib);
        webgl.bufferData(webgl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices), drawType);
        webgl.bindBuffer(webgl.ELEMENT_ARRAY_BUFFER, null);
        this.m_nTriNumber = nIndicesCount ? nIndicesCount : indices.length;
        if (!this.m_vecDecl) {
            this.m_vecDecl = new Array(vertexTypeList.length);
            var offset = 0;
            for (var i = 0; i < vertexTypeList.length; i++) {
                var decl = new __dVertexDecl();
                switch (vertexTypeList[i] & 0xFF) {
                    case dMeshData.Vertex_Type_Float1:
                        decl.dataNum = 1;
                        decl.nSizePerVertex = 4;
                        decl.nDataType = webgl.FLOAT;
                        decl.nStartOffset = offset;
                        break;
                    case dMeshData.Vertex_Type_Float2:
                        decl.dataNum = 2;
                        decl.nSizePerVertex = 4 * 2;
                        decl.nDataType = webgl.FLOAT;
                        decl.nStartOffset = offset;
                        break;
                    case dMeshData.Vertex_Type_Float3:
                        decl.dataNum = 3;
                        decl.nSizePerVertex = 4 * 3;
                        decl.nDataType = webgl.FLOAT;
                        decl.nStartOffset = offset;
                        break;
                    case dMeshData.Vertex_Type_Float4:
                        decl.dataNum = 4;
                        decl.nSizePerVertex = 4 * 4;
                        decl.nDataType = webgl.FLOAT;
                        decl.nStartOffset = offset;
                        break;
                    case dMeshData.Vertex_Type_Byte4:
                        decl.dataNum = 4;
                        decl.nSizePerVertex = 4;
                        decl.nDataType = webgl.UNSIGNED_BYTE;
                        decl.nStartOffset = offset;
                        break;
                    case dMeshData.Vertex_Type_Color:
                        decl.dataNum = 4;
                        decl.nSizePerVertex = 4;
                        decl.nDataType = webgl.UNSIGNED_BYTE;
                        decl.nStartOffset = offset;
                        decl.bNormalized = true;
                        break;
                }
                this.m_vecDecl[i] = decl;
                offset += decl.nSizePerVertex;
            }
            for (var i = 0; i < this.m_vecDecl.length; i++)
                this.m_vecDecl[i].nStrideInBytePerVertex = offset;
        }
    };
    dMeshData.prototype.ComputeVertexUnIndexed = function () {
        var arr = new dByteArray();
        arr.SetEndian(dMeshData.GetMeshDataEndian());
        this.m_verticesData.SetPosition(0);
        var stride = this.GetVertexStrideInByte();
        var vertices = new Array(this.m_nVertexCount);
        for (var i = 0; i < this.m_nVertexCount; i++) {
            vertices[i] = this.m_verticesData.ReadBinEx(stride);
        }
        for (var i = 0; i < this.m_nIndicesCount; i++) {
            var index = this.m_indices[i];
            arr.WriteBinEx(vertices[index], vertices[index].Size());
        }
        arr.SetPosition(0);
        this.m_verticesData = arr;
        this.m_nVertexCount = this.m_nIndicesCount;
        for (var i = 0; i < this.m_nIndicesCount; i++)
            this.m_indices[i] = i;
        this.UpdateData();
    };
    dMeshData.prototype.ComputeVertexIndexed = function () {
        var arr = new dByteArray();
        arr.SetEndian(dMeshData.GetMeshDataEndian());
        var vertexCount = 0;
        var newIndices = new Array(this.m_nIndicesCount);
        var stride = this.GetVertexStrideInByte();
        var arrVertexHash = new Map();
        var oldVertices = new Array(this.m_nVertexCount);
        var oldVerticesHash = new Array(this.m_nVertexCount);
        this.m_verticesData.SetPosition(0);
        for (var i = 0; i < this.m_nVertexCount; i++) {
            oldVertices[i] = this.m_verticesData.ReadBinEx(stride);
            oldVerticesHash[i] = oldVertices[i].ToBinString();
        }
        var k = 0;
        for (var i = 0; i < this.m_nIndicesCount; i++) {
            var v = oldVertices[this.m_indices[i]];
            var hash = oldVerticesHash[this.m_indices[i]];
            if (arrVertexHash.has(hash)) {
                newIndices[k++] = arrVertexHash.get(hash);
            }
            else {
                var size = arrVertexHash.size;
                newIndices[k++] = size;
                arrVertexHash.set(hash, size);
                arr.WriteBinEx(v, v.Size());
                vertexCount++;
            }
        }
        arr.SetPosition(0);
        this.m_verticesData = arr;
        this.m_nVertexCount = vertexCount;
        this.m_indices = newIndices;
        this.UpdateData();
    };
    dMeshData.GetMeshDataEndian = function () {
        return dByteArray.LITTLE_ENDIAN;
    };
    dMeshData.prototype.GetVerticesData = function () {
        return this.m_verticesData;
    };
    dMeshData.prototype.GetVerticesDataFloat = function () {
        return this.m_verticesDataFloat;
    };
    dMeshData.prototype.GetVertexCount = function () {
        return this.m_nVertexCount;
    };
    dMeshData.prototype.GetIndicesData = function () {
        return this.m_indices;
    };
    dMeshData.prototype.GetVertexTypeList = function () {
        return this.m_vertexTypeList;
    };
    dMeshData.prototype.GetStrideInByte = function (type) {
        switch (type & 0xFF) {
            case dMeshData.Vertex_Type_Float1:
                return 4;
            case dMeshData.Vertex_Type_Float2:
                return 8;
            case dMeshData.Vertex_Type_Float3:
                return 12;
            case dMeshData.Vertex_Type_Float4:
                return 16;
            case dMeshData.Vertex_Type_Byte4:
                return 4;
            case dMeshData.Vertex_Type_Color:
                return 4;
        }
        return 0;
    };
    dMeshData.prototype.GetVertexStrideInByte = function () {
        var ret = 0;
        for (var i = 0; i < this.m_vertexTypeList.length; i++) {
            ret += this.GetStrideInByte(this.m_vertexTypeList[i]);
        }
        return ret;
    };
    dMeshData.prototype._Draw = function (pShader) {
        if (this.m_vecDecl == null || pShader.m_vecAttributeList.length != this.m_vecDecl.length)
            return;
        var webgl = dInterface.ptr.webgl;
        webgl.bindBuffer(webgl.ARRAY_BUFFER, this.vb);
        for (var i = 0; i < pShader.m_vecAttributeList.length; i++)
            webgl.vertexAttribPointer(pShader.m_vecAttributeList[i], this.m_vecDecl[i].dataNum, this.m_vecDecl[i].nDataType, this.m_vecDecl[i].bNormalized, this.m_vecDecl[i].nStrideInBytePerVertex, this.m_vecDecl[i].nStartOffset);
        webgl.bindBuffer(webgl.ELEMENT_ARRAY_BUFFER, this.ib);
        webgl.drawElements(webgl.TRIANGLES, this.m_nTriNumber, webgl.UNSIGNED_SHORT, 0);
        webgl.bindBuffer(webgl.ARRAY_BUFFER, null);
        webgl.bindBuffer(webgl.ELEMENT_ARRAY_BUFFER, null);
    };
    dMeshData.Vertex_Type_Float1 = 1;
    dMeshData.Vertex_Type_Float2 = 2;
    dMeshData.Vertex_Type_Float3 = 3;
    dMeshData.Vertex_Type_Float4 = 4;
    dMeshData.Vertex_Type_Byte4 = 5;
    dMeshData.Vertex_Type_Color = 6;
    dMeshData.Vertex_Type_Pos2 = 0x800 | dMeshData.Vertex_Type_Float2;
    dMeshData.Vertex_Type_Pos3 = 0x100 | dMeshData.Vertex_Type_Float3;
    dMeshData.Vertex_Type_Normal3 = 0x200 | dMeshData.Vertex_Type_Float3;
    dMeshData.Vertex_Type_UV2 = 0x300 | dMeshData.Vertex_Type_Float2;
    dMeshData.Vertex_Type_UV3 = 0x400 | dMeshData.Vertex_Type_Float3;
    dMeshData.Vertex_Type_BoneIndex1 = 0x500 | dMeshData.Vertex_Type_Byte4;
    dMeshData.Vertex_Type_Weights4 = 0x600 | dMeshData.Vertex_Type_Float4;
    dMeshData.Vertex_Type_Color4 = 0x700 | dMeshData.Vertex_Type_Float4;
    dMeshData.ACCESS_WRITE_TYPE_STATIC_DRAW = 0;
    dMeshData.ACCESS_WRITE_TYPE_DYNAMIC_DRAW = 1;
    dMeshData.ACCESS_WRITE_TYPE_STREAM_DRAW = 2;
    return dMeshData;
}(dObject));
var __dVertexDecl = (function () {
    function __dVertexDecl() {
        this.dataNum = 0;
        this.nSizePerVertex = 0;
        this.nDataType = 0;
        this.bNormalized = false;
        this.nStrideInBytePerVertex = 0;
        this.nStartOffset = 0;
    }
    return __dVertexDecl;
}());
var dRect = (function (_super) {
    __extends(dRect, _super);
    function dRect(_left, _top, _right, _bottom) {
        if (_left === void 0) { _left = 0; }
        if (_top === void 0) { _top = 0; }
        if (_right === void 0) { _right = 0; }
        if (_bottom === void 0) { _bottom = 0; }
        var _this = _super.call(this) || this;
        _this.left = _left;
        _this.top = _top;
        _this.right = _right;
        _this.bottom = _bottom;
        return _this;
    }
    dRect.prototype.SetValue = function (_left, _top, _right, _bottom) {
        if (_left === void 0) { _left = 0; }
        if (_top === void 0) { _top = 0; }
        if (_right === void 0) { _right = 0; }
        if (_bottom === void 0) { _bottom = 0; }
        this.left = _left;
        this.top = _top;
        this.right = _right;
        this.bottom = _bottom;
        return this;
    };
    dRect.prototype.SetPosSize = function (_left, _top, width, height) {
        this.left = _left;
        this.top = _top;
        this.right = this.left + width;
        this.bottom = this.top + height;
        return this;
    };
    dRect.prototype.SetCenterSize = function (cx, cy, width, height) {
        this.left = cx - width / 2;
        this.top = cy - height / 2;
        this.right = this.left + width;
        this.bottom = this.top + height;
        return this;
    };
    dRect.prototype.SetWidth = function (width) {
        this.right = this.left + width;
        return this;
    };
    dRect.prototype.SetHeight = function (height) {
        this.bottom = this.top + height;
        return this;
    };
    dRect.prototype.TranslationAppend = function (x, y) {
        this.left += x;
        this.right += x;
        this.top += y;
        this.bottom += y;
        return this;
    };
    dRect.prototype.Copy = function (pFrom) {
        this.left = pFrom.left;
        this.top = pFrom.top;
        this.right = pFrom.right;
        this.bottom = pFrom.bottom;
        return this;
    };
    dRect.prototype.Width = function () {
        return this.right - this.left;
    };
    dRect.prototype.Height = function () {
        return this.bottom - this.top;
    };
    dRect.prototype.Collect = function (r2, collRectOut) {
        if (collRectOut === void 0) { collRectOut = null; }
        if (this.right < r2.left || r2.right < this.left || r2.bottom < this.top || r2.top > this.bottom)
            return false;
        else if (collRectOut) {
            collRectOut.bottom = dMath.Min(r2.bottom, this.bottom);
            collRectOut.top = dMath.Max(this.top, r2.top);
            collRectOut.right = dMath.Min(r2.right, this.right);
            collRectOut.left = dMath.Max(this.left, r2.left);
        }
        return true;
    };
    dRect.prototype.CollectPoint = function (x, y) {
        return this.left <= x && x <= this.right && this.top <= y && y <= this.bottom;
    };
    dRect.prototype.CollectCircle = function (arcOx, arcOy, arcR) {
        var rectX = this.left;
        var rectY = this.top;
        var rectW = this.Width();
        var rectH = this.Height();
        if (((rectX - arcOx) * (rectX - arcOx) + (rectY - arcOy) * (rectY - arcOy)) <= arcR * arcR)
            return true;
        if (((rectX + rectW - arcOx) * (rectX + rectW - arcOx) + (rectY - arcOy) * (rectY - arcOy)) <= arcR * arcR)
            return true;
        if (((rectX - arcOx) * (rectX - arcOx) + (rectY + rectH - arcOy) * (rectY + rectH - arcOy)) <= arcR * arcR)
            return true;
        if (((rectX + rectW - arcOx) * (rectX + rectW - arcOx) + (rectY + rectH - arcOy) * (rectY + rectH - arcOy)) <= arcR * arcR)
            return true;
        var minDisX = 0;
        if (arcOy >= rectY && arcOy <= rectY + rectH) {
            if (arcOx < rectX)
                minDisX = rectX - arcOx;
            else if (arcOx > rectX + rectW)
                minDisX = arcOx - rectX - rectW;
            else
                return true;
            if (minDisX <= arcR)
                return true;
        }
        var minDisY = 0;
        if (arcOx >= rectX && arcOx <= rectX + rectW) {
            if (arcOy < rectY)
                minDisY = rectY - arcOy;
            else if (arcOy > rectY + rectH)
                minDisY = arcOy - rectY - rectH;
            else
                return true;
            if (minDisY <= arcR)
                return true;
        }
        return false;
    };
    dRect.prototype.RowData = function () {
        return [this.left, this.top, this.right, this.bottom];
    };
    dRect.prototype.isZero = function () {
        return this.left == 0 && this.top == 0 && this.right == 0 && this.bottom == 0;
    };
    dRect.prototype.OriginX = function () {
        return this.right - this.left;
    };
    dRect.prototype.OriginY = function () {
        return this.bottom - this.top;
    };
    dRect.prototype.MakeValidSize = function () {
        if (this.left > this.right) {
            var tmp = this.right;
            this.right = this.left;
            this.left = tmp;
        }
        if (this.top > this.bottom) {
            var tmp = this.bottom;
            this.bottom = this.top;
            this.top = tmp;
        }
        return this;
    };
    dRect.prototype.AddAppend = function (rc) {
        this.left += rc.left;
        this.top += rc.top;
        this.right += rc.right;
        this.bottom += rc.bottom;
        return this;
    };
    dRect.prototype.SubAppend = function (rc) {
        this.left -= rc.left;
        this.top -= rc.top;
        this.right -= rc.right;
        this.bottom -= rc.bottom;
        return this;
    };
    dRect.prototype.Equals = function (rc) {
        if (!rc)
            return false;
        return this.left == rc.left && this.top == rc.top && this.right == rc.right && this.bottom == rc.bottom;
    };
    dRect.RectEquals = function (rc1, rc2) {
        if (!rc1 && !rc2)
            return true;
        if (!rc1 || !rc2)
            return false;
        return rc1.Equals(rc2);
    };
    dRect.prototype.GetCenterX = function () {
        return (this.right - this.left) / 2 + this.left;
    };
    dRect.prototype.GetCenterY = function () {
        return (this.bottom - this.top) / 2 + this.top;
    };
    dRect.prototype.GetCenter = function () {
        return new dVector2(this.GetCenterX(), this.GetCenterY());
    };
    dRect.prototype.ToStringBuffer = function (split) {
        if (split === void 0) { split = ","; }
        return this.left + split + this.top + split + this.right + split + this.bottom;
    };
    dRect.prototype.FromString = function (value, split) {
        if (split === void 0) { split = ","; }
        var s = value.split(split);
        this.left = dMath.ParseFloat(s[0]);
        this.top = dMath.ParseFloat(s[1]);
        this.right = dMath.ParseFloat(s[2]);
        this.bottom = dMath.ParseFloat(s[3]);
        return this;
    };
    dRect.prototype.Clip = function (rc) {
        this.left = dMath.Max(this.left, rc.left);
        this.top = dMath.Max(this.top, rc.top);
        this.right = dMath.Min(this.right, rc.right);
        this.bottom = dMath.Min(this.bottom, rc.bottom);
        if (this.right < this.left)
            this.right = this.left;
        if (this.bottom < this.top)
            this.bottom = this.top;
    };
    dRect.prototype.Merge = function (rc) {
        if (this.left > rc.left)
            this.left = rc.left;
        if (this.right < rc.right)
            this.right = rc.right;
        if (this.top > rc.top)
            this.top = rc.top;
        if (this.bottom < rc.bottom)
            this.bottom = rc.bottom;
    };
    dRect.ZERO = new dRect();
    return dRect;
}(dObject));
var dSocket = (function (_super) {
    __extends(dSocket, _super);
    function dSocket() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    dSocket.RequestHttp = function (url, pResponse, method, postData) {
        if (pResponse === void 0) { pResponse = null; }
        if (method === void 0) { method = "get"; }
        if (postData === void 0) { postData = null; }
        dInterface.ptr.RequestHttp(url, pResponse, method, postData);
    };
    return dSocket;
}(dObject));
var dSound = (function (_super) {
    __extends(dSound, _super);
    function dSound() {
        return _super.call(this) || this;
    }
    dSound.PlaySound = function (fileName) {
        if (dSound.s_globalSoundVolume > 0)
            dInterface.ptr.PlayAudio(fileName, 0, false, dSound.s_globalSoundVolume);
    };
    dSound.PlayMusic = function (fileName, loop, position, volume) {
        if (loop === void 0) { loop = true; }
        if (position === void 0) { position = 0; }
        if (volume === void 0) { volume = 1; }
        if (dSound.s_strCurMusicFileName == fileName)
            return;
        if (dSound.s_pMusicPlayer)
            dSound.StopMusic();
        dSound.s_strCurMusicFileName = fileName;
        dSound.s_pMusicPlayer = dInterface.ptr.PlayAudio(fileName, position, loop, volume * dSound.s_globalMusicVolume);
        dSound.s_pMusicPlayer.m_curVolume = volume;
    };
    dSound.StopMusic = function () {
        dSound.s_strCurMusicFileName = "";
        if (dSound.s_pMusicPlayer) {
            dSound.s_pMusicPlayer.stop();
            dSound.s_pMusicPlayer = null;
        }
    };
    dSound.SetGlobalSoundVolume = function (volume) {
        dSound.s_globalSoundVolume = volume;
    };
    dSound.SetGlobalMusicVolume = function (volume) {
        dSound.s_globalMusicVolume = volume;
        if (dSound.s_pMusicPlayer)
            dSound.s_pMusicPlayer.volume = dSound.s_pMusicPlayer.m_curVolume * dSound.s_globalMusicVolume;
    };
    dSound.s_pMusicPlayer = null;
    dSound.s_globalSoundVolume = 1;
    dSound.s_globalMusicVolume = 1;
    dSound.s_strCurMusicFileName = "";
    return dSound;
}(dObject));
var dStringUtils = (function () {
    function dStringUtils() {
    }
    dStringUtils.NonNull = function (str) {
        if (!str)
            return "";
        return str;
    };
    dStringUtils.SplitFileName = function (strFileName) {
        if (strFileName == null)
            return ["", "", "", ""];
        strFileName = dStringUtils.ReplaceAll(strFileName, "\\", "/");
        var vecDriver = dStringUtils.HalfStringFind(strFileName, ":", -2, false);
        var vecPath = dStringUtils.HalfStringFindLast(vecDriver[1], "/", -1, false);
        var vecFileName = dStringUtils.HalfStringFindLast(vecPath[1], ".", 0, true);
        return [vecDriver[0], vecPath[0], vecFileName[0], vecFileName[1]];
    };
    dStringUtils.HalfStringFind = function (str, find, nFindStringInLeft, bNoFindPushFirst) {
        var left = (nFindStringInLeft < 0) ? -nFindStringInLeft : 0;
        var right = (nFindStringInLeft > 0) ? nFindStringInLeft : 0;
        var ret = str.indexOf(find);
        if (ret != -1)
            return [str.substring(0, ret + left), str.substring(ret + left + right, str.length)];
        else if (bNoFindPushFirst)
            return [str, ""];
        else
            return ["", str];
    };
    dStringUtils.HalfStringFindLast = function (str, find, nFindStringInLeft, bNoFindPushFirst) {
        var left = (nFindStringInLeft < 0) ? -nFindStringInLeft : 0;
        var right = (nFindStringInLeft > 0) ? nFindStringInLeft : 0;
        var ret = str.lastIndexOf(find);
        if (ret != -1)
            return [str.substring(0, ret + left), str.substring(ret + left + right, str.length)];
        else if (bNoFindPushFirst)
            return [str, ""];
        else
            return ["", str];
    };
    dStringUtils.ReplaceAll = function (str, strFind, strReplace) {
        var indexOf;
        while ((indexOf = str.indexOf(strFind)) != -1) {
            str = str.substring(0, indexOf) + strReplace + str.substring(indexOf + strFind.length, str.length);
        }
        return str;
    };
    dStringUtils.FormatInt = function (t, nForceBit) {
        var str = dMath.ToInt(t).toString();
        if (nForceBit > 0) {
            for (var i = str.length; i < nForceBit; i++)
                str = "0" + str;
        }
        return str;
    };
    dStringUtils.FormatNumber = function (f, nAfterDot, erase0) {
        if (erase0 === void 0) { erase0 = false; }
        if (nAfterDot == 0)
            return String(dMath.ToInt(f));
        var str = String(f);
        if (str.indexOf(".") == -1 && !erase0) {
            if (nAfterDot > 0)
                str += ".";
            for (var i = 0; i < nAfterDot; i++)
                str += "0";
            return str;
        }
        var ret = str.substring(0, str.indexOf(".") + nAfterDot + 1);
        if (!erase0) {
            for (var i = ret.length - ret.indexOf("."); i <= nAfterDot; i++)
                ret += "0";
        }
        else {
            while (ret.charCodeAt(ret.length - 1) == '0'.charCodeAt(0))
                ret = ret.substring(0, ret.length - 1);
            if (ret.charCodeAt(ret.length - 1) == '.'.charCodeAt(0))
                ret = ret.substring(0, ret.length - 1);
        }
        return ret;
    };
    dStringUtils.FormatString = function (dst, args) {
        if (args == null)
            return dst;
        var ret = "";
        for (var i = 0, j = 0; i < dst.length; i++) {
            if (dst.charCodeAt(i) != '%'.charCodeAt(0)) {
                ret += dst.charAt(i);
            }
            else if (j < args.length) {
                ret += args[j++];
            }
        }
        return ret;
    };
    dStringUtils.isNullOrEmpty = function (str) {
        return str == undefined || str == null || str == "";
    };
    dStringUtils.FourCC = function (a, b, c, d, nEndian) {
        if (nEndian === void 0) { nEndian = dByteArray.BIG_ENDIAN; }
        var c1 = a.charCodeAt(0);
        var c2 = b.charCodeAt(0);
        var c3 = c.charCodeAt(0);
        var c4 = d.charCodeAt(0);
        if (nEndian == dByteArray.BIG_ENDIAN)
            return (c1 << 24 | c2 << 16 | c3 << 8 | c4);
        else
            return (c4 << 24 | c3 << 16 | c2 << 8 | c1);
        return 0;
    };
    dStringUtils.GetFileNameExt = function (strFileName, bWithDot) {
        if (bWithDot === void 0) { bWithDot = true; }
        if (strFileName.lastIndexOf(".") != -1) {
            return strFileName.substring(strFileName.lastIndexOf(".") + (bWithDot ? 0 : 1), strFileName.length);
        }
        return "";
    };
    dStringUtils.GetFileNamePath = function (strFileName, bWithSlash) {
        if (bWithSlash === void 0) { bWithSlash = false; }
        if (strFileName.indexOf("/") != -1)
            return strFileName.substring(0, strFileName.lastIndexOf("/") + Number(bWithSlash));
        return "";
    };
    dStringUtils.GetFileNameName = function (strFileName, bWithExt) {
        if (bWithExt === void 0) { bWithExt = true; }
        if (strFileName.indexOf("/") != -1)
            strFileName = strFileName.substring(strFileName.lastIndexOf("/") + 1, strFileName.length);
        if (!bWithExt && strFileName.lastIndexOf(".") != -1)
            strFileName = strFileName.substring(0, strFileName.lastIndexOf("."));
        return strFileName;
    };
    dStringUtils.SplitStringEquals = function (strSource, strSplit, bKeyWithoutSpace, bValueWithoutSpace, strEquals) {
        if (strSplit === void 0) { strSplit = ","; }
        if (bKeyWithoutSpace === void 0) { bKeyWithoutSpace = false; }
        if (bValueWithoutSpace === void 0) { bValueWithoutSpace = false; }
        if (strEquals === void 0) { strEquals = "="; }
        var ret = new Map();
        if (strSource == null || strSource == "")
            return ret;
        var m = strSource.split(strSplit);
        for (var i = 0, n = m.length; i < n; i++) {
            var m2 = m[i].split(strEquals, 2);
            if (m2.length > 2) {
                for (var j = 2; j < m2.length; j++)
                    m2[1] += "=" + m2[j];
            }
            if (m2[0] != null && m2[0] != "") {
                var key = m2[0];
                var value = m2[1];
                if (bKeyWithoutSpace) {
                    while (key.length && key.charCodeAt(0) <= 32)
                        key = key.substring(1, key.length);
                    while (key.length && key.charCodeAt(key.length - 1) <= 32)
                        key = key.substring(0, key.length - 1);
                }
                if (bValueWithoutSpace) {
                    while (value.length && value.charCodeAt(0) <= 32)
                        value = value.substring(1, value.length);
                    while (value.length && value.charCodeAt(value.length - 1) <= 32)
                        value = value.substring(0, value.length - 1);
                }
                ret.set(key, value);
            }
        }
        return ret;
    };
    dStringUtils.StringToNumber = function (str) {
        for (var i = 0; i < str.length; i++) {
            var code = str.charCodeAt(i);
            if (code >= '0'.charCodeAt(0) && code <= '9'.charCodeAt(0) || code == '-'.charCodeAt(0) && i == 0)
                continue;
            str = str.substring(0, i);
            break;
        }
        return Number(str);
    };
    dStringUtils.InswertStr = function (src, at, insert) {
        return src.substring(0, at) + insert + src.substring(at, src.length);
    };
    dStringUtils.StringToBoolean = function (str) {
        if (!str || str == "0" || str.toLowerCase() == "false")
            return false;
        return true;
    };
    dStringUtils.CODE_PAGE_UTF8 = 0;
    dStringUtils.CODE_PAGE_UNICODE = 1;
    dStringUtils.CODE_PAGE_GBK = 2;
    dStringUtils.CODE_PAGE_SHIFTJIS = 3;
    dStringUtils.CODE_PAGE_JIS_X_0201 = 4;
    dStringUtils.dLANG_ENGLISH = 120;
    dStringUtils.dLANG_CHINESE_SIMPLIFIED = 110;
    return dStringUtils;
}());
var dTimer = (function (_super) {
    __extends(dTimer, _super);
    function dTimer(pSprite) {
        if (pSprite === void 0) { pSprite = null; }
        var _this = _super.call(this) || this;
        _this.m_pSpriteForStop = null;
        _this.m_nLastCheckSpriteTime = 0;
        _this.m_nRepeatCountEnd = 0;
        _this.m_nRepeatCountAdd = 0;
        _this.m_nRepeatCountAddStep = 0;
        _this.m_bRunning = false;
        _this.m_bPause = false;
        _this.m_nCallTimes = 1;
        _this.m_nDelay = 0;
        _this.m_pBaseObject = null;
        _this.m_onTimerCallback = null;
        _this.m_nTargetTick = 0;
        _this.m_nLastApplyTick = 0;
        _this.m_pSpriteForStop = pSprite;
        return _this;
    }
    dTimer.prototype.SetCallTimes = function (data) {
        this.m_nCallTimes = data;
        return this;
    };
    dTimer.prototype.GetCallTimes = function () {
        return this.m_nCallTimes;
    };
    dTimer.prototype.Stop = function () {
        this.m_bRunning = false;
        if (this.m_pBaseObject != null) {
            dInterface.ptr.m_vecTimerWillDelete.push(this.m_pBaseObject);
            this.m_pBaseObject = null;
        }
        this.m_nRepeatCountEnd = 0;
        this.m_nRepeatCountAdd = 0;
        this.m_nRepeatCountAddStep = 0;
    };
    dTimer.prototype.isRunning = function () {
        return this.m_bRunning;
    };
    dTimer.prototype.Apply = function (fTimeElapse) {
        if (fTimeElapse === void 0) { fTimeElapse = 0; }
        if (!this.m_bRunning)
            return;
        var bStop = false;
        for (var i = 0; i < this.m_nCallTimes; i++) {
            this.m_nRepeatCountAdd += this.m_nRepeatCountAddStep;
            if (this.m_nRepeatCountEnd > 0 && this.m_nRepeatCountAdd - this.m_nRepeatCountAddStep >= this.m_nRepeatCountEnd) {
                this.Stop();
                bStop = true;
                break;
            }
            else {
                if (!bStop && this.m_onTimerCallback != null) {
                    if (this.m_pSpriteForStop == null || !this.m_pSpriteForStop.isDestroyed())
                        this.m_onTimerCallback(this, this.m_nRepeatCountAdd - this.m_nRepeatCountAddStep, fTimeElapse);
                }
                if (bStop)
                    break;
            }
        }
        if (this.m_pSpriteForStop != null) {
            if (this.m_pSpriteForStop.isDestroyed()) {
                this.Stop();
                bStop = true;
            }
            else {
                var time = dTimer.GetTickCount();
                if (this.m_nLastCheckSpriteTime == 0)
                    this.m_nLastCheckSpriteTime = time;
                if (time > this.m_nLastCheckSpriteTime + 1000) {
                    if (!this.m_pSpriteForStop.isInRoot()) {
                        this.Stop();
                    }
                    this.m_nLastCheckSpriteTime = time;
                }
            }
        }
    };
    dTimer.prototype.SetDelay = function (delay) {
        this.m_nDelay = delay;
    };
    dTimer.prototype.Pause = function () {
        this.m_bPause = true;
    };
    dTimer.prototype.Resume = function () {
        this.m_bPause = false;
    };
    dTimer.prototype.isPause = function () {
        return this.m_bPause;
    };
    dTimer.prototype.SetRepeatCount = function (repeatCount) {
        this.m_nRepeatCountEnd = repeatCount;
        return this;
    };
    dTimer.prototype.Restart = function () {
        this.m_nLastApplyTick = dInterface.ptr.GetRenderTick();
        this.m_nTargetTick = this.m_nLastApplyTick + this.m_nDelay;
    };
    dTimer.prototype.GetRepeatCount = function () {
        return this.m_nRepeatCountEnd;
    };
    dTimer.prototype.isLastRepeat = function () {
        return this.m_nRepeatCountAdd >= this.m_nRepeatCountEnd;
    };
    dTimer.prototype.Create = function (delay, repeatCount, onTimer) {
        var _this = this;
        this.Stop();
        this.m_bRunning = true;
        this.m_nRepeatCountEnd = repeatCount;
        this.m_nRepeatCountAddStep = 1;
        this.m_onTimerCallback = onTimer;
        this.m_nDelay = delay;
        this.m_nLastApplyTick = dInterface.ptr.GetRenderTick();
        this.m_nTargetTick = this.m_nLastApplyTick + delay;
        if (this.m_pBaseObject == null) {
            this.m_pBaseObject = function (elapseTime, curTick) {
                if (curTick >= _this.m_nTargetTick) {
                    var fElapse = (curTick - _this.m_nLastApplyTick) / 1000;
                    _this.m_nLastApplyTick = curTick;
                    if (_this.m_nDelay > 0) {
                        var sub = (curTick - _this.m_nTargetTick) % _this.m_nDelay;
                        _this.m_nTargetTick = curTick + _this.m_nDelay - sub;
                    }
                    else {
                        _this.m_nTargetTick = curTick;
                    }
                    _this.Apply(dMath.Min(fElapse, dTimer.MAX_ELAPSE_TIME));
                }
            };
            dInterface.ptr.m_vecTimer.push(this.m_pBaseObject);
        }
        return this;
    };
    dTimer.GetTickCount = function () {
        return new Date().getTime() - dTimer.__g_nFirstGetTickCountTime;
    };
    dTimer.SetTimeScale = function (fScale) {
    };
    dTimer.GetTimeScale = function () {
        return 0;
    };
    dTimer.PauseAllTimer = function (bPause) {
    };
    dTimer.SetGlobalSleep = function (time) {
    };
    dTimer.__g_nFirstGetTickCountTime = new Date().getTime();
    dTimer.MAX_ELAPSE_TIME = 1;
    return dTimer;
}(dObject));
var dVector2 = (function (_super) {
    __extends(dVector2, _super);
    function dVector2(x, y) {
        if (x === void 0) { x = 0; }
        if (y === void 0) { y = 0; }
        var _this = _super.call(this) || this;
        _this.x = x;
        _this.y = y;
        return _this;
    }
    dVector2.prototype.SetValue = function (_x, _y) {
        if (_x === void 0) { _x = 0.0; }
        if (_y === void 0) { _y = 0.0; }
        this.x = _x;
        this.y = _y;
        return this;
    };
    dVector2.prototype.Copy = function (t) {
        this.x = t.x;
        this.y = t.y;
        return this;
    };
    dVector2.prototype.Equals = function (p) {
        if (p == null)
            return false;
        return this.x == p.x && this.y == p.y;
    };
    dVector2.prototype.ToStringBuffer = function (split) {
        if (split === void 0) { split = " "; }
        return this.x + split + this.y;
    };
    dVector2.prototype.FromString = function (value, split) {
        if (split === void 0) { split = " "; }
        var arr = value.split(split);
        this.x = dMath.ParseFloat(arr[0]);
        this.y = dMath.ParseFloat(arr[1]);
        return this;
    };
    dVector2.prototype.Transform = function (mat) {
        var _x = this.x * mat._11 + this.y * mat._21 + mat._41;
        var _y = this.x * mat._12 + this.y * mat._22 + mat._42;
        var _w = this.x * mat._14 + this.y * mat._24 + mat._44;
        if (_w != 0.0) {
            this.x = _x / _w;
            this.y = _y / _w;
        }
        else {
            this.x = _x;
            this.y = _y;
        }
        return this;
    };
    dVector2.prototype.AddAppend = function (v) {
        this.x += v.x;
        this.y += v.y;
        return this;
    };
    dVector2.prototype.AddAppendF = function (f) {
        this.x += f;
        this.y += f;
        return this;
    };
    dVector2.prototype.SubAppend = function (v) {
        this.x -= v.x;
        this.y -= v.y;
        return this;
    };
    dVector2.prototype.SubAppendF = function (f) {
        this.x -= f;
        this.y -= f;
        return this;
    };
    dVector2.prototype.MulAppendF = function (f) {
        this.x *= f;
        this.y *= f;
        return this;
    };
    dVector2.prototype.DivAppendF = function (f) {
        if (f == 0.0) {
            this.x = 0.0;
            this.y = 0.0;
        }
        else {
            this.x /= f;
            this.y /= f;
        }
        return this;
    };
    dVector2.prototype.Add = function (v) {
        return new dVector2(this.x + v.x, this.y + v.y);
    };
    dVector2.prototype.AddF = function (f) {
        return new dVector2(this.x + f, this.y + f);
    };
    dVector2.prototype.Sub = function (v) {
        return new dVector2(this.x - v.x, this.y - v.y);
    };
    dVector2.prototype.SubF = function (f) {
        return new dVector2(this.x - f, this.y - f);
    };
    dVector2.prototype.MulF = function (f) {
        return new dVector2(this.x * f, this.y * f);
    };
    dVector2.prototype.DivF = function (f) {
        if (f == 0.0)
            return new dVector2();
        return new dVector2(this.x / f, this.y / f);
    };
    dVector2.prototype.Cross = function (p) {
        return new dVector2(this.x * p.y - p.x * this.y);
    };
    dVector2.prototype.Length = function () {
        return dMath.Sqrt(this.x * this.x + this.y * this.y);
    };
    dVector2.prototype.LengthTo = function (p) {
        var ret = dMath.Sqrt((this.x - p.x) * (this.x - p.x) + (this.y - p.y) * (this.y - p.y));
        return ret;
    };
    dVector2.prototype.Normalize = function () {
        var l = this.Length();
        if (l != 0.0) {
            this.x /= l;
            this.y /= l;
        }
        return this;
    };
    dVector2.prototype.Dot = function (p) {
        return this.x * p.x + this.y * p.y;
    };
    dVector2.prototype.WriteToBin = function (to) {
        to.WriteFloat(this.x);
        to.WriteFloat(this.y);
    };
    dVector2.prototype.ReadFromBin = function (data) {
        this.x = data.ReadFloat();
        this.y = data.ReadFloat();
        return this;
    };
    dVector2.prototype.ToAngle = function (vTo) {
        if (vTo === void 0) { vTo = null; }
        return dMath.RadianToAngle(this.ToRadian(vTo));
    };
    dVector2.prototype.FromAngle = function (v) {
        return this.FromRadian(dMath.AngleToRadian(v));
    };
    dVector2.prototype.FromRadian = function (v) {
        this.x = dMath.Sin(v);
        this.y = -dMath.Cos(v);
        return this;
    };
    dVector2.prototype.ToRadian = function (vTo) {
        if (vTo === void 0) { vTo = null; }
        if (vTo == null)
            vTo = new dVector2(0, 1);
        else {
            return dMath.AngleToRadian(dMath.SubAngle(dMath.RadianToAngle(this.ToRadian()), dMath.RadianToAngle(vTo.ToRadian())));
        }
        var fRotAngle = 0.0;
        if (dMath.Abs(this.x) < 0.00001) {
            if (this.y < 0.0)
                fRotAngle = 0;
            else
                fRotAngle = dMath.dPI;
        }
        else {
            fRotAngle = dMath.dPI - dMath.Acos(this.Dot(vTo));
            if (this.x < 0)
                fRotAngle = -fRotAngle;
        }
        return fRotAngle;
    };
    dVector2.prototype.ToVector3 = function () {
        return new dVector3(this.x, this.y, 0);
    };
    dVector2.ZERO = new dVector2();
    return dVector2;
}(dObject));
var dVector3 = (function (_super) {
    __extends(dVector3, _super);
    function dVector3(x, y, z) {
        if (x === void 0) { x = 0; }
        if (y === void 0) { y = 0; }
        if (z === void 0) { z = 0; }
        var _this = _super.call(this) || this;
        _this.x = x;
        _this.y = y;
        _this.z = z;
        return _this;
    }
    dVector3.prototype.SetValue = function (_x, _y, _z) {
        if (_x === void 0) { _x = 0.0; }
        if (_y === void 0) { _y = 0.0; }
        if (_z === void 0) { _z = 0.0; }
        this.x = _x;
        this.y = _y;
        this.z = _z;
        return this;
    };
    dVector3.prototype.Copy = function (t) {
        if (t != null) {
            this.x = t.x;
            this.y = t.y;
            this.z = t.z;
        }
        return this;
    };
    dVector3.prototype.ToStringBuffer = function (split) {
        if (split === void 0) { split = " "; }
        return this.x + split + this.y + split + this.z;
    };
    dVector3.prototype.FromString = function (value, split) {
        if (split === void 0) { split = " "; }
        var arr = value.split(split);
        this.x = dMath.ParseFloat(arr[0]);
        this.y = dMath.ParseFloat(arr[1]);
        this.z = dMath.ParseFloat(arr[2]);
        return this;
    };
    dVector3.prototype.GetAt = function (at) {
        if (at == 0)
            return this.x;
        if (at == 1)
            return this.y;
        if (at == 2)
            return this.z;
        return 0.0;
    };
    dVector3.prototype.SetAt = function (at, data) {
        if (at == 0)
            this.x = data;
        if (at == 1)
            this.y = data;
        if (at == 2)
            this.z = data;
        return this;
    };
    dVector3.Vec3Sub = function (_out, v1, v2) {
        _out.x = v1.x - v2.x;
        _out.y = v1.y - v2.y;
        _out.z = v1.z - v2.z;
        return _out;
    };
    dVector3.prototype.Equals = function (v) {
        return this.x == v.x && this.y == v.y && this.z == v.z;
    };
    dVector3.prototype.EqualsIgnore = function (v, ignore) {
        if (ignore === void 0) { ignore = 0.0001; }
        return dMath.FloatEquals(this.x, v.x, ignore) && dMath.FloatEquals(this.y, v.y, ignore) && dMath.FloatEquals(this.z, v.z, ignore);
    };
    dVector3.prototype.NotEquals = function (v) {
        return !(this.Equals(v));
    };
    dVector3.prototype.AddAppend = function (v) {
        this.x += v.x;
        this.y += v.y;
        this.z += v.z;
        return this;
    };
    dVector3.prototype.AddAppendF = function (f) {
        this.x += f;
        this.y += f;
        this.z += f;
        return this;
    };
    dVector3.prototype.SubAppend = function (v) {
        this.x -= v.x;
        this.y -= v.y;
        this.z -= v.z;
        return this;
    };
    dVector3.prototype.SubAppendF = function (f) {
        this.x -= f;
        this.y -= f;
        this.z -= f;
        return this;
    };
    dVector3.prototype.MulAppend = function (v) {
        this.x *= v.x;
        this.y *= v.y;
        this.z *= v.z;
        return this;
    };
    dVector3.prototype.MulAppendF = function (f) {
        this.x *= f;
        this.y *= f;
        this.z *= f;
        return this;
    };
    dVector3.prototype.DivAppendF = function (f) {
        if (f == 0.0) {
            this.x = 0.0;
            this.y = 0.0;
            this.z = 0.0;
        }
        else {
            this.x /= f;
            this.y /= f;
            this.z /= f;
        }
        return this;
    };
    dVector3.prototype.Add = function (v) {
        return new dVector3(this.x + v.x, this.y + v.y, this.z + v.z);
    };
    dVector3.prototype.AddF = function (f) {
        return new dVector3(this.x + f, this.y + f, this.z + f);
    };
    dVector3.prototype.Sub = function (v) {
        return new dVector3(this.x - v.x, this.y - v.y, this.z - v.z);
    };
    dVector3.prototype.SubF = function (f) {
        return new dVector3(this.x - f, this.y - f, this.z - f);
    };
    dVector3.prototype.MulF = function (f) {
        return new dVector3(this.x * f, this.y * f, this.z * f);
    };
    dVector3.prototype.DivF = function (f) {
        if (f == 0.0)
            return new dVector3();
        return new dVector3(this.x / f, this.y / f, this.z / f);
    };
    dVector3.prototype.Cross = function (p) {
        return new dVector3(this.y * p.z - p.y * this.z, this.z * p.x - p.z * this.x, this.x * p.y - p.x * this.y);
    };
    dVector3.prototype.CrossAppend = function (p) {
        var xx = this.y * p.z - p.y * this.z;
        var yy = this.z * p.x - p.z * this.x;
        var zz = this.x * p.y - p.x * this.y;
        this.SetValue(xx, yy, zz);
        return this;
    };
    dVector3.Vec3Cross = function (_out, v1, v2) {
        _out.x = v1.y * v2.z - v2.y * v1.z;
        _out.y = v1.z * v2.x - v2.z * v1.x;
        _out.z = v1.x * v2.y - v2.x * v1.y;
        return _out;
    };
    dVector3.prototype.isZero = function () {
        return this.x == 0 && this.y == 0 && this.z == 0;
    };
    dVector3.prototype.Length = function () {
        return dMath.Sqrt(this.x * this.x + this.y * this.y + this.z * this.z);
    };
    dVector3.prototype.LengthTo = function (p) {
        return dMath.Sqrt((this.x - p.x) * (this.x - p.x) + (this.y - p.y) * (this.y - p.y) + (this.z - p.z) * (this.z - p.z));
    };
    dVector3.prototype.SquareMagnitude = function () {
        return this.x * this.x + this.y * this.y + this.z * this.z;
    };
    dVector3.prototype.Normalize = function () {
        var l = this.Length();
        if (l != 0.0) {
            this.x /= l;
            this.y /= l;
            this.z /= l;
        }
        return this;
    };
    dVector3.prototype.NormalizeToNewVector = function () {
        return new dVector3().Copy(this).Normalize();
    };
    dVector3.prototype.Dot = function (p) {
        return this.x * p.x + this.y * p.y + this.z * p.z;
    };
    dVector3.Vec3Dot = function (a, p) {
        return a.x * p.x + a.y * p.y + a.z * p.z;
    };
    dVector3.prototype.ToAngle = function (vTo) {
        if (vTo === void 0) { vTo = null; }
        if (vTo == null)
            vTo = new dVector3(0, 1, 0);
        return dMath.RadianToAngle(dMath.Acos(this.Dot(vTo)));
    };
    dVector3.prototype.FromAngle = function (angle, vAxis) {
        if (vAxis === void 0) { vAxis = null; }
        if (vAxis == null)
            vAxis = new dVector3(0, 0, 1);
        var mat = new dMatrix();
        mat.RotationAxis(dMath.AngleToRadian(angle), vAxis);
        this.SetValue(0, 1, 0);
        this.Transform(mat);
        return this;
    };
    dVector3.prototype.Transform = function (mat) {
        var _x = this.x * mat._11 + this.y * mat._21 + this.z * mat._31 + mat._41;
        var _y = this.x * mat._12 + this.y * mat._22 + this.z * mat._32 + mat._42;
        var _z = this.x * mat._13 + this.y * mat._23 + this.z * mat._33 + mat._43;
        var _w = this.x * mat._14 + this.y * mat._24 + this.z * mat._34 + mat._44;
        if (_w != 0.0) {
            this.x = _x / _w;
            this.y = _y / _w;
            this.z = _z / _w;
        }
        else {
            this.x = _x;
            this.y = _y;
            this.z = _z;
        }
        return this;
    };
    dVector3.prototype.TransformNormal = function (mat) {
        var _x = this.x * mat._11 + this.y * mat._21 + this.z * mat._31;
        var _y = this.x * mat._12 + this.y * mat._22 + this.z * mat._32;
        var _z = this.x * mat._13 + this.y * mat._23 + this.z * mat._33;
        this.x = _x;
        this.y = _y;
        this.z = _z;
        return this;
    };
    dVector3.LerpVector = function (out1, p1, p2, t) {
        var inv = 1.0 - t;
        out1.SetValue(p1.x * inv + p2.x * t, p1.y * inv + p2.y * t, p1.z * inv + p2.z * t);
        return out1;
    };
    dVector3.Unproject = function (vScreen, fViewX, fViewY, fViewWidth, fViewHeight, fViewZMin, fViewZMax, matWorldViewProj) {
        var A = new dMatrix().Copy(matWorldViewProj).Inverse();
        var v = new dVector4();
        v.x = (vScreen.x - fViewX) / fViewWidth * 2.0 - 1.0;
        v.y = -((vScreen.y - fViewY) / fViewHeight * 2.0 - 1.0);
        v.z = 2.0 * vScreen.z - 1.0;
        v.w = 1.0;
        v.Transform(A);
        if (v.w == 0.0)
            return new dVector3();
        v.w = 1.0 / v.w;
        return new dVector3(v.x * v.w, v.y * v.w, v.z * v.w);
    };
    dVector3.prototype.WriteToBin = function (to) {
        to.WriteFloat(this.x);
        to.WriteFloat(this.y);
        to.WriteFloat(this.z);
        return this;
    };
    dVector3.prototype.ReadFromBin = function (data) {
        this.x = data.ReadFloat();
        this.y = data.ReadFloat();
        this.z = data.ReadFloat();
        return this;
    };
    dVector3.ZERO = new dVector3();
    return dVector3;
}(dObject));
var dVector4 = (function (_super) {
    __extends(dVector4, _super);
    function dVector4(x, y, z, w) {
        if (x === void 0) { x = 0; }
        if (y === void 0) { y = 0; }
        if (z === void 0) { z = 0; }
        if (w === void 0) { w = 0; }
        var _this = _super.call(this) || this;
        _this.x = x;
        _this.y = y;
        _this.z = z;
        _this.w = w;
        return _this;
    }
    dVector4.prototype.SetValue = function (_x, _y, _z, _w) {
        if (_x === void 0) { _x = 0.0; }
        if (_y === void 0) { _y = 0.0; }
        if (_z === void 0) { _z = 0.0; }
        if (_w === void 0) { _w = 0.0; }
        this.x = _x;
        this.y = _y;
        this.z = _z;
        this.w = _w;
        return this;
    };
    dVector4.prototype.Copy = function (t) {
        this.x = t.x;
        this.y = t.y;
        this.z = t.z;
        this.w = t.w;
        return this;
    };
    dVector4.prototype.ToStringBuffer = function (split) {
        if (split === void 0) { split = " "; }
        return this.x + split + this.y + split + this.z + split + this.w;
    };
    dVector4.prototype.FromString = function (value, split) {
        if (split === void 0) { split = " "; }
        var arr = value.split(split);
        this.x = dMath.ParseFloat(arr[0]);
        this.y = dMath.ParseFloat(arr[1]);
        this.z = dMath.ParseFloat(arr[2]);
        this.w = dMath.ParseFloat(arr[3]);
        return this;
    };
    dVector4.prototype.Equals = function (v) {
        if (v == null)
            return false;
        return this.x == v.x && this.y == v.y && this.z == v.z && this.w == v.w;
    };
    dVector4.prototype.AddAppend = function (v) {
        this.x += v.x;
        this.y += v.y;
        this.z += v.z;
        this.w += v.w;
        return this;
    };
    dVector4.prototype.AddAppendF = function (f) {
        this.x += f;
        this.y += f;
        this.z += f;
        this.w += f;
        return this;
    };
    dVector4.prototype.SubAppend = function (v) {
        this.x -= v.x;
        this.y -= v.y;
        this.z -= v.z;
        this.w -= v.z;
        return this;
    };
    dVector4.prototype.SubAppendF = function (f) {
        this.x -= f;
        this.y -= f;
        this.z -= f;
        this.z -= f;
        return this;
    };
    dVector4.prototype.MulAppend = function (v) {
        this.x *= v.x;
        this.y *= v.y;
        this.z *= v.z;
        this.w *= v.w;
        return this;
    };
    dVector4.prototype.MulAppendF = function (f) {
        this.x *= f;
        this.y *= f;
        this.z *= f;
        this.w *= f;
        return this;
    };
    dVector4.prototype.DivAppendF = function (f) {
        if (f == 0.0) {
            this.x = 0.0;
            this.y = 0.0;
            this.z = 0.0;
            this.w = 0.0;
        }
        else {
            this.x /= f;
            this.y /= f;
            this.z /= f;
            this.w /= f;
        }
        return this;
    };
    dVector4.prototype.Add = function (v) {
        return new dVector4(this.x + v.x, this.y + v.y, this.z + v.z, this.w + v.w);
    };
    dVector4.prototype.AddF = function (f) {
        return new dVector4(this.x + f, this.y + f, this.z + f, this.w + f);
    };
    dVector4.prototype.Sub = function (v) {
        return new dVector4(this.x - v.x, this.y - v.y, this.z - v.z, this.w - v.w);
    };
    dVector4.prototype.SubF = function (f) {
        return new dVector4(this.x - f, this.y - f, this.z - f, this.w - f);
    };
    dVector4.prototype.MulF = function (f) {
        return new dVector4(this.x * f, this.y * f, this.z * f, this.w * f);
    };
    dVector4.prototype.DivF = function (f) {
        if (f == 0.0)
            return new dVector4();
        return new dVector4(this.x / f, this.y / f, this.z / f, this.w / f);
    };
    dVector4.prototype.Length = function () {
        return dMath.Sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);
    };
    dVector4.prototype.LengthTo = function (p) {
        return dMath.Sqrt((this.x - p.x) * (this.x - p.x) + (this.y - p.y) * (this.y - p.y) + (this.z - p.z) * (this.z - p.z) + (this.w - p.w) * (this.w - p.w));
    };
    dVector4.prototype.Length3 = function () {
        return dMath.Sqrt(this.x * this.x + this.y * this.y + this.z * this.z);
    };
    dVector4.prototype.Normalize = function () {
        var l = this.Length();
        if (l != 0.0) {
            this.x /= l;
            this.y /= l;
            this.z /= l;
            this.w /= l;
        }
        return this;
    };
    dVector4.prototype.Normalize3 = function () {
        var l = this.Length3();
        if (l != 0.0) {
            this.x /= l;
            this.y /= l;
            this.z /= l;
        }
        return this;
    };
    dVector4.prototype.Dot = function (p) {
        return this.x * p.x + this.y * p.y + this.z * p.z + this.w * p.w;
    };
    dVector4.QuaternionSlerp = function (out1, p1, p2, t) {
        var cosa = p1.x * p2.x + p1.y * p2.y + p1.z * p2.z + p1.w * p2.w;
        if (cosa < 0.0) {
            p2.x = -p2.x;
            p2.y = -p2.y;
            p2.z = -p2.z;
            p2.w = -p2.w;
            cosa = -cosa;
        }
        var k0, k1;
        if (cosa > 0.9999) {
            k0 = 1.0 - t;
            k1 = t;
        }
        else {
            var sina = dMath.Sqrt(1.0 - cosa * cosa);
            var a = dMath.Atan2(sina, cosa);
            var invSina = 1.0 / sina;
            k0 = dMath.Sin((1.0 - t) * a) * invSina;
            k1 = dMath.Sin(t * a) * invSina;
        }
        out1.SetValue(p1.x * k0 + p2.x * k1, p1.y * k0 + p2.y * k1, p1.z * k0 + p2.z * k1, p1.w * k0 + p2.w * k1);
        return out1;
    };
    dVector4.prototype.QuaternionIdentity = function () {
        this.x = this.y = this.z = 0;
        this.w = 1;
        return this;
    };
    dVector4.prototype.QuaternionRotationAxisAngle = function (axis, angle) {
        var s, c;
        angle = angle * 0.5;
        s = dMath.Sin(angle);
        c = dMath.Cos(angle);
        var n = axis.Length();
        if (n < 1e-6) {
            this.QuaternionIdentity();
        }
        else {
            s = s / n;
            this.x = axis.x * s;
            this.y = axis.y * s;
            this.z = axis.z * s;
            this.w = c;
        }
        return this;
    };
    dVector4.prototype.QuaternionRotationX = function (angle) {
        angle = angle * 0.5;
        this.x = dMath.Sin(angle);
        this.y = 0;
        this.z = 0;
        this.w = dMath.Cos(angle);
        return this;
    };
    dVector4.prototype.QuaternionRotationY = function (angle) {
        angle = angle * 0.5;
        this.x = 0;
        this.y = dMath.Sin(angle);
        this.z = 0;
        this.w = dMath.Cos(angle);
        return this;
    };
    dVector4.prototype.QuaternionRotationZ = function (angle) {
        angle = angle * 0.5;
        this.x = 0;
        this.y = 0;
        this.z = dMath.Sin(angle);
        this.w = dMath.Cos(angle);
        return this;
    };
    dVector4.prototype.Transform = function (mat) {
        var _x = this.x * mat._11 + this.y * mat._21 + this.z * mat._31 + this.w * mat._41;
        var _y = this.x * mat._12 + this.y * mat._22 + this.z * mat._32 + this.w * mat._42;
        var _z = this.x * mat._13 + this.y * mat._23 + this.z * mat._33 + this.w * mat._43;
        var _w = this.x * mat._14 + this.y * mat._24 + this.z * mat._34 + this.w * mat._44;
        this.SetValue(_x, _y, _z, _w);
        return this;
    };
    dVector4.prototype.WriteToBin = function (to) {
        to.WriteFloat(this.x);
        to.WriteFloat(this.y);
        to.WriteFloat(this.z);
        to.WriteFloat(this.w);
        return this;
    };
    dVector4.prototype.ReadFromBin = function (data) {
        this.x = data.ReadFloat();
        this.y = data.ReadFloat();
        this.z = data.ReadFloat();
        this.w = data.ReadFloat();
        return this;
    };
    dVector4.prototype.QuaternionToEuler = function () {
        var _rotationX = dMath.Atan2(2.0 * (this.w * this.x + this.y * this.z), 1.0 - 2.0 * (this.x * this.x + this.y * this.y));
        var sy = 2.0 * (this.w * this.y - this.z * this.x);
        sy = dMath.Clamp(sy, -1, 1);
        var _rotationY = dMath.Asin(sy);
        var _rotationZ = dMath.Atan2(2.0 * (this.w * this.z + this.x * this.y), 1.0 - 2.0 * (this.y * this.y + this.z * this.z));
        return new dVector3(dMath.RadianToAngle(_rotationX), dMath.RadianToAngle(_rotationY), dMath.RadianToAngle(_rotationZ));
    };
    dVector4.prototype.QuaternionFromEuler = function (euler) {
        var halfRadx = dMath.AngleToRadian(euler.x / 2.0);
        var halfRady = dMath.AngleToRadian(euler.y / 2.0);
        var halfRadz = dMath.AngleToRadian(euler.z / 2.0);
        var coshalfRadx = dMath.Cos(halfRadx);
        var sinhalfRadx = dMath.Sin(halfRadx);
        var coshalfRady = dMath.Cos(halfRady);
        var sinhalfRady = dMath.Sin(halfRady);
        var coshalfRadz = dMath.Cos(halfRadz);
        var sinhalfRadz = dMath.Sin(halfRadz);
        this.x = sinhalfRadx * coshalfRady * coshalfRadz - coshalfRadx * sinhalfRady * sinhalfRadz;
        this.y = coshalfRadx * sinhalfRady * coshalfRadz + sinhalfRadx * coshalfRady * sinhalfRadz;
        this.z = coshalfRadx * coshalfRady * sinhalfRadz - sinhalfRadx * sinhalfRady * coshalfRadz;
        this.w = coshalfRadx * coshalfRady * coshalfRadz + sinhalfRadx * sinhalfRady * sinhalfRadz;
        return this;
    };
    dVector4.ZERO = new dVector4();
    return dVector4;
}(dObject));
var dAnimationImage = (function (_super) {
    __extends(dAnimationImage, _super);
    function dAnimationImage() {
        var _this = _super.call(this) || this;
        _this.m_pFrames = new Array();
        _this.m_pImage = new dSprite();
        _this.m_nDelay = 0;
        _this.m_nLoop = 0;
        _this.m_pPlayTimer = null;
        _this.AddChild(_this.m_pImage);
        return _this;
    }
    Object.defineProperty(dAnimationImage.prototype, "Frames", {
        get: function () {
            return this.m_pFrames;
        },
        enumerable: false,
        configurable: true
    });
    dAnimationImage.prototype.GetFrameData = function (frame) {
        return this.m_pFrames[frame];
    };
    dAnimationImage.prototype.GetFrameBitmapData = function (frame) {
        if (frame >= 0 && frame < this.m_pFrames.length)
            return this.m_pFrames[frame].bmp;
        return null;
    };
    dAnimationImage.prototype.InitWithAnimationFrames = function (arrayOfAnimationFrames) {
        this.m_pFrames = arrayOfAnimationFrames;
        return true;
    };
    dAnimationImage.prototype.SetAnchor = function (u, v) {
        _super.prototype.SetAnchor.call(this, u, v);
        this.UpdateFrame();
    };
    dAnimationImage.prototype.SetColor = function (colorARGB, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetColor.call(this, colorARGB, bSetToChild);
        if (!bSetToChild)
            this.m_pImage.SetColor(colorARGB, bSetToChild);
    };
    dAnimationImage.prototype.SetBlendMode = function (mode, bWithChild) {
        if (bWithChild === void 0) { bWithChild = false; }
        _super.prototype.SetBlendMode.call(this, mode, bWithChild);
        if (!bWithChild)
            this.m_pImage.SetBlendMode(mode, bWithChild);
    };
    dAnimationImage.prototype.ClearFrame = function () {
        this.m_pFrames.clear();
    };
    dAnimationImage.prototype.AddFrameWithFileName = function (pszFileName, rect, index, onComplete) {
        var _this = this;
        if (rect === void 0) { rect = null; }
        if (index === void 0) { index = -1; }
        if (onComplete === void 0) { onComplete = null; }
        var bmp = new dBitmapData();
        var frameData = this._AddFrameWithBitmapData(bmp, index);
        if (rect != null)
            frameData.rcSource.Copy(rect);
        else
            frameData.rcSource.SetPosSize(0, 0, 1, 1);
        if (pszFileName != "") {
            bmp.LoadFromFile(pszFileName, function () {
                _this.UpdateFrame();
                if (onComplete)
                    onComplete(_this);
            });
        }
        else {
            if (onComplete)
                onComplete(this);
        }
    };
    dAnimationImage.prototype.AddFrameWithSplitRect = function (pszFileName, width_count, height_count, startFrame, endFrame) {
        var _this = this;
        if (startFrame === void 0) { startFrame = 0; }
        if (endFrame === void 0) { endFrame = 0; }
        if (width_count < 1)
            width_count = 1;
        if (height_count < 1)
            height_count = 1;
        var bmp = new dBitmapData();
        for (var j = startFrame / width_count; j < height_count; j++) {
            for (var i = startFrame % width_count; i < width_count; i++) {
                var per_width = 1 / width_count;
                var per_height = 1 / height_count;
                var frameData = this._AddFrameWithBitmapData(bmp);
                frameData.rcSource.SetPosSize(i * per_width, j * per_height, per_width, per_height);
                if (endFrame > 0 && this.m_pFrames.length >= endFrame)
                    break;
            }
            if (endFrame > 0 && this.m_pFrames.length >= endFrame)
                break;
        }
        bmp.LoadFromFile(pszFileName, function () {
            _this.UpdateFrame();
        });
    };
    dAnimationImage.prototype.AddFrameWithBitmapDatas = function (pobTextures) {
        for (var i = 0; i < pobTextures.length; i++) {
            this._AddFrameWithBitmapData(pobTextures[i]);
        }
    };
    dAnimationImage.prototype._AddFrameWithBitmapData = function (pobTexture, index) {
        if (index === void 0) { index = -1; }
        if (index == -1 || index >= this.m_pFrames.length) {
            var frameData = new FrameData();
            frameData.bmp = pobTexture;
            this.Frames.push(frameData);
            return frameData;
        }
        else {
            var frameData = this.m_pFrames[index];
            if (frameData == null)
                this.m_pFrames[index] = frameData = new FrameData();
            frameData.bmp = pobTexture;
            return frameData;
        }
    };
    dAnimationImage.prototype.AddFrameWithBitmapData = function (pobTexture, width_count, height_count, startFrame, endFrame) {
        if (width_count === void 0) { width_count = 1; }
        if (height_count === void 0) { height_count = 1; }
        if (startFrame === void 0) { startFrame = 0; }
        if (endFrame === void 0) { endFrame = 0; }
        if (width_count < 1)
            width_count = 1;
        if (height_count < 1)
            height_count = 1;
        var frameCountAdd = 0;
        for (var j = startFrame / width_count; j < height_count; j++) {
            for (var i = startFrame % width_count; i < width_count; i++) {
                var bmp = pobTexture;
                var per_width = 1 / width_count;
                var per_height = 1 / height_count;
                var frameData = this._AddFrameWithBitmapData(bmp);
                frameData.rcSource.SetPosSize(i * per_width, j * per_height, per_width, per_height);
                frameCountAdd++;
                if (endFrame > 0 && frameCountAdd >= endFrame)
                    break;
            }
            if (endFrame > 0 && frameCountAdd >= endFrame)
                break;
        }
    };
    dAnimationImage.prototype.SetLoadCompleteCallback = function (onComplete) {
        var callback = new dCompleteCallback(this);
        for (var i = 0; i < this.m_pFrames.length; i++) {
            if (this.m_pFrames[i].bmp != null) {
                this.m_pFrames[i].bmp.SetLoadCompleteCallback(callback.CreateCompleteFun_Normal());
            }
        }
        callback.SetCompleteFun(onComplete);
    };
    dAnimationImage.prototype.DeleteFrame = function (frame) {
        this.m_pFrames.erase(frame);
    };
    dAnimationImage.prototype.WhenLoadFinish = function (onComplete) {
        var _this = this;
        var pTimer = new dTimer();
        pTimer.Create(30, 0, function (p, ii, f) {
            for (var i = 0; i < _this.m_pFrames.length; i++)
                if (_this.m_pFrames[i].bmp != null && _this.m_pFrames[i].bmp.isLoading())
                    return;
            onComplete(_this);
            pTimer.Stop();
        });
    };
    dAnimationImage.prototype.GetMaxFrame = function () {
        return this.m_pFrames.length;
    };
    dAnimationImage.prototype.SetSize = function (w, h) {
    };
    dAnimationImage.prototype.EndDsc = function () {
        _super.prototype.EndDsc.call(this);
        this.UpdateFrame();
    };
    dAnimationImage.prototype.SetShow = function (bShow) {
        _super.prototype.SetShow.call(this, bShow);
        this.UpdateFrame();
    };
    dAnimationImage.prototype.GetBitmapData = function (at) {
        if (at === void 0) { at = 0; }
        return this.m_pImage.GetBitmapData(at);
    };
    dAnimationImage.prototype.UpdateFrame = function () {
        if (this.m_bBeginDsc)
            return;
        if (this.m_pFrames == null)
            return;
        if (!this.isShow())
            return;
        var frame = dMath.ToInt(this.m_nSpriteFrame);
        if (frame >= 0 && frame < this.m_pFrames.length) {
            var frameData = this.m_pFrames[frame];
            if (frameData.bmp) {
                this.m_pImage.SetBitmapData(frameData.bmp, frameData.rcSource);
                this.m_pImage.SetSize(frameData.bmp.GetWidth() * frameData.rcSource.Width(), frameData.bmp.GetHeight() * frameData.rcSource.Height());
                _super.prototype.SetSize.call(this, this.m_pImage.width, this.m_pImage.height);
                this.m_pImage.SetAnchor(this.anchorU, this.anchorV);
                this.m_pImage.SetPos(frameData.x, frameData.y);
                this.m_pImage.SetScale(frameData.sx, frameData.sy);
                this.m_pImage.SetRotation(frameData.rotation);
            }
            else {
                this.m_pImage.SetSize(0, 0);
            }
        }
        else if (this.m_pImage.GetBitmapData() != null) {
            this.m_pImage.SetBitmapData(null);
            _super.prototype.SetSize.call(this, 0, 0);
        }
    };
    dAnimationImage.prototype.SetFrame = function (frame) {
        this.m_nSpriteFrame = frame;
        this.UpdateFrame();
    };
    Object.defineProperty(dAnimationImage.prototype, "resourceFileName", {
        get: function () {
            var ret = "";
            for (var i = 0; i < this.m_pFrames.length; i++) {
                if (i != 0)
                    ret += "|";
                if (this.m_pFrames[i] != null && this.m_pFrames[i].bmp.GetResourceFileName() != null)
                    ret += this.m_pFrames[i].bmp.GetResourceFileName();
            }
            return ret;
        },
        set: function (fileName) {
            this.LoadFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    dAnimationImage.prototype.LoadFromFile = function (strFileName) {
        var _this = this;
        var vec = strFileName.split("|");
        if (this.m_pFrames.length < vec.length)
            this.m_pFrames.resize(vec.length);
        var callback = new dCompleteCallback(this);
        for (var i = 0; i < vec.length; i++)
            this.AddFrameWithFileName(vec[i], null, i, callback.CreateCompleteFun_Normal());
        callback.SetCompleteFun(function () {
            _this.UpdateFrame();
        });
    };
    Object.defineProperty(dAnimationImage.prototype, "resourceOffsetsAndScale", {
        get: function () {
            var ret = "";
            for (var i = 0; i < this.m_pFrames.length; i++) {
                if (i != 0)
                    ret += ",";
                var frameData = this.m_pFrames[i];
                ret += frameData.x + "," + frameData.y + "," + frameData.sx + "," + frameData.sy;
            }
            return ret;
        },
        set: function (value) {
            var vec = value.split(",");
            if (this.m_pFrames.length < vec.length / 4)
                this.m_pFrames.resize(vec.length / 4);
            for (var i = 0; i < vec.length; i += 4) {
                if (this.m_pFrames[i / 4] == null)
                    this.m_pFrames[i / 4] = new FrameData();
                this.m_pFrames[i / 4].x = dMath.ParseFloat(vec[i]);
                this.m_pFrames[i / 4].y = dMath.ParseFloat(vec[i + 1]);
                this.m_pFrames[i / 4].sx = dMath.ParseFloat(vec[i + 2]);
                this.m_pFrames[i / 4].sy = dMath.ParseFloat(vec[i + 3]);
            }
            this.UpdateFrame();
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dAnimationImage.prototype, "resourceOffsetsAndScaleAndRotation", {
        get: function () {
            var ret = "";
            for (var i = 0; i < this.m_pFrames.length; i++) {
                if (i != 0)
                    ret += ",";
                var v4 = this.m_pFrames[i];
                ret += v4.x + "," + v4.y + "," + v4.sx + "," + v4.sy + "," + v4.rotation;
            }
            return ret;
        },
        set: function (value) {
            var vec = value.split(",");
            if (this.m_pFrames.length < vec.length / 5)
                this.m_pFrames.resize(vec.length / 5);
            for (var i = 0; i < vec.length; i += 5) {
                this.m_pFrames[i / 5].x = dMath.ParseFloat(vec[i]);
                this.m_pFrames[i / 5].y = dMath.ParseFloat(vec[i + 1]);
                this.m_pFrames[i / 5].sx = dMath.ParseFloat(vec[i + 2]);
                this.m_pFrames[i / 5].sy = dMath.ParseFloat(vec[i + 3]);
                this.m_pFrames[i / 5].rotation = dMath.ParseFloat(vec[i + 4]);
            }
            this.UpdateFrame();
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dAnimationImage.prototype, "resourceOffsets", {
        set: function (value) {
            var vec = value.split(",");
            if (this.m_pFrames.length < vec.length / 2)
                this.m_pFrames.resize(vec.length / 2);
            for (var i = 0; i < vec.length; i += 2) {
                this.m_pFrames[i / 2].x = dMath.ParseFloat(vec[i]);
                this.m_pFrames[i / 2].y = dMath.ParseFloat(vec[i + 1]);
            }
            this.UpdateFrame();
        },
        enumerable: false,
        configurable: true
    });
    dAnimationImage.prototype.SetResourceOffset = function (frame, ox, oy, sx, sy, rotation) {
        if (rotation === void 0) { rotation = 0; }
        if (frame >= 0 && frame < this.GetMaxFrame()) {
            this.m_pFrames[frame].x = ox;
            this.m_pFrames[frame].y = oy;
            this.m_pFrames[frame].sx = sx;
            this.m_pFrames[frame].sy = sy;
            this.m_pFrames[frame].rotation = rotation;
        }
    };
    dAnimationImage.prototype.Play = function (loop, delay, bAutoRemove) {
        var _this = this;
        if (loop === void 0) { loop = 1; }
        if (delay === void 0) { delay = 100; }
        if (bAutoRemove === void 0) { bAutoRemove = true; }
        this.m_nLoop = loop;
        this.m_nDelay = delay;
        if (this.GetMaxFrame() == 0)
            return;
        var count = 0;
        if (loop > 0)
            count = this.GetMaxFrame() * loop + 1;
        this.Stop();
        this.m_pPlayTimer = new dTimer(this).Create(delay, count, function (sender, iTimer, fTimer) {
            if (iTimer == count - 1)
                _this.m_pPlayTimer = null;
            if (iTimer == count - 1 && bAutoRemove)
                _this.RemoveParent();
            else
                _this.SetFrame(iTimer % _this.GetMaxFrame());
        });
        this.m_pPlayTimer.Apply();
    };
    dAnimationImage.prototype.Stop = function () {
        if (this.m_pPlayTimer != null) {
            this.m_pPlayTimer.Stop();
            this.m_pPlayTimer = null;
        }
    };
    dAnimationImage.prototype.isPlaying = function () {
        return this.m_pPlayTimer != null;
    };
    dAnimationImage.prototype.GetLoop = function () {
        return this.m_nLoop;
    };
    dAnimationImage.prototype.GetDelay = function () {
        return this.m_nDelay;
    };
    dAnimationImage.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("resourceFileName"))
            this.resourceFileName = json.resourceFileName;
        if (json.hasOwnProperty("resourceOffsets"))
            this.resourceOffsets = json.resourceOffsets;
        if (json.hasOwnProperty("resourceOffsetsAndScale"))
            this.resourceOffsetsAndScale = json.resourceOffsetsAndScale;
        if (json.hasOwnProperty("resourceOffsetsAndScaleAndRotation"))
            this.resourceOffsetsAndScaleAndRotation = this.resourceOffsetsAndScaleAndRotation;
    };
    return dAnimationImage;
}(dBaseControl));
var FrameData = (function () {
    function FrameData() {
        this.rcSource = new dRect();
        this.x = 0;
        this.y = 0;
        this.sx = 1;
        this.sy = 1;
        this.rotation = 0;
        this.bmp = null;
    }
    return FrameData;
}());
var dLabel = (function (_super) {
    __extends(dLabel, _super);
    function dLabel() {
        var _this = _super.call(this) || this;
        _this.m_strText = "";
        _this.m_fWordSpace = 0;
        _this.m_fLineSpace = 0;
        _this.m_bAutoWrap = false;
        _this.m_bAutoSetSize = true;
        _this.m_bPassword = false;
        _this.m_nAlign = dLabel.ALIGN_LEFT;
        _this.m_nFontSize = 16;
        _this.m_nFontColor = 0xffffffff;
        _this.m_bBold = false;
        _this.m_bItalic = false;
        _this.m_nEdgeSize = 0;
        _this.m_nEdgeColor = 0;
        _this.m_bNeedUpdate = false;
        return _this;
    }
    Object.defineProperty(dLabel.prototype, "autoWrap", {
        get: function () {
            return this.m_bAutoWrap;
        },
        set: function (bAutoWrap) {
            if (this.m_bAutoWrap != bAutoWrap) {
                this.m_bAutoWrap = bAutoWrap;
                this.m_bNeedUpdate = true;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dLabel.prototype, "autoSetSize", {
        get: function () {
            return this.m_bAutoSetSize;
        },
        set: function (bAuto) {
            if (this.m_bAutoSetSize != bAuto) {
                this.m_bAutoSetSize = bAuto;
                this.m_bNeedUpdate = true;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dLabel.prototype, "password", {
        get: function () {
            return this.m_bPassword;
        },
        set: function (bPassword) {
            if (this.m_bPassword != bPassword) {
                this.m_bPassword = bPassword;
                this.m_bNeedUpdate = true;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dLabel.prototype, "align", {
        get: function () {
            return this.m_nAlign;
        },
        set: function (type) {
            if (this.m_nAlign != type) {
                this.m_nAlign = type;
                this.m_bNeedUpdate = true;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dLabel.prototype, "text", {
        get: function () {
            return this.GetText();
        },
        set: function (str) {
            this.SetText(str);
        },
        enumerable: false,
        configurable: true
    });
    dLabel.prototype.SetText = function (str) {
        if (this.m_strText != str) {
            this.m_strText = str;
            this.m_bNeedUpdate = true;
        }
    };
    dLabel.prototype.GetText = function () {
        return this.m_strText;
    };
    Object.defineProperty(dLabel.prototype, "lineSpace", {
        get: function () {
            return this.m_fLineSpace;
        },
        set: function (value) {
            if (this.m_fLineSpace != value) {
                this.m_fLineSpace = value;
                this.m_bNeedUpdate = true;
            }
        },
        enumerable: false,
        configurable: true
    });
    dLabel.prototype.SetFontSize = function (size) {
        if (this.m_nFontSize != size) {
            this.m_nFontSize = size;
            this.m_bNeedUpdate = true;
        }
    };
    dLabel.prototype.GetFontSize = function () {
        return this.m_nFontSize;
    };
    Object.defineProperty(dLabel.prototype, "fontSize", {
        get: function () {
            return this.GetFontSize();
        },
        set: function (size) {
            this.SetFontSize(size);
        },
        enumerable: false,
        configurable: true
    });
    dLabel.prototype.SetFontColor = function (color) {
        if (this.m_nFontColor != color) {
            this.m_nFontColor = color;
            this.m_bNeedUpdate = true;
        }
    };
    dLabel.prototype.GetFontColor = function () {
        return this.m_nFontColor;
    };
    Object.defineProperty(dLabel.prototype, "fontColor", {
        get: function () {
            return this.GetFontColor();
        },
        set: function (color) {
            this.SetFontColor(color);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dLabel.prototype, "bold", {
        get: function () {
            return this.m_bBold;
        },
        set: function (bBold) {
            if (this.m_bBold != bBold) {
                this.m_bBold = bBold;
                this.m_bNeedUpdate = true;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dLabel.prototype, "italic", {
        get: function () {
            return this.m_bItalic;
        },
        set: function (bItalic) {
            if (this.m_bItalic != bItalic) {
                this.m_bItalic = bItalic;
                this.m_bNeedUpdate = true;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dLabel.prototype, "edgeSize", {
        get: function () {
            return this.m_nEdgeSize;
        },
        set: function (size) {
            if (this.m_nEdgeSize != size) {
                this.m_nEdgeSize = size;
                this.m_bNeedUpdate = true;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dLabel.prototype, "edgeColor", {
        get: function () {
            return this.m_nEdgeColor;
        },
        set: function (color) {
            if (this.m_nEdgeColor != color) {
                this.m_nEdgeColor = color;
                this.m_bNeedUpdate = true;
            }
        },
        enumerable: false,
        configurable: true
    });
    dLabel.prototype.GetWidth = function () {
        if (this.m_bNeedUpdate)
            this.UpdateText();
        return _super.prototype.GetWidth.call(this);
    };
    dLabel.prototype.GetHeight = function () {
        if (this.m_bNeedUpdate)
            this.UpdateText();
        return _super.prototype.GetHeight.call(this);
    };
    dLabel.prototype.UpdateText = function () {
        if (this.m_bNeedUpdate) {
            this.m_bNeedUpdate = false;
            var bmp = this.GetBitmapData();
            if (bmp == null) {
                bmp = new dBitmapData();
                this.SetBitmapData(bmp);
            }
            bmp.FillText(this.m_strText, this.m_nFontSize, this.m_nFontColor, this.m_bBold, this.m_bItalic, this.autoWrap ? this.GetWidth() : -1, this.align, 0, this.m_fWordSpace, this.m_fLineSpace, this.m_nEdgeSize, this.m_nEdgeColor, 0, this.m_nFontSize * dLabel.s_globalFontOffsetY);
            if (this.m_bAutoSetSize)
                this.SetSize(bmp.GetWidth(), bmp.GetHeight());
        }
    };
    dLabel.prototype.PrepareRender = function () {
        if (this.m_bNeedUpdate)
            this.UpdateText();
        _super.prototype.PrepareRender.call(this);
    };
    dLabel.prototype.LoadFromJson = function (j) {
        _super.prototype.LoadFromJson.call(this, j);
        if (j.hasOwnProperty("autoWrap"))
            this.autoWrap = Boolean(dMath.ParseInt(j.autoWrap));
        if (j.hasOwnProperty("fontSize"))
            this.fontSize = dMath.ParseFloat(j.fontSize);
        if (dInterface.ptr.GetLocalLanguage() == dStringUtils.dLANG_CHINESE_SIMPLIFIED && j.hasOwnProperty("text_LANG_CHINESE_SIMPLIFIED"))
            this.text = j.text_LANG_CHINESE_SIMPLIFIED;
        else if (j.hasOwnProperty("text")) {
            if (j.text.indexOf("\\") != -1)
                j.text = dStringUtils.ReplaceAll(j.text, "\\n", "\n");
            this.text = j.text;
        }
        if (j.hasOwnProperty("fontEdgeSize"))
            this.edgeSize = dMath.ParseFloat(j.fontEdgeSize);
        if (j.hasOwnProperty("fontEdgeColor"))
            this.edgeColor = dMath.ParseInt(j.fontEdgeColor);
        if (j.hasOwnProperty("align"))
            this.align = dMath.ParseInt(j.align);
        if (j.hasOwnProperty("bold"))
            this.bold = Boolean(dMath.ParseInt(j.bold));
        if (j.hasOwnProperty("italic"))
            this.italic = Boolean(dMath.ParseInt(j.italic));
        if (j.hasOwnProperty("lineSpace"))
            this.lineSpace = dMath.ParseFloat(j.lineSpace);
    };
    dLabel.autoWrapWithFullWordDefault = false;
    dLabel.ALIGN_LEFT = -1;
    dLabel.ALIGN_CENTER = 0;
    dLabel.ALIGN_RIGHT = 1;
    dLabel.s_globalFontOffsetY = 0;
    return dLabel;
}(dBaseControl));
var dBitmapFont = (function (_super) {
    __extends(dBitmapFont, _super);
    function dBitmapFont() {
        var _this = _super.call(this) || this;
        _this.m_vecImageBuffer = new Array();
        _this.m_arrRect = new Map();
        _this.m_strFileName = "";
        _this.m_pBitmapData = new Array();
        _this.m_strContext = "";
        _this.m_fBlankWidth = dBitmapFont.globalBlankWidth;
        _this.m_fEnterHeight = 16;
        _this.m_nImageVisibleCount = 0;
        _this.m_vecRenderBatch = new Array();
        _this.m_bNeedComputeRenderBatch = false;
        _this.m_matBuffer = new dMatrix();
        _this.m_fOrgSize = 64;
        _this.m_bLoading = 0;
        _this.m_bImageLoading = [0];
        _this.m_vertices = null;
        _this.m_indices = null;
        _this.m_nLineCount = 0;
        _this.maxHeightLessThenFontHeight = false;
        _this.m_bForceRender = true;
        _this.SetMeshData(dSpriteDefaultShader.Instance().m_pStreamMeshData);
        return _this;
    }
    Object.defineProperty(dBitmapFont.prototype, "wordSpace", {
        get: function () {
            if (this.m_fWordSpace == dBitmapFont.globalWordSpace)
                return 0;
            return this.m_fWordSpace;
        },
        set: function (value) {
            if (value == 0)
                value = dBitmapFont.globalWordSpace;
            this.m_fWordSpace = value;
            this.m_bNeedUpdate = true;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dBitmapFont.prototype, "blankWidth", {
        get: function () {
            return this.m_fBlankWidth;
        },
        set: function (value) {
            this.m_fBlankWidth = value;
        },
        enumerable: false,
        configurable: true
    });
    dBitmapFont.prototype.GetFileName = function () {
        return this.m_strFileName;
    };
    Object.defineProperty(dBitmapFont.prototype, "resourceFileName", {
        get: function () {
            return this.GetFileName();
        },
        set: function (fileName) {
            this.LoadFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    dBitmapFont.PreLoadBuffer = function (strImage, onComplete) {
        if (onComplete === void 0) { onComplete = null; }
        var buffer = new dBitmapFont();
        buffer.LoadFromFile(strImage, function () {
            if (onComplete != null)
                onComplete(buffer);
        });
    };
    dBitmapFont.prototype._AddLoadComplete = function (onComplete) {
        if (onComplete) {
            if (!this.m_vecOnLoadComplete)
                this.m_vecOnLoadComplete = new Array();
            this.m_vecOnLoadComplete.push(onComplete);
        }
    };
    dBitmapFont.prototype._DoLoadComplete = function () {
        if (this.m_vecOnLoadComplete) {
            for (var i = 0; i < this.m_vecOnLoadComplete.length; i++)
                this.m_vecOnLoadComplete[i](this);
            this.m_vecOnLoadComplete = null;
        }
    };
    dBitmapFont.prototype.LoadFromFile = function (strImage, onComplete) {
        var _this = this;
        if (onComplete === void 0) { onComplete = null; }
        if (strImage != null && strImage != "" && this.m_strFileName != strImage) {
            this.m_pBitmapData = new Array();
            this.m_strFileName = strImage;
            if (dBitmapFont.s_arrPreloadFontData != null && dBitmapFont.s_arrPreloadFontData.has(strImage)) {
                var buffer = dBitmapFont.s_arrPreloadFontData.get(strImage);
                if (buffer.m_bLoading) {
                    buffer._AddLoadComplete(function () {
                        _this.LoadFromBitmapFont(buffer);
                    });
                    buffer._AddLoadComplete(onComplete);
                }
                else {
                    this.LoadFromBitmapFont(buffer);
                    if (onComplete != null)
                        onComplete(this);
                }
            }
            else {
                if (dBitmapFont.s_arrPreloadFontData == null)
                    dBitmapFont.s_arrPreloadFontData = new Map();
                dBitmapFont.s_arrPreloadFontData.set(strImage, this);
                this._AddLoadComplete(onComplete);
                var arr = new dByteArray();
                this.m_bLoading++;
                arr.LoadFromFile(strImage, function () {
                    _this.m_bLoading--;
                    _this.LoadFromString(arr.ToStringBuffer());
                    _this._DoLoadComplete();
                });
            }
        }
        return this;
    };
    dBitmapFont.prototype.LoadFromBitmapFont = function (from) {
        this.m_strContext = from.m_strContext;
        this.m_arrRect = from.m_arrRect;
        this.m_pBitmapData = from.m_pBitmapData;
        this.m_fEnterHeight = from.m_fEnterHeight;
        this.m_fBlankWidth = from.m_fBlankWidth;
        this.m_fOrgSize = from.m_fOrgSize;
        this.m_bImageLoading = from.m_bImageLoading;
        this.m_bNeedUpdate = true;
    };
    dBitmapFont.prototype.LoadFromJsonString = function (str) {
        var _this = this;
        var json = JSON.parse(str);
        this.m_strContext = "";
        var maxIndex = -1;
        if (json.orgSize)
            this.m_fOrgSize = dMath.ParseFloat(json.orgSize);
        var chars = json.chars;
        for (var i = 0, n = chars.length; i < n; i++) {
            var rc = new dBitmapFontTextRect();
            var c = chars[i];
            if (c.x)
                rc.left = dMath.ParseFloat(c.x);
            if (c.y)
                rc.top = dMath.ParseFloat(c.y);
            if (c.w)
                rc.right = dMath.ParseFloat(c.w) + rc.left;
            if (c.h)
                rc.bottom = dMath.ParseFloat(c.h) + rc.top;
            if (c.i)
                rc.bmpIndex = dMath.ParseFloat(c.i);
            if (maxIndex < rc.bmpIndex)
                maxIndex = rc.bmpIndex;
            var code = dMath.ParseInt(c.c);
            this.m_arrRect.set(code, rc);
            this.m_strContext += String.fromCharCode(code);
            if (i == 0 || code == 32) {
                this.m_fEnterHeight = rc.Height();
                this.m_fBlankWidth = rc.Width();
            }
        }
        var split = dStringUtils.SplitFileName(this.m_strFileName);
        if (maxIndex >= 0) {
            this.m_pBitmapData = new Array(maxIndex + 1);
            for (var i = 0; i <= maxIndex; i++) {
                var pBitmapData = new dBitmapData();
                var fileName;
                if (i == 0)
                    fileName = split[0] + split[1] + split[2] + ".png";
                else
                    fileName = split[0] + split[1] + split[2] + "_" + i + ".png";
                this.m_bImageLoading[0]++;
                pBitmapData.LoadFromFile(fileName, function () {
                    _this.m_bImageLoading[0]--;
                });
                this.m_pBitmapData[i] = pBitmapData;
            }
        }
        this.m_bNeedUpdate = true;
    };
    dBitmapFont.prototype.LoadFromString = function (str) {
        var _this = this;
        if (str.charCodeAt(0) == 123)
            return this.LoadFromJsonString(str);
        this.m_strContext = "";
        var index = str.indexOf("FONTGROUP");
        if (index != -1)
            str = str.substring(0, index);
        var split = str.split("\n");
        var maxIndex = -1;
        var bFollowIsChar = false;
        for (var i = 0; i < split.length; i++) {
            var split2 = split[i].split(" ");
            if (bFollowIsChar || split2[0] == "char") {
                bFollowIsChar = true;
                var rc = new dBitmapFontTextRect();
                rc.left = dMath.ParseFloat(split2[2]);
                rc.top = dMath.ParseFloat(split2[3]);
                rc.right = dMath.ParseFloat(split2[4]);
                rc.bottom = dMath.ParseFloat(split2[5]);
                rc.bmpIndex = dMath.ParseFloat(split2[6]);
                if (maxIndex < rc.bmpIndex)
                    maxIndex = rc.bmpIndex;
                var code = dMath.ParseInt(split2[1]);
                this.m_arrRect.set(code, rc);
                this.m_strContext += String.fromCharCode(code);
                if (i == 0 || code == 32) {
                    this.m_fEnterHeight = rc.Height();
                    this.m_fBlankWidth = rc.Width();
                }
            }
            else if (split2[0] == "orgSize") {
                this.m_fOrgSize = dMath.ParseFloat(split2[1]);
            }
            else
                break;
        }
        split = dStringUtils.SplitFileName(this.m_strFileName);
        if (maxIndex >= 0) {
            this.m_pBitmapData = new Array(maxIndex + 1);
            for (var i = 0; i <= maxIndex; i++) {
                var pBitmapData = new dBitmapData();
                var fileName;
                if (i == 0)
                    fileName = split[0] + split[1] + split[2] + ".png";
                else
                    fileName = split[0] + split[1] + split[2] + "_" + i + ".png";
                this.m_bImageLoading[0]++;
                pBitmapData.LoadFromFile(fileName, function () {
                    _this.m_bImageLoading[0]--;
                });
                this.m_pBitmapData[i] = pBitmapData;
            }
        }
        this.m_bNeedUpdate = true;
    };
    dBitmapFont.prototype.SetAnchor = function (u, v) {
        _super.prototype.SetAnchor.call(this, u, v);
        this.m_bNeedUpdate = true;
    };
    dBitmapFont.prototype.UpdateText = function () {
        var a = this;
        if (a.m_bBeginDsc || a.m_bLoading)
            return;
        a.m_bNeedUpdate = false;
        if (a.m_strText == null)
            return;
        if (a.m_strContext == "")
            return;
        var str = a.m_strText;
        var k = 0;
        var max_width = 0;
        if (a.m_bAutoWrap)
            max_width = a.GetWidth();
        var max_height = this.m_nFontSize;
        if (this.maxHeightLessThenFontHeight)
            max_height = 1;
        var x = 0;
        var y = 0;
        var fontScale = a.m_nFontSize / a.m_fOrgSize;
        var lineWidth = new Array();
        for (var i = 0, n = str.length; i < n; i++) {
            var rc = null;
            var code = str.charCodeAt(i);
            if (code == 10) {
                lineWidth.push(x - a.m_fWordSpace);
                x = 0;
                y += a.m_fEnterHeight * fontScale + a.m_fLineSpace;
            }
            else if (code == 32)
                rc = new dBitmapFontTextRect().SetPosSize(0, 0, a.m_fBlankWidth, 1);
            else {
                if (!a.m_arrRect.has(code))
                    console.log("code not found: " + String.fromCharCode(code) + " in " + dStringUtils.NonNull(a.m_strFileName));
                rc = a.m_arrRect.get(code);
            }
            if (rc == null)
                continue;
            if (a.m_bAutoWrap && x + rc.Width() * fontScale > a.GetWidth()) {
                lineWidth.push(x - a.m_fWordSpace);
                x = 0;
                y += a.m_fEnterHeight * fontScale + a.m_fLineSpace;
            }
            if (k >= a.m_vecImageBuffer.length) {
                var pImage = new dBitmapFontTextObj();
                pImage.SetAnchor(0, 0);
                a.m_vecImageBuffer.push(pImage);
                pImage.SetColor(a.GetColor());
            }
            var pImage = a.m_vecImageBuffer[k++];
            pImage.SetShow(true);
            if (rc.bmpIndex < a.m_pBitmapData.length)
                pImage.SetBitmapData(a.m_pBitmapData[rc.bmpIndex]);
            pImage.SetSize(rc.Width(), rc.Height());
            pImage.SetPos(x, y);
            pImage.SetScale(fontScale, fontScale);
            pImage.lineIndex = lineWidth.length;
            pImage.rc = rc;
            pImage.code = code;
            pImage.textIndex = i;
            if (!a.m_bAutoWrap) {
                if (max_width < x + rc.Width() * fontScale)
                    max_width = x + rc.Width() * fontScale;
            }
            if (max_height < y + rc.Height() * fontScale)
                max_height = y + rc.Height() * fontScale;
            x += rc.Width() * fontScale + a.m_fWordSpace;
        }
        lineWidth.push(x - a.m_fWordSpace);
        if (a.m_bAutoSetSize) {
            if (a.m_bAutoWrap)
                _super.prototype.SetSize.call(this, this.GetWidth(), max_height);
            else
                _super.prototype.SetSize.call(this, max_width, max_height);
        }
        if (a.m_bAutoWrap) {
            if (fontScale == 0)
                max_width = 0;
            else
                max_width = a.GetWidth();
        }
        for (var i = 0; i < k; i++) {
            var pImage = a.m_vecImageBuffer[i];
            var offX = 0;
            if (a.m_nAlign == dLabel.ALIGN_CENTER)
                offX = (max_width - lineWidth[pImage.lineIndex]) / 2;
            else if (a.m_nAlign == dLabel.ALIGN_RIGHT)
                offX = (max_width - lineWidth[pImage.lineIndex]);
            pImage.SetPos(pImage.positionX - max_width * a.anchorU + offX, pImage.positionY - max_height * a.anchorV);
        }
        a.m_nImageVisibleCount = k;
        a.m_bNeedComputeRenderBatch = true;
        a.m_nLineCount = lineWidth.length;
    };
    dBitmapFont.prototype.GetLineCount = function () {
        if (this.m_bNeedUpdate)
            this.UpdateText();
        return this.m_nLineCount;
    };
    dBitmapFont.prototype.GetTextObj = function () {
        if (this.m_bNeedUpdate)
            this.UpdateText();
        return this.m_vecImageBuffer;
    };
    dBitmapFont.prototype.GetTextObjCount = function () {
        if (this.m_bNeedUpdate)
            this.UpdateText();
        return this.m_nImageVisibleCount;
    };
    dBitmapFont.prototype.GetEnterHeight = function () {
        if (this.m_bNeedUpdate)
            this.UpdateText();
        var fontScale = this.m_nFontSize / this.m_fOrgSize;
        return this.m_fEnterHeight * fontScale;
    };
    dBitmapFont.prototype.ComputeRenderBatch = function () {
        var a = this;
        if (a.m_vertices == null || a.m_vertices.length < a.m_nImageVisibleCount * 20)
            a.m_vertices = new Array(a.m_nImageVisibleCount * 20);
        if (a.m_indices == null || a.m_indices.length < a.m_nImageVisibleCount * 6)
            a.m_indices = new Array(a.m_nImageVisibleCount * 6);
        var t_vertices = a.m_vertices;
        var t_indices = a.m_indices;
        var j = 0;
        var lastBmp = null;
        a.m_vecRenderBatch.clear();
        var fontScale = a.m_nFontSize / a.m_fOrgSize;
        for (var i = 0, n = a.m_nImageVisibleCount; i < n; i++, j++) {
            var image = a.m_vecImageBuffer[i];
            if (!image.visible)
                break;
            var bmp = image.GetBitmapData();
            if (bmp == null)
                continue;
            if (lastBmp != null && bmp != lastBmp) {
                a.m_vecRenderBatch.push(new dBitmapFontRenderBatch(lastBmp, t_vertices, j * 4 * 5, t_indices, j * 6));
                j = 0;
            }
            lastBmp = bmp;
            var width = image.GetWidth();
            var height = image.GetHeight();
            var mat2 = a.m_matBuffer.Copy(a.m_matRenderMatrixSelf);
            mat2.Scaling(width / a.GetWidth() * fontScale, height / a.GetHeight() * fontScale, 1);
            mat2.TranslationFast(image.GetPosX() / a.GetWidth() + a.GetAnchorU(), image.GetPosY() / a.GetHeight() + a.GetAnchorV(), 0);
            var t_left = image.rc.left / bmp.GetWidth();
            var t_top = 1 - image.rc.top / bmp.GetHeight();
            var t_right = image.rc.right / bmp.GetWidth();
            var t_bottom = 1 - image.rc.bottom / bmp.GetHeight();
            var index = j * 20;
            t_vertices[index] = 0.0;
            t_vertices[index + 1] = 0.0;
            t_vertices[index + 2] = 0.0;
            t_vertices[index + 3] = t_left;
            t_vertices[index + 4] = t_top;
            t_vertices[index + 5] = 1.0;
            t_vertices[index + 6] = 0.0;
            t_vertices[index + 7] = 0.0;
            t_vertices[index + 8] = t_right;
            t_vertices[index + 9] = t_top;
            t_vertices[index + 10] = 0.0;
            t_vertices[index + 11] = 1.0;
            t_vertices[index + 12] = 0.0;
            t_vertices[index + 13] = t_left;
            t_vertices[index + 14] = t_bottom;
            t_vertices[index + 15] = 1.0;
            t_vertices[index + 16] = 1.0;
            t_vertices[index + 17] = 0.0;
            t_vertices[index + 18] = t_right;
            t_vertices[index + 19] = t_bottom;
            mat2.TransformFloatArray3(t_vertices, index);
            mat2.TransformFloatArray3(t_vertices, index + 5);
            mat2.TransformFloatArray3(t_vertices, index + 10);
            mat2.TransformFloatArray3(t_vertices, index + 15);
            index = j * 6;
            var m = j * 4;
            t_indices[index] = 1 + m;
            t_indices[index + 1] = 0 + m;
            t_indices[index + 2] = 2 + m;
            t_indices[index + 3] = 1 + m;
            t_indices[index + 4] = 2 + m;
            t_indices[index + 5] = 3 + m;
        }
        if (lastBmp != null) {
            a.m_vecRenderBatch.push(new dBitmapFontRenderBatch(lastBmp, t_vertices, j * 4 * 5, t_indices, j * 6));
        }
    };
    dBitmapFont.prototype.SpriteRender = function () {
        if (this.m_nImageVisibleCount <= 0)
            return;
        var a = this;
        if (a.m_bNeedComputeRenderBatch && a.m_bImageLoading[0] == 0) {
            a.m_bNeedComputeRenderBatch = false;
            a.ComputeRenderBatch();
        }
        for (var i = 0; i < a.m_vecRenderBatch.length; i++) {
            var renderBatch = a.m_vecRenderBatch[i];
            a.SetBitmapData(renderBatch.bmp);
            var bAccessWrite = dMeshData.ACCESS_WRITE_TYPE_STREAM_DRAW;
            dSpriteDefaultShader.Instance().m_pStreamMeshData.SetData(null, renderBatch.vertices.length / 5, renderBatch.indices, dSpriteDefaultShader.Instance().m_vertexDecl, bAccessWrite, renderBatch.vertices, renderBatch.indices.length);
            _super.prototype.SpriteRender.call(this);
        }
    };
    dBitmapFont.prototype.LoadFromJson = function (j) {
        _super.prototype.LoadFromJson.call(this, j);
        if (j.hasOwnProperty("resourceFileName"))
            this.resourceFileName = j.resourceFileName;
        if (j.hasOwnProperty("wordSpace"))
            this.wordSpace = dMath.ParseFloat(j.wordSpace);
        if (j.hasOwnProperty("lineSpace"))
            this.lineSpace = dMath.ParseFloat(j.lineSpace);
    };
    dBitmapFont.globalWordSpace = 0;
    dBitmapFont.globalBlankWidth = 10;
    dBitmapFont.m_vertices = null;
    dBitmapFont.m_indices = null;
    dBitmapFont.s_arrPreloadFontData = null;
    return dBitmapFont;
}(dLabel));
var dBitmapFontTextRect = (function (_super) {
    __extends(dBitmapFontTextRect, _super);
    function dBitmapFontTextRect() {
        var _this = _super.call(this) || this;
        _this.bmpIndex = 0;
        return _this;
    }
    return dBitmapFontTextRect;
}(dRect));
var dBitmapFontTextObj = (function (_super) {
    __extends(dBitmapFontTextObj, _super);
    function dBitmapFontTextObj() {
        var _this = _super.call(this) || this;
        _this.lineIndex = 0;
        _this.textIndex = 0;
        _this.rc = null;
        _this.code = 0;
        return _this;
    }
    return dBitmapFontTextObj;
}(dImage));
var dBitmapFontRenderBatch = (function () {
    function dBitmapFontRenderBatch(bmp, vertices, verCount, indices, indexCount) {
        this.bmp = bmp;
        this.vertices = new Array(verCount);
        for (var i = 0; i < verCount; i++)
            this.vertices[i] = vertices[i];
        this.indices = new Array(indexCount);
        for (var i = 0; i < indexCount; i++)
            this.indices[i] = indices[i];
    }
    return dBitmapFontRenderBatch;
}());
var dButtonContainer = (function (_super) {
    __extends(dButtonContainer, _super);
    function dButtonContainer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    dButtonContainer.prototype.AddChild = function (pChild, at) {
        if (at === void 0) { at = -1; }
        _super.prototype.AddChild.call(this, pChild, at);
        this.UpdateImage();
    };
    dButtonContainer.prototype.RemoveChild = function (pChild) {
        _super.prototype.RemoveChild.call(this, pChild);
        this.UpdateImage();
    };
    dButtonContainer.prototype.RemoveAllChild = function () {
        _super.prototype.RemoveAllChild.call(this);
        this.UpdateImage();
    };
    dButtonContainer.prototype.UpdateImage = function () {
        var vec = this.GetChildList();
        this.m_pNormal = this.m_pTouchDown = this.m_pDisable = null;
        if (vec.length > 0)
            this.m_pNormal = vec[0];
        if (vec.length > 1)
            this.m_pTouchDown = vec[1];
        if (vec.length > 2)
            this.m_pDisable = vec[2];
    };
    return dButtonContainer;
}(dButton));
var dButtonScale9 = (function (_super) {
    __extends(dButtonScale9, _super);
    function dButtonScale9() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.m_repeatType = false;
        return _this;
    }
    dButtonScale9.prototype.CreateImage = function () {
        var ret = new dScale9();
        ret.repeatType = this.m_repeatType;
        return ret;
    };
    Object.defineProperty(dButtonScale9.prototype, "repeatType", {
        get: function () {
            return this.m_repeatType;
        },
        set: function (bRepeatType) {
            this.m_repeatType = bRepeatType;
            if (this.m_pNormal instanceof dScale9)
                this.m_pNormal.repeatType = bRepeatType;
            if (this.m_pTouchDown instanceof dScale9)
                this.m_pTouchDown.repeatType = bRepeatType;
        },
        enumerable: false,
        configurable: true
    });
    return dButtonScale9;
}(dButton));
var dCheckBox = (function (_super) {
    __extends(dCheckBox, _super);
    function dCheckBox() {
        var _this = _super.call(this) || this;
        _this.m_pCheckImage = null;
        _this.m_pUnCheckImage = null;
        _this.m_vecLoadingCallback = null;
        _this.m_vecLoadingCheckCallback = null;
        _this.SetHandleMouse(true);
        _this.CreateCheckImage();
        return _this;
    }
    dCheckBox.prototype.CreateCheckImage = function () {
        this.m_pCheckImage = new dImage();
        this.m_pUnCheckImage = new dImage();
        this.AddChild(this.m_pCheckImage);
        this.AddChild(this.m_pUnCheckImage);
    };
    dCheckBox.prototype.OnTouchUp = function (x, y) {
        if (this.isEnable()) {
            this.SetCheck(!this.isCheck());
            if (this.m_pEvent != null)
                this.m_pEvent.OnCheck(this);
        }
    };
    dCheckBox.prototype.SetSize = function (w, h) {
        _super.prototype.SetSize.call(this, w, h);
    };
    dCheckBox.prototype.LoadFromFile = function (strUncheckedImageName, onComplete) {
        var _this = this;
        if (onComplete === void 0) { onComplete = null; }
        if (this.m_pUnCheckImage != null && this.m_pUnCheckImage.resourceFileName != strUncheckedImageName) {
            if (onComplete) {
                if (!this.m_vecLoadingCallback)
                    this.m_vecLoadingCallback = new Array();
                this.m_vecLoadingCallback.push(onComplete);
            }
            this.m_pUnCheckImage.LoadFromFile(strUncheckedImageName, function () {
                _this.SetSize(dMath.Max(_this.m_pCheckImage.width, _this.m_pUnCheckImage.width), dMath.Max(_this.m_pCheckImage.height, _this.m_pUnCheckImage.height));
                if (_this.m_vecLoadingCallback) {
                    for (var i = 0; i < _this.m_vecLoadingCallback.length; i++)
                        _this.m_vecLoadingCallback[i](_this);
                    _this.m_vecLoadingCallback = null;
                }
            });
        }
        else {
            if (onComplete) {
                if (this.m_vecLoadingCallback)
                    this.m_vecLoadingCallback.push(onComplete);
                else
                    onComplete(this);
            }
        }
        return this;
    };
    dCheckBox.prototype.LoadCheckFromFile = function (strCheckedImageName, onComplete) {
        var _this = this;
        if (onComplete === void 0) { onComplete = null; }
        if (this.m_pCheckImage != null && this.m_pCheckImage.resourceFileName != strCheckedImageName) {
            if (onComplete) {
                if (!this.m_vecLoadingCheckCallback)
                    this.m_vecLoadingCheckCallback = new Array();
                this.m_vecLoadingCheckCallback.push(onComplete);
            }
            this.m_pCheckImage.LoadFromFile(strCheckedImageName, function () {
                _this.SetSize(dMath.Max(_this.m_pCheckImage.width, _this.m_pUnCheckImage.width), dMath.Max(_this.m_pCheckImage.height, _this.m_pUnCheckImage.height));
                if (_this.m_vecLoadingCheckCallback) {
                    for (var i = 0; i < _this.m_vecLoadingCheckCallback.length; i++)
                        _this.m_vecLoadingCheckCallback[i](_this);
                    _this.m_vecLoadingCheckCallback = null;
                }
            });
        }
        else {
            if (onComplete) {
                if (this.m_vecLoadingCheckCallback)
                    this.m_vecLoadingCheckCallback.push(onComplete);
                else
                    onComplete(this);
            }
        }
        return this;
    };
    dCheckBox.prototype.GetFileName = function () {
        if (this.m_pUnCheckImage == null)
            return "";
        return this.m_pUnCheckImage.GetFileName();
    };
    dCheckBox.prototype.GetCheckFileName = function () {
        if (this.m_pCheckImage == null)
            return "";
        return this.m_pCheckImage.GetFileName();
    };
    dCheckBox.prototype.SetCheck = function (bCheck) {
        if (this.m_pCheckImage != null)
            this.m_pCheckImage.SetShow(bCheck);
        if (this.m_pUnCheckImage != null)
            this.m_pUnCheckImage.SetShow(!bCheck);
        if (this.GetParent() instanceof dCheckBoxGroup) {
            if (bCheck)
                this.GetParent().OnCheck(this);
            else if (this.GetParent().GetChecked() == null)
                this.SetCheck(true);
        }
    };
    dCheckBox.prototype.UpdateCheck = function () {
        this.SetCheck(this.isCheck());
    };
    dCheckBox.prototype.SetColor = function (colorARGB, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        if (this.m_pCheckImage != null)
            this.m_pCheckImage.SetColor(colorARGB, bSetToChild);
        if (this.m_pUnCheckImage != null)
            this.m_pUnCheckImage.SetColor(colorARGB, bSetToChild);
        _super.prototype.SetColor.call(this, colorARGB, bSetToChild);
    };
    dCheckBox.prototype.SetAlpha = function (alpha, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        if (this.m_pCheckImage != null)
            this.m_pCheckImage.SetAlpha(alpha, bSetToChild);
        if (this.m_pUnCheckImage != null)
            this.m_pUnCheckImage.SetAlpha(alpha, bSetToChild);
        _super.prototype.SetAlpha.call(this, alpha, bSetToChild);
    };
    dCheckBox.prototype.isCheck = function () {
        if (this.m_pCheckImage == null)
            return false;
        return this.m_pCheckImage.isShow();
    };
    Object.defineProperty(dCheckBox.prototype, "check", {
        get: function () {
            return this.isCheck();
        },
        set: function (bCheck) {
            this.SetCheck(bCheck);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dCheckBox.prototype, "resourceFileName", {
        get: function () {
            return this.GetFileName();
        },
        set: function (fileName) {
            this.LoadFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dCheckBox.prototype, "checkImage", {
        get: function () {
            return this.GetCheckFileName();
        },
        set: function (fileName) {
            this.LoadCheckFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    dCheckBox.prototype.AddChild = function (pChild, at) {
        if (at === void 0) { at = -1; }
        _super.prototype.AddChild.call(this, pChild, at);
        this.UpdateCheck();
    };
    dCheckBox.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("resourceFileName"))
            this.resourceFileName = json.resourceFileName;
        if (json.hasOwnProperty("checkImage"))
            this.checkImage = json.checkImage;
        if (json.hasOwnProperty("check"))
            this.check = Boolean(dMath.ParseInt(json.check));
    };
    return dCheckBox;
}(dBaseControl));
var dCheckBoxContainer = (function (_super) {
    __extends(dCheckBoxContainer, _super);
    function dCheckBoxContainer() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    dCheckBoxContainer.prototype.SetCheck = function (bCheck) {
        var vecChild = this.GetChildList();
        if (vecChild.length >= 4) {
            vecChild[2].visible = bCheck;
            vecChild[3].visible = !bCheck;
        }
        _super.prototype.SetCheck.call(this, bCheck);
    };
    return dCheckBoxContainer;
}(dCheckBox));
var dCheckBoxGroup = (function (_super) {
    __extends(dCheckBoxGroup, _super);
    function dCheckBoxGroup() {
        var _this = _super.call(this) || this;
        _this.m_bDoingSetCheck = false;
        return _this;
    }
    dCheckBoxGroup.prototype.OnCheck = function (checkBox) {
        if (this.m_bDoingSetCheck)
            return;
        this.m_bDoingSetCheck = true;
        var vecChild = this.GetChildList();
        for (var i = 0; i < vecChild.length; i++) {
            if (vecChild[i] instanceof dCheckBox) {
                vecChild[i].SetCheck(vecChild[i] == checkBox);
            }
        }
        this.m_bDoingSetCheck = false;
    };
    dCheckBoxGroup.prototype.GetChecked = function () {
        var vecChild = this.GetChildList();
        for (var i = 0; i < vecChild.length; i++) {
            if (vecChild[i] instanceof dCheckBox && vecChild[i].isCheck()) {
                return vecChild[i];
            }
        }
        return null;
    };
    return dCheckBoxGroup;
}(dBaseControl));
var dCheckBoxScale9 = (function (_super) {
    __extends(dCheckBoxScale9, _super);
    function dCheckBoxScale9() {
        return _super.call(this) || this;
    }
    dCheckBoxScale9.prototype.CreateCheckImage = function () {
        this.m_pCheckImage = new dScale9();
        this.m_pUnCheckImage = new dScale9();
        this.AddChild(this.m_pCheckImage);
        this.AddChild(this.m_pUnCheckImage);
    };
    return dCheckBoxScale9;
}(dCheckBox));
var dControlLoader = (function () {
    function dControlLoader() {
    }
    dControlLoader.SetOnCreateConsole = function (onCreateConsole) {
        dControlLoader.s_onCreateConsole = onCreateConsole;
    };
    dControlLoader.CreateUIByJson = function (p, json, root, rootName) {
        if (root === void 0) { root = null; }
        if (rootName === void 0) { rootName = ""; }
        if (!root)
            root = p;
        var classType = json.classType;
        if (!p) {
            switch (classType) {
                case "dSprite":
                    p = new dBaseControl();
                    break;
                case "dAnimationImage":
                    p = new dAnimationImage();
                    break;
                case "dBitmapFont":
                    p = new dBitmapFont();
                    break;
                case "dButton":
                    p = new dButton();
                    break;
                case "dButtonContainer":
                    p = new dButtonContainer();
                    break;
                case "dButtonScale9":
                    p = new dButtonScale9();
                    break;
                case "dCheckBox":
                    p = new dCheckBox();
                    break;
                case "dCheckBoxContainer":
                    p = new dCheckBoxContainer();
                    break;
                case "dCheckBoxGroup":
                    p = new dCheckBoxGroup();
                    break;
                case "dCheckBoxScale9":
                    p = new dCheckBoxScale9();
                    break;
                case "dImage":
                    p = new dImage();
                    break;
                case "dInputBox":
                    p = new dInputBox();
                    break;
                case "dLabel":
                    p = new dLabel();
                    break;
                case "dLayoutHBox":
                    p = new dLayoutHBox();
                    break;
                case "dLayoutVBox":
                    p = new dLayoutVBox();
                    break;
                case "dLayoutLimitScale":
                    p = new dLayoutLimitScale();
                    break;
                case "dLine":
                    p = new dLine();
                    break;
                case "dListBox":
                    p = new dListBox();
                    break;
                case "dListBoxPageView":
                    p = new dListBoxPageView();
                    break;
                case "dMover":
                    p = new dMover();
                    break;
                case "dProgress":
                    p = new dProgress();
                    break;
                case "dRepeatImage":
                    p = new dRepeatImage();
                    break;
                case "dScale9":
                    p = new dScale9();
                    break;
                case "dScrollView":
                    p = new dScrollView();
                    break;
                case "dTabView":
                    p = new dTabView();
                    break;
                default:
                    {
                        if (dControlLoader.s_onCreateConsole) {
                            p = dControlLoader.s_onCreateConsole(classType);
                        }
                        if (!p) {
                            console.log("class not found " + classType);
                        }
                    }
            }
        }
        if (p) {
            p.LoadFromJson(json);
            if (json.hasOwnProperty("_child")) {
                var child = json._child;
                for (var i = 0, n = child.length; i < n; i++) {
                    var className = child[i].className;
                    var rootName2 = "";
                    if (rootName != "")
                        rootName2 = rootName + "_" + className;
                    else
                        rootName2 = className;
                    var p2 = dControlLoader.CreateUIByJson(null, child[i], root, rootName2);
                    if (p2) {
                        p.AddChild(p2);
                        if (className) {
                            p2.spriteName = className;
                            root[rootName2] = p2;
                        }
                    }
                }
            }
            if (json.hasOwnProperty("_linkChild")) {
                var linkChilds = json._linkChild.split(",");
                for (var i = 0, n = linkChilds.length; i < n; i += 2) {
                    var p1 = p.FindChild(linkChilds[i]);
                    var p2 = p.FindChild(linkChilds[i + 1]);
                    if (p1 && p2) {
                        p1.AddLinkSprite(p2);
                    }
                }
            }
            if (p != root && json.hasOwnProperty("_frames") && json["_frames"]) {
                var frames = json["_frames"];
                var maxFrame = 0;
                for (var i = 0; i < frames.length; i++) {
                    if (maxFrame < frames[i].frame + 1)
                        maxFrame = frames[i].frame + 1;
                }
                if (maxFrame == frames.length) {
                }
                else {
                    var frames2 = new Array();
                    frames2.resize(maxFrame);
                    for (var i = 0; i < frames.length; i++)
                        frames2[frames[i].frame] = frames[i];
                    for (var i = 0; i < maxFrame; i++) {
                        if (frames2[i] == null) {
                            frames2[i] = dControlLoader._CreateSpriteFrame();
                            frames2[i].frame = i;
                        }
                    }
                    for (var i = 0; i < maxFrame; i++) {
                        if (frames2[i] == null)
                            frames2[i] = dControlLoader._CreateSpriteFrame();
                        dControlLoader.LerpKey(p, frames2, i, 0xFFFFFFFF, maxFrame);
                    }
                    frames = frames2;
                }
                for (var i = 0; i < frames.length; i++) {
                    var frameData = frames[i];
                    frameData.x += p.positionX;
                    frameData.y += p.positionY;
                    frameData.z += p.positionZ;
                    frameData.rx += p.rotationX;
                    frameData.ry += p.rotationY;
                    frameData.rz += p.rotation;
                    frameData.sx *= p.scaleX;
                    frameData.sy *= p.scaleY;
                    frameData.sz *= p.scaleZ;
                }
                p.SetFrameDataList(frames);
            }
        }
        return p;
    };
    dControlLoader._CreateSpriteFrame = function () {
        return {
            frame: 0,
            majorKey: 0,
            aniName: "default",
            alpha: 0,
            x: 0,
            y: 0,
            z: 0,
            rz: 0,
            rx: 0,
            ry: 0,
            sx: 1,
            sy: 1,
            sz: 1,
            spriteColor: 0xffffffff,
            spriteFrame: 0,
            visible: 1
        };
    };
    dControlLoader.LerpAngle = function (from, to, lerp) {
        if (from - to >= 180)
            return dMath.Lerp(from - 360.0, to, lerp);
        else
            return dMath.Lerp(from, to, lerp);
    };
    dControlLoader.LerpKey = function (firstKey, arrKeyFrameData, start, majoy_mask, maxFrame) {
        var prev = null;
        var next = null;
        var prevIndex = 0;
        var nextIndex = 0;
        for (var i = start; i >= 0; i--) {
            var key = arrKeyFrameData[i];
            if (key.majorKey & majoy_mask) {
                prev = key;
                prevIndex = i;
                break;
            }
        }
        for (var i = start; i < maxFrame; i++) {
            var key = arrKeyFrameData[i];
            if (key.majorKey & majoy_mask) {
                next = key;
                nextIndex = i;
                break;
            }
        }
        var zero = dControlLoader._CreateSpriteFrame();
        if (prev == null) {
            prev = zero;
            prevIndex = 0;
        }
        if (next == null) {
            next = prev;
            nextIndex = prevIndex;
        }
        var lerp = 0.0;
        if (nextIndex != prevIndex)
            lerp = (start - prevIndex) / (nextIndex - prevIndex);
        {
            arrKeyFrameData[start].x = dMath.Lerp(prev.x + firstKey.positionX, next.x + firstKey.positionX, lerp) - firstKey.positionX;
            arrKeyFrameData[start].y = dMath.Lerp(prev.y + firstKey.positionY, next.y + firstKey.positionY, lerp) - firstKey.positionY;
            arrKeyFrameData[start].z = dMath.Lerp(prev.z + firstKey.positionZ, next.z + firstKey.positionZ, lerp) - firstKey.positionZ;
        }
        {
            arrKeyFrameData[start].sx = dMath.Lerp(prev.sx * firstKey.scaleX, next.sx * firstKey.scaleX, lerp) / firstKey.scaleX;
            arrKeyFrameData[start].sy = dMath.Lerp(prev.sy * firstKey.scaleY, next.sy * firstKey.scaleY, lerp) / firstKey.scaleY;
            arrKeyFrameData[start].sz = dMath.Lerp(prev.sz * firstKey.scaleZ, next.sz * firstKey.scaleZ, lerp) / firstKey.scaleZ;
        }
        {
            arrKeyFrameData[start].rx = dControlLoader.LerpAngle(prev.rx + firstKey.rotationX, next.rx + firstKey.rotationX, lerp) - firstKey.rotationX;
            arrKeyFrameData[start].ry = dControlLoader.LerpAngle(prev.ry + firstKey.rotationY, next.ry + firstKey.rotationY, lerp) - firstKey.rotationY;
            arrKeyFrameData[start].rz = dControlLoader.LerpAngle(prev.rz + firstKey.rotation, next.rz + firstKey.rotation, lerp) - firstKey.rotation;
        }
        {
            arrKeyFrameData[start].spriteColor = prev.spriteColor;
        }
        {
            arrKeyFrameData[start].spriteFrame = prev.spriteFrame;
        }
        {
            arrKeyFrameData[start].visible = prev.visible;
        }
        {
        }
        {
            arrKeyFrameData[start].alpha = dMath.Lerp(prev.alpha, next.alpha, lerp);
        }
    };
    dControlLoader.s_onCreateConsole = null;
    return dControlLoader;
}());
var dEvent = (function (_super) {
    __extends(dEvent, _super);
    function dEvent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.m_onButtonDown = null;
        _this.m_onButtonUp = null;
        _this.m_onButtonUpOutside = null;
        _this.m_onScroll = null;
        _this.m_onInputBegin = null;
        _this.m_onInput = null;
        _this.m_onCheck = null;
        _this.m_onListShowView = null;
        _this.m_onListShowViewEnd = null;
        _this.m_onListShowVirtualChild = null;
        _this.m_onScrollViewTouchDownToChild = null;
        _this.m_onScrollViewTouchUpToChild = null;
        _this.m_onScrollViewPosChanged = null;
        _this.m_onSliderValueChanging = null;
        _this.m_onSliderValueChangeFinished = null;
        _this.m_onUpdateLayout = null;
        return _this;
    }
    dEvent.prototype.OnButtonDown = function (sender) {
        if (this.m_onButtonDown)
            this.m_onButtonDown(sender);
    };
    dEvent.prototype.OnButtonUp = function (sender) {
        if (this.m_onButtonUp)
            this.m_onButtonUp(sender);
    };
    dEvent.prototype.OnButtonUpOutside = function (sender) {
        if (this.m_onButtonUpOutside)
            this.m_onButtonUpOutside(sender);
    };
    dEvent.prototype.OnScroll = function (sender) {
        if (this.m_onScroll)
            this.m_onScroll(sender);
    };
    dEvent.prototype.OnInputBegin = function (sender) {
        if (this.m_onInputBegin)
            this.m_onInputBegin(sender);
    };
    dEvent.prototype.OnInput = function (sender) {
        if (this.m_onInput)
            this.m_onInput(sender);
    };
    dEvent.prototype.OnCheck = function (sender) {
        if (this.m_onCheck)
            this.m_onCheck(sender);
    };
    dEvent.prototype.OnListShowView = function (sender) {
        if (this.m_onListShowView)
            this.m_onListShowView(sender);
    };
    dEvent.prototype.OnListShowViewEnd = function (sender) {
        if (this.m_onListShowViewEnd)
            this.m_onListShowViewEnd(sender);
    };
    dEvent.prototype.OnListShowVirtualChild = function (sender, childIndex, virtualIndex) {
        if (this.m_onListShowVirtualChild)
            this.m_onListShowVirtualChild(sender, childIndex, virtualIndex);
    };
    dEvent.prototype.OnScrollViewTouchDownToChild = function (child) {
        if (this.m_onScrollViewTouchDownToChild)
            return this.m_onScrollViewTouchDownToChild(child);
        return false;
    };
    dEvent.prototype.OnScrollViewTouchUpToChild = function (child) {
        if (this.m_onScrollViewTouchUpToChild)
            this.m_onScrollViewTouchUpToChild(child);
        return false;
    };
    dEvent.prototype.OnScrollViewPosChanged = function (child) {
        if (this.m_onScrollViewPosChanged)
            this.m_onScrollViewPosChanged(child);
    };
    dEvent.prototype.OnSliderValueChanging = function (sender) {
        if (this.m_onSliderValueChanging)
            this.m_onSliderValueChanging(sender);
    };
    dEvent.prototype.OnSliderValueChangeFinished = function (sender) {
        if (this.m_onSliderValueChangeFinished)
            this.m_onSliderValueChangeFinished(sender);
    };
    dEvent.prototype.OnUpdateLayout = function (sender) {
        if (this.m_onUpdateLayout)
            this.m_onUpdateLayout(sender);
    };
    dEvent.prototype.SetOnButtonDown = function (callback) {
        this.m_onButtonDown = callback;
        return this;
    };
    dEvent.prototype.SetOnButtonUp = function (callback) {
        this.m_onButtonUp = callback;
        return this;
    };
    dEvent.prototype.SetOnButtonUpOutside = function (callback) {
        this.m_onButtonUpOutside = callback;
        return this;
    };
    dEvent.prototype.SetOnScroll = function (callback) {
        this.m_onScroll = callback;
        return this;
    };
    dEvent.prototype.SetOnInputBegin = function (callback) {
        this.m_onInputBegin = callback;
        return this;
    };
    dEvent.prototype.SetOnInput = function (callback) {
        this.m_onInput = callback;
        return this;
    };
    dEvent.prototype.SetOnCheck = function (callback) {
        this.m_onCheck = callback;
        return this;
    };
    dEvent.prototype.SetOnListShowView = function (callback) {
        this.m_onListShowView = callback;
        return this;
    };
    dEvent.prototype.SetOnListShowViewEnd = function (callback) {
        this.m_onListShowViewEnd = callback;
        return this;
    };
    dEvent.prototype.SetOnListShowVirtualChild = function (callback) {
        this.m_onListShowVirtualChild = callback;
        return this;
    };
    dEvent.prototype.SetOnScrollViewTouchDownToChild = function (callback) {
        this.m_onScrollViewTouchDownToChild = callback;
        return this;
    };
    dEvent.prototype.SetOnScrollViewTouchUpToChild = function (callback) {
        this.m_onScrollViewTouchUpToChild = callback;
        return this;
    };
    dEvent.prototype.SetOnScrollViewPosChanged = function (callback) {
        this.m_onScrollViewPosChanged = callback;
        return this;
    };
    dEvent.prototype.SetOnSliderValueChanging = function (callback) {
        this.m_onSliderValueChanging = callback;
        return this;
    };
    dEvent.prototype.SetOnSliderValueChangeFinished = function (callback) {
        this.m_onSliderValueChangeFinished = callback;
        return this;
    };
    dEvent.prototype.SetOnUpdateLayout = function (callback) {
        this.m_onUpdateLayout = callback;
        return this;
    };
    return dEvent;
}(dObject));
var dInputBox = (function (_super) {
    __extends(dInputBox, _super);
    function dInputBox() {
        var _this = _super.call(this) || this;
        _this.m_pLabel = new dLabel();
        _this.m_bMultiLine = false;
        _this.m_nAlignVertical = dLabel.ALIGN_CENTER;
        _this.m_nAlignHorizontal = dLabel.ALIGN_LEFT;
        _this.m_nMaxLength = 0;
        _this.m_strDefaultText = "";
        _this.SetHandleMouse(true);
        _this.m_pLabel.SetAnchor(0, 0);
        _this.SetClipChild(true);
        _this.AddChild(_this.m_pLabel);
        return _this;
    }
    dInputBox.prototype.GetText = function () {
        var ret = this.m_pLabel.GetText();
        if (ret == this.m_strDefaultText)
            ret = "";
        return ret;
    };
    dInputBox.prototype.SetText = function (str) {
        if (str == "") {
            str = this.m_strDefaultText;
            this.m_pLabel.alpha = 0.5;
        }
        else {
            this.m_pLabel.alpha = 1;
        }
        this.m_pLabel.SetText(str);
        this._UpdateText();
    };
    dInputBox.prototype.SetDefaultText = function (str) {
        this.m_strDefaultText = str;
        this.SetText(this.GetText());
    };
    Object.defineProperty(dInputBox.prototype, "text", {
        get: function () {
            return this.GetText();
        },
        set: function (v) {
            this.SetText(v);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dInputBox.prototype, "autoWrap", {
        get: function () {
            return this.m_pLabel.autoWrap;
        },
        set: function (bAutoWrap) {
            this.m_pLabel.autoWrap = bAutoWrap;
            if (bAutoWrap)
                this.m_pLabel.SetSize(this.GetWidth(), this.GetHeight());
            this.m_pLabel.UpdateText();
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dInputBox.prototype, "password", {
        get: function () {
            return this.m_pLabel.password;
        },
        set: function (bPassword) {
            this.m_pLabel.password = bPassword;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dInputBox.prototype, "alignVertical", {
        get: function () {
            return this.m_nAlignVertical;
        },
        set: function (type) {
            this.m_nAlignVertical = type;
            this._UpdateText();
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dInputBox.prototype, "alignHorizontal", {
        get: function () {
            return this.m_nAlignHorizontal;
        },
        set: function (type) {
            this.m_nAlignHorizontal = type;
            this._UpdateText();
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dInputBox.prototype, "multiLine", {
        get: function () {
            return this.m_bMultiLine;
        },
        set: function (bMulti) {
            this.m_bMultiLine = bMulti;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dInputBox.prototype, "maxLength", {
        get: function () {
            return this.m_nMaxLength;
        },
        set: function (len) {
            this.m_nMaxLength = len;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dInputBox.prototype, "fontSize", {
        get: function () {
            return this.m_pLabel.fontSize;
        },
        set: function (v) {
            this.m_pLabel.fontSize = v;
        },
        enumerable: false,
        configurable: true
    });
    dInputBox.prototype.SetColor = function (color, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetColor.call(this, color);
        this.m_pLabel.SetColor(color, bSetToChild);
    };
    dInputBox.prototype.SetAlpha = function (alpha, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetAlpha.call(this, alpha);
        this.m_pLabel.SetAlpha(alpha);
    };
    dInputBox.prototype.SetSize = function (w, h) {
        if (this.GetWidth() != w || this.GetHeight() != h) {
            _super.prototype.SetSize.call(this, w, h);
            this.m_pLabel.SetSize(w, h);
            this._UpdateText();
        }
    };
    dInputBox.prototype.OnTouchDown = function (x, y, delta) {
        if (this.m_onTouchEvent != null)
            this.m_onTouchEvent.OnTouchDown(x, y, delta);
        else {
            if (this.isEnable())
                this.SetFocus();
        }
    };
    dInputBox.prototype.SetFocus = function () {
        var _this = this;
        if (this.m_pEvent != null)
            this.m_pEvent.OnInputBegin(this);
        var flag = 0;
        if (this.m_bMultiLine)
            flag |= dSprite.INPUTBOX_STYLE_CANENTERLINE;
        if (this.autoWrap)
            flag |= dSprite.INPUBBOX_STYPE_AUTOENTERLINE;
        if (this.password)
            flag |= dSprite.INPUTBOX_STYLE_PASSWORD;
        var strText = this.GetText();
        var mat = this.GetMatrixWorld();
        var pos = new dVector3(-this.width * this.anchorU, -this.height * this.anchorV);
        pos.Transform(mat);
        var size = new dVector3(this.width, this.height, 0);
        mat._41 = mat._42 = mat._43 = 0;
        size.Transform(mat);
        this.m_pLabel.visible = false;
        dSprite.s_pCurrentInputingBox = this;
        dInterface.ptr.ShowInputBox(strText, pos.x, pos.y, size.x, size.y, this.m_pLabel.GetColor(), this.m_pLabel.GetFontSize() * mat._11, this.m_nMaxLength, this.m_bMultiLine, function (inputText) {
            dSprite.s_pCurrentInputingBox = null;
            _this.m_pLabel.visible = true;
            if (!_this.m_bMultiLine && inputText.charAt(inputText.length - 1) == "\n")
                inputText = inputText.substring(0, inputText.length - 1);
            _this.SetText(inputText);
            if (_this.m_pEvent != null)
                _this.m_pEvent.OnInput(_this);
        }, function () {
            dSprite.s_pCurrentInputingBox = null;
            _this.m_pLabel.visible = true;
            _this.SetText(strText);
        });
    };
    dInputBox.prototype._UpdateText = function () {
        if (this.m_bBeginDsc || this.m_pLabel == null)
            return;
        var xoff = 0;
        var yoff = 0;
        if (this.m_nAlignHorizontal == dLabel.ALIGN_CENTER)
            xoff = (this.GetWidth() - this.m_pLabel.GetWidth()) / 2;
        else if (this.m_nAlignHorizontal == dLabel.ALIGN_RIGHT)
            xoff = this.GetWidth() - this.m_pLabel.GetWidth();
        if (this.m_nAlignVertical == dLabel.ALIGN_CENTER)
            yoff = (this.GetHeight() - this.m_pLabel.GetHeight()) / 2;
        else if (this.m_nAlignVertical == dLabel.ALIGN_RIGHT)
            yoff = this.GetHeight() - this.m_pLabel.GetHeight();
        this.m_pLabel.SetPos(-this.GetWidth() * this.GetAnchorU() + xoff, -this.GetHeight() * this.GetAnchorV() + yoff);
    };
    dInputBox.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("text"))
            this.text = json.text;
        if (json.hasOwnProperty("fontSize"))
            this.fontSize = json.fontSize;
        if (json.hasOwnProperty("alignVertical"))
            this.alignVertical = json.alignVertical;
        if (json.hasOwnProperty("alignHorizontal"))
            this.alignHorizontal = json.alignHorizontal;
        if (json.hasOwnProperty("password"))
            this.password = Boolean(dMath.ParseInt(json.password));
        if (json.hasOwnProperty("autoWrap"))
            this.autoWrap = Boolean(dMath.ParseInt(json.autoWrap));
    };
    return dInputBox;
}(dLabel));
var dLayoutHBox = (function (_super) {
    __extends(dLayoutHBox, _super);
    function dLayoutHBox() {
        var _this = _super.call(this) || this;
        _this.m_bNeedUpdate = false;
        _this.m_nAlignType = dLabel.ALIGN_CENTER;
        _this.m_fSpace = 10;
        _this.m_bSpaceAverage = false;
        _this.m_pResizeEvent = null;
        _this.m_pResizeEvent = new dSprite();
        _this.m_pResizeEvent.SetSize = function (w, h) {
            _this.m_bNeedUpdate = true;
        };
        _this.m_pResizeEvent.SetScale = function (x, y) {
            _this.m_bNeedUpdate = true;
        };
        _this.m_pResizeEvent.SetPos = function (x, y) {
            _this.m_bNeedUpdate = true;
        };
        return _this;
    }
    dLayoutHBox.prototype.AddChild = function (pChild, at) {
        if (at === void 0) { at = -1; }
        _super.prototype.AddChild.call(this, pChild, at);
        pChild.SetTouchEvent(this.m_pResizeEvent);
        this.m_bNeedUpdate = true;
    };
    dLayoutHBox.prototype.RemoveChild = function (pChild) {
        _super.prototype.RemoveChild.call(this, pChild);
        pChild.SetTouchEvent(null);
        this.m_bNeedUpdate = true;
    };
    dLayoutHBox.prototype.SetSize = function (w, h) {
        this.m_bNeedUpdate = true;
        _super.prototype.SetSize.call(this, w, h);
    };
    dLayoutHBox.prototype.SetAlignType = function (type) {
        this.m_nAlignType = type;
        this.m_bNeedUpdate = true;
    };
    dLayoutHBox.prototype.GetAlignType = function () {
        return this.m_nAlignType;
    };
    Object.defineProperty(dLayoutHBox.prototype, "alignType", {
        get: function () {
            return this.GetAlignType();
        },
        set: function (type) {
            this.SetAlignType(type);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dLayoutHBox.prototype, "space", {
        get: function () {
            return this.m_fSpace;
        },
        set: function (value) {
            this.m_fSpace = value;
            this.m_bNeedUpdate = true;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dLayoutHBox.prototype, "spaceAverage", {
        get: function () {
            return this.m_bSpaceAverage;
        },
        set: function (bAverage) {
            this.m_bSpaceAverage = bAverage;
            this.m_bNeedUpdate = true;
        },
        enumerable: false,
        configurable: true
    });
    dLayoutHBox.prototype._Render = function (mat, windowWidth, windowHeight, bFatherMatrixDirty) {
        if (this.m_bNeedUpdate) {
            this.UpdateLayout();
        }
        _super.prototype._Render.call(this, mat, windowWidth, windowHeight, bFatherMatrixDirty);
    };
    dLayoutHBox.prototype.UpdateLayout = function () {
        this.m_bNeedUpdate = false;
        var vec = this.GetChildList();
        if (vec.length == 0)
            return;
        var totalWidth = 0;
        var count = 0;
        for (var i = 0, n = vec.length; i < n; i++) {
            var p = vec[i];
            if (p.visible) {
                totalWidth += p.width * p.scaleX;
                count++;
            }
        }
        var space = this.m_fSpace;
        if (this.m_bSpaceAverage)
            space = (this.width - totalWidth) / (count + 1);
        totalWidth += (count - 1) * space;
        var mul = 0.5;
        if (this.m_nAlignType == dLabel.ALIGN_LEFT)
            mul = 0;
        else if (this.m_nAlignType == dLabel.ALIGN_RIGHT)
            mul = 1;
        var add = 0;
        for (var i = 0, n = vec.length; i < n; i++) {
            var p = vec[i];
            if (p.visible) {
                p.positionX = (this.width - totalWidth) * mul + add + p.anchorU * p.width * p.scaleX - this.anchorU * this.width;
                add += p.width * p.scaleX + space;
            }
        }
        if (this.GetEvent())
            this.GetEvent().OnUpdateLayout(this);
    };
    dLayoutHBox.prototype.LoadFromJson = function (j) {
        _super.prototype.LoadFromJson.call(this, j);
        if (j.hasOwnProperty("alignType"))
            this.alignType = dMath.ParseInt(j.alignType);
        if (j.hasOwnProperty("space"))
            this.space = dMath.ParseFloat(j.space);
        if (j.hasOwnProperty("spaceAverage"))
            this.spaceAverage = Boolean(dMath.ParseInt(j.spaceAverage));
    };
    return dLayoutHBox;
}(dBaseControl));
var dLayoutLimitScale = (function (_super) {
    __extends(dLayoutLimitScale, _super);
    function dLayoutLimitScale() {
        var _this = _super.call(this) || this;
        _this.m_bNeedUpdate = false;
        _this.m_pView = new dSprite();
        _this.m_pResizeEvent = new dSprite();
        _this.m_pResizeEvent.SetSize = function (w, h) {
            _this.m_bNeedUpdate = true;
        };
        _this.m_pResizeEvent.SetScale = function (x, y) {
            _this.m_bNeedUpdate = true;
        };
        _this.m_pResizeEvent.SetPos = function (x, y) {
            _this.m_bNeedUpdate = true;
        };
        _this.m_pView.SetAnchor(0.5, 0.5);
        _super.prototype.AddChild.call(_this, _this.m_pView);
        return _this;
    }
    dLayoutLimitScale.prototype.GetChildList = function () {
        return this.m_pView.GetChildList();
    };
    dLayoutLimitScale.prototype.AddChild = function (pChild, at) {
        if (at === void 0) { at = -1; }
        this.m_pView.AddChild(pChild, at);
        pChild.SetTouchEvent(this.m_pResizeEvent);
        this.m_bNeedUpdate = true;
    };
    dLayoutLimitScale.prototype.RemoveChild = function (pChild) {
        this.m_pView.RemoveChild(pChild);
        pChild.SetTouchEvent(null);
        this.m_bNeedUpdate = true;
    };
    dLayoutLimitScale.prototype.SetSize = function (w, h) {
        this.m_bNeedUpdate = true;
        _super.prototype.SetSize.call(this, w, h);
    };
    dLayoutLimitScale.prototype._Render = function (mat, windowWidth, windowHeight, bFatherMatrixDirty) {
        if (this.m_bNeedUpdate) {
            this.UpdateLayout();
        }
        _super.prototype._Render.call(this, mat, windowWidth, windowHeight, bFatherMatrixDirty);
    };
    dLayoutLimitScale.prototype.UpdateLayout = function () {
        this.m_bNeedUpdate = false;
        var vec = this.m_pView.GetChildList();
        if (vec.length == 0)
            return;
        var left;
        var top;
        var right;
        var bottom;
        var bFirst = true;
        for (var i = 0, n = vec.length; i < n; i++) {
            if (vec[i].visible) {
                var t_left = vec[i].positionX - vec[i].width * vec[i].anchorU * vec[i].scaleX;
                var t_right = vec[i].positionX + vec[i].width * vec[i].anchorU * vec[i].scaleX;
                var t_top = vec[i].positionY - vec[i].height * vec[i].anchorV * vec[i].scaleY;
                var t_bottom = vec[i].positionY + vec[i].height * vec[i].anchorV * vec[i].scaleY;
                if (bFirst) {
                    left = t_left;
                    top = t_top;
                    right = t_right;
                    bottom = t_bottom;
                    bFirst = false;
                }
                else {
                    if (left > t_left)
                        left = t_left;
                    if (right < t_right)
                        right = t_right;
                    if (top > t_top)
                        top = t_top;
                    if (bottom < t_bottom)
                        bottom = t_bottom;
                }
            }
        }
        var scaleLeft = this.width * 0.5 / dMath.Max(-left, this.width * 0.5);
        var scaleRight = this.width * 0.5 / dMath.Max(right, this.width * 0.5);
        var scaleTop = this.height * 0.5 / dMath.Max(-top, this.height * 0.5);
        var scaleBottom = this.height * 0.5 / dMath.Max(bottom, this.height * 0.5);
        var scale = scaleLeft;
        if (scale > scaleRight)
            scale = scaleRight;
        if (scale > scaleTop)
            scale = scaleTop;
        if (scale > scaleBottom)
            scale = scaleBottom;
        if (scale > 1)
            scale = 1;
        this.m_pView.SetScale(scale, scale);
    };
    return dLayoutLimitScale;
}(dBaseControl));
var dLayoutVBox = (function (_super) {
    __extends(dLayoutVBox, _super);
    function dLayoutVBox() {
        return _super.call(this) || this;
    }
    dLayoutVBox.prototype.UpdateLayout = function () {
        this.m_bNeedUpdate = false;
        var vec = this.GetChildList();
        if (vec.length == 0)
            return;
        var totalHeight = 0;
        var count = 0;
        for (var i = 0, n = vec.length; i < n; i++) {
            var p = vec[i];
            if (p.visible) {
                totalHeight += p.height * p.scaleY;
                count++;
            }
        }
        var space = this.m_fSpace;
        if (this.m_bSpaceAverage)
            space = (this.height - totalHeight) / (count + 1);
        totalHeight += (count - 1) * space;
        var mul = 0.5;
        if (this.m_nAlignType == dLabel.ALIGN_LEFT)
            mul = 0;
        else if (this.m_nAlignType == dLabel.ALIGN_RIGHT)
            mul = 1;
        var add = 0;
        for (var i = 0, n = vec.length; i < n; i++) {
            var p = vec[i];
            if (p.visible) {
                p.positionY = (this.height - totalHeight) * mul + add + p.anchorV * p.height * p.scaleY - this.anchorV * this.height;
                add += p.height * p.scaleY + space;
            }
        }
    };
    return dLayoutVBox;
}(dLayoutHBox));
var dScrollView = (function (_super) {
    __extends(dScrollView, _super);
    function dScrollView() {
        var _this = _super.call(this) || this;
        _this.m_pContainer = new dSprite();
        _this.m_pView = new dBaseControl();
        _this.m_pScrollH = new dScale9();
        _this.m_pScrollV = new dScale9();
        _this.m_pTimer = null;
        _this.m_pScrollHTimer = null;
        _this.m_pScrollVTimer = null;
        _this.m_fScrollHAlpha = 0;
        _this.m_fScrollVAlpha = 0;
        _this.m_vMoveDir = new dVector2();
        _this.m_pHandleMouse = new dSprite();
        _this.m_bCanDragH = false;
        _this.m_bCanDragV = true;
        _this.m_bCanViewOutsideH = true;
        _this.m_bCanViewOutsideV = true;
        _this.m_fViewPosAnimateX = 0;
        _this.m_fViewPosAnimateY = 0;
        _this.m_bPageMode = false;
        _this.m_nLastTouchMoveTime = 0;
        _this.m_vDownedObjScale = new dVector2(1, 1);
        _this.m_bUpdatingPerChild = false;
        _this.m_nPageWidth = 0;
        _this.m_nPageHeight = 0;
        _this.m_fTouchMoveAdd = 0;
        _this.touchMoveThreshold = 1;
        _this.m_bAutoSetScrollAlpha = true;
        _this.m_pCurrentTouchDownScaleSprite = null;
        _this.m_pBindPageView = null;
        _this.m_pTimerForAutoViewSize = null;
        _this.m_bTouchMoved = 0;
        _this.m_bTouchMoving = false;
        _this.m_pTouchDownCollectSprite = null;
        _this.touchDownScaleMode = true;
        _this.m_fTimeAdd = 0;
        var a = _this;
        a.SetClipChild(true);
        _super.prototype.AddChild.call(_this, a.m_pContainer);
        a.m_pContainer.AddChild(a.m_pView);
        if (dScrollView.s_pScrollButtonBitmap == null) {
            dScrollView.s_pScrollButtonBitmap = new dBitmapData();
            dScrollView.s_pScrollButtonBitmap.Create(9, 9, 0);
        }
        a.m_pScrollH.SetBitmapData(dScrollView.s_pScrollButtonBitmap);
        a.m_pScrollV.SetBitmapData(dScrollView.s_pScrollButtonBitmap);
        a.m_pContainer.AddChild(a.m_pScrollH);
        a.m_pContainer.AddChild(a.m_pScrollV);
        if (a.m_bAutoSetScrollAlpha) {
            a.m_pScrollH.SetAlpha(0);
            a.m_pScrollV.SetAlpha(0);
        }
        a.m_pContainer.AddChild(a.m_pHandleMouse);
        a.m_pHandleMouse.SetHandleMouse(true);
        var pTouchEvent = new dSprite();
        pTouchEvent.OnTouchDown = function (x, y, delta) {
            _this.OnTouchDown(x, y, delta);
        };
        pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
            _this.OnTouchMove(x, y, offx, offy, delta);
        };
        pTouchEvent.OnTouchUp = function (x, y) {
            _this.OnTouchUp(x, y);
        };
        a.m_pHandleMouse.SetTouchEvent(pTouchEvent);
        a.m_pView.SetAnchor(0, 0);
        a.m_pContainer.SetAnchor(0, 0);
        a.m_pHandleMouse.SetAnchor(0, 0);
        a.m_pScrollH.SetAnchor(0, 0);
        a.m_pScrollV.SetAnchor(0, 0);
        a.m_pContainer.SetPos(-a.GetAnchorU() * a.GetWidth(), -a.GetAnchorV() * a.GetHeight());
        return _this;
    }
    dScrollView.prototype.SetListBoxPageView = function (pageView) {
        if (this.m_pBindPageView != pageView) {
            this.m_pBindPageView = pageView;
            this.AdjustViewSize();
        }
    };
    dScrollView.prototype.GetListBoxPageView = function () {
        return this.m_pBindPageView;
    };
    dScrollView.prototype.Destroy = function () {
        this.StopMove();
        _super.prototype.Destroy.call(this);
    };
    dScrollView.prototype.SetHandleMouse = function (bHandle) {
        _super.prototype.SetHandleMouse.call(this, bHandle);
        this.m_pHandleMouse.SetHandleMouse(bHandle);
    };
    dScrollView.prototype.SetAnchor = function (u, v) {
        _super.prototype.SetAnchor.call(this, u, v);
        if (this.m_pContainer != null)
            this.m_pContainer.SetPos(-u * this.GetWidth(), -v * this.GetHeight());
    };
    dScrollView.prototype.GetView = function () {
        return this.m_pView;
    };
    dScrollView.prototype.CreateTimer = function () {
        var _this = this;
        if (!this.isDestroyed() && this.m_pTimer == null) {
            if (this.m_vMoveDir.x != 0 || this.m_vMoveDir.y != 0 || this.GetOffsetX() != 0 || this.GetOffsetY() != 0 ||
                this.m_fViewPosAnimateX != this.m_pView.positionX || this.m_fViewPosAnimateY != this.m_pView.positionY) {
                this.m_pTimer = new dTimer();
                this.m_pTimer.Create(0, 0, function (p, i, fTimeElapse) {
                    _this._OnTimer(fTimeElapse);
                });
            }
        }
    };
    dScrollView.prototype.SetSize = function (width, height) {
        _super.prototype.SetSize.call(this, width, height);
        this.m_pHandleMouse.SetSize(width, height);
        this.m_pContainer.SetPos(-this.GetAnchorU() * this.GetWidth(), -this.GetAnchorV() * this.GetHeight());
        this.UpdateScrollButtonSize();
        this.CreateTimer();
    };
    dScrollView.prototype._SetViewSize = function (width, height) {
        if (this.pageMode) {
            width = width + (width % this._GetPageWidth());
            height = height + (height % this._GetPageHeight());
        }
        this.SetViewSize(width, height);
        if (this.m_pBindPageView != null) {
            if (this.canDragH)
                this.m_pBindPageView.SetPageCount(this.GetPageCountX());
            else
                this.m_pBindPageView.SetPageCount(this.GetPageCountY());
        }
    };
    dScrollView.prototype.SetViewSize = function (width, height) {
        if (this.m_pTimerForAutoViewSize != null)
            this.m_pTimerForAutoViewSize.Apply();
        this.m_pView.SetSize(width, height);
        this.UpdateScrollButtonSize();
        this.CreateTimer();
    };
    dScrollView.prototype.GetViewWidth = function () {
        if (this.m_pTimerForAutoViewSize != null)
            this.m_pTimerForAutoViewSize.Apply();
        return this.m_pView.GetWidth();
    };
    dScrollView.prototype.GetViewHeight = function () {
        if (this.m_pTimerForAutoViewSize != null)
            this.m_pTimerForAutoViewSize.Apply();
        return this.m_pView.GetHeight();
    };
    dScrollView.prototype.AdjustViewSize = function () {
        var a = this;
        if (!a.isDestroyed() && a.m_pTimerForAutoViewSize == null) {
            a.m_pTimerForAutoViewSize = new dTimer();
            a.m_pTimerForAutoViewSize.Create(0, 1, function (p, iTimer, fTimer) {
                a.m_pTimerForAutoViewSize = null;
                a.m_pView.SetSize(0, 0);
                var rc = a.m_pView.GetBoundRect(false);
                a._SetViewSize(rc.right, rc.bottom);
            });
        }
    };
    dScrollView.prototype.OnTouchDown = function (x, y, delta) {
        var a = this;
        a.m_fTouchMoveAdd = 0;
        a.StopMove();
        a.m_bTouchMoved = 0;
        a.m_bTouchMoving = false;
        a.m_nLastTouchMoveTime = 0;
        a.m_pTouchDownCollectSprite = a.m_pView.CollectionChild(x, y);
        if (a.m_pTouchDownCollectSprite != null) {
            if ((a.m_pTouchDownCollectSprite instanceof dBaseControl) && !a.m_pTouchDownCollectSprite.isEnable()) {
                a.m_pTouchDownCollectSprite = null;
            }
        }
        a.OnTouchDownToChild(a.m_pTouchDownCollectSprite);
        _super.prototype.OnTouchDown.call(this, x, y, delta);
    };
    dScrollView.prototype.SetTouchDownScaleMode = function (bScaleMode) {
        this.touchDownScaleMode = bScaleMode;
    };
    dScrollView.prototype.OnTouchDownToChild = function (child) {
        if (this.m_pEvent == null || this.m_pEvent != null && !this.m_pEvent.OnScrollViewTouchDownToChild(child)) {
            if (child != null && this.touchDownScaleMode) {
                this.m_vDownedObjScale.SetValue(child.scaleX, child.scaleY);
                child.SetScale(child.scaleX - 0.05, child.scaleY - 0.05);
                this.m_pCurrentTouchDownScaleSprite = child;
            }
        }
    };
    dScrollView.prototype.OnTouchUpToChild = function (child) {
        var bRet = false;
        if (this.m_pEvent == null || this.m_pEvent != null && !(bRet = this.m_pEvent.OnScrollViewTouchUpToChild(child))) {
            if (child != null && this.touchDownScaleMode) {
                child.SetScale(this.m_vDownedObjScale.x, this.m_vDownedObjScale.y);
                this.m_pCurrentTouchDownScaleSprite = null;
            }
        }
        return bRet;
    };
    dScrollView.prototype.CheckViewOutside = function () {
        var a = this;
        if (!a.m_bCanViewOutsideH) {
            if (a.GetWidth() >= a.m_pView.GetWidth())
                a._SetViewPos(0, a.m_pView.positionY);
            else {
                if (a.m_pView.positionX > 0)
                    a._SetViewPos(0, a.m_pView.positionY);
                else if (a.m_pView.positionX < -(a.m_pView.GetWidth() - a.GetWidth()))
                    a._SetViewPos(-(a.m_pView.GetWidth() - a.GetWidth()), a.m_pView.positionY);
            }
        }
        if (!a.m_bCanViewOutsideV) {
            if (a.GetHeight() >= a.m_pView.GetHeight())
                a._SetViewPos(a.m_pView.positionX, 0);
            else {
                if (a.m_pView.positionY > 0)
                    a._SetViewPos(a.m_pView.positionX, 0);
                else if (a.m_pView.positionY < -(a.m_pView.GetHeight() - a.GetHeight()))
                    a._SetViewPos(a.m_pView.positionX, -(a.m_pView.GetHeight() - a.GetHeight()));
            }
        }
    };
    dScrollView.prototype.OnTouchMove = function (mouseX, mouseY, x, y, delta) {
        var a = this;
        if (!a.m_bCanDragH)
            x = 0;
        if (!a.m_bCanDragV)
            y = 0;
        if (a.m_pView.GetWidth() < a.GetWidth() && !a.m_bCanViewOutsideH)
            x = 0;
        if (a.m_pView.GetHeight() < a.GetHeight() && !a.m_bCanViewOutsideV)
            y = 0;
        if (dMath.Abs(a.m_fTouchMoveAdd) > a.touchMoveThreshold) {
            a.m_bTouchMoved += x + y;
            a.m_bTouchMoving = true;
            a.m_vMoveDir.SetValue(x, y);
            a._SetViewPos(a.m_pView.GetPosX() + x, a.m_pView.GetPosY() + y);
            a.CheckViewOutside();
            a.UpdateScrollButtonSize();
            if (a.m_pEvent != null)
                a.m_pEvent.OnScroll(this);
        }
        else
            a.m_fTouchMoveAdd += x + y;
        a.m_nLastTouchMoveTime = dTimer.GetTickCount();
        _super.prototype.OnTouchMove.call(this, mouseX, mouseY, x, y, delta);
    };
    dScrollView.prototype.GetPageX = function () {
        var pageWidth = dMath.ToInt(this._GetPageWidth());
        if (pageWidth == 0)
            return 0;
        return -dMath.ToInt((this.m_fViewPosAnimateX - pageWidth / 2) / pageWidth);
    };
    dScrollView.prototype.GetPageY = function () {
        var pageHeight = dMath.ToInt(this._GetPageHeight());
        if (pageHeight == 0)
            return 0;
        return -dMath.ToInt((this.m_fViewPosAnimateY - pageHeight / 2) / pageHeight);
    };
    dScrollView.prototype.GetPageCountX = function () {
        return dMath.Ceil(this.GetViewWidth() / this._GetPageWidth());
    };
    dScrollView.prototype.GetPageCountY = function () {
        return dMath.Ceil(this.GetViewHeight() / this._GetPageHeight());
    };
    dScrollView.prototype.SetPage = function (x, y, bPlayAnimate) {
        if (bPlayAnimate === void 0) { bPlayAnimate = true; }
        if (bPlayAnimate)
            this.SetViewPosAnimate(-x * this._GetPageWidth(), -y * this._GetPageHeight());
        else
            this.SetViewPos(-x * this._GetPageWidth(), -y * this._GetPageHeight(), false);
        if (this.m_pBindPageView != null) {
            if (this.canDragH)
                this.m_pBindPageView.SetCurPage(x);
            else
                this.m_pBindPageView.SetCurPage(y);
        }
    };
    Object.defineProperty(dScrollView.prototype, "pageMode", {
        get: function () {
            return this.m_bPageMode;
        },
        set: function (v) {
            this.m_bPageMode = v;
            this.AdjustViewSize();
        },
        enumerable: false,
        configurable: true
    });
    dScrollView.prototype._GetPageWidth = function () {
        if (this.m_nPageWidth == 0)
            return this.width;
        return this.m_nPageWidth;
    };
    dScrollView.prototype._GetPageHeight = function () {
        if (this.m_nPageHeight == 0)
            return this.height;
        return this.m_nPageHeight;
    };
    dScrollView.prototype.SetPageSize = function (width, height) {
        this.m_nPageWidth = width;
        this.m_nPageHeight = height;
    };
    dScrollView.prototype.GetPageWidth = function () {
        return this.m_nPageWidth;
    };
    dScrollView.prototype.GetPageHeight = function () {
        return this.m_nPageHeight;
    };
    dScrollView.prototype.OnTouchUp = function (x, y) {
        var a = this;
        a.m_bTouchMoving = false;
        if (dTimer.GetTickCount() > a.m_nLastTouchMoveTime + 150)
            a.m_vMoveDir.SetValue(0, 0);
        if (a.m_bPageMode) {
            a._SetViewPosAnimate(a.m_fViewPosAnimateX + (a.m_vMoveDir.x > 0 ? a._GetPageWidth() / 3 : -a._GetPageWidth() / 3), a.m_fViewPosAnimateY + (a.m_vMoveDir.y > 0 ? a._GetPageHeight() / 3 : -a._GetPageHeight() / 3));
            a.SetPage(a.GetPageX(), a.GetPageY());
            a.m_vMoveDir.SetValue(0, 0);
        }
        a.CreateTimer();
        var bTouchUpHandled = a.OnTouchUpToChild(a.m_pTouchDownCollectSprite);
        if (!bTouchUpHandled && a.m_pTouchDownCollectSprite != null) {
            if (dMath.Abs(a.m_bTouchMoved) < 3) {
                var xx = x - a.m_pTouchDownCollectSprite.GetPosX_World(this, false) - a.anchorU * a.width;
                var yy = y - a.m_pTouchDownCollectSprite.GetPosY_World(this, false) - a.anchorV * a.height;
                var bHandleTouch = false;
                if (!bHandleTouch) {
                    a.m_pTouchDownCollectSprite.OnTouchDown(xx, yy, 1);
                    a.m_pTouchDownCollectSprite.OnTouchUp(xx, yy);
                }
            }
            a.m_pTouchDownCollectSprite = null;
        }
        _super.prototype.OnTouchUp.call(this, x, y);
    };
    dScrollView.prototype.StopMove = function () {
        this.m_vMoveDir.SetValue(0, 0);
        if (this.m_pTimer != null) {
            this.m_pTimer.Stop();
            this.m_pTimer = null;
        }
    };
    dScrollView.prototype._OnTimer = function (fTimeElapse) {
        var a = this;
        a.m_fTimeAdd += fTimeElapse;
        if (a.m_fTimeAdd > 1)
            a.m_fTimeAdd = 1;
        var bMoved = false;
        while (a.m_fTimeAdd > 0.01) {
            if (dMath.Abs(a.m_fViewPosAnimateX - a.m_pView.positionX) < 1)
                a.m_fViewPosAnimateX = a.m_pView.positionX;
            if (dMath.Abs(a.m_fViewPosAnimateY - a.m_pView.positionY) < 1)
                a.m_fViewPosAnimateY = a.m_pView.positionY;
            var moveX = (a.m_fViewPosAnimateX - a.m_pView.positionX) * 0.1;
            var moveY = (a.m_fViewPosAnimateY - a.m_pView.positionY) * 0.1;
            if (moveX != 0 || moveY != 0) {
                a._SysSetViewPos(a.m_pView.positionX + moveX, a.m_pView.positionY + moveY);
                bMoved = true;
            }
            if (!a.m_bTouchMoving) {
                a._SetViewPosAnimate(a.m_fViewPosAnimateX + a.m_vMoveDir.x, a.m_fViewPosAnimateY + a.m_vMoveDir.y);
                a.m_vMoveDir.MulAppendF(0.95);
                if (a.m_vMoveDir.Length() < 1)
                    a.m_vMoveDir.SetValue(0, 0);
            }
            else {
                a._SetViewPosAnimate(a.m_fViewPosAnimateX, a.m_fViewPosAnimateY);
            }
            a.m_fTimeAdd -= 0.01;
        }
        if (bMoved) {
            a.UpdateScrollButtonSize();
            a.OnViewScrolled(a.m_pView.positionX, a.m_pView.positionY);
            if (a.m_pEvent != null)
                a.m_pEvent.OnScroll(this);
        }
        if (a.m_vMoveDir.x == 0 && a.m_vMoveDir.y == 0 && a.m_pView.positionX == a.m_fViewPosAnimateX && a.m_pView.positionY == a.m_fViewPosAnimateY)
            a.StopMove();
    };
    dScrollView.prototype.OnViewScrolled = function (x, y) {
    };
    dScrollView.prototype._SysSetViewPos = function (x, y) {
        if (x != this.m_pView.positionX || y != this.m_pView.positionY) {
            this.m_pView.SetPos(x, y);
            if (this.m_pEvent != null)
                this.m_pEvent.OnScrollViewPosChanged(this);
        }
    };
    dScrollView.prototype._SetViewPos = function (x, y) {
        this._SetViewPosAnimate(x, y);
        this._SysSetViewPos(x, y);
        this.OnViewScrolled(x, y);
    };
    dScrollView.prototype.ScrollToTop = function (bAnimate) {
        this.SetViewPos(0, 0, bAnimate);
    };
    dScrollView.prototype.ScrollToBottom = function (bAnimate) {
        this.SetViewPos(0, -this.GetViewHeight(), bAnimate);
    };
    dScrollView.prototype.isViewTop = function () {
        return this.m_pView.positionY > 0;
    };
    dScrollView.prototype.isViewBottom = function () {
        return this.m_pView.positionY < -(this.m_pView.GetHeight() - this.GetHeight());
    };
    dScrollView.prototype.SetViewPos = function (x, y, bAnimate) {
        if (bAnimate === void 0) { bAnimate = true; }
        var a = this;
        if (a.isDestroyed())
            return;
        a.SetViewPosAnimate(x, y);
        if (!bAnimate) {
            a._SetViewPos(x, y);
            if (a.m_bCanDragH) {
                if (a.GetWidth() >= a.m_pView.GetWidth())
                    a._SysSetViewPos(0, a.m_pView.positionY);
                else {
                    if (a.m_pView.positionX > 0)
                        a._SysSetViewPos(0, a.m_pView.positionY);
                    else if (a.m_pView.positionX < -(a.m_pView.GetWidth() - a.GetWidth()))
                        a._SysSetViewPos(-(a.m_pView.GetWidth() - a.GetWidth()), a.m_pView.positionY);
                }
            }
            if (a.m_bCanDragV) {
                if (a.GetHeight() >= a.m_pView.GetHeight())
                    a._SysSetViewPos(a.m_pView.positionX, 0);
                else {
                    if (a.m_pView.positionY > 0)
                        a._SysSetViewPos(a.m_pView.positionX, 0);
                    else if (a.m_pView.positionY < -(a.m_pView.GetHeight() - a.GetHeight()))
                        a._SysSetViewPos(a.m_pView.positionX, -(a.m_pView.GetHeight() - a.GetHeight()));
                }
            }
        }
    };
    dScrollView.prototype._SetViewPosAnimate = function (x, y) {
        var a = this;
        var vw = a.m_pView.width;
        if (vw < a.width)
            vw = a.width;
        var vh = a.m_pView.height;
        if (vh < a.height)
            vh = a.height;
        if (x > 0)
            x = 0;
        else if (x < -vw + a.width)
            x = -vw + a.width;
        if (y > 0)
            y = 0;
        else if (y < -vh + a.height)
            y = -vh + a.height;
        a.m_fViewPosAnimateX = x;
        a.m_fViewPosAnimateY = y;
    };
    dScrollView.prototype.SetViewPosAnimate = function (x, y) {
        if (this.m_fViewPosAnimateX != x || this.m_fViewPosAnimateY != y) {
            if (this.m_pTimerForAutoViewSize != null)
                this.m_pTimerForAutoViewSize.Apply();
            this.m_vMoveDir.SetValue(0, 0);
            this._SetViewPosAnimate(x, y);
            this.CreateTimer();
        }
    };
    dScrollView.prototype.GetViewPosX = function () {
        return this.m_pView.GetPosX();
    };
    dScrollView.prototype.GetViewPosY = function () {
        return this.m_pView.GetPosY();
    };
    dScrollView.prototype.GetOffsetX = function () {
        var width = dMath.Min(this.GetWidth(), this.m_pView.GetWidth());
        if (this.m_pView.GetPosX() > 0)
            return this.m_pView.GetPosX();
        else if (this.m_pView.GetPosX() < (width - this.m_pView.GetWidth()))
            return this.m_pView.GetPosX() - (width - this.m_pView.GetWidth());
        return 0;
    };
    dScrollView.prototype.GetOffsetY = function () {
        var height = dMath.Min(this.GetHeight(), this.m_pView.GetHeight());
        if (this.m_pView.GetPosY() > 0)
            return this.m_pView.GetPosY();
        else if (this.m_pView.GetPosY() < (height - this.m_pView.GetHeight()))
            return this.m_pView.GetPosY() - (height - this.m_pView.GetHeight());
        return 0;
    };
    dScrollView.prototype.GetViewOffsetLeft = function () {
        var width = dMath.Min(this.GetWidth(), this.m_pView.GetWidth());
        if (this.m_pView.GetPosX() > 0)
            return this.m_pView.GetPosX();
        return 0;
    };
    dScrollView.prototype.GetViewOffsetRight = function () {
        var width = dMath.Min(this.GetWidth(), this.m_pView.GetWidth());
        if (this.m_pView.GetPosX() > 0)
            return 0;
        else if (this.m_pView.GetPosX() < (width - this.m_pView.GetWidth()))
            return -(this.m_pView.GetPosX() - (width - this.m_pView.GetWidth()));
        return 0;
    };
    dScrollView.prototype.EndDsc = function () {
        _super.prototype.EndDsc.call(this);
        this.UpdateScrollButtonSize();
    };
    dScrollView.prototype.UpdateScrollButtonSize = function () {
        var a = this;
        if (a.m_bBeginDsc)
            return;
        var width_add = dMath.Abs(a.GetOffsetX());
        var height_add = dMath.Abs(a.GetOffsetY());
        var bNeedShowHScrollButton = false;
        var bNeedShowVScrollButton = false;
        var width = a.GetWidth();
        if (a.m_pView.GetWidth() != 0) {
            width = a.GetWidth() / (a.m_pView.GetWidth() + width_add) * a.GetWidth();
            if (width != a.m_pScrollH.GetWidth())
                bNeedShowHScrollButton = true;
            if (width > a.GetWidth())
                width = a.GetWidth();
        }
        var height = a.GetHeight();
        if (a.m_pView.GetHeight() != 0) {
            height = a.GetHeight() / (a.m_pView.GetHeight() + height_add) * a.GetHeight();
            if (height != a.m_pScrollV.GetHeight())
                bNeedShowVScrollButton = true;
            if (height > a.GetHeight())
                height = a.GetHeight();
        }
        var scrollWidth = 5;
        if (a.m_pScrollH.GetBitmapData() != null && scrollWidth < a.m_pScrollH.GetBitmapData().GetWidth())
            scrollWidth = this.m_pScrollH.GetBitmapData().GetWidth();
        a.m_pScrollH.SetSize(width, scrollWidth);
        a.m_pScrollV.SetSize(scrollWidth, height);
        var x = -a.m_pView.GetPosX() / (a.m_pView.GetWidth() - a.GetWidth()) * (a.GetWidth() - a.m_pScrollH.GetWidth());
        var limit_x = (a.GetWidth() - a.m_pScrollH.GetWidth());
        if (x < 0)
            x = 0;
        else if (x > limit_x)
            x = limit_x;
        if (bNeedShowHScrollButton || x != a.m_pScrollH.GetPosX()) {
            a.m_fScrollHAlpha = 1.5;
            if (a.m_bAutoSetScrollAlpha)
                a.m_pScrollH.SetAlpha(0.5);
            if (!a.m_bCanDragH) {
                a.m_fScrollHAlpha = 0;
                if (a.m_bAutoSetScrollAlpha)
                    a.m_pScrollH.SetAlpha(0);
            }
            else if (a.m_pScrollHTimer == null) {
                a.m_pScrollHTimer = new dTimer();
                a.m_pScrollHTimer.Create(0, 0, function (p, ii, f) {
                    a.m_fScrollHAlpha -= f;
                    if (a.m_fScrollHAlpha < 0) {
                        a.m_fScrollHAlpha = 0;
                        a.m_pScrollHTimer.Stop();
                        a.m_pScrollHTimer = null;
                    }
                    if (a.m_bAutoSetScrollAlpha)
                        a.m_pScrollH.SetAlpha(dMath.Clamp(a.m_fScrollHAlpha, 0, 0.5));
                });
            }
        }
        a.m_pScrollH.SetPos(x, a.GetHeight() - a.m_pScrollH.GetHeight());
        var y = -a.m_pView.GetPosY() / (a.m_pView.GetHeight() - a.GetHeight()) * (a.GetHeight() - a.m_pScrollV.GetHeight());
        var limit_y = (a.GetHeight() - a.m_pScrollV.GetHeight());
        if (y < 0)
            y = 0;
        else if (y > limit_y)
            y = limit_y;
        if (bNeedShowVScrollButton || y != a.m_pScrollV.GetPosY()) {
            a.m_fScrollVAlpha = 1.5;
            if (a.m_bAutoSetScrollAlpha)
                a.m_pScrollV.SetAlpha(0.5);
            if (!a.m_bCanDragV) {
                a.m_fScrollVAlpha = 0;
                if (a.m_bAutoSetScrollAlpha)
                    a.m_pScrollV.SetAlpha(0);
            }
            else if (a.m_pScrollVTimer == null) {
                a.m_pScrollVTimer = new dTimer();
                a.m_pScrollVTimer.Create(0, 0, function (p, ii, f) {
                    a.m_fScrollVAlpha -= f;
                    if (a.m_fScrollVAlpha < 0) {
                        a.m_fScrollVAlpha = 0;
                        a.m_pScrollVTimer.Stop();
                        a.m_pScrollVTimer = null;
                    }
                    if (a.m_bAutoSetScrollAlpha)
                        a.m_pScrollV.SetAlpha(dMath.Clamp(a.m_fScrollVAlpha, 0, 0.5));
                });
            }
        }
        a.m_pScrollV.SetPos(a.GetWidth() - a.m_pScrollV.GetWidth(), y);
    };
    dScrollView.prototype.AddChildToContainer = function (pChild, at) {
        if (at === void 0) { at = -1; }
        _super.prototype.AddChild.call(this, pChild, at);
    };
    dScrollView.prototype.AddChild = function (pChild, at) {
        if (at === void 0) { at = -1; }
        this.m_pView.AddChild(pChild, at);
        this.AdjustViewSize();
    };
    dScrollView.prototype.RemoveChild = function (pChild) {
        this.m_pView.RemoveChild(pChild);
        this.AdjustViewSize();
    };
    dScrollView.prototype.RemoveAllChild = function (bDestory) {
        if (bDestory === void 0) { bDestory = false; }
        this.m_pView.RemoveAllChild(bDestory);
        this.AdjustViewSize();
    };
    dScrollView.prototype.GetChildList = function () {
        return this.m_pView.GetChildList();
    };
    Object.defineProperty(dScrollView.prototype, "canDragH", {
        get: function () {
            return this.m_bCanDragH;
        },
        set: function (bCan) {
            this.m_bCanDragH = bCan;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dScrollView.prototype, "canDragV", {
        get: function () {
            return this.m_bCanDragV;
        },
        set: function (bCan) {
            this.m_bCanDragV = bCan;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dScrollView.prototype, "canOutsideViewH", {
        get: function () {
            return this.m_bCanViewOutsideH;
        },
        set: function (bCan) {
            this.m_bCanViewOutsideH = bCan;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dScrollView.prototype, "canOutsideViewV", {
        get: function () {
            return this.m_bCanViewOutsideV;
        },
        set: function (bCan) {
            this.m_bCanViewOutsideV = bCan;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dScrollView.prototype, "viewPosX", {
        get: function () {
            return this.GetViewPosX();
        },
        set: function (value) {
            this.SetViewPos(value, this.GetViewPosY());
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dScrollView.prototype, "viewPosY", {
        get: function () {
            return this.GetViewPosY();
        },
        set: function (value) {
            this.SetViewPos(this.GetViewPosX(), value);
        },
        enumerable: false,
        configurable: true
    });
    dScrollView.prototype.SetShowScroll = function (bShow) {
        this.m_pScrollH.visible = bShow;
        this.m_pScrollV.visible = bShow;
    };
    dScrollView.prototype.isShowScroll = function () {
        return this.m_pScrollH.visible && this.m_pScrollV.visible;
    };
    dScrollView.prototype.SetScrollBitmapData = function (bmp) {
        this.m_pScrollH.SetBitmapData(bmp);
        this.m_pScrollV.SetBitmapData(bmp);
    };
    dScrollView.prototype.SetScrollAutoSetAlpha = function (bSet) {
        this.m_bAutoSetScrollAlpha = bSet;
        if (!bSet) {
            this.GetScrollH().SetAlpha(this.canDragH ? 1 : 0);
            this.GetScrollV().SetAlpha(this.canDragV ? 1 : 0);
        }
    };
    dScrollView.prototype.GetScrollH = function () {
        return this.m_pScrollH;
    };
    dScrollView.prototype.GetScrollV = function () {
        return this.m_pScrollV;
    };
    dScrollView.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("canDragH"))
            this.canDragH = Boolean(dMath.ParseInt(json.canDragH));
        if (json.hasOwnProperty("canDragV"))
            this.canDragV = Boolean(dMath.ParseInt(json.canDragV));
    };
    dScrollView.s_pScrollButtonBitmap = null;
    return dScrollView;
}(dBaseControl));
var dListBox = (function (_super) {
    __extends(dListBox, _super);
    function dListBox() {
        var _this = _super.call(this) || this;
        _this.m_pSelect = new dImage();
        _this.m_nSelect = -1;
        _this.m_bVerticalList = true;
        _this.m_fLineSpace = 0;
        _this.m_fBlankSpace = 0;
        _this.m_nBlankCount = 1;
        _this.m_nVirtualChildCount = -1;
        _this.m_vecLastVirtualChildIndex = null;
        _this.m_vecCurVirtualChildIndex = null;
        _this.m_vecVirtualChildList = null;
        _this.m_fVirtualChildOffsetY = 0;
        _this.m_fViewSizeOffsetRight = 0;
        _this.m_fViewSizeOffsetBottom = 0;
        _this.m_bHeaderHasSpace = false;
        _this.m_bComputingVirtualChild = false;
        _this.m_pSelect.SetColor(0x800000FF);
        _this.m_pSelect.SetAnchor(0, 0);
        _this.AddChildToContainer(_this.m_pSelect, 0);
        return _this;
    }
    dListBox.prototype.SetViewSizeOffset = function (left, top, right, bottom) {
        this.m_fViewSizeOffsetRight = right;
        this.m_fViewSizeOffsetBottom = bottom;
    };
    dListBox.prototype.SetVirtualChildCount = function (count) {
        count = dMath.ToInt(count);
        this.m_nVirtualChildCount = count;
        this.m_vecLastVirtualChildIndex = null;
        this.m_vecCurVirtualChildIndex = null;
        if (count == -1)
            this.m_vecVirtualChildList = null;
        else {
            this.m_vecVirtualChildList = new Array();
            this.m_vecVirtualChildList.copy(this.m_pView.GetChildList());
        }
        this.UpdateViewSize();
    };
    dListBox.prototype.GetVirtualChildCount = function () {
        return this.m_nVirtualChildCount;
    };
    Object.defineProperty(dListBox.prototype, "vertical", {
        get: function () {
            return this.m_bVerticalList;
        },
        set: function (bVertical) {
            if (this.m_bVerticalList != bVertical) {
                this.m_bVerticalList = bVertical;
                this.canDragH = !bVertical;
                this.canDragV = bVertical;
                this.UpdateViewSize();
            }
        },
        enumerable: false,
        configurable: true
    });
    dListBox.prototype.SetLineSpace = function (value) {
        this.m_fLineSpace = value;
        this.UpdateViewSize();
    };
    dListBox.prototype.GetLineSpace = function () {
        return this.m_fLineSpace;
    };
    Object.defineProperty(dListBox.prototype, "lineSpace", {
        get: function () {
            return this.GetLineSpace();
        },
        set: function (value) {
            this.SetLineSpace(value);
        },
        enumerable: false,
        configurable: true
    });
    dListBox.prototype.SetBlankSpace = function (value) {
        this.m_fBlankSpace = value;
        this.UpdateViewSize();
    };
    dListBox.prototype.GetBlankSpace = function () {
        return this.m_fBlankSpace;
    };
    Object.defineProperty(dListBox.prototype, "blankSpace", {
        get: function () {
            return this.GetBlankSpace();
        },
        set: function (value) {
            this.SetBlankSpace(value);
        },
        enumerable: false,
        configurable: true
    });
    dListBox.prototype.SetBlankCount = function (count) {
        this.m_nBlankCount = count;
        this.UpdateViewSize();
    };
    dListBox.prototype.GetBlankCount = function () {
        return this.m_nBlankCount;
    };
    Object.defineProperty(dListBox.prototype, "blankCount", {
        get: function () {
            return this.GetBlankCount();
        },
        set: function (count) {
            if (count < 1)
                count = 1;
            this.SetBlankCount(count);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dListBox.prototype, "headerHasSpace", {
        get: function () {
            return this.m_bHeaderHasSpace;
        },
        set: function (value) {
            this.m_bHeaderHasSpace = value;
            this.UpdateViewSize();
        },
        enumerable: false,
        configurable: true
    });
    dListBox.prototype.AddChild = function (pChild, at) {
        if (at === void 0) { at = -1; }
        _super.prototype.AddChild.call(this, pChild, at);
        if (this.m_vecVirtualChildList != null && this.m_vecVirtualChildList.indexOf(pChild) == -1)
            this.m_vecVirtualChildList.push(pChild);
        this.UpdateViewSize();
    };
    dListBox.prototype.RemoveChild = function (pChild) {
        _super.prototype.RemoveChild.call(this, pChild);
        if (this.m_vecVirtualChildList != null)
            this.m_vecVirtualChildList.remove(pChild);
        this.UpdateViewSize();
    };
    dListBox.prototype.RemoveAllChild = function (bDestory) {
        if (bDestory === void 0) { bDestory = false; }
        _super.prototype.RemoveAllChild.call(this, bDestory);
        this.UpdateViewSize();
        this.SetViewPos(0, 0);
    };
    dListBox.prototype.GetViewWidth = function () {
        return _super.prototype.GetViewWidth.call(this);
    };
    dListBox.prototype.GetViewHeight = function () {
        return _super.prototype.GetViewHeight.call(this);
    };
    dListBox.prototype.OnUpdatePerChildEnd = function () {
        this.UpdateViewSize();
    };
    dListBox.prototype.EndDsc = function () {
        _super.prototype.EndDsc.call(this);
        this.UpdateViewSize();
    };
    dListBox.prototype.OnViewScrolled = function (x, y) {
        _super.prototype.OnViewScrolled.call(this, x, y);
        this.ComputeVirtualChild(x, y);
    };
    dListBox.prototype.GetVirtualIndexByChildIndex = function (childIndex) {
        return this.m_vecCurVirtualChildIndex[childIndex];
    };
    dListBox.prototype.SetVirtualChildOffsetY = function (offy) {
        this.m_fVirtualChildOffsetY = offy;
    };
    dListBox.prototype.ComputeVirtualChild = function (x, y) {
        var a = this;
        if (a.m_bComputingVirtualChild || a.isDestroyed())
            return;
        y += a.m_fVirtualChildOffsetY;
        a.m_bComputingVirtualChild = true;
        if (a.m_nVirtualChildCount > -1 && a.m_vecVirtualChildList.length > 0) {
            if (a.m_pCurrentTouchDownScaleSprite != null) {
                a.m_pCurrentTouchDownScaleSprite.SetScale(a.m_vDownedObjScale.x, a.m_vDownedObjScale.y);
            }
            var vecChild = a.m_vecVirtualChildList;
            var nLineCount = dMath.ToInt(vecChild.length / a.m_nBlankCount);
            var nVirtualLineCount = dMath.ToInt((a.m_nVirtualChildCount + (a.m_nBlankCount - 1)) / a.m_nBlankCount);
            for (var i = nVirtualLineCount * a.m_nBlankCount; i < vecChild.length; i++)
                vecChild[i].visible = false;
            if (a.m_vecLastVirtualChildIndex == null || a.m_vecLastVirtualChildIndex.length != nLineCount) {
                a.m_vecLastVirtualChildIndex = new Array(nLineCount);
                for (var i = 0; i < a.m_vecLastVirtualChildIndex.length; i++)
                    a.m_vecLastVirtualChildIndex[i] = -1;
            }
            if (a.m_vecCurVirtualChildIndex == null || a.m_vecCurVirtualChildIndex.length != nLineCount) {
                a.m_vecCurVirtualChildIndex = new Array(nLineCount);
            }
            if (a.m_bVerticalList) {
                var xpos = 0;
                var ypos = 0;
                var maxHeight2 = 0;
                for (var i = 0, n = nLineCount; i < n; i++) {
                    xpos = 0;
                    for (var j = 0; j < a.m_nBlankCount; j++) {
                        var index = i * a.m_nBlankCount + j;
                        if (index < vecChild.length) {
                            var pChild = vecChild[index];
                            pChild.SetPos(pChild.GetWidth() * pChild.GetAnchorU() * pChild.GetScaleX() + xpos + (a.m_bHeaderHasSpace ? a.m_fBlankSpace : 0), pChild.GetHeight() * pChild.GetAnchorV() * pChild.GetScaleY() + ypos + (a.m_bHeaderHasSpace ? a.m_fLineSpace : 0));
                            if (maxHeight2 < pChild.GetHeight() * pChild.GetScaleY())
                                maxHeight2 = pChild.GetHeight() * pChild.GetScaleY();
                            xpos += pChild.width * pChild.scaleX + a.m_fBlankSpace;
                        }
                    }
                    ypos += maxHeight2 + a.m_fLineSpace;
                    a.m_vecCurVirtualChildIndex[i] = i;
                }
                if (ypos > 0) {
                    var curTop = 0;
                    var count = 0;
                    var step = -dMath.ToInt(y / ypos);
                    while (a.m_vecCurVirtualChildIndex[a.m_vecCurVirtualChildIndex.length - 1] + step * nLineCount >= nVirtualLineCount)
                        step--;
                    if (step > 0) {
                        for (var i = 0, n = nLineCount; i < n; i++) {
                            a.m_vecCurVirtualChildIndex[i] += step * nLineCount;
                            for (var k = 0; k < a.m_nBlankCount; k++)
                                vecChild[i * a.m_nBlankCount + k].positionY += step * ypos;
                        }
                        count += step * nLineCount;
                    }
                    while (vecChild[curTop * a.m_nBlankCount].positionY + vecChild[curTop * a.m_nBlankCount].height - vecChild[curTop * a.m_nBlankCount].anchorV * vecChild[curTop * a.m_nBlankCount].height + y < 0 &&
                        count < nVirtualLineCount - nLineCount) {
                        for (var k = 0; k < a.m_nBlankCount; k++)
                            vecChild[curTop * a.m_nBlankCount + k].positionY += ypos;
                        a.m_vecCurVirtualChildIndex[curTop] += nLineCount;
                        curTop++;
                        curTop %= nLineCount;
                        count++;
                    }
                }
            }
            else {
                var xpos = 0;
                var ypos = 0;
                var maxWidth2 = 0;
                for (var i = 0, n = nLineCount; i < n; i++) {
                    ypos = 0;
                    for (var j = 0; j < a.m_nBlankCount; j++) {
                        var index = i * a.m_nBlankCount + j;
                        if (index < vecChild.length) {
                            var pChild = vecChild[index];
                            pChild.SetPos(pChild.GetWidth() * pChild.GetAnchorU() * pChild.GetScaleX() + xpos + (a.m_bHeaderHasSpace ? a.m_fLineSpace : 0), pChild.GetHeight() * pChild.GetAnchorV() * pChild.GetScaleY() + ypos + (a.m_bHeaderHasSpace ? a.m_fBlankSpace : 0));
                            if (maxWidth2 < pChild.GetWidth() * pChild.GetScaleX())
                                maxWidth2 = pChild.GetWidth() * pChild.GetScaleX();
                            ypos += pChild.height * pChild.scaleY + a.m_fBlankSpace;
                        }
                    }
                    xpos += maxWidth2 + a.m_fLineSpace;
                    a.m_vecCurVirtualChildIndex[i] = i;
                }
                if (xpos > 0) {
                    var curTop = 0;
                    var count = 0;
                    var step = -dMath.ToInt(x / xpos);
                    while (a.m_vecCurVirtualChildIndex[a.m_vecCurVirtualChildIndex.length - 1] + step * nLineCount >= nVirtualLineCount)
                        step--;
                    if (step > 0) {
                        for (var i = 0, n = nLineCount; i < n; i++) {
                            a.m_vecCurVirtualChildIndex[i] += step * nLineCount;
                            for (var k = 0; k < a.m_nBlankCount; k++)
                                vecChild[i * a.m_nBlankCount + k].positionX += step * xpos;
                        }
                        count += step * nLineCount;
                    }
                    while (vecChild[curTop * a.m_nBlankCount].positionX + vecChild[curTop * a.m_nBlankCount].width - vecChild[curTop * a.m_nBlankCount].anchorU * vecChild[curTop * a.m_nBlankCount].width + x < 0 &&
                        count < nVirtualLineCount - nLineCount) {
                        for (var k = 0; k < a.m_nBlankCount; k++)
                            vecChild[curTop * a.m_nBlankCount + k].positionX += xpos;
                        a.m_vecCurVirtualChildIndex[curTop] += nLineCount;
                        curTop++;
                        curTop %= nLineCount;
                        count++;
                    }
                }
            }
            if (a.m_pCurrentTouchDownScaleSprite != null) {
                a.m_pCurrentTouchDownScaleSprite.SetScale(a.m_vDownedObjScale.x - 0.05, a.m_vDownedObjScale.y - 0.05);
            }
            if (a.m_pEvent != null) {
                for (var i = 0; i < a.m_vecLastVirtualChildIndex.length; i++) {
                    if (a.m_vecLastVirtualChildIndex[i] != a.m_vecCurVirtualChildIndex[i]) {
                        if (i < a.m_nVirtualChildCount) {
                            for (var k = 0; k < a.m_nBlankCount; k++) {
                                var childIndex = i * a.m_nBlankCount + k;
                                var virtualIndex = a.m_vecCurVirtualChildIndex[i] * a.m_nBlankCount + k;
                                a.m_vecVirtualChildList[childIndex].visible = virtualIndex < a.m_nVirtualChildCount;
                                if (a.m_vecVirtualChildList[childIndex].visible) {
                                    a.OnShowVirtualChild(childIndex, virtualIndex, a.m_vecVirtualChildList[childIndex]);
                                }
                            }
                        }
                        a.m_vecLastVirtualChildIndex[i] = a.m_vecCurVirtualChildIndex[i];
                    }
                }
            }
        }
        a.m_bComputingVirtualChild = false;
    };
    dListBox.prototype.SetEvent = function (evt) {
        _super.prototype.SetEvent.call(this, evt);
        this.ComputeVirtualChild(this.GetViewPosX(), this.GetViewPosY());
    };
    dListBox.prototype.OnShowVirtualChild = function (childIndex, virtualIndex, pChild) {
        if (this.m_pEvent)
            this.m_pEvent.OnListShowVirtualChild(pChild, childIndex, virtualIndex);
    };
    dListBox.prototype.AdjustViewSize = function () {
        if (this.m_nVirtualChildCount > 0)
            this.UpdateViewSize();
        else
            _super.prototype.AdjustViewSize.call(this);
    };
    dListBox.prototype.UpdateViewSize = function () {
        var a = this;
        if (a.m_bBeginDsc)
            return;
        if (a.m_bUpdatingPerChild)
            return;
        var vecChild = this.m_pView.GetChildList();
        if (a.m_bVerticalList) {
            var maxX = 0;
            var xpos = 0;
            var ypos = 0;
            if (a.m_bHeaderHasSpace)
                ypos = a.m_fLineSpace;
            var maxHeight2;
            if (vecChild.length > 0) {
                var nLineCount = dMath.ToInt((vecChild.length + (a.m_nBlankCount - 1)) / a.m_nBlankCount);
                var nBlankCount = a.m_nBlankCount;
                if (a.m_nVirtualChildCount > -1) {
                    nLineCount = dMath.ToInt((a.m_nVirtualChildCount + (a.m_nBlankCount - 1)) / a.m_nBlankCount);
                }
                for (var j = 0; j < nLineCount; j++) {
                    xpos = 0;
                    maxHeight2 = 0;
                    if (a.m_bHeaderHasSpace)
                        xpos = a.m_fBlankSpace;
                    for (var i = 0; i < nBlankCount; i++) {
                        var index = j * nBlankCount + i;
                        if (a.m_nVirtualChildCount > -1)
                            index %= vecChild.length;
                        if (index < vecChild.length) {
                            var pChild = vecChild[index];
                            pChild.SetPos(pChild.GetWidth() * pChild.GetAnchorU() * pChild.GetScaleX() + xpos, pChild.GetHeight() * pChild.GetAnchorV() * pChild.GetScaleY() + ypos);
                            if (maxHeight2 < pChild.height * pChild.GetScaleY())
                                maxHeight2 = pChild.height * pChild.GetScaleY();
                            xpos += pChild.width * pChild.scaleX + a.m_fBlankSpace;
                        }
                    }
                    ypos += maxHeight2 + a.m_fLineSpace;
                    if (maxX < xpos)
                        maxX = xpos;
                }
            }
            if (!a.m_bHeaderHasSpace) {
                maxX -= a.m_fBlankSpace;
                ypos -= a.m_fLineSpace;
            }
            a._SetViewSize(maxX, ypos + a.m_fViewSizeOffsetBottom);
        }
        else {
            var maxY = 0;
            var xpos = 0;
            var ypos = 0;
            if (a.m_bHeaderHasSpace)
                xpos = a.m_fLineSpace;
            var maxWidth2;
            if (vecChild.length > 0) {
                var nLineCount = dMath.ToInt((vecChild.length + (a.m_nBlankCount - 1)) / a.m_nBlankCount);
                var nBlankCount = a.m_nBlankCount;
                if (a.m_nVirtualChildCount > -1) {
                    nLineCount = dMath.ToInt((a.m_nVirtualChildCount + (a.m_nBlankCount - 1)) / a.m_nBlankCount);
                }
                for (var j = 0; j < nLineCount; j++) {
                    ypos = 0;
                    maxWidth2 = 0;
                    if (a.m_bHeaderHasSpace)
                        ypos = a.m_fBlankSpace;
                    for (var i = 0; i < nBlankCount; i++) {
                        var index = j * nBlankCount + i;
                        if (a.m_nVirtualChildCount > -1)
                            index %= vecChild.length;
                        if (index < vecChild.length) {
                            var pChild = vecChild[index];
                            pChild.SetPos(pChild.GetWidth() * pChild.GetAnchorU() * pChild.GetScaleX() + xpos, pChild.GetHeight() * pChild.GetAnchorV() * pChild.GetScaleY() + ypos);
                            if (maxWidth2 < pChild.width * pChild.GetScaleX())
                                maxWidth2 = pChild.width * pChild.GetScaleX();
                            ypos += pChild.height * pChild.scaleY + a.m_fBlankSpace;
                        }
                    }
                    xpos += maxWidth2 + a.m_fLineSpace;
                    if (maxY < ypos)
                        maxY = ypos;
                }
            }
            if (!a.m_bHeaderHasSpace) {
                maxY -= a.m_fBlankSpace;
                xpos -= a.m_fLineSpace;
            }
            a._SetViewSize(xpos + a.m_fViewSizeOffsetRight, maxY);
        }
        a.ComputeVirtualChild(a.GetViewPosX(), a.GetViewPosY());
        a.UpdateSelection();
    };
    dListBox.prototype.UpdateVirtualChild = function () {
        if (this.m_vecLastVirtualChildIndex != null) {
            for (var i = 0; i < this.m_vecLastVirtualChildIndex.length; i++)
                this.m_vecLastVirtualChildIndex[i] = -1;
        }
        this.UpdateViewSize();
    };
    dListBox.prototype.SetSelect = function (nSel) {
        var vecChild = this.m_pView.GetChildList();
        if (nSel >= 0 && nSel < vecChild.length) {
            this.m_nSelect = nSel;
            this.UpdateSelection();
        }
    };
    dListBox.prototype.UpdateSelection = function () {
        var a = this;
        var vecChild = a.m_pView.GetChildList();
        var nSel = this.m_nSelect;
        if (nSel >= 0 && nSel < vecChild.length) {
            a.m_pSelect.SetSize(a.GetWidth(), vecChild[nSel].GetHeight());
            this.m_pSelect.SetPos(-a.GetWidth() * a.GetAnchorU() + a.m_pView.GetPosX(), vecChild[nSel].GetPosY() - vecChild[nSel].GetHeight() * vecChild[nSel].GetAnchorV() - a.GetHeight() * a.GetAnchorV() + a.m_pView.GetPosY());
        }
    };
    dListBox.prototype.GetSelect = function () {
        return this.m_nSelect;
    };
    dListBox.prototype.GetSelectObj = function () {
        var vecChild = this.m_pView.GetChildList();
        if (this.m_nSelect >= 0 && this.m_nSelect < vecChild.length)
            return vecChild[this.m_nSelect];
        return null;
    };
    dListBox.prototype.SetSize = function (width, height) {
        _super.prototype.SetSize.call(this, width, height);
        this.UpdateViewSize();
    };
    dListBox.prototype._SetViewPos = function (x, y) {
        _super.prototype._SetViewPos.call(this, x, y);
        this.UpdateSelection();
    };
    dListBox.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("vertical"))
            this.vertical = Boolean(dMath.ParseInt(json.vertical));
        if (json.hasOwnProperty("blankCount"))
            this.blankCount = dMath.ParseInt(json.blankCount);
        if (json.hasOwnProperty("lineSpace"))
            this.lineSpace = dMath.ParseFloat(json.lineSpace);
        if (json.hasOwnProperty("blankSpace"))
            this.blankSpace = dMath.ParseFloat(json.blankSpace);
    };
    return dListBox;
}(dScrollView));
var dListBoxPageView = (function (_super) {
    __extends(dListBoxPageView, _super);
    function dListBoxPageView() {
        var _this = _super.call(this) || this;
        _this.m_strCheckFileName = "";
        _this.m_strUncheckFileName = "";
        _this.m_fSpace = 0;
        _this.m_vecChecks = new Array();
        _this.m_nCurPage = 0;
        _this.SetPageCount(2);
        return _this;
    }
    dListBoxPageView.prototype.LoadFromFile = function (strUncheckedImageName) {
        var _this = this;
        if (this.m_strUncheckFileName != strUncheckedImageName) {
            this.m_strUncheckFileName = strUncheckedImageName;
            var callback = new dCompleteCallback(this);
            for (var i = 0; i < this.m_vecChecks.length; i++)
                this.m_vecChecks[i].LoadFromFile(strUncheckedImageName, callback.CreateCompleteFun_Normal());
            callback.SetCompleteFun(function () {
                _this.UpdatePos();
            });
        }
        return this;
    };
    dListBoxPageView.prototype.LoadCheckFromFile = function (strCheckedImageName) {
        var _this = this;
        if (this.m_strCheckFileName != strCheckedImageName) {
            this.m_strCheckFileName = strCheckedImageName;
            var callback = new dCompleteCallback(this);
            for (var i = 0; i < this.m_vecChecks.length; i++)
                this.m_vecChecks[i].LoadCheckFromFile(strCheckedImageName, callback.CreateCompleteFun_Normal());
            callback.SetCompleteFun(function () {
                _this.UpdatePos();
            });
        }
        return this;
    };
    dListBoxPageView.prototype.GetFileName = function () {
        return this.m_strUncheckFileName;
    };
    dListBoxPageView.prototype.GetCheckFileName = function () {
        return this.m_strCheckFileName;
    };
    Object.defineProperty(dListBoxPageView.prototype, "resourceFileName", {
        get: function () {
            return this.GetFileName();
        },
        set: function (fileName) {
            this.LoadFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dListBoxPageView.prototype, "checkImage", {
        get: function () {
            return this.GetCheckFileName();
        },
        set: function (fileName) {
            this.LoadCheckFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dListBoxPageView.prototype, "space", {
        get: function () {
            return this.m_fSpace;
        },
        set: function (value) {
            this.m_fSpace = value;
            this.UpdatePos();
        },
        enumerable: false,
        configurable: true
    });
    dListBoxPageView.prototype.SetPageCount = function (count) {
        var _this = this;
        if (count != this.m_vecChecks.length) {
            for (var i = count; i < this.m_vecChecks.length; i++)
                this.m_vecChecks[i].RemoveParent();
            this.m_vecChecks.resize(count);
            var callback = new dCompleteCallback(this);
            for (var i = 0; i < count; i++) {
                if (this.m_vecChecks[i] == null) {
                    this.m_vecChecks[i] = new dCheckBox();
                    callback.Add();
                    this.m_vecChecks[i].LoadFromFile(this.m_strUncheckFileName, function () {
                        callback.DoComplete();
                    });
                    callback.Add();
                    this.m_vecChecks[i].LoadCheckFromFile(this.m_strCheckFileName, function () {
                        callback.DoComplete();
                    });
                    this.m_vecChecks[i].SetHandleMouse(false);
                    this.AddChild(this.m_vecChecks[i]);
                }
            }
            callback.SetCompleteFun(function () {
                _this.UpdatePos();
            });
        }
        else
            this.UpdatePos();
    };
    dListBoxPageView.prototype.GetPageCount = function () {
        return this.m_vecChecks.length;
    };
    Object.defineProperty(dListBoxPageView.prototype, "pageCount", {
        get: function () {
            return this.GetPageCount();
        },
        set: function (count) {
            this.SetPageCount(count);
        },
        enumerable: false,
        configurable: true
    });
    dListBoxPageView.prototype.SetCurPage = function (curPage) {
        this.m_nCurPage = curPage;
        this.UpdateCurPageDot();
    };
    dListBoxPageView.prototype.GetCurPage = function () {
        return this.m_nCurPage;
    };
    dListBoxPageView.prototype.UpdatePos = function () {
        if (this.m_vecChecks.length > 0) {
            var totalWidth = this.m_vecChecks.length * this.m_vecChecks[0].width + this.m_fSpace * (this.m_vecChecks.length - 1);
            for (var i = 0; i < this.m_vecChecks.length; i++) {
                this.m_vecChecks[i].positionX = i * this.m_vecChecks[0].width + this.m_fSpace * i - (totalWidth * this.anchorU - this.m_vecChecks[0].width * this.anchorU);
            }
            this.UpdateCurPageDot();
        }
    };
    dListBoxPageView.prototype.UpdateCurPageDot = function () {
        for (var i = 0; i < this.m_vecChecks.length; i++)
            this.m_vecChecks[i].SetCheck(i == this.m_nCurPage);
    };
    dListBoxPageView.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("resourceFileName"))
            this.resourceFileName = json.resourceFileName;
        if (json.hasOwnProperty("checkImage"))
            this.checkImage = json.checkImage;
        if (json.hasOwnProperty("space"))
            this.space = dMath.ParseFloat(json.space);
        if (json.hasOwnProperty("pageCount"))
            this.pageCount = dMath.ParseInt(json.pageCount);
    };
    return dListBoxPageView;
}(dBaseControl));
var dMover = (function (_super) {
    __extends(dMover, _super);
    function dMover() {
        var _this = _super.call(this) || this;
        _this.m_pBkImage = new dImage();
        _this.m_pButton = new dImage();
        _this.m_vDir = new dVector2();
        _this.m_fDownPosX = 0;
        _this.m_fDownPosY = 0;
        _this.m_bTouchDowned = false;
        _this.m_fDirLength = 0;
        _this.AddChild(_this.m_pBkImage);
        _this.AddChild(_this.m_pButton);
        _this.m_pBkImage.SetShow(false);
        _this.m_pButton.SetShow(false);
        _this.SetHandleMouse(true);
        return _this;
    }
    dMover.prototype.IgnoreDirValue = function (value) {
        if (dMath.Abs(value) < 16)
            return 0;
        return value;
    };
    dMover.prototype.CheckGamepad = function () {
    };
    dMover.prototype.OnTouchDown = function (x, y, delta) {
        this.m_bTouchDowned = true;
        this.m_pBkImage.SetPos(x, y);
        this.m_pButton.SetPos(x, y);
        this.m_pBkImage.SetShow(true);
        this.m_pButton.SetShow(true);
        this.m_fDownPosX = x;
        this.m_fDownPosY = y;
        this.m_vDir.SetValue(this.m_pButton.GetPosX() - this.m_pBkImage.GetPosX(), this.m_pButton.GetPosY() - this.m_pBkImage.GetPosY());
        var length = this.m_vDir.Length();
        if (length > (this.m_pBkImage.GetWidth() - this.m_pButton.GetWidth() / 2) / 2)
            length = (this.m_pBkImage.GetWidth() - this.m_pButton.GetWidth() / 2) / 2;
        this.m_vDir.Normalize();
        this.m_pButton.SetPos(this.m_vDir.x * length + this.m_pBkImage.GetPosX(), this.m_vDir.y * length + this.m_pBkImage.GetPosY());
    };
    dMover.prototype.OnTouchMove = function (mouseX, mouseY, x, y, delta) {
        if (this.m_bTouchDowned) {
            this.m_fDownPosX += x;
            this.m_fDownPosY += y;
            this.m_pButton.SetPos(this.m_fDownPosX, this.m_fDownPosY);
            this.m_vDir.SetValue(this.m_pButton.GetPosX() - this.m_pBkImage.GetPosX(), this.m_pButton.GetPosY() - this.m_pBkImage.GetPosY());
            var length = this.m_vDir.Length();
            if (length > (this.m_pBkImage.GetWidth() - this.m_pButton.GetWidth() / 2) / 2)
                length = (this.m_pBkImage.GetWidth() - this.m_pButton.GetWidth() / 2) / 2;
            this.m_vDir.Normalize();
            this.m_fDirLength = length / ((this.m_pBkImage.GetWidth() - this.m_pButton.GetWidth() / 2) / 2);
            this.m_pButton.SetPos(this.m_vDir.x * length + this.m_pBkImage.GetPosX(), this.m_vDir.y * length + this.m_pBkImage.GetPosY());
        }
    };
    dMover.prototype.OnTouchUp = function (x, y) {
        this.m_bTouchDowned = false;
        this.m_pBkImage.SetShow(false);
        this.m_pButton.SetShow(false);
        this.m_vDir.SetValue(0, 0);
    };
    dMover.prototype.LoadFromFile = function (strBkImage, strButton) {
        this.m_pBkImage.LoadFromFile(strBkImage);
        this.m_pButton.LoadFromFile(strButton);
    };
    dMover.prototype.BreakTouch = function () {
        this.m_bTouchDowned = false;
        this.m_pBkImage.SetShow(false);
        this.m_pButton.SetShow(false);
        this.m_vDir.SetValue(0, 0);
    };
    dMover.prototype.SetAlpha = function (alpha, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetAlpha.call(this, alpha, bSetToChild);
        if (!bSetToChild) {
            this.m_pBkImage.SetAlpha(alpha, false);
            this.m_pButton.SetAlpha(alpha, false);
        }
    };
    dMover.prototype.SetColor = function (color, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetColor.call(this, color, bSetToChild);
        if (!bSetToChild) {
            this.m_pBkImage.SetColor(color, false);
            this.m_pButton.SetColor(color, false);
        }
    };
    dMover.prototype.GetDir = function () {
        return this.m_vDir;
    };
    dMover.prototype.GetDirLength = function () {
        return this.m_fDirLength;
    };
    Object.defineProperty(dMover.prototype, "resourceFileName", {
        get: function () {
            return this.m_pBkImage.resourceFileName;
        },
        set: function (fileName) {
            this.m_pBkImage.LoadFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dMover.prototype, "buttonFileName", {
        get: function () {
            return this.m_pButton.resourceFileName;
        },
        set: function (fileName) {
            this.m_pButton.LoadFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    dMover.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("resourceFileName"))
            this.resourceFileName = json.resourceFileName;
        if (json.hasOwnProperty("buttonFileName"))
            this.buttonFileName = json.buttonFileName;
    };
    return dMover;
}(dBaseControl));
var dProgress = (function (_super) {
    __extends(dProgress, _super);
    function dProgress() {
        var _this = _super.call(this) || this;
        _this.m_fValue = 100;
        _this.m_fMaxValue = 100;
        _this.m_pImage = null;
        _this.m_bScale9Type = 1;
        _this.m_nDirectionType = dProgress.DirectionType_LeftToRight;
        _this.m_strResourceFileName = "";
        return _this;
    }
    Object.defineProperty(dProgress.prototype, "resourceFileName", {
        get: function () {
            return this.GetFileName();
        },
        set: function (fileName) {
            this.LoadFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    dProgress.prototype.SetImage = function (image) {
        if (this.m_pImage != null)
            this.m_pImage.RemoveParent();
        this.m_pImage = image;
        this.m_pImage.SetDirection(this.m_nDirectionType);
        this.m_pImage.SetSize(this.width, this.height);
        this.m_pImage.SetPos(-this.width * this.anchorU, -this.height * this.anchorV);
        this.AddChild(this.m_pImage);
        this.Update();
    };
    dProgress.prototype.GetImage = function () {
        return this.m_pImage;
    };
    Object.defineProperty(dProgress.prototype, "scale9Type", {
        get: function () {
            return this.m_bScale9Type;
        },
        set: function (value) {
            this.m_bScale9Type = value;
            this._ReloadFileName(this.resourceFileName, false);
        },
        enumerable: false,
        configurable: true
    });
    dProgress.prototype.LoadFromFile = function (strImage, bAutoSetSize) {
        if (bAutoSetSize === void 0) { bAutoSetSize = true; }
        if (this.GetFileName() != strImage) {
            this.m_strResourceFileName = strImage;
            this._ReloadFileName(strImage, bAutoSetSize);
        }
        return this;
    };
    dProgress.prototype.GetProgressImage = function () {
        return this.m_pImage;
    };
    dProgress.prototype.SetDirectionType = function (direction) {
        this.m_nDirectionType = direction;
        if (this.m_pImage != null)
            this.m_pImage.SetDirection(direction);
        this.Update();
    };
    dProgress.prototype.GetDirectionType = function () {
        return this.m_nDirectionType;
    };
    Object.defineProperty(dProgress.prototype, "direction", {
        get: function () {
            return this.GetDirectionType();
        },
        set: function (direction) {
            this.SetDirectionType(direction);
        },
        enumerable: false,
        configurable: true
    });
    dProgress.prototype._ReloadFileName = function (strImage, bAutoSetSize) {
        var a = this;
        if (a.scale9Type == 2) {
            if (a.m_pImage == null || !(a.m_pImage instanceof ProgressImage_Clipped)) {
                if (a.m_pImage != null)
                    a.m_pImage.RemoveParent();
                a.m_pImage = new ProgressImage_Clipped();
                a.m_pImage.SetColor(a.spriteColor);
                a.m_pImage.SetDirection(a.m_nDirectionType);
                a.m_pImage.SetSize(a.width, a.height);
                a.m_pImage.SetPos(-a.width * a.anchorU, -a.height * a.anchorV);
                a.m_pImage.renderAs3D = a.renderAs3D;
                a.AddChild(a.m_pImage, 0);
            }
        }
        else if (a.scale9Type == 1) {
            if (a.m_pImage == null || !(a.m_pImage instanceof ProgressImage_Scale9)) {
                if (a.m_pImage != null)
                    a.m_pImage.RemoveParent();
                a.m_pImage = new ProgressImage_Scale9();
                a.m_pImage.SetColor(a.spriteColor);
                a.m_pImage.SetDirection(a.m_nDirectionType);
                a.m_pImage.SetSize(a.width, a.height);
                a.m_pImage.SetPos(-a.width * a.anchorU, -a.height * a.anchorV);
                a.m_pImage.renderAs3D = a.renderAs3D;
                a.AddChild(a.m_pImage, 0);
            }
        }
        else {
            if (a.m_pImage == null || !(a.m_pImage instanceof ProgressImage_Resize)) {
                if (a.m_pImage != null)
                    a.m_pImage.RemoveParent();
                a.m_pImage = new ProgressImage_Resize();
                a.m_pImage.SetColor(a.spriteColor);
                a.m_pImage.SetDirection(a.m_nDirectionType);
                a.m_pImage.SetSize(a.width, a.height);
                a.m_pImage.SetPos(-a.width * a.anchorU, -a.height * a.anchorV);
                a.m_pImage.renderAs3D = a.renderAs3D;
                a.AddChild(a.m_pImage, 0);
            }
        }
        a.m_pImage.LoadFromFile(strImage, function () {
            if (bAutoSetSize && a.m_pImage.GetBitmapData() != null && a.GetWidth() == 0 && a.GetHeight() == 0)
                a.SetSize(a.m_pImage.GetBitmapData().GetWidth(), a.m_pImage.GetBitmapData().GetHeight());
        });
        a.Update();
    };
    dProgress.prototype.GetFileName = function () {
        return this.m_strResourceFileName;
    };
    Object.defineProperty(dProgress.prototype, "value", {
        get: function () {
            return this.m_fValue;
        },
        set: function (v) {
            if (v != this.m_fValue) {
                this.m_fValue = v;
                this.Update();
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dProgress.prototype, "maxValue", {
        get: function () {
            return this.m_fMaxValue;
        },
        set: function (v) {
            if (v != this.m_fMaxValue) {
                this.m_fMaxValue = v;
                this.Update();
            }
        },
        enumerable: false,
        configurable: true
    });
    dProgress.prototype.SetAnchor = function (u, v) {
        var a = this;
        if (u != a.m_fAnchorU || v != a.m_fAnchorV) {
            _super.prototype.SetAnchor.call(this, u, v);
            if (a.m_pImage != null) {
                a.m_pImage.SetPos(-a.width * a.anchorU, -a.height * a.anchorV);
            }
        }
    };
    dProgress.prototype.SetColor = function (colorARGB, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetColor.call(this, colorARGB, bSetToChild);
        if (!bSetToChild) {
            if (this.m_pImage != null)
                this.m_pImage.SetColor(colorARGB);
        }
    };
    dProgress.prototype.SetShader = function (pShader, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetShader.call(this, pShader, bSetToChild);
        if (!bSetToChild) {
            if (this.m_pImage != null)
                this.m_pImage.SetShader(pShader);
        }
    };
    dProgress.prototype.SetSize = function (width, height) {
        if (width != this.m_fWidth || height != this.m_fHeight) {
            _super.prototype.SetSize.call(this, width, height);
            if (this.m_pImage != null) {
                this.m_pImage.SetSize(this.width, this.height);
                this.m_pImage.SetPos(-this.width * this.anchorU, -this.height * this.anchorV);
            }
            this.Update();
        }
    };
    dProgress.prototype.EndDsc = function () {
        _super.prototype.EndDsc.call(this);
        this.Update();
    };
    dProgress.prototype.Update = function () {
        if (this.m_bBeginDsc)
            return;
        if (this.m_pImage != null) {
            var cur = this.m_fValue;
            if (cur < 0)
                cur = 0;
            else if (cur > this.m_fMaxValue)
                cur = this.m_fMaxValue;
            this.m_pImage.UpdateValue(cur / this.m_fMaxValue);
        }
    };
    dProgress.prototype.GetValue = function () {
        return this.m_fValue;
    };
    dProgress.prototype.GetMaxValue = function () {
        return this.m_fMaxValue;
    };
    dProgress.prototype.SetValueAndMax = function (value, max) {
        if (value != this.m_fValue || this.m_fMaxValue != max) {
            this.m_fMaxValue = max;
            this.m_fValue = value;
            this.Update();
        }
    };
    dProgress.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("resourceFileName"))
            this.resourceFileName = json.resourceFileName;
        if (json.hasOwnProperty("scale9Type"))
            this.scale9Type = dMath.ParseInt(json.scale9Type);
        if (json.hasOwnProperty("direction"))
            this.direction = dMath.ParseInt(json.direction);
        if (json.hasOwnProperty("value"))
            this.value = dMath.ParseFloat(json.value);
        if (json.hasOwnProperty("maxValue"))
            this.maxValue = dMath.ParseFloat(json.maxValue);
    };
    dProgress.DirectionType_LeftToRight = 0;
    dProgress.DirectionType_RightToLeft = 1;
    dProgress.DirectionType_TopToBottom = 2;
    dProgress.DirectionType_BottomToTop = 3;
    dProgress.Type_Resize = 0;
    dProgress.Type_Scale9 = 1;
    dProgress.Type_Clipped = 2;
    return dProgress;
}(dBaseControl));
var ProgressImage_Base = (function (_super) {
    __extends(ProgressImage_Base, _super);
    function ProgressImage_Base() {
        var _this = _super.call(this) || this;
        _this.m_nDirection = 0;
        return _this;
    }
    ProgressImage_Base.prototype.LoadFromFile = function (fileName, onComplete) {
    };
    ProgressImage_Base.prototype.SetDirection = function (direction) {
        this.m_nDirection = direction;
    };
    ProgressImage_Base.prototype.UpdateValue = function (value) {
    };
    ProgressImage_Base.prototype.GetImage = function () {
        return null;
    };
    ProgressImage_Base.prototype.SetColor = function (colorARGB, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetColor.call(this, colorARGB, bSetToChild);
        if (!bSetToChild && this.GetImage() != null)
            this.GetImage().SetColor(colorARGB, false);
    };
    ProgressImage_Base.prototype.SetAlpha = function (alpha, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetAlpha.call(this, alpha, bSetToChild);
        if (!bSetToChild && this.GetImage() != null)
            this.GetImage().SetAlpha(alpha, false);
    };
    ProgressImage_Base.prototype.SetShader = function (pShader, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetShader.call(this, pShader, bSetToChild);
        if (!bSetToChild && this.GetImage() != null)
            this.GetImage().SetShader(pShader, false);
    };
    ProgressImage_Base.prototype.SetEnableZReadWrite = function (disable_r_rw, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetEnableZReadWrite.call(this, disable_r_rw, bSetToChild);
        if (!bSetToChild && this.GetImage() != null)
            this.GetImage().SetEnableZReadWrite(disable_r_rw, false);
    };
    return ProgressImage_Base;
}(dBaseControl));
var ProgressImage_Scale9 = (function (_super) {
    __extends(ProgressImage_Scale9, _super);
    function ProgressImage_Scale9() {
        var _this = _super.call(this) || this;
        _this.m_pImage = new dScale9();
        _this.m_pImage.SetAnchor(0, 0);
        _this.AddChild(_this.m_pImage);
        return _this;
    }
    ProgressImage_Scale9.prototype.GetImage = function () {
        return this.m_pImage;
    };
    ProgressImage_Scale9.prototype.LoadFromFile = function (fileName, onComplete) {
        this.m_pImage.LoadFromFile(fileName, onComplete);
    };
    ProgressImage_Scale9.prototype.UpdateValue = function (value) {
        switch (this.m_nDirection) {
            case dProgress.DirectionType_LeftToRight:
                this.m_pImage.SetSize(value * this.width, this.height);
                this.m_pImage.SetPos(0, 0);
                break;
            case dProgress.DirectionType_RightToLeft:
                this.m_pImage.SetSize(value * this.width, this.height);
                this.m_pImage.SetPos(this.width - this.m_pImage.width, 0);
                break;
            case dProgress.DirectionType_TopToBottom:
                this.m_pImage.SetSize(this.width, value * this.height);
                this.m_pImage.SetPos(0, 0);
                break;
            case dProgress.DirectionType_BottomToTop:
                this.m_pImage.SetSize(this.width, value * this.height);
                this.m_pImage.SetPos(0, this.height - this.m_pImage.height);
                break;
        }
    };
    return ProgressImage_Scale9;
}(ProgressImage_Base));
var ProgressImage_Resize = (function (_super) {
    __extends(ProgressImage_Resize, _super);
    function ProgressImage_Resize() {
        var _this = _super.call(this) || this;
        _this.m_pImage = new dImage();
        _this.m_pImage.SetAnchor(0, 0);
        _this.AddChild(_this.m_pImage);
        return _this;
    }
    ProgressImage_Resize.prototype.GetImage = function () {
        return this.m_pImage;
    };
    ProgressImage_Resize.prototype.LoadFromFile = function (fileName, onComplete) {
        this.m_pImage.LoadFromFile(fileName, onComplete);
    };
    ProgressImage_Resize.prototype.UpdateValue = function (value) {
        switch (this.m_nDirection) {
            case dProgress.DirectionType_LeftToRight:
                this.m_pImage.SetSize(value * this.width, this.height);
                this.m_pImage.SetPos(0, 0);
                break;
            case dProgress.DirectionType_RightToLeft:
                this.m_pImage.SetSize(value * this.width, this.height);
                this.m_pImage.SetPos(this.width - this.m_pImage.width, 0);
                break;
            case dProgress.DirectionType_TopToBottom:
                this.m_pImage.SetSize(this.width, value * this.height);
                this.m_pImage.SetPos(0, 0);
                break;
            case dProgress.DirectionType_BottomToTop:
                this.m_pImage.SetSize(this.width, value * this.height);
                this.m_pImage.SetPos(0, this.height - this.m_pImage.height);
                break;
        }
    };
    return ProgressImage_Resize;
}(ProgressImage_Base));
var ProgressImage_Clipped = (function (_super) {
    __extends(ProgressImage_Clipped, _super);
    function ProgressImage_Clipped() {
        var _this = _super.call(this) || this;
        _this.m_pClip = new dSprite();
        _this.m_pImage = new dImage();
        _this.m_pClip.clipChild = true;
        _this.m_pImage.SetAnchor(0, 0);
        _this.AddChild(_this.m_pClip);
        _this.m_pClip.AddChild(_this.m_pImage);
        return _this;
    }
    ProgressImage_Clipped.prototype.SetSize = function (w, h) {
        _super.prototype.SetSize.call(this, w, h);
        this.m_pImage.SetSize(w, h);
    };
    ProgressImage_Clipped.prototype.GetImage = function () {
        return this.m_pImage;
    };
    ProgressImage_Clipped.prototype.LoadFromFile = function (fileName, onComplete) {
        this.m_pImage.LoadFromFile(fileName, onComplete);
        this.m_pImage.SetSize(this.width, this.height);
    };
    ProgressImage_Clipped.prototype.UpdateValue = function (value) {
        switch (this.m_nDirection) {
            case dProgress.DirectionType_LeftToRight:
                this.m_pClip.SetSize(value * this.width, this.height);
                this.m_pClip.SetPos(0, 0);
                break;
            case dProgress.DirectionType_RightToLeft:
                this.m_pClip.SetSize(value * this.width, this.height);
                this.m_pClip.SetPos(this.width - this.m_pClip.width, 0);
                break;
            case dProgress.DirectionType_TopToBottom:
                this.m_pClip.SetSize(this.width, value * this.height);
                this.m_pClip.SetPos(0, 0);
                break;
            case dProgress.DirectionType_BottomToTop:
                this.m_pClip.SetSize(this.width, value * this.height);
                this.m_pClip.SetPos(0, this.height - this.m_pClip.height);
                break;
        }
        this.m_pImage.SetPos(-this.m_pClip.positionX, -this.m_pClip.positionY);
    };
    return ProgressImage_Clipped;
}(ProgressImage_Base));
var dRepeatImage = (function (_super) {
    __extends(dRepeatImage, _super);
    function dRepeatImage() {
        var _this = _super.call(this) || this;
        _this.m_vecImage = new Array();
        _this.m_pImageCliper = new dSprite();
        _this.m_nForceWidthCount = 0;
        _this.m_nForceHeightCount = 0;
        _this.m_rcSourceRect = new dRect(0, 0, 1, 1);
        _this.SetAnchor(0.5, 0.5);
        _this.AddChild(_this.m_pImageCliper);
        _this.m_pImageCliper.SetAnchor(0.5, 0.5);
        _this.m_pImageCliper.SetLayoutAlign(dSprite.LAYOUT_ALIGN_RESIZE, dSprite.LAYOUT_ALIGN_RESIZE);
        _this.m_pImageCliper.SetClipChild(true);
        return _this;
    }
    dRepeatImage.prototype.LoadFromFile = function (strImage, onLoadComplete, bAutoResize, rcSrc) {
        var _this = this;
        if (onLoadComplete === void 0) { onLoadComplete = null; }
        if (bAutoResize === void 0) { bAutoResize = true; }
        if (rcSrc === void 0) { rcSrc = null; }
        if (strImage != null && this.GetFileName() != strImage) {
            if (strImage != "") {
                this.m_pImageBitmapData = new dBitmapData();
                this.m_pImageBitmapData.LoadFromFile(strImage, function () {
                    _this.SetBitmapData(_this.m_pImageBitmapData);
                });
            }
            else if (this.GetBitmapData() != null)
                this.SetBitmapData(null);
        }
        return this;
    };
    dRepeatImage.prototype.SetBitmapData = function (bmp, rc, at, sampleType) {
        if (rc === void 0) { rc = null; }
        if (at === void 0) { at = 0; }
        if (sampleType === void 0) { sampleType = 0; }
        if (at == 0) {
            this.m_pImageBitmapData = bmp;
            if (rc != null)
                this.m_rcSourceRect.Copy(rc);
            else if (bmp != null)
                this.m_rcSourceRect.SetValue(0, 0, 1, 1);
            else
                this.m_rcSourceRect.SetValue(0, 0, 0, 0);
            for (var i = 0; i < this.m_vecImage.length; i++) {
                this.m_vecImage[i].SetBitmapData(this.m_pImageBitmapData, this.m_rcSourceRect, at, sampleType);
                this.m_vecImage[i].SetSize(this.m_rcSourceRect.Width() * bmp.GetWidth(), this.m_rcSourceRect.Height() * bmp.GetHeight());
            }
            this.UpdateSize();
        }
    };
    dRepeatImage.prototype.GetBitmapData = function (at) {
        if (at === void 0) { at = 0; }
        return this.m_pImageBitmapData;
    };
    dRepeatImage.prototype.SetColor = function (colorARGB, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        if (!bSetToChild) {
            for (var i = 0; i < this.m_vecImage.length; i++)
                this.m_vecImage[i].SetColor(colorARGB);
        }
        _super.prototype.SetColor.call(this, colorARGB, bSetToChild);
    };
    dRepeatImage.prototype.SetSize = function (width, height) {
        _super.prototype.SetSize.call(this, width, height);
        this.m_pImageCliper.SetSize(width, height);
        this.UpdateSize();
    };
    dRepeatImage.prototype.EndDsc = function () {
        _super.prototype.EndDsc.call(this);
        this.UpdateSize();
    };
    dRepeatImage.prototype.UpdateSize = function () {
        var a = this;
        if (a.m_bBeginDsc)
            return;
        var bmpWidth = a.GetImageWidth();
        var bmpHeight = a.GetImageHeight();
        if (a.m_pImageBitmapData != null && bmpWidth > 0 && bmpHeight > 0) {
            var widthCount;
            if (a.m_nForceWidthCount == 0)
                widthCount = dMath.Ceil(a.GetWidth() / bmpWidth);
            else
                widthCount = a.m_nForceWidthCount;
            var heightCount;
            if (a.m_nForceHeightCount == 0)
                heightCount = dMath.Ceil(a.GetHeight() / bmpHeight);
            else
                heightCount = this.m_nForceHeightCount;
            widthCount = dMath.Abs(widthCount);
            heightCount = dMath.Abs(heightCount);
            for (var i = widthCount * heightCount; i < a.m_vecImage.length; i++)
                if (this.m_vecImage[i] != null)
                    a.m_vecImage[i].RemoveParent();
            a.m_vecImage.resize(widthCount * heightCount);
            for (var i = 0; i < this.m_vecImage.length; i++) {
                if (a.m_vecImage[i] == null) {
                    a.m_vecImage[i] = new dSprite();
                    a.m_vecImage[i].SetBitmapData(a.m_pImageBitmapData, a.m_rcSourceRect);
                    a.m_vecImage[i].SetColor(this.spriteColor);
                    a.m_vecImage[i].SetSize(bmpWidth, bmpHeight);
                    a.m_vecImage[i].SetLayoutAlign(dSprite.LAYOUT_ALIGN_LEFT_TOP, dSprite.LAYOUT_ALIGN_LEFT_TOP);
                    a.m_pImageCliper.AddChild(a.m_vecImage[i]);
                }
                a.m_vecImage[i].SetPos((i % widthCount) * a.m_vecImage[i].width - this.width * this.anchorU, dMath.ToInt(i / widthCount) * a.m_vecImage[i].height - this.height * this.anchorV);
            }
        }
    };
    dRepeatImage.prototype.SetAnchor = function (u, v) {
        var a = this;
        _super.prototype.SetAnchor.call(this, u, v);
        if (a.m_pImageCliper != null)
            a.m_pImageCliper.SetAnchor(u, v);
        a.UpdateSize();
    };
    Object.defineProperty(dRepeatImage.prototype, "forceWidthCount", {
        get: function () {
            return this.m_nForceWidthCount;
        },
        set: function (value) {
            this.m_nForceWidthCount = value;
            this.UpdateSize();
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dRepeatImage.prototype, "forceHeightCount", {
        get: function () {
            return this.m_nForceHeightCount;
        },
        set: function (value) {
            this.m_nForceHeightCount = value;
            this.UpdateSize();
        },
        enumerable: false,
        configurable: true
    });
    dRepeatImage.prototype.GetImageWidth = function () {
        if (this.m_rcSourceRect == null || this.m_pImageBitmapData == null)
            return 0;
        return this.GetBitmapSourceRect().Width() * this.m_pImageBitmapData.GetWidth();
    };
    dRepeatImage.prototype.GetImageHeight = function () {
        if (this.m_rcSourceRect == null || this.m_pImageBitmapData == null)
            return 0;
        return this.GetBitmapSourceRect().Height() * this.m_pImageBitmapData.GetHeight();
    };
    dRepeatImage.prototype.GetBitmapSourceRect = function () {
        return this.m_rcSourceRect;
    };
    return dRepeatImage;
}(dImage));
var dRoundList = (function (_super) {
    __extends(dRoundList, _super);
    function dRoundList() {
        var _this = _super.call(this) || this;
        _this.m_fAngle = 0;
        _this.m_fAngleOffset = dMath.dPI / 2;
        _this.m_fScaleMin = 0.2;
        _this.m_fScaleMax = 0.7;
        _this.m_nLastSendCurSel = 0;
        _this.m_bSortingChild = false;
        _this.m_pTimer = null;
        _this.m_vecChild = new Array();
        _this.SetHandleMouse(true);
        return _this;
    }
    Object.defineProperty(dRoundList.prototype, "scaleMin", {
        get: function () {
            return this.m_fScaleMin;
        },
        set: function (v) {
            this.m_fScaleMin = v;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dRoundList.prototype, "scaleMax", {
        get: function () {
            return this.m_fScaleMax;
        },
        set: function (v) {
            this.m_fScaleMax = v;
        },
        enumerable: false,
        configurable: true
    });
    dRoundList.prototype.SetSize = function (w, h) {
        _super.prototype.SetSize.call(this, w, h);
        this.UpdateChild();
    };
    dRoundList.prototype.OnTouchMove = function (mouseX, mouseY, x, y, delta) {
        var w = this.GetWidth() / 2;
        if (w == 0)
            w = 1;
        this.m_fAngle -= x / w;
        this.m_fAngle %= dMath.dPI * 2;
        this.UpdateChild();
        _super.prototype.OnTouchMove.call(this, mouseX, mouseY, x, y, delta);
    };
    dRoundList.prototype.OnTouchUp = function (x, y) {
        var curSel = this.GetCurSel();
        this.SetCurSel(curSel);
        if (this.m_nLastSendCurSel != curSel && this.m_pEvent != null) {
            this.m_pEvent.OnListShowViewEnd(curSel);
            this.m_nLastSendCurSel = curSel;
        }
        _super.prototype.OnTouchUp.call(this, x, y);
    };
    dRoundList.prototype.AddChild = function (pChild, at) {
        if (at === void 0) { at = -1; }
        _super.prototype.AddChild.call(this, pChild, at);
        if (!this.m_bSortingChild) {
            this.m_vecChild.remove(pChild);
            if (at == -1)
                this.m_vecChild.push(pChild);
            else
                this.m_vecChild.insert(at, pChild);
            this.UpdateChild();
        }
    };
    dRoundList.prototype.RemoveChild = function (pChild) {
        _super.prototype.RemoveChild.call(this, pChild);
        if (!this.m_bSortingChild) {
            this.UpdateChild();
            this.m_vecChild.remove(pChild);
        }
    };
    dRoundList.prototype.SortChild = function () {
        this.m_bSortingChild = true;
        _super.prototype.SortChild.call(this, function (a1, a2) {
            return a1.GetPosY() - a2.GetPosY();
        });
        this.m_bSortingChild = false;
    };
    dRoundList.prototype.UpdateChild = function () {
        var vecChild = this.m_vecChild;
        for (var i = 0, n = vecChild.length; i < n; i++) {
            var angle = i / vecChild.length * (dMath.dPI * 2) + this.m_fAngle;
            var x = -dMath.Sin(angle) * this.GetWidth() / 2;
            var y = dMath.Cos(angle) * this.GetHeight() / 2;
            vecChild[i].SetPos(x, y);
            var value = (y + this.GetHeight() / 2) / this.GetHeight();
            var scale = value * (this.m_fScaleMax - this.m_fScaleMin) + this.m_fScaleMin;
            vecChild[i].SetScale(scale, scale);
            vecChild[i].SetAlpha(scale + 0.3);
            var bri = value * 0.5 + 0.5;
            vecChild[i].SetBrightness(bri - 1);
        }
        this.SortChild();
        var curSel = this.GetCurSel();
        if (this.m_nLastSendCurSel != curSel && this.m_pEvent != null) {
            this.m_pEvent.OnListShowView(curSel);
            this.m_nLastSendCurSel = curSel;
        }
    };
    dRoundList.prototype.SetCurSel = function (index) {
        var _this = this;
        var vecChild = this.m_vecChild;
        if (vecChild.length == 0)
            return;
        index %= vecChild.length;
        var angle = index / vecChild.length * (dMath.dPI * 2);
        if (this.m_pTimer != null)
            this.m_pTimer.Stop();
        this.m_pTimer = new dTimer();
        this.m_pTimer.Create(0, 20, function (p, iTimer, fTimer) {
            _this.m_fAngle = dMath.LerpAngle(_this.m_fAngle, angle, 0.25);
            if (dMath.Abs(_this.m_fAngle - angle) < 0.01) {
                _this.m_fAngle = angle;
                _this.m_pTimer.Stop();
                _this.m_pTimer = null;
            }
            _this.UpdateChild();
        });
        this.UpdateChild();
    };
    dRoundList.prototype.GetCurSel = function () {
        var vecChild = this.m_vecChild;
        if (vecChild.length == 0)
            return 0;
        var per = (dMath.dPI * 2) / vecChild.length;
        var ret = this.m_fAngle / per;
        var ret2 = dMath.Round(ret) % vecChild.length;
        if (ret2 < 0)
            return vecChild.length + ret2;
        return ret2;
    };
    return dRoundList;
}(dBaseControl));
var dScale9 = (function (_super) {
    __extends(dScale9, _super);
    function dScale9() {
        var _this = _super.call(this) || this;
        _this.m_vecImage = new Array(9);
        _this.m_rcBitmapRect = null;
        _this.m_bRepeatType = false;
        _this.m_vertices = null;
        _this.m_indices = null;
        _this.m_nVerticesLength = 0;
        _this.m_nIndicesLength = 0;
        _this.m_bNeedComputeRenderBatch = false;
        _this.m_matBuffer = new dMatrix();
        _this.m_bNeedUpdateSize = false;
        for (var i = 0; i < _this.m_vecImage.length; i++) {
            _this.m_vecImage[i] = new ImageObj();
        }
        _this.m_bForceRender = true;
        _this.SetMeshData(dSpriteDefaultShader.Instance().m_pStreamMeshData);
        return _this;
    }
    Object.defineProperty(dScale9.prototype, "repeatType", {
        get: function () {
            return this.isRepeatType();
        },
        set: function (bRepeatType) {
            this.SetRepeatMode(bRepeatType);
        },
        enumerable: false,
        configurable: true
    });
    dScale9.prototype.LoadFromFile = function (strImage, onLoadComplete, bAutoResize, rc) {
        var _this = this;
        if (onLoadComplete === void 0) { onLoadComplete = null; }
        if (bAutoResize === void 0) { bAutoResize = true; }
        if (rc === void 0) { rc = null; }
        var a = this;
        if (strImage != null) {
            if (strImage != "") {
                var bmp = new dBitmapData();
                a.SetBitmapData(bmp, rc);
                bmp.LoadFromFile(strImage, function () {
                    if (bAutoResize && a.GetWidth() == 0 && a.GetHeight() == 0)
                        a.SetSize(bmp.GetWidth(), bmp.GetHeight());
                    _this.m_bNeedUpdateSize = true;
                    if (onLoadComplete)
                        onLoadComplete(a);
                });
            }
            else if (a.GetBitmapData() != null) {
                a.SetBitmapData(null);
            }
        }
        return this;
    };
    dScale9.prototype.SetBitmapData = function (bmp, rc, at, sampleType) {
        if (rc === void 0) { rc = null; }
        if (at === void 0) { at = 0; }
        if (sampleType === void 0) { sampleType = 0; }
        if (at == 0) {
            if (this.m_pImageBitmapData != bmp) {
                _super.prototype.SetBitmapData.call(this, bmp);
                this.m_bNeedUpdateSize = true;
            }
        }
        else
            _super.prototype.SetBitmapData.call(this, bmp, rc, at, sampleType);
    };
    dScale9.prototype.GetBitmapData = function (at) {
        if (at === void 0) { at = 0; }
        if (at == 0)
            return this.m_pImageBitmapData;
        return _super.prototype.GetBitmapData.call(this, at);
    };
    dScale9.prototype.isRepeatType = function () {
        return this.m_bRepeatType;
    };
    dScale9.prototype.SetRepeatMode = function (bRepeat) {
        if (this.m_bRepeatType == bRepeat)
            return;
        this.m_bRepeatType = bRepeat;
        if (bRepeat) {
            this.m_vecImage[0].SetRepeat(false, false);
            this.m_vecImage[1].SetRepeat(true, false);
            this.m_vecImage[2].SetRepeat(false, false);
            this.m_vecImage[3].SetRepeat(false, true);
            this.m_vecImage[4].SetRepeat(true, true);
            this.m_vecImage[5].SetRepeat(false, true);
            this.m_vecImage[6].SetRepeat(false, false);
            this.m_vecImage[7].SetRepeat(true, false);
            this.m_vecImage[8].SetRepeat(false, false);
        }
        else {
            for (var i = 0; i < 9; i++)
                this.m_vecImage[i].SetRepeat(false, false);
        }
        this.m_bNeedUpdateSize = true;
    };
    dScale9.prototype.SetSize = function (width, height) {
        if (this.m_fWidth != width || this.m_fHeight != height) {
            _super.prototype.SetSize.call(this, width, height);
            this.m_bNeedUpdateSize = true;
        }
    };
    dScale9.prototype.EndDsc = function () {
        _super.prototype.EndDsc.call(this);
        this.m_bNeedUpdateSize = true;
    };
    dScale9.prototype.UpdateSize = function () {
        var a = this;
        if (a.m_bBeginDsc)
            return;
        if (a.m_pImageBitmapData != null && !a.m_pImageBitmapData.isLoading()) {
            a.m_bNeedUpdateSize = false;
            var rc = a.m_rcBitmapRect;
            if (rc == null)
                rc = new dRect().SetPosSize(0, 0, a.m_pImageBitmapData.GetWidth(), a.m_pImageBitmapData.GetHeight());
            var width = _super.prototype.GetWidth.call(this);
            var height = _super.prototype.GetHeight.call(this);
            var tile_width = this.m_pImageBitmapData.GetWidth() / 3;
            var tile_height = this.m_pImageBitmapData.GetHeight() / 3;
            if (tile_width < 1)
                tile_width = 1;
            if (tile_height < 1)
                tile_height = 1;
            if (tile_width > width / 2)
                tile_width = width / 2;
            if (tile_height > height / 2)
                tile_height = height / 2;
            a.m_vecImage[0].SetPos(0, 0);
            a.m_vecImage[0].SetSize(tile_width, tile_height);
            a.m_vecImage[1].SetPos(tile_width, 0);
            a.m_vecImage[1].SetSize(width - tile_width - tile_width, tile_height);
            a.m_vecImage[2].SetSize(tile_width, tile_height);
            a.m_vecImage[2].SetPos(width - tile_width, 0);
            a.m_vecImage[3].SetPos(0, tile_height);
            a.m_vecImage[3].SetSize(tile_width, height - tile_height - tile_height);
            a.m_vecImage[4].SetPos(tile_width, tile_height);
            a.m_vecImage[4].SetSize(width - tile_width - tile_width, height - tile_height - tile_height);
            a.m_vecImage[5].SetPos(width - tile_width, tile_height);
            a.m_vecImage[5].SetSize(tile_width, height - tile_height - tile_height);
            a.m_vecImage[6].SetSize(tile_width, tile_height);
            a.m_vecImage[6].SetPos(0, height - tile_height);
            a.m_vecImage[7].SetPos(tile_width, height - tile_height);
            a.m_vecImage[7].SetSize(width - tile_width - tile_width, tile_height);
            a.m_vecImage[8].SetSize(tile_width, tile_height);
            a.m_vecImage[8].SetPos(width - tile_width, height - tile_height);
            for (var i = 0; i < 9; i++) {
                a.m_vecImage[i].SetPos(a.m_vecImage[i].GetPosX() - this.GetAnchorU() * width, a.m_vecImage[i].GetPosY() - a.GetAnchorV() * height);
                if (a.m_vecImage[i].GetWidth() < 0)
                    a.m_vecImage[i].SetSize(0, a.m_vecImage[i].GetHeight());
                if (a.m_vecImage[i].GetHeight() < 0)
                    a.m_vecImage[i].SetSize(a.m_vecImage[i].GetWidth(), 0);
            }
            var bmp_width = rc.Width();
            var bmp_height = rc.Height();
            var bmp_width3 = rc.Width() / 3;
            var bmp_height3 = rc.Height() / 3;
            var x1 = 0;
            var x2 = bmp_width3;
            var x3 = bmp_width - bmp_width3;
            var x4 = bmp_width;
            var y1 = 0;
            var y2 = bmp_height3;
            var y3 = bmp_height - bmp_height3;
            var y4 = bmp_height;
            if (x2 > width / 2) {
                x2 = width / 2;
                x3 = bmp_width - width / 2;
            }
            if (y2 > height / 2) {
                y2 = height / 2;
                y3 = bmp_height - height / 2;
            }
            x1 += rc.left;
            x2 += rc.left;
            x3 += rc.left;
            x4 += rc.left;
            y1 += rc.top;
            y2 += rc.top;
            y3 += rc.top;
            y4 += rc.top;
            var rect = new dRect();
            a.m_vecImage[0].SetBitmapData(a.GetBitmapData(), rect.SetValue(x1, y1, x2, y2));
            if (x2 != x3)
                a.m_vecImage[1].SetBitmapData(a.GetBitmapData(), rect.SetValue(x2, y1, x3, y2));
            a.m_vecImage[2].SetBitmapData(a.GetBitmapData(), rect.SetValue(x3, y1, x4, y2));
            if (y2 != y3) {
                a.m_vecImage[3].SetBitmapData(a.GetBitmapData(), rect.SetValue(x1, y2, x2, y3));
                if (x2 != x3)
                    a.m_vecImage[4].SetBitmapData(a.GetBitmapData(), rect.SetValue(x2, y2, x3, y3));
                a.m_vecImage[5].SetBitmapData(a.GetBitmapData(), rect.SetValue(x3, y2, x4, y3));
            }
            a.m_vecImage[6].SetBitmapData(a.GetBitmapData(), rect.SetValue(x1, y3, x2, y4));
            if (x2 != x3)
                a.m_vecImage[7].SetBitmapData(a.GetBitmapData(), rect.SetValue(x2, y3, x3, y4));
            a.m_vecImage[8].SetBitmapData(a.GetBitmapData(), rect.SetValue(x3, y3, x4, y4));
        }
        a.m_bNeedComputeRenderBatch = true;
    };
    dScale9.prototype.SetAnchor = function (u, v) {
        var a = this;
        if (a.m_fAnchorU != u || a.m_fAnchorV != v) {
            _super.prototype.SetAnchor.call(this, u, v);
            a.UpdateSize();
        }
    };
    dScale9.prototype._DrawImage = function (i, image, perWidth, perHeight, offx, offy, uMulty, vMulty) {
        var a = this;
        var bmpWidth = a.m_pImageBitmapData.GetWidth();
        var bmpHeight = a.m_pImageBitmapData.GetHeight();
        var rc = image.GetBitmapSourceRect();
        var width = perWidth;
        var height = perHeight;
        var mat2 = a.m_matBuffer.Copy(a.m_matRenderMatrixSelf);
        mat2.Scaling(width / a.GetWidth(), height / a.GetHeight(), 1);
        mat2.TranslationFast((image.GetPosX() + offx) / a.GetWidth() + a.GetAnchorU(), (image.GetPosY() + offy) / a.GetHeight() + a.GetAnchorV(), 0);
        var t_left = rc.left / bmpWidth;
        var t_top = rc.top / bmpHeight;
        var t_right = rc.Width() / bmpWidth * uMulty + t_left;
        var t_bottom = rc.Height() / bmpHeight * vMulty + t_top;
        t_top = 1 - t_top;
        t_bottom = 1 - t_bottom;
        var t_vertices = a.m_vertices;
        var t_indices = a.m_indices;
        var index = i * 20;
        t_vertices[index] = 0.0;
        t_vertices[index + 1] = 0.0;
        t_vertices[index + 2] = 0.0;
        t_vertices[index + 3] = t_left;
        t_vertices[index + 4] = t_top;
        t_vertices[index + 5] = 1.0;
        t_vertices[index + 6] = 0.0;
        t_vertices[index + 7] = 0.0;
        t_vertices[index + 8] = t_right;
        t_vertices[index + 9] = t_top;
        t_vertices[index + 10] = 0.0;
        t_vertices[index + 11] = 1.0;
        t_vertices[index + 12] = 0.0;
        t_vertices[index + 13] = t_left;
        t_vertices[index + 14] = t_bottom;
        t_vertices[index + 15] = 1.0;
        t_vertices[index + 16] = 1.0;
        t_vertices[index + 17] = 0.0;
        t_vertices[index + 18] = t_right;
        t_vertices[index + 19] = t_bottom;
        mat2.TransformFloatArray3(t_vertices, index);
        mat2.TransformFloatArray3(t_vertices, index + 5);
        mat2.TransformFloatArray3(t_vertices, index + 10);
        mat2.TransformFloatArray3(t_vertices, index + 15);
        index = i * 6;
        var m = i * 4;
        t_indices[index] = 1 + m;
        t_indices[index + 1] = 0 + m;
        t_indices[index + 2] = 2 + m;
        t_indices[index + 3] = 1 + m;
        t_indices[index + 4] = 2 + m;
        t_indices[index + 5] = 3 + m;
    };
    dScale9.prototype.ComputeRenderBatch = function () {
        var a = this;
        var bmp = a.m_pImageBitmapData;
        if (bmp == null)
            return;
        if (a.m_bRepeatType) {
            var perWidth = bmp.GetWidth() / 3;
            var perHeight = bmp.GetHeight() / 3;
            var imageCount = 0;
            for (var i = 0; i < 9; i++) {
                imageCount += a.m_vecImage[i].GetImageCountH(perWidth, perHeight) * a.m_vecImage[i].GetImageCountV(perWidth, perHeight);
            }
            a.m_nVerticesLength = 20 * imageCount;
            a.m_nIndicesLength = 6 * imageCount;
            if (a.m_vertices == null || a.m_vertices.length < a.m_nVerticesLength)
                a.m_vertices = new Array(a.m_nVerticesLength);
            if (a.m_indices == null || a.m_indices.length < a.m_nIndicesLength)
                a.m_indices = new Array(a.m_nIndicesLength);
            var ii = 0;
            for (var i = 0; i < 9; i++) {
                var pImage = a.m_vecImage[i];
                if (pImage.repeatH || pImage.repeatV) {
                    var h = pImage.GetImageCountH(perWidth, perHeight);
                    var v = pImage.GetImageCountV(perWidth, perHeight);
                    for (var n = 0; n < v; n++) {
                        for (var m = 0; m < h; m++) {
                            var perWidth2 = perWidth;
                            var uMulty = 1;
                            if (pImage.repeatH) {
                                if (m == h - 1) {
                                    perWidth2 = pImage.width % perWidth;
                                    if (perWidth2 == 0)
                                        perWidth2 += perWidth;
                                }
                                uMulty = perWidth2 / perWidth;
                            }
                            else
                                perWidth2 = pImage.width;
                            var perHeight2 = perHeight;
                            var vMulty = 1;
                            if (pImage.repeatV) {
                                if (n == v - 1) {
                                    perHeight2 = pImage.height % perHeight;
                                    if (perHeight2 == 0)
                                        perHeight2 += perHeight;
                                }
                                vMulty = perHeight2 / perHeight;
                            }
                            else
                                perHeight2 = pImage.height;
                            a._DrawImage(ii, pImage, perWidth2, perHeight2, m * perWidth, n * perHeight, uMulty, vMulty);
                            ii++;
                        }
                    }
                }
                else {
                    a._DrawImage(ii, pImage, pImage.width, pImage.height, 0, 0, 1, 1);
                    ii++;
                }
            }
        }
        else {
            a.m_nVerticesLength = 180;
            a.m_nIndicesLength = 54;
            if (a.m_vertices == null || a.m_vertices.length != a.m_nVerticesLength)
                a.m_vertices = new Array(a.m_nVerticesLength);
            if (a.m_indices == null || a.m_indices.length != a.m_nIndicesLength)
                a.m_indices = new Array(a.m_nIndicesLength);
            for (var i = 0; i < 9; i++) {
                var pImage = a.m_vecImage[i];
                a._DrawImage(i, pImage, pImage.width, pImage.height, 0, 0, 1, 1);
            }
        }
    };
    dScale9.prototype.SpriteRender = function () {
        var a = this;
        if (a.m_pImageBitmapData == null || a.m_pImageBitmapData.isLoading())
            return;
        if (a.m_bNeedUpdateSize)
            a.UpdateSize();
        if (a.m_bNeedComputeRenderBatch) {
            a.m_bNeedComputeRenderBatch = false;
            a.ComputeRenderBatch();
        }
        if (a.m_indices) {
            dSpriteDefaultShader.Instance().m_pStreamMeshData.SetData(null, a.m_nVerticesLength / 5, a.m_indices, dSpriteDefaultShader.Instance().m_vertexDecl, dMeshData.ACCESS_WRITE_TYPE_STREAM_DRAW, a.m_vertices, a.m_nIndicesLength);
            _super.prototype.SpriteRender.call(this);
        }
    };
    dScale9.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("repeatType"))
            this.repeatType = Boolean(dMath.ParseInt(json.repeatType));
    };
    return dScale9;
}(dImage));
var ImageObj = (function () {
    function ImageObj() {
        this.rc = new dRect();
        this.x = 0;
        this.y = 0;
        this.width = 0;
        this.height = 0;
        this.repeatH = false;
        this.repeatV = false;
    }
    ImageObj.prototype.SetPos = function (x, y) {
        this.x = x;
        this.y = y;
    };
    ImageObj.prototype.GetPosX = function () {
        return this.x;
    };
    ImageObj.prototype.GetPosY = function () {
        return this.y;
    };
    ImageObj.prototype.SetSize = function (width, height) {
        this.width = width;
        this.height = height;
    };
    ImageObj.prototype.GetWidth = function () {
        return this.width;
    };
    ImageObj.prototype.GetHeight = function () {
        return this.height;
    };
    ImageObj.prototype.SetBitmapData = function (bmp, rc) {
        this.rc.Copy(rc);
    };
    ImageObj.prototype.GetBitmapSourceRect = function () {
        return this.rc;
    };
    ImageObj.prototype.SetRepeat = function (repeatH, repeatV) {
        this.repeatH = repeatH;
        this.repeatV = repeatV;
    };
    ImageObj.prototype.GetImageCountH = function (perWidth, perHeight) {
        var hCount = 1;
        if (this.repeatH)
            hCount = dMath.Ceil(this.width / perWidth);
        return hCount;
    };
    ImageObj.prototype.GetImageCountV = function (perWidth, perHeight) {
        var vCount = 1;
        if (this.repeatV)
            vCount = dMath.Ceil(this.height / perHeight);
        return vCount;
    };
    return ImageObj;
}());
var dSlider = (function (_super) {
    __extends(dSlider, _super);
    function dSlider() {
        var _this = _super.call(this) || this;
        _this.m_pButton = new dImage();
        _this.m_fValue = 1;
        _this.m_fMaxValue = 1;
        _this.m_bButtonTouchMoved = false;
        _this.AddChild(_this.m_pButton);
        _this.m_pButton.SetHandleMouse(true);
        var pTouchEvent = new dSprite();
        pTouchEvent.OnTouchMove = function (x, y, offx, offy, delta) {
            _this.m_pButton.positionX += offx / _this.m_pButton.GetMatrixWorld()._11;
            if (_this.m_pButton.positionX < -_this.anchorU * _this.width)
                _this.m_pButton.positionX = -_this.anchorU * _this.width;
            else if (_this.m_pButton.positionX > _this.width - _this.anchorU * _this.width)
                _this.m_pButton.positionX = _this.width - _this.anchorU * _this.width;
            var value = (_this.m_pButton.positionX + _this.anchorU * _this.width) / _this.width;
            _this.m_fValue = value * _this.m_fMaxValue;
            _this.m_bButtonTouchMoved = true;
            if (_this.m_pEvent != null)
                _this.m_pEvent.OnSliderValueChanging(_this);
        };
        pTouchEvent.OnTouchUp = function (x, y) {
            if (_this.m_bButtonTouchMoved) {
                _this.m_bButtonTouchMoved = false;
                if (_this.m_pEvent != null)
                    _this.m_pEvent.OnSliderValueChangeFinished(_this);
            }
        };
        _this.m_pButton.SetTouchEvent(pTouchEvent);
        return _this;
    }
    dSlider.prototype.LoadFromFile = function (strImage, onLoadComplete, rcSource) {
        if (onLoadComplete === void 0) { onLoadComplete = null; }
        if (rcSource === void 0) { rcSource = null; }
        this.m_pButton.LoadFromFile(strImage, onLoadComplete, true, rcSource);
        this.Update();
        return this;
    };
    dSlider.prototype.GetFileName = function () {
        return this.m_pButton.GetFileName();
    };
    Object.defineProperty(dSlider.prototype, "resourceFileName", {
        get: function () {
            return this.GetFileName();
        },
        set: function (fileName) {
            this.LoadFromFile(fileName);
        },
        enumerable: false,
        configurable: true
    });
    dSlider.prototype.SetSize = function (w, h) {
        _super.prototype.SetSize.call(this, w, h);
        this.Update();
    };
    dSlider.prototype.Update = function () {
        this.m_pButton.SetPos(this.width * this.m_fValue / this.m_fMaxValue - this.anchorU * this.width, this.height * 0.5 - this.anchorV * this.height);
    };
    dSlider.prototype.SetValue = function (v) {
        if (v != this.m_fValue) {
            this.m_fValue = v;
            this.Update();
        }
    };
    dSlider.prototype.GetValue = function () {
        return this.m_fValue;
    };
    Object.defineProperty(dSlider.prototype, "value", {
        get: function () {
            return this.m_fValue;
        },
        set: function (v) {
            this.SetValue(v);
        },
        enumerable: false,
        configurable: true
    });
    dSlider.prototype.SetMaxValue = function (v) {
        if (v != this.m_fMaxValue) {
            this.m_fMaxValue = v;
            this.Update();
        }
    };
    dSlider.prototype.GetMaxValue = function () {
        return this.m_fMaxValue;
    };
    Object.defineProperty(dSlider.prototype, "maxValue", {
        get: function () {
            return this.m_fMaxValue;
        },
        set: function (v) {
            this.SetMaxValue(v);
        },
        enumerable: false,
        configurable: true
    });
    dSlider.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("resourceFileName"))
            this.resourceFileName = json.resourceFileName;
    };
    return dSlider;
}(dBaseControl));
var dTabView = (function (_super) {
    __extends(dTabView, _super);
    function dTabView() {
        return _super.call(this) || this;
    }
    dTabView.prototype.AddChild = function (pChild, at) {
        if (at === void 0) { at = -1; }
        _super.prototype.AddChild.call(this, pChild, at);
        this.SetFrame(this.GetCurSel());
    };
    dTabView.prototype.SetFrame = function (frame) {
        this.m_nSpriteFrame = frame;
        var nFrame = dMath.ToInt(frame);
        var vecChild = this.GetChildList();
        for (var i = 0, n = vecChild.length; i < n; i++)
            vecChild[i].SetShow(i == nFrame);
    };
    dTabView.prototype.GetCurSel = function () {
        return this.m_nSpriteFrame;
    };
    dTabView.prototype.GetCurShowPage = function () {
        if (this.m_nSpriteFrame >= 0 && this.m_nSpriteFrame < this.GetChildList().length)
            return this.GetChildList()[this.m_nSpriteFrame];
        return null;
    };
    Object.defineProperty(dTabView.prototype, "showPage", {
        get: function () {
            return this.GetFrame();
        },
        set: function (index) {
            this.SetFrame(index);
        },
        enumerable: false,
        configurable: true
    });
    return dTabView;
}(dBaseControl));
var dTileImage = (function (_super) {
    __extends(dTileImage, _super);
    function dTileImage() {
        var _this = _super.call(this) || this;
        _this.m_pBitmapData = null;
        _this.m_vecImage = new Array();
        _this.m_pTileLayer = new dSprite();
        _this.m_nTileWidth = 0;
        _this.m_nTileHeight = 0;
        _this.m_nWidthCount = 0;
        _this.m_nHeightCount = 0;
        _this.m_nTileSpaceX = 0;
        _this.m_nTileSpaceY = 0;
        _this.m_nTileStartOffsetX = 0;
        _this.m_nTileStartOffsetY = 0;
        _this.m_data = null;
        _this.m_indexProperty = null;
        _this.AddChild(_this.m_pTileLayer);
        _this.UpdateTile();
        return _this;
    }
    dTileImage.prototype.SetTileData = function (tileWidth, tileHeight, widthCount, heightCount, data, tileSpaceX, tileSpaceY, bAutoUpdate) {
        if (tileSpaceX === void 0) { tileSpaceX = 0; }
        if (tileSpaceY === void 0) { tileSpaceY = 0; }
        if (bAutoUpdate === void 0) { bAutoUpdate = true; }
        this.m_nTileWidth = tileWidth;
        this.m_nTileHeight = tileHeight;
        this.m_nWidthCount = widthCount;
        this.m_nHeightCount = heightCount;
        this.m_nTileSpaceX = tileSpaceX;
        this.m_nTileSpaceY = tileSpaceY;
        this.m_data = data;
        if (bAutoUpdate)
            this.UpdateTile();
    };
    dTileImage.prototype.LoadFromFile = function (strImage, onLoadComplete, bAutoResize, rcSrc) {
        var _this = this;
        if (onLoadComplete === void 0) { onLoadComplete = null; }
        if (bAutoResize === void 0) { bAutoResize = true; }
        if (rcSrc === void 0) { rcSrc = null; }
        if (strImage != null) {
            if (strImage != "") {
                var bmp = new dBitmapData();
                bmp.LoadFromFile(strImage, function (sender) {
                    _this.UpdateTile();
                    if (onLoadComplete != null)
                        onLoadComplete(sender);
                });
                this.SetBitmapData(bmp);
            }
            else
                this.SetBitmapData(null);
        }
        this.UpdateTile();
        return this;
    };
    Object.defineProperty(dTileImage.prototype, "pureColor", {
        get: function () {
            return false;
        },
        set: function (bSet) {
        },
        enumerable: false,
        configurable: true
    });
    dTileImage.prototype.SetBitmapData = function (bmp, rc, at, sampleType) {
        if (rc === void 0) { rc = null; }
        if (at === void 0) { at = 0; }
        if (sampleType === void 0) { sampleType = 0; }
        this.m_pBitmapData = bmp;
        if (bmp == null) {
            for (var i = 0; i < this.m_vecImage.length; i++) {
                if (this.m_vecImage[i] != null)
                    this.m_vecImage[i].SetBitmapData(null);
            }
        }
    };
    dTileImage.prototype.GetBitmapData = function (at) {
        if (at === void 0) { at = 0; }
        return this.m_pBitmapData;
    };
    dTileImage.prototype.SetColor = function (colorARGB, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        _super.prototype.SetColor.call(this, colorARGB, bSetToChild);
        if (!bSetToChild) {
            for (var i = 0; i < this.m_vecImage.length; i++) {
                if (this.m_vecImage[i] != null)
                    this.m_vecImage[i].SetColor(colorARGB, bSetToChild);
            }
        }
    };
    dTileImage.prototype.SetBlendMode = function (mode, bWithChild) {
        if (bWithChild === void 0) { bWithChild = false; }
        _super.prototype.SetBlendMode.call(this, mode, bWithChild);
        if (!bWithChild) {
            for (var i = 0; i < this.m_vecImage.length; i++) {
                if (this.m_vecImage[i] != null)
                    this.m_vecImage[i].SetBlendMode(mode, bWithChild);
            }
        }
    };
    dTileImage.prototype.SetAnchor = function (u, v) {
        _super.prototype.SetAnchor.call(this, u, v);
        if (this.m_vecImage != null)
            this.UpdateTile();
    };
    dTileImage.prototype.GetTileImage = function (x, y) {
        if (x >= 0 && y >= 0 && x < this.m_nWidthCount && y < this.m_nHeightCount)
            return this.m_vecImage[y * this.m_nWidthCount + x];
        return null;
    };
    dTileImage.prototype.UpdateTile = function (rc) {
        if (rc === void 0) { rc = null; }
        if (this.GetBitmapData() == null || this.GetBitmapData().isLoading())
            return;
        this.SetSize(this.m_nWidthCount * this.m_nTileWidth, this.m_nHeightCount * this.m_nTileHeight);
        for (var i = this.m_nWidthCount * this.m_nHeightCount, n = this.m_vecImage.length; i < n; i++) {
            if (this.m_vecImage[i] != null)
                this.m_vecImage[i].RemoveParent();
        }
        this.m_vecImage.resize(this.m_nWidthCount * this.m_nHeightCount);
        var split;
        for (var i = 0, n = this.m_vecImage.length; i < n; i++) {
            var pImage = this.m_vecImage[i];
            var x = i % this.m_nWidthCount;
            var y = i / this.m_nWidthCount;
            if (rc != null && (x < rc.left || y < rc.top || x >= rc.right || y >= rc.bottom))
                return;
            var index = 0;
            var aniCount = 0;
            if (this.m_data != null && i >= 0 && i < this.m_data.length) {
                index = this.m_data[i] & 0xFFFF;
            }
            if (this.m_indexProperty != null && index < this.m_indexProperty.length) {
                aniCount = this.m_indexProperty[index];
            }
            if (index == 0 || this.m_pBitmapData == null || this.m_pBitmapData.GetWidth() == 0) {
                if (pImage != null)
                    pImage.SetBitmapData(null);
            }
            else {
                if (this.m_vecImage[i] == null) {
                    this.m_vecImage[i] = new dImage();
                    this.m_vecImage[i].SetAnchor(0, 0);
                    this.m_vecImage[i].SetColor(this.GetColor());
                    this.m_vecImage[i].SetBlendMode(this.GetBlendMode());
                    this.m_pTileLayer.AddChild(this.m_vecImage[i]);
                    pImage = this.m_vecImage[i];
                }
                var tile_width = (this.m_nTileWidth + this.m_nTileSpaceX * 2);
                var tile_height = (this.m_nTileHeight + this.m_nTileSpaceY * 2);
                var xx = (index - 1) % (this.m_pBitmapData.GetWidth() / tile_width);
                var yy = (index - 1) / (this.m_pBitmapData.GetWidth() / tile_height);
                pImage.SetBitmapData(this.m_pBitmapData, new dRect().SetPosSize(xx * tile_width + this.m_nTileSpaceX, yy * tile_height + this.m_nTileSpaceY, this.m_nTileWidth, this.m_nTileHeight));
                pImage.SetSize(this.m_nTileWidth, this.m_nTileHeight);
                pImage.SetPos(x * this.m_nTileWidth - this.GetWidth() * this.GetAnchorU() + this.m_nTileStartOffsetX * this.m_nTileWidth, y * this.m_nTileHeight - this.GetHeight() * this.GetAnchorV() + this.m_nTileStartOffsetY * this.m_nTileHeight);
            }
        }
    };
    dTileImage.prototype.GetBitmapWidthCount = function () {
        if (this.m_pBitmapData == null)
            return 0;
        var tile_width = this.m_nTileWidth + this.m_nTileSpaceX * 2;
        return this.m_pBitmapData.GetWidth() / tile_width;
    };
    dTileImage.prototype.GetBitmapHeightCount = function () {
        if (this.m_pBitmapData == null)
            return 0;
        var tile_height = this.m_nTileHeight + this.m_nTileSpaceY * 2;
        return this.m_pBitmapData.GetHeight() / tile_height;
    };
    dTileImage.prototype.EndDsc = function () {
        _super.prototype.EndDsc.call(this);
        this.UpdateTile();
    };
    dTileImage.prototype.GetRowData = function () {
        return this.m_data;
    };
    dTileImage.prototype.SetTile = function (x, y, data) {
        if (this.m_data != null && x >= 0 && y >= 0 && x < this.m_nWidthCount && y < this.m_nHeightCount) {
            var index = y * this.m_nWidthCount + x;
            if (index < this.m_data.length)
                this.m_data[index] = data;
        }
    };
    dTileImage.prototype.GetTile = function (x, y) {
        if (this.m_data != null && x >= 0 && y >= 0 && x < this.m_nWidthCount && y < this.m_nHeightCount) {
            var index = y * this.m_nWidthCount + x;
            if (index < this.m_data.length)
                return this.m_data[index];
        }
        return 0;
    };
    Object.defineProperty(dTileImage.prototype, "dataString", {
        get: function () {
            var arr = new dByteArray();
            arr.WriteStringEx(this.m_nWidthCount + "," + this.m_nHeightCount, false);
            if (this.m_data != null) {
                for (var i = 0; i < this.m_data.length; i++) {
                    arr.WriteStringEx("," + this.m_data[i], false);
                }
            }
            return arr.ToStringBuffer();
        },
        set: function (str) {
            if (str != null) {
                var arr = str.split(",");
                if (arr.length < 2)
                    return;
                var nTileWidth = dMath.ParseInt(arr[0]);
                var nTileHeight = dMath.ParseInt(arr[1]);
                this.SetTileCount(nTileWidth, nTileHeight);
                for (var i = 2; i < arr.length; i++) {
                    if (i - 2 < this.m_data.length) {
                        var s = arr[i];
                        this.m_data[i - 2] = dMath.ParseInt(s);
                    }
                }
            }
            else
                this.m_data = null;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dTileImage.prototype, "tileWidth", {
        get: function () {
            return this.m_nTileWidth;
        },
        set: function (value) {
            this.m_nTileWidth = value;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dTileImage.prototype, "tileHeight", {
        get: function () {
            return this.m_nTileHeight;
        },
        set: function (value) {
            this.m_nTileHeight = value;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dTileImage.prototype, "tileSpaceX", {
        get: function () {
            return this.m_nTileSpaceX;
        },
        set: function (value) {
            this.m_nTileSpaceX = value;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dTileImage.prototype, "tileSpaceY", {
        get: function () {
            return this.m_nTileSpaceY;
        },
        set: function (value) {
            this.m_nTileSpaceY = value;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dTileImage.prototype, "widthCount", {
        get: function () {
            return this.m_nWidthCount;
        },
        set: function (value) {
            this.SetTileCount(value, this.heightCount);
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dTileImage.prototype, "heightCount", {
        get: function () {
            return this.m_nHeightCount;
        },
        set: function (value) {
            this.SetTileCount(value, value);
        },
        enumerable: false,
        configurable: true
    });
    dTileImage.prototype.SetTileCount = function (newWidthCount, newHeightCount) {
        if (this.m_nWidthCount != newWidthCount || this.m_nHeightCount != newHeightCount) {
            var newData = new Array(newWidthCount * newHeightCount);
            for (var j = 0; j < this.m_nHeightCount; j++) {
                for (var i = 0; i < this.m_nWidthCount; i++) {
                    if (i < this.m_nWidthCount && j < this.m_nHeightCount && i < newWidthCount && j < newHeightCount)
                        newData[j * newWidthCount + i] = this.m_data[j * this.m_nWidthCount + i];
                }
            }
            this.m_nWidthCount = newWidthCount;
            this.m_nHeightCount = newHeightCount;
            this.m_data = newData;
        }
    };
    Object.defineProperty(dTileImage.prototype, "tileStartOffsetX", {
        get: function () {
            return this.m_nTileStartOffsetX;
        },
        set: function (value) {
            this.m_nTileStartOffsetX = value;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(dTileImage.prototype, "tileStartOffsetY", {
        get: function () {
            return this.m_nTileStartOffsetY;
        },
        set: function (value) {
            this.m_nTileStartOffsetY = value;
        },
        enumerable: false,
        configurable: true
    });
    dTileImage.prototype.GetData = function (x, y) {
        x -= this.tileStartOffsetX;
        y -= this.tileStartOffsetY;
        if (x >= 0 && x < this.widthCount && y >= 0 && y < this.heightCount)
            return this.m_data[y * this.widthCount + x];
        return 0;
    };
    dTileImage.prototype.GetAnimateCount = function (x, y) {
        if (this.m_indexProperty != null && x >= 0 && y >= 0 && x < this.GetBitmapWidthCount() && y < this.GetBitmapHeightCount()) {
            var index = y * this.GetBitmapWidthCount() + x;
            if (index < this.m_indexProperty.length)
                return this.m_indexProperty[index];
        }
        return 0;
    };
    dTileImage.prototype.SetAnimateCount = function (x, y, data) {
        if (this.m_indexProperty == null || this.m_indexProperty.length != this.GetBitmapWidthCount() * this.GetBitmapHeightCount()) {
            this.m_indexProperty = new Array(this.GetBitmapWidthCount() * this.GetBitmapHeightCount());
        }
        if (x >= 0 && y >= 0 && x < this.GetBitmapWidthCount() && y < this.GetBitmapHeightCount()) {
            this.m_indexProperty[y * this.GetBitmapWidthCount() + x] = data;
            var isAllZero = true;
            for (var i = 0; i < this.m_indexProperty.length; i++) {
                if (this.m_indexProperty[i] != 0) {
                    isAllZero = false;
                    break;
                }
            }
            if (isAllZero)
                this.m_indexProperty = null;
        }
    };
    Object.defineProperty(dTileImage.prototype, "indexPropertyString", {
        get: function () {
            var ret = "";
            if (this.m_indexProperty != null) {
                for (var i = 0; i < this.m_indexProperty.length; i++) {
                    if (i != 0)
                        ret += ",";
                    ret += this.m_indexProperty[i];
                }
            }
            return ret;
        },
        set: function (str) {
            if (str != null) {
                var arr = str.split(",");
                if (arr.length) {
                    this.m_indexProperty = new Array(arr.length);
                    for (var i = 0; i < arr.length; i++) {
                        this.m_indexProperty[i] = dMath.ParseInt(arr[i]);
                    }
                }
            }
            else
                this.m_indexProperty = null;
        },
        enumerable: false,
        configurable: true
    });
    dTileImage.prototype.SetFrame = function (frame) {
        _super.prototype.SetFrame.call(this, frame);
        var split;
        if (this.m_indexProperty != null) {
            for (var i = 0, n = this.m_vecImage.length; i < n; i++) {
                if (this.m_vecImage[i] != null && this.m_vecImage[i].GetBitmapData() != null) {
                    var index = 0;
                    var aniCount = 0;
                    if (this.m_data != null && i >= 0 && i < this.m_data.length) {
                        index = this.m_data[i] & 0xFFFF;
                    }
                    if (this.m_indexProperty != null && index > 0 && index <= this.m_indexProperty.length) {
                        aniCount = this.m_indexProperty[index - 1];
                    }
                    if (aniCount != 0 && index != 0) {
                        index = index + (frame % aniCount);
                        var tile_width = (this.m_nTileWidth + this.m_nTileSpaceX * 2);
                        var tile_height = (this.m_nTileHeight + this.m_nTileSpaceY * 2);
                        var xx = (index - 1) % (this.m_pBitmapData.GetWidth() / tile_width);
                        var yy = (index - 1) / (this.m_pBitmapData.GetWidth() / tile_height);
                        this.m_vecImage[i].SetBitmapData(this.m_pBitmapData, new dRect().SetPosSize(xx * tile_width + this.m_nTileSpaceX, yy * tile_height + this.m_nTileSpaceY, this.m_nTileWidth, this.m_nTileHeight));
                    }
                }
            }
        }
    };
    dTileImage.prototype.LoadFromJson = function (json) {
        _super.prototype.LoadFromJson.call(this, json);
        if (json.hasOwnProperty("tileWidth"))
            this.tileWidth = json.tileWidth;
        if (json.hasOwnProperty("tileHeight"))
            this.tileHeight = json.tileHeight;
        if (json.hasOwnProperty("tileSpaceX"))
            this.tileSpaceX = json.tileSpaceX;
        if (json.hasOwnProperty("tileSpaceY"))
            this.tileSpaceY = json.tileSpaceY;
        if (json.hasOwnProperty("tileStartOffsetX"))
            this.tileStartOffsetX = json.tileStartOffsetX;
        if (json.hasOwnProperty("tileStartOffsetY"))
            this.tileStartOffsetY = json.tileStartOffsetY;
        if (json.hasOwnProperty("dataString"))
            this.dataString = json.dataString;
        if (json.hasOwnProperty("indexPropertyString"))
            this.indexPropertyString = json.indexPropertyString;
    };
    return dTileImage;
}(dImage));
var dTileView = (function (_super) {
    __extends(dTileView, _super);
    function dTileView() {
        var _this = _super.call(this) || this;
        _this.m_pBitmapData = null;
        _this.m_nTileWidth = 0;
        _this.m_nTileHeight = 0;
        _this.m_vecTiles = null;
        _this.m_onCallback = null;
        _this.m_pViewPanel = new dSprite();
        _this.m_vOldViewPos = new dVector2();
        _this.m_nTilesWidthCount = 0;
        _this.m_nTilesHeightCount = 0;
        _this.m_vecLineH = null;
        _this.m_vecLineV = null;
        _this.m_vecBmpBufferLineH = new Array();
        _this.m_vecBmpBufferLineV = new Array();
        _this.m_nViewOffX = 0;
        _this.m_nViewOffY = 0;
        _this.m_vecBmpBuffer = new Array();
        _this.m_nBmpBufferWidth = 0;
        _this.m_nBmpBufferHeight = 0;
        _this.m_nBmpStartX = 0;
        _this.m_nBmpStartY = 0;
        _this.m_ptBuffer = new dVector2();
        _this.m_rcBuffer = new dRect();
        _this.m_matBuffer = new dMatrix();
        _this.AddChild(_this.m_pViewPanel);
        _this.m_bForceRender = true;
        return _this;
    }
    dTileView.prototype.LoadFromFile = function (strImage, onLoadComplete) {
        var _this = this;
        if (onLoadComplete === void 0) { onLoadComplete = null; }
        if (strImage != null && this.GetFileName() != strImage) {
            if (strImage != "") {
                var bmp = new dBitmapData();
                bmp.LoadFromFile(strImage, function (sender) {
                    _this.m_pBitmapData = bmp;
                    if (onLoadComplete != null)
                        onLoadComplete(_this);
                });
            }
            else
                this.m_pBitmapData = null;
        }
        return this;
    };
    dTileView.prototype.GetFileName = function () {
        if (this.m_pBitmapData == null)
            return "";
        return this.m_pBitmapData.GetResourceFileName();
    };
    Object.defineProperty(dTileView.prototype, "resourceFileName", {
        set: function (fileName) {
            this.LoadFromFile(fileName, null);
        },
        enumerable: false,
        configurable: true
    });
    dTileView.prototype.SetTileCallback = function (onCallback) {
        this.m_onCallback = onCallback;
    };
    dTileView.prototype.SetTileSize = function (width, height) {
        this.m_nTileWidth = width;
        this.m_nTileHeight = height;
        this.ResizeTile();
    };
    dTileView.prototype.SetViewOffset = function (offx, offy) {
        this.m_nViewOffX = offx;
        this.m_nViewOffY = offy;
        this.UpdateView();
    };
    dTileView.prototype.SetSize = function (w, h) {
        if (this.m_fWidth != w || this.m_fHeight != h) {
            _super.prototype.SetSize.call(this, w, h);
            this.ResizeTile();
        }
    };
    dTileView.prototype.SetViewPos = function (x, y) {
        if (x != this.m_vOldViewPos.x || y != this.m_vOldViewPos.y) {
            this.m_vOldViewPos.SetValue(this.m_pViewPanel.positionX, this.m_pViewPanel.positionY);
            this.m_pViewPanel.SetPos(x, y);
            this.UpdateView();
        }
    };
    dTileView.prototype.GetViewPosX = function () {
        return this.m_pViewPanel.positionX;
    };
    dTileView.prototype.GetViewPosY = function () {
        return this.m_pViewPanel.positionY;
    };
    dTileView.prototype.ResizeTile = function () {
        var e_11, _a, e_12, _b;
        if (this.m_nTileWidth > 0 && this.m_nTileHeight > 0) {
            var xx = dMath.ToInt(this.GetWidth() / this.m_nTileWidth) + 1;
            var yy = dMath.ToInt(this.GetHeight() / this.m_nTileHeight) + 1;
            var needCount = xx * yy;
            var arrSendAdded = new Map();
            var arrSendRemove = new Map();
            if (this.m_vecTiles != null) {
                for (var i = 0; i < this.m_vecTiles.length; i++) {
                    if (this.m_onCallback != null)
                        arrSendRemove.set(this.m_vecTiles[i].dataY << 16 | this.m_vecTiles[i].dataX, 1);
                    this.m_vecTiles[i].RemoveParent();
                }
            }
            var vecNewTiles = new Array(needCount);
            var offx = this.m_pViewPanel.positionX;
            offx /= this.m_nTileWidth;
            if (this.m_pViewPanel.positionX < 0)
                offx--;
            var offy = this.m_pViewPanel.positionY;
            offy /= this.m_nTileHeight;
            if (this.m_pViewPanel.positionY < 0)
                offy--;
            this.m_vecLineH = new Array(yy);
            this.m_vecLineV = new Array(xx);
            for (var i = 0; i < yy; i++) {
                this.m_vecLineH[i] = new LineData();
                this.m_vecLineH[i].vecTiles.resize(xx);
                this.m_vecLineH[i].y = (i - offy) * this.m_nTileHeight;
            }
            for (var i = 0; i < xx; i++) {
                this.m_vecLineV[i] = new LineData();
                this.m_vecLineV[i].vecTiles.resize(yy);
                this.m_vecLineV[i].x = (i - offx) * this.m_nTileWidth;
            }
            for (var j = 0; j < yy; j++) {
                for (var i = 0; i < xx; i++) {
                    var p = new TileData();
                    p.SetPosI(this.m_vecLineV[i].x, this.m_vecLineH[j].y);
                    p.SetAnchor(0, 0);
                    p.SetSize(this.m_nTileWidth, this.m_nTileHeight);
                    if (this.m_onCallback != null) {
                        var tx = dMath.ToInt(p.posX / this.m_nTileWidth);
                        var ty = dMath.ToInt(p.posY / this.m_nTileHeight);
                        var id = ty << 16 | tx;
                        if (arrSendRemove.has(id))
                            arrSendRemove.delete(id);
                        else
                            arrSendAdded.set(id, 1);
                    }
                    this._UpdateTileImage(p, false);
                    vecNewTiles[j * xx + i] = p;
                    this.m_vecLineH[j].vecTiles[i] = p;
                    this.m_vecLineV[i].vecTiles[j] = p;
                }
            }
            try {
                for (var _c = __values(arrSendRemove.keys()), _d = _c.next(); !_d.done; _d = _c.next()) {
                    var id = _d.value;
                    var x = id & 0xffff;
                    var y = (id >> 16) & 0xffff;
                    this.m_onCallback.OnRemoveTile(x, y);
                }
            }
            catch (e_11_1) { e_11 = { error: e_11_1 }; }
            finally {
                try {
                    if (_d && !_d.done && (_a = _c.return)) _a.call(_c);
                }
                finally { if (e_11) throw e_11.error; }
            }
            try {
                for (var _e = __values(arrSendAdded.keys()), _f = _e.next(); !_f.done; _f = _e.next()) {
                    var id = _f.value;
                    var x = id & 0xffff;
                    var y = (id >> 16) & 0xffff;
                    this.m_onCallback.OnAddTile(x, y);
                }
            }
            catch (e_12_1) { e_12 = { error: e_12_1 }; }
            finally {
                try {
                    if (_f && !_f.done && (_b = _e.return)) _b.call(_e);
                }
                finally { if (e_12) throw e_12.error; }
            }
            this.m_vecTiles = vecNewTiles;
            this.m_nTilesWidthCount = xx;
            this.m_nTilesHeightCount = yy;
        }
        this.UpdateView();
    };
    dTileView.prototype._UpdateTileImage = function (p, bSendAdded) {
        if (bSendAdded === void 0) { bSendAdded = true; }
        var x = p.posX / this.m_nTileWidth;
        var y = p.posY / this.m_nTileHeight;
        var pt = this.m_ptBuffer;
        pt.x = pt.y = -1;
        if (this.m_onCallback != null) {
            if (bSendAdded)
                this.m_onCallback.OnAddTile(x, y);
            this.m_onCallback.OnGetTile(x, y, pt);
        }
        p.dataX = x;
        p.dataY = y;
        var bmpBufferIndexX = (p.posX - this.m_nBmpStartX) / this.m_nBmpBufferWidth;
        var bmpBufferIndexY = (p.posY - this.m_nBmpStartY) / this.m_nBmpBufferHeight;
        var tx = p.posX % this.m_nBmpBufferWidth;
        var ty = p.posY % this.m_nBmpBufferHeight;
        var bmp;
        if (bmpBufferIndexX >= 0 && bmpBufferIndexX < this.m_vecBmpBufferLineV.length && bmpBufferIndexY >= 0 && bmpBufferIndexY < this.m_vecBmpBufferLineV[0].vecTiles.length) {
            var pBmpBuffer = this.m_vecBmpBufferLineV[bmpBufferIndexX].vecTiles[bmpBufferIndexY];
            bmp = pBmpBuffer.GetBitmapData();
        }
    };
    dTileView.prototype._PopTile = function (vec, width, height, x, y) {
        if (x >= 0 && x < width && y >= 0 && y < height) {
            var ret = vec[y * width + x];
            vec[y * width + x] = null;
            return ret;
        }
        return null;
    };
    dTileView.prototype.SetBitmapData = function (bmp, rc, at, sampleType) {
        if (rc === void 0) { rc = null; }
        if (at === void 0) { at = 0; }
        if (sampleType === void 0) { sampleType = 0; }
        this.m_pBitmapData = bmp;
        if (this.m_vecTiles != null) {
            for (var i = 0; i < this.m_vecTiles.length; i++)
                this.m_vecTiles[i].SetBitmapData(bmp, this.m_vecTiles[i].GetBitmapSourceRect(), at, sampleType);
        }
    };
    dTileView.prototype._UpdateBmpBuffer = function () {
        var xx = dMath.ToInt(this.GetWidth() / this.m_nTileWidth) + 1;
        var yy = dMath.ToInt(this.GetHeight() / this.m_nTileHeight) + 1;
        var totalTileWidth = xx * this.m_nTileWidth;
        var totalTileHeight = yy * this.m_nTileHeight;
        var bmpBufferWidth = 1024;
        var bmpBufferHeight = 1024;
        bmpBufferWidth -= 1024 % this.m_nTileWidth;
        bmpBufferHeight -= 1024 % this.m_nTileHeight;
        var xx2 = totalTileWidth / bmpBufferWidth + 2;
        var yy2 = totalTileHeight / bmpBufferHeight + 2;
        xx = xx2;
        yy = yy2;
        totalTileWidth = xx * this.m_nBmpBufferWidth;
        totalTileHeight = yy * this.m_nBmpBufferHeight;
        var panelX = this.m_pViewPanel.positionX;
        var panelY = this.m_pViewPanel.positionY;
        var viewOffX = this.m_nViewOffX - this.m_nBmpBufferWidth;
        var viewOffY = this.m_nViewOffY - this.m_nBmpBufferHeight;
        for (var i = 0, n = this.m_vecBmpBufferLineV.length; i < n; i++) {
            var lineData = this.m_vecBmpBufferLineV[i];
            var x = lineData.x;
            var bNeedUpdateTile = false;
            if (x + panelX < viewOffX) {
                lineData.x = totalTileWidth + ((x + panelX - viewOffX) % totalTileWidth) - panelX + viewOffX;
                bNeedUpdateTile = true;
            }
            else if (x + panelX >= totalTileWidth + viewOffX) {
                lineData.x = (x + panelX - viewOffX) % totalTileWidth - panelX + viewOffX;
                bNeedUpdateTile = true;
            }
            if (bNeedUpdateTile) {
                for (var j = 0, n2 = lineData.vecTiles.length; j < n2; j++) {
                    var tileData = lineData.vecTiles[j];
                    tileData.SetPosI(lineData.x, tileData.posY);
                }
                this.m_nBmpStartX = this.m_vecBmpBufferLineV[0].x;
            }
        }
        for (var i = 0, n = this.m_vecBmpBufferLineH.length; i < n; i++) {
            var lineData = this.m_vecBmpBufferLineH[i];
            var y = lineData.y;
            var bNeedUpdateTile = false;
            if (y + panelY < viewOffY) {
                lineData.y = totalTileHeight + ((y + panelY - viewOffY) % totalTileHeight) - panelY + viewOffY;
                bNeedUpdateTile = true;
            }
            else if (y + panelY >= totalTileHeight + viewOffY) {
                lineData.y = (y + panelY - viewOffY) % totalTileHeight - panelY + viewOffY;
                bNeedUpdateTile = true;
            }
            if (bNeedUpdateTile) {
                for (var j = 0, n2 = lineData.vecTiles.length; j < n2; j++) {
                    var tileData = lineData.vecTiles[j];
                    tileData.SetPosI(tileData.posX, lineData.y);
                }
                for (var j = 0, n2 = this.m_vecBmpBufferLineV.length; j < n2; j++) {
                }
                this.m_nBmpStartY = this.m_vecBmpBufferLineV[0].vecTiles[0].posY;
            }
        }
    };
    dTileView.prototype.UpdateView = function () {
        var xx = dMath.ToInt(this.GetWidth() / this.m_nTileWidth) + 1;
        var yy = dMath.ToInt(this.GetHeight() / this.m_nTileHeight) + 1;
        var totalTileWidth = xx * this.m_nTileWidth;
        var totalTileHeight = yy * this.m_nTileHeight;
        var panelX = this.m_pViewPanel.positionX;
        var panelY = this.m_pViewPanel.positionY;
        for (var i = 0, n = this.m_vecLineV.length; i < n; i++) {
            var lineData = this.m_vecLineV[i];
            var x = lineData.x;
            var bNeedUpdateTile = false;
            if (x + panelX < this.m_nViewOffX) {
                lineData.x = totalTileWidth + ((x + panelX - this.m_nViewOffX) % totalTileWidth) - panelX + this.m_nViewOffX;
                bNeedUpdateTile = true;
            }
            else if (x + panelX >= totalTileWidth + this.m_nViewOffX) {
                lineData.x = (x + panelX - this.m_nViewOffX) % totalTileWidth - panelX + this.m_nViewOffX;
                bNeedUpdateTile = true;
            }
            if (bNeedUpdateTile) {
                for (var j = 0, n2 = lineData.vecTiles.length; j < n2; j++) {
                    var tileData = lineData.vecTiles[j];
                    tileData.SetPosI(lineData.x, tileData.posY);
                    if (this.m_onCallback != null)
                        this.m_onCallback.OnRemoveTile(tileData.dataX, tileData.dataY);
                    this._UpdateTileImage(tileData);
                }
            }
        }
        for (var i = 0, n = this.m_vecLineH.length; i < n; i++) {
            var lineData = this.m_vecLineH[i];
            var y = lineData.y;
            var bNeedUpdateTile = false;
            if (y + panelY < this.m_nViewOffY) {
                lineData.y = totalTileHeight + ((y + panelY - this.m_nViewOffY) % totalTileHeight) - panelY + this.m_nViewOffY;
                bNeedUpdateTile = true;
            }
            else if (y + panelY >= totalTileHeight + this.m_nViewOffY) {
                lineData.y = (y + panelY - this.m_nViewOffY) % totalTileHeight - panelY + this.m_nViewOffY;
                bNeedUpdateTile = true;
            }
            if (bNeedUpdateTile) {
                for (var j = 0, n2 = lineData.vecTiles.length; j < n2; j++) {
                    var tileData = lineData.vecTiles[j];
                    tileData.SetPosI(tileData.posX, lineData.y);
                    if (this.m_onCallback != null)
                        this.m_onCallback.OnRemoveTile(tileData.dataX, tileData.dataY);
                    this._UpdateTileImage(tileData);
                }
            }
        }
    };
    dTileView.prototype.SpriteRender = function () {
        if (this.m_pBitmapData != null) {
            var bUpdateColored = false;
            var bmpWidth = this.m_pBitmapData.GetWidth();
            var bmpHeight = this.m_pBitmapData.GetHeight();
            var matLocal = this.m_matBuffer;
            matLocal.Identity();
            var matWorld = this.m_matRenderMatrixWorld;
            var isFatherRotation = true;
            if (matWorld._12 == 0 && matWorld._13 == 0 && matWorld._21 == 0 && matWorld._23 == 0 && this.rotation == 0 && this.rotationX == 0 && this.rotationY == 0)
                isFatherRotation = false;
            for (var i = 0, n = this.m_vecTiles.length; i < n; i++) {
                var p = this.m_vecTiles[i];
                if (p.isShow() && p.GetBitmapData() != null) {
                    matLocal.TranslationFast(p.GetPosX() + this.m_pViewPanel.GetPosX(), p.GetPosY() + this.m_pViewPanel.GetPosY(), 0);
                    matLocal.ScalingFast(p.GetWidth(), p.GetHeight(), 1);
                    var rcSource = p.GetBitmapSourceRect();
                    var vUV_x = rcSource.left / bmpWidth;
                    var vUV_y = rcSource.top / bmpHeight;
                    var vUV_z = rcSource.Width() / bmpWidth;
                    var vUV_w = rcSource.Height() / bmpHeight;
                    p.SetUniformF("uvTrans", vUV_x, vUV_y + vUV_w, vUV_z, -vUV_w);
                    if (!isFatherRotation) {
                        matLocal._11 *= matWorld._11;
                        matLocal._22 *= matWorld._22;
                        matLocal._33 *= matWorld._33;
                        matLocal._41 *= matWorld._11;
                        matLocal._42 *= matWorld._22;
                        matLocal._41 += matWorld._41;
                        matLocal._42 += matWorld._42;
                    }
                    else
                        matLocal.MulAppend(matWorld);
                    p.SetUniformMatrix("mWorld", matLocal);
                    if (!bUpdateColored) {
                        var color = this.m_nColorARGB;
                        if (color == 0xffffffff)
                            p.SetUniformF("color", 1, 1, 1, this.m_fAlpha * this.alpha);
                        else {
                            var a = ((color & 0xFF000000) >>> 24) / 255.0;
                            var r = ((color & 0x00FF0000) >> 16) / 255.0;
                            var g = ((color & 0x0000FF00) >> 8) / 255.0;
                            var b = ((color & 0x000000FF)) / 255.0;
                            p.SetUniformF("color", r, g, b, a * this.m_fAlpha * this.alpha);
                        }
                        if (this.m_matColorTransform != null)
                            p.SetUniformMatrix("colorMatrix", this.m_matColorTransform);
                        else
                            p.SetUniformMatrix("colorMatrix", dMatrix.IDENTITY);
                        bUpdateColored = true;
                    }
                    p.SpriteRender();
                }
            }
        }
    };
    return dTileView;
}(dBaseControl));
var dTileViewCallback = (function () {
    function dTileViewCallback() {
    }
    dTileViewCallback.prototype.OnGetTile = function (x, y, outPt) {
    };
    dTileViewCallback.prototype.OnAddTile = function (x, y) {
    };
    dTileViewCallback.prototype.OnRemoveTile = function (x, y) {
    };
    return dTileViewCallback;
}());
var TileData = (function (_super) {
    __extends(TileData, _super);
    function TileData() {
        var _this = _super.call(this) || this;
        _this.dataX = 0;
        _this.dataY = 0;
        _this.posX = 0;
        _this.posY = 0;
        return _this;
    }
    TileData.prototype.SetPosI = function (x, y) {
        this.posX = dMath.ToInt(x);
        this.posY = dMath.ToInt(y);
        this.SetPos(x, y);
    };
    return TileData;
}(dImage));
var LineData = (function () {
    function LineData() {
        this.x = 0;
        this.y = 0;
        this.vecTiles = new Array();
    }
    return LineData;
}());
var Actions = (function () {
    function Actions() {
    }
    return Actions;
}());
var CCAction = (function (_super) {
    __extends(CCAction, _super);
    function CCAction() {
        var _this = _super.call(this) || this;
        _this.m_nTag = -1;
        _this.m_pOriginalTarget = null;
        _this.m_pTarget = null;
        _this.name = null;
        _this.m_onStartWithTarget = null;
        return _this;
    }
    CCAction.prototype.Clear = function () {
        this.m_pTarget = null;
        this.m_pOriginalTarget = null;
    };
    Object.defineProperty(CCAction.prototype, "Target", {
        get: function () {
            return this.m_pTarget;
        },
        set: function (value) {
            this.m_pTarget = value;
            if (this.m_pTarget == null)
                throw "target is null";
        },
        enumerable: false,
        configurable: true
    });
    CCAction.prototype.SetTarget = function (p) {
        this.m_pTarget = p;
        return this;
    };
    CCAction.prototype.GetTarget = function () {
        return this.m_pTarget;
    };
    CCAction.prototype.SetTag = function (tag) {
        this.m_nTag = tag;
        return this;
    };
    CCAction.prototype.GetTag = function () {
        return this.m_nTag;
    };
    Object.defineProperty(CCAction.prototype, "OriginalTarget", {
        get: function () {
            return this.m_pOriginalTarget;
        },
        enumerable: false,
        configurable: true
    });
    CCAction.prototype.IsDone = function () {
        return true;
    };
    CCAction.prototype.SetStartWithTarget = function (onStartWithTarget) {
        this.m_onStartWithTarget = onStartWithTarget;
    };
    CCAction.prototype.StartWithTarget = function (target) {
        if (this.m_onStartWithTarget)
            this.m_onStartWithTarget(this);
        this.m_pOriginalTarget = this.m_pTarget = target;
    };
    CCAction.prototype.Stop = function () {
        this.m_pTarget = null;
    };
    CCAction.prototype.Step = function (dt) {
        throw "[Action step]. override me";
    };
    CCAction.prototype.Update = function (time) {
        throw "[Action update]. override me";
    };
    CCAction.prototype.GetActionList = function (outData) {
        outData.push(this);
    };
    return CCAction;
}(dObject));
var CCFiniteTimeAction = (function (_super) {
    __extends(CCFiniteTimeAction, _super);
    function CCFiniteTimeAction() {
        var _this = _super.call(this) || this;
        _this.m_fDuration = 0;
        return _this;
    }
    Object.defineProperty(CCFiniteTimeAction.prototype, "Duration", {
        get: function () {
            return this.m_fDuration;
        },
        set: function (value) {
            this.m_fDuration = value;
        },
        enumerable: false,
        configurable: true
    });
    return CCFiniteTimeAction;
}(CCAction));
var CCActionInterval = (function (_super) {
    __extends(CCActionInterval, _super);
    function CCActionInterval() {
        var _this = _super.call(this) || this;
        _this.m_bFirstTick = false;
        _this.m_elapsed = 0;
        return _this;
    }
    CCActionInterval.prototype.Clear = function () {
        _super.prototype.Clear.call(this);
        this.m_bFirstTick = false;
        this.m_elapsed = 0;
    };
    Object.defineProperty(CCActionInterval.prototype, "Elapsed", {
        get: function () {
            return this.m_elapsed;
        },
        enumerable: false,
        configurable: true
    });
    CCActionInterval.prototype.InitWithDuration = function (d) {
        this.m_fDuration = d;
        if (this.m_fDuration == 0) {
            this.m_fDuration = dMath.dFLOAT_EPSILON;
        }
        this.m_elapsed = 0;
        this.m_bFirstTick = true;
    };
    CCActionInterval.prototype.IsDone = function () {
        return this.m_elapsed >= this.m_fDuration;
    };
    CCActionInterval.prototype.Step = function (dt) {
        if (this.m_bFirstTick) {
            this.m_bFirstTick = false;
            this.m_elapsed = 0;
        }
        else {
            this.m_elapsed += dt;
        }
        this.Update(dMath.Max(0, dMath.Min(1, this.m_elapsed / dMath.Max(this.m_fDuration, dMath.dFLOAT_EPSILON))));
    };
    CCActionInterval.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_elapsed = 0.0;
        this.m_bFirstTick = true;
    };
    Object.defineProperty(CCActionInterval.prototype, "AmplitudeRate", {
        get: function () {
            throw "NotImplementedException";
        },
        set: function (value) {
            throw "NotImplementedException";
        },
        enumerable: false,
        configurable: true
    });
    return CCActionInterval;
}(CCFiniteTimeAction));
var CCActionEase = (function (_super) {
    __extends(CCActionEase, _super);
    function CCActionEase(pAction) {
        var _this = _super.call(this) || this;
        _this.m_pInner = null;
        _this.m_pInner = null;
        _this.InitWithAction(pAction);
        return _this;
    }
    Object.defineProperty(CCActionEase.prototype, "InnerAction", {
        get: function () {
            return this.m_pInner;
        },
        enumerable: false,
        configurable: true
    });
    CCActionEase.prototype.InitWithAction = function (pAction) {
        _super.prototype.InitWithDuration.call(this, pAction.Duration);
        this.m_pInner = pAction;
    };
    CCActionEase.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_pInner.StartWithTarget(this.m_pTarget);
    };
    CCActionEase.prototype.Stop = function () {
        this.m_pInner.Stop();
        _super.prototype.Stop.call(this);
    };
    CCActionEase.prototype.Update = function (time) {
        this.m_pInner.Update(time);
    };
    return CCActionEase;
}(CCActionInterval));
var CCActionInstant = (function (_super) {
    __extends(CCActionInstant, _super);
    function CCActionInstant() {
        return _super.call(this) || this;
    }
    CCActionInstant.prototype.IsDone = function () {
        return true;
    };
    CCActionInstant.prototype.Step = function (dt) {
        this.Update(1);
    };
    CCActionInstant.prototype.Update = function (time) {
    };
    return CCActionInstant;
}(CCFiniteTimeAction));
var CCActionManager = (function (_super) {
    __extends(CCActionManager, _super);
    function CCActionManager() {
        var _this = _super.call(this) || this;
        _this.m_bCurrentTargetSalvaged = false;
        _this.m_pCurrentTarget = null;
        _this.m_pTargets = new Array();
        _this.m_arrSpriteMap = new Map();
        _this.m_pTimer = null;
        return _this;
    }
    CCActionManager.prototype.UpdateElement = function (elt, dt) {
        var m_pCurrentTarget = elt;
        this.m_bCurrentTargetSalvaged = false;
        if (!this.m_pCurrentTarget.Paused) {
            for (this.m_pCurrentTarget.ActionIndex = 0; this.m_pCurrentTarget.ActionIndex < this.m_pCurrentTarget.Actions.length; this.m_pCurrentTarget.ActionIndex++) {
                this.m_pCurrentTarget.CurrentAction = this.m_pCurrentTarget.Actions[this.m_pCurrentTarget.ActionIndex];
                if (this.m_pCurrentTarget.CurrentAction == null) {
                    continue;
                }
                this.m_pCurrentTarget.CurrentActionSalvaged = false;
                this.m_pCurrentTarget.CurrentAction.Step(dt);
                if (this.m_pCurrentTarget.CurrentActionSalvaged) {
                }
                else if (this.m_pCurrentTarget.CurrentAction.IsDone()) {
                    this.m_pCurrentTarget.CurrentAction.Stop();
                    var action = m_pCurrentTarget.CurrentAction;
                    this.m_pCurrentTarget.CurrentAction = null;
                    this.RemoveAction(action);
                }
                this.m_pCurrentTarget.CurrentAction = null;
            }
        }
    };
    CCActionManager.prototype.Update = function (fTimeElapse) {
        var dt = fTimeElapse;
        for (var i = 0; i < this.m_pTargets.length; i++) {
            var elt = this.m_pTargets[i];
            this.m_pCurrentTarget = elt;
            this.m_bCurrentTargetSalvaged = false;
            if (!this.m_pCurrentTarget.Paused) {
                for (this.m_pCurrentTarget.ActionIndex = 0; this.m_pCurrentTarget.ActionIndex < this.m_pCurrentTarget.Actions.length; this.m_pCurrentTarget.ActionIndex++) {
                    this.m_pCurrentTarget.CurrentAction = this.m_pCurrentTarget.Actions[this.m_pCurrentTarget.ActionIndex];
                    if (this.m_pCurrentTarget.CurrentAction == null) {
                        continue;
                    }
                    this.m_pCurrentTarget.CurrentActionSalvaged = false;
                    this.m_pCurrentTarget.CurrentAction.Step(dt);
                    if (this.m_pCurrentTarget.CurrentAction == null) {
                        continue;
                    }
                    if (this.m_pCurrentTarget.CurrentActionSalvaged) {
                    }
                    else if (this.m_pCurrentTarget.CurrentAction.IsDone()) {
                        this.m_pCurrentTarget.CurrentAction.Stop();
                        var action = this.m_pCurrentTarget.CurrentAction;
                        this.m_pCurrentTarget.CurrentAction = null;
                        this.RemoveAction(action);
                    }
                    this.m_pCurrentTarget.CurrentAction = null;
                }
            }
            if (this.m_bCurrentTargetSalvaged && this.m_pCurrentTarget.Actions.length == 0 ||
                this.m_pCurrentTarget.bAutoRemoveWhenChildRemoveRoot && !this.m_pCurrentTarget.Target.isInRoot()) {
                this.DeleteHashElement(this.m_pCurrentTarget);
            }
        }
        this.m_pCurrentTarget = null;
    };
    CCActionManager.prototype.DeleteHashElement = function (element) {
        element.Actions.clear();
        this.m_pTargets.remove(element);
        this.m_arrSpriteMap.remove(element.Target);
        element.Target = null;
    };
    CCActionManager.prototype.ActionAllocWithHashElement = function (element) {
        if (element.Actions == null) {
            element.Actions = Array();
        }
    };
    CCActionManager.prototype.RemoveActionAtIndex = function (index, element) {
        var action = element.Actions[index];
        if (action == element.CurrentAction && (!element.CurrentActionSalvaged)) {
            element.CurrentActionSalvaged = true;
        }
        element.Actions.erase(index);
        if (element.ActionIndex >= index) {
            element.ActionIndex--;
        }
        if (element.Actions.length == 0) {
            if (this.m_pCurrentTarget == element) {
                this.m_bCurrentTargetSalvaged = true;
            }
            else {
                this.DeleteHashElement(element);
            }
        }
    };
    CCActionManager.prototype.FindElementBySprite = function (target) {
        return this.m_arrSpriteMap.get(target);
    };
    CCActionManager.prototype.PauseTarget = function (target) {
        var element = this.FindElementBySprite(target);
        if (element != null) {
            element.Paused = true;
        }
    };
    CCActionManager.prototype.ResumeTarget = function (target) {
        var element = this.FindElementBySprite(target);
        if (element != null) {
            element.Paused = false;
        }
    };
    CCActionManager.prototype.PauseAllRunningActions = function (outData) {
        if (outData === void 0) { outData = null; }
        for (var i = 0, count = this.m_pTargets.length; i < count; i++) {
            var element = this.m_pTargets[i];
            if (!element.Paused) {
                element.Paused = true;
                if (outData != null)
                    outData.push(element.Target);
            }
        }
    };
    CCActionManager.prototype.ResumeAllRunningActions = function (outData) {
        if (outData === void 0) { outData = null; }
        for (var i = 0, count = this.m_pTargets.length; i < count; i++) {
            var element = this.m_pTargets[i];
            if (element.Paused) {
                element.Paused = false;
                if (outData != null)
                    outData.push(element.Target);
            }
        }
    };
    CCActionManager.prototype.ResumeTargets = function (targetsToResume) {
        for (var i = 0; i < targetsToResume.length; i++) {
            this.ResumeTarget(targetsToResume[i]);
        }
    };
    CCActionManager.prototype.SetAction = function (action, target, paused, bAutoRemoveWhenChildRemoveRoot) {
        if (paused === void 0) { paused = false; }
        if (bAutoRemoveWhenChildRemoveRoot === void 0) { bAutoRemoveWhenChildRemoveRoot = true; }
        this.RemoveAllActionsFromTarget(target);
        this.AddAction(action, target, paused, bAutoRemoveWhenChildRemoveRoot);
    };
    CCActionManager.prototype.AddAction = function (action, target, paused, bAutoRemoveWhenChildRemoveRoot, tagID) {
        if (paused === void 0) { paused = false; }
        if (bAutoRemoveWhenChildRemoveRoot === void 0) { bAutoRemoveWhenChildRemoveRoot = true; }
        if (tagID === void 0) { tagID = 0; }
        if (action == null)
            return null;
        if (target == null)
            throw "target is null";
        action.Clear();
        action.SetTag(tagID);
        var element = this.FindElementBySprite(target);
        if (element == null) {
            element = new CCActionHashElement();
            element.Paused = paused;
            element.Target = target;
            element.bAutoRemoveWhenChildRemoveRoot = bAutoRemoveWhenChildRemoveRoot;
            this.m_pTargets.push(element);
            this.m_arrSpriteMap.set(target, element);
        }
        else if (!bAutoRemoveWhenChildRemoveRoot)
            element.bAutoRemoveWhenChildRemoveRoot = false;
        this.ActionAllocWithHashElement(element);
        element.Actions.push(action);
        action.StartWithTarget(target);
        return element;
    };
    CCActionManager.prototype.RemoveAllActions = function () {
        var vec = new Array();
        vec.copy(this.m_pTargets);
        var count = this.m_pTargets.length;
        for (var i = 0; i < count; i++) {
            this.RemoveAllActionsFromHashElement(vec[i]);
        }
    };
    CCActionManager.prototype.RemoveAllActionsFromTargetWithChild = function (target) {
        this.RemoveAllActionsFromTarget(target);
        var child = target.GetChildList();
        for (var i = 0, n = child.length; i < n; i++)
            this.RemoveAllActionsFromTargetWithChild(child[i]);
    };
    CCActionManager.prototype.RemoveAllActionsFromTarget = function (target) {
        var element = this.FindElementBySprite(target);
        if (element != null) {
            this.RemoveAllActionsFromHashElement(element);
        }
    };
    CCActionManager.prototype.RemoveAllActionsFromHashElement = function (element) {
        if (element != null) {
            if (element.Actions.indexOf(element.CurrentAction) != -1 && (!element.CurrentActionSalvaged)) {
                element.CurrentActionSalvaged = true;
            }
            element.Actions.clear();
            if (this.m_pCurrentTarget == element) {
                this.m_bCurrentTargetSalvaged = true;
            }
            else {
                this.DeleteHashElement(element);
            }
        }
    };
    CCActionManager.prototype.hasAction = function (action) {
        if (action == null || action.OriginalTarget == null) {
            return false;
        }
        var target = action.OriginalTarget;
        var element = this.FindElementBySprite(target);
        if (element != null) {
            var i = element.Actions.indexOf(action);
            return i != -1;
        }
        return false;
    };
    CCActionManager.prototype.hasActionByTarget = function (target) {
        var element = this.FindElementBySprite(target);
        if (element != null)
            return element.Actions.length > 0;
        return false;
    };
    CCActionManager.prototype.RemoveAction = function (action) {
        if (action == null || action.OriginalTarget == null) {
            return;
        }
        var target = action.OriginalTarget;
        var element = this.FindElementBySprite(target);
        if (element != null) {
            var i = element.Actions.indexOf(action);
            if (i != -1) {
                this.RemoveActionAtIndex(i, element);
            }
            else {
            }
        }
        else {
        }
        action.Clear();
    };
    CCActionManager.prototype.RemoveActionByTag = function (tag, target) {
        var element = this.FindElementBySprite(target);
        if (element != null) {
            var limit = element.Actions.length;
            for (var i = 0; i < limit; i++) {
                var action = element.Actions[i];
                if (action.GetTag() == tag && action.OriginalTarget == target) {
                    this.RemoveActionAtIndex(i, element);
                    break;
                }
            }
        }
        else {
        }
    };
    CCActionManager.prototype.GetActionByTag = function (tag, target) {
        var element = this.FindElementBySprite(target);
        if (element != null) {
            if (element.Actions != null) {
                var limit = element.Actions.length;
                for (var i = 0; i < limit; i++) {
                    var action = element.Actions[i];
                    if (action.GetTag() == tag) {
                        return action;
                    }
                }
            }
        }
        else {
        }
        return null;
    };
    CCActionManager.prototype.NumberOfRunningActionsInTarget = function (target) {
        var element = this.FindElementBySprite(target);
        if (element != null) {
            return (element.Actions != null) ? element.Actions.length : 0;
        }
        return 0;
    };
    CCActionManager.Instance = function () {
        if (!CCActionManager.s_pInstance) {
            CCActionManager.s_pInstance = new CCActionManager();
            CCActionManager.s_pInstance.SetAutoUpdate(true);
        }
        return CCActionManager.s_pInstance;
    };
    CCActionManager.prototype.GetUpdateTime = function () {
        return this.m_pTimer;
    };
    CCActionManager.prototype.SetAutoUpdate = function (bAutoUpdate) {
        if (bAutoUpdate) {
            if (this.m_pTimer == null) {
                this.m_pTimer = new dTimer();
                var pThis = this;
                this.m_pTimer.Create(0, -1, function (t, ii, fTimeElapse) {
                    pThis.Update(fTimeElapse);
                });
            }
        }
        else {
            if (this.m_pTimer != null) {
                this.m_pTimer.Stop();
                this.m_pTimer = null;
            }
        }
    };
    CCActionManager.s_pInstance = null;
    return CCActionManager;
}(dObject));
var CCActionHashElement = (function () {
    function CCActionHashElement() {
        this.ActionIndex = 0;
        this.Actions = null;
        this.CurrentAction = null;
        this.CurrentActionSalvaged = false;
        this.Paused = false;
        this.Target = null;
        this.bAutoRemoveWhenChildRemoveRoot = false;
    }
    return CCActionHashElement;
}());
var CCAnimate = (function (_super) {
    __extends(CCAnimate, _super);
    function CCAnimate(fDelayPerUnit, nLoops, startFrame, endFrame, bSetFrameWithChild, bRandomStartFrame) {
        if (fDelayPerUnit === void 0) { fDelayPerUnit = 0.1; }
        if (nLoops === void 0) { nLoops = 1; }
        if (startFrame === void 0) { startFrame = 0; }
        if (endFrame === void 0) { endFrame = 1; }
        if (bSetFrameWithChild === void 0) { bSetFrameWithChild = false; }
        if (bRandomStartFrame === void 0) { bRandomStartFrame = false; }
        var _this = _super.call(this) || this;
        _this.m_nNextFrame = 0;
        _this.m_uExecutedLoops = 0;
        _this.m_uLoops = 1;
        _this.m_fDelayPerUnit = 0;
        _this.m_nStartFrame = 0;
        _this.m_nEndFrame = 0;
        _this.m_bSetFrameWithChild = false;
        _this.m_bRandomStartFrame = false;
        _this.m_nRandomStartFrameDelta = 0;
        _this.m_fDelayPerUnit = fDelayPerUnit;
        _this.Loops = nLoops;
        _this.m_bSetFrameWithChild = bSetFrameWithChild;
        _this.m_bRandomStartFrame = bRandomStartFrame;
        _this.m_nStartFrame = startFrame;
        _this.m_nEndFrame = endFrame;
        var singleDuration = (endFrame - startFrame) * _this.m_fDelayPerUnit;
        _super.prototype.InitWithDuration.call(_this, singleDuration * _this.Loops);
        _this.m_nNextFrame = 0;
        _this.m_uExecutedLoops = 0;
        return _this;
    }
    CCAnimate.prototype.GetStartFrame = function () {
        return this.m_nStartFrame;
    };
    CCAnimate.prototype.GetEndFrame = function () {
        return this.m_nEndFrame;
    };
    Object.defineProperty(CCAnimate.prototype, "DelayPerUnit", {
        get: function () {
            return this.m_fDelayPerUnit;
        },
        set: function (value) {
            this.m_fDelayPerUnit = value;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CCAnimate.prototype, "Loops", {
        get: function () {
            return this.m_uLoops;
        },
        set: function (value) {
            if (value < 0)
                value = dMath.dINT_MAX;
            this.m_uLoops = value;
        },
        enumerable: false,
        configurable: true
    });
    CCAnimate.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_nNextFrame = 0;
        this.m_uExecutedLoops = 0;
        if (this.m_bRandomStartFrame)
            this.m_nRandomStartFrameDelta = dMath.RandomI() % this.GetFrameCount();
        else
            this.m_nRandomStartFrameDelta = 0;
    };
    CCAnimate.prototype.GetFrameCount = function () {
        var ret = this.m_nEndFrame - this.m_nStartFrame;
        if (ret < 1)
            ret = 1;
        return ret;
    };
    CCAnimate.prototype.Stop = function () {
        _super.prototype.Stop.call(this);
    };
    CCAnimate.prototype.Update = function (t) {
        if (t < 1.0) {
            t *= this.Loops;
            var loopNumber = dMath.ToInt(t);
            if (loopNumber > this.m_uExecutedLoops) {
                this.m_nNextFrame = 0;
                this.m_uExecutedLoops++;
            }
            t = t % 1.0;
        }
        var numberOfFrames = this.m_nEndFrame - this.m_nStartFrame;
        for (var i = this.m_nNextFrame; i < numberOfFrames; i++) {
            var splitTime = i / numberOfFrames;
            if (splitTime <= t) {
                this.m_pTarget.SetFrame(((i + this.m_nRandomStartFrameDelta) % numberOfFrames) + this.m_nStartFrame, this.m_bSetFrameWithChild);
                this.m_nNextFrame = i + 1;
            }
            else {
                break;
            }
        }
    };
    return CCAnimate;
}(CCActionInterval));
var CCBezierBy = (function (_super) {
    __extends(CCBezierBy, _super);
    function CCBezierBy(t, c, bSetDir) {
        if (bSetDir === void 0) { bSetDir = false; }
        var _this = _super.call(this) || this;
        _this.m_sConfig = null;
        _this.m_startPosition = null;
        _this.m_previousPosition = null;
        _this.m_bSetDir = bSetDir;
        _super.prototype.InitWithDuration.call(_this, t);
        _this.m_sConfig = c;
        return _this;
    }
    CCBezierBy.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_startPosition = new dVector2(target.GetPosX(), target.GetPosY());
        this.m_previousPosition = new dVector2().Copy(this.m_startPosition);
    };
    CCBezierBy.prototype.Update = function (time) {
        var a = this;
        if (a.m_pTarget != null) {
            var xa = 0;
            var xb = a.m_sConfig.ControlPoint1.x;
            var xc = a.m_sConfig.ControlPoint2.x;
            var xd = a.m_sConfig.EndPosition.x;
            var ya = 0;
            var yb = a.m_sConfig.ControlPoint1.y;
            var yc = a.m_sConfig.ControlPoint2.y;
            var yd = a.m_sConfig.EndPosition.y;
            var x = CCSplineMath.CubicBezier(xa, xb, xc, xd, time);
            var y = CCSplineMath.CubicBezier(ya, yb, yc, yd, time);
            var currentPosX = a.m_pTarget.GetPosX();
            var currentPosY = a.m_pTarget.GetPosY();
            var diffX = currentPosX - a.m_previousPosition.x;
            var diffY = currentPosY - a.m_previousPosition.y;
            a.m_startPosition.x = a.m_startPosition.x + diffX;
            a.m_startPosition.y = a.m_startPosition.y + diffY;
            var newPosX = a.m_startPosition.x + x;
            var newPosY = a.m_startPosition.y + y;
            a.m_pTarget.SetPos(newPosX, newPosY);
            if (a.m_bSetDir) {
                if (!dMath.FloatEquals(newPosX, a.m_previousPosition.x) || !dMath.FloatEquals(newPosY, a.m_previousPosition.y)) {
                    a.m_previousPosition.SetValue(newPosX - a.m_previousPosition.x, newPosY - a.m_previousPosition.y);
                    a.m_previousPosition.Normalize();
                    a.m_pTarget.SetRotation(a.m_previousPosition.ToAngle());
                }
            }
            a.m_previousPosition.SetValue(newPosX, newPosY);
        }
    };
    return CCBezierBy;
}(CCActionInterval));
var CCBezierConfig = (function () {
    function CCBezierConfig(ControlPoint1X, ControlPoint1Y, ControlPoint2X, ControlPoint2Y, EndPositionX, EndPositionY) {
        if (ControlPoint1X === void 0) { ControlPoint1X = 0; }
        if (ControlPoint1Y === void 0) { ControlPoint1Y = 0; }
        if (ControlPoint2X === void 0) { ControlPoint2X = 0; }
        if (ControlPoint2Y === void 0) { ControlPoint2Y = 0; }
        if (EndPositionX === void 0) { EndPositionX = 0; }
        if (EndPositionY === void 0) { EndPositionY = 0; }
        this.ControlPoint1 = new dVector2(ControlPoint1X, ControlPoint1Y);
        this.ControlPoint2 = new dVector2(ControlPoint2X, ControlPoint2Y);
        this.EndPosition = new dVector2(EndPositionX, EndPositionY);
    }
    return CCBezierConfig;
}());
var CCBezierTo = (function (_super) {
    __extends(CCBezierTo, _super);
    function CCBezierTo(t, c, bSetDir) {
        if (bSetDir === void 0) { bSetDir = false; }
        return _super.call(this, t, c, bSetDir) || this;
    }
    CCBezierTo.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        var a = this;
        a.m_sConfig.ControlPoint1.x -= a.m_startPosition.x;
        a.m_sConfig.ControlPoint1.y -= a.m_startPosition.y;
        a.m_sConfig.ControlPoint2.x -= a.m_startPosition.x;
        a.m_sConfig.ControlPoint2.y -= a.m_startPosition.y;
        a.m_sConfig.EndPosition.x -= a.m_startPosition.x;
        a.m_sConfig.EndPosition.y -= a.m_startPosition.y;
    };
    return CCBezierTo;
}(CCBezierBy));
var CCBlink = (function (_super) {
    __extends(CCBlink, _super);
    function CCBlink(duration, uBlinks) {
        var _this = _super.call(this) || this;
        _this.m_bOriginalState = false;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_nTimes = uBlinks;
        return _this;
    }
    CCBlink.prototype.Stop = function () {
        if (this.m_pTarget != null)
            this.m_pTarget.SetShow(this.m_bOriginalState);
        _super.prototype.Stop.call(this);
    };
    CCBlink.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_bOriginalState = target.isShow();
    };
    CCBlink.prototype.Update = function (time) {
        if (this.m_pTarget != null && !this.IsDone()) {
            if (this.m_nTimes <= 0) {
                this.m_pTarget.visible = !this.m_pTarget.visible;
            }
            else {
                var slice = 1.0 / this.m_nTimes;
                var m = time % slice;
                this.m_pTarget.SetShow(m > (slice / 2));
            }
        }
    };
    return CCBlink;
}(CCActionInterval));
var CCBrightnessTo = (function (_super) {
    __extends(CCBrightnessTo, _super);
    function CCBrightnessTo(duration, brightness, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        var _this = _super.call(this) || this;
        _this.m_fromBrightness = 0;
        _this.m_toBrightness = 0;
        _this.m_bSetToChild = false;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_toBrightness = brightness;
        _this.m_bSetToChild = bSetToChild;
        return _this;
    }
    CCBrightnessTo.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        if (target != null) {
            this.m_fromBrightness = target.GetBrightness();
        }
    };
    CCBrightnessTo.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            this.m_pTarget.SetBrightness((this.m_fromBrightness + (this.m_toBrightness - this.m_fromBrightness) * time), this.m_bSetToChild);
        }
    };
    return CCBrightnessTo;
}(CCActionInterval));
var CCCallFunc = (function (_super) {
    __extends(CCCallFunc, _super);
    function CCCallFunc(selector, pObject) {
        if (pObject === void 0) { pObject = null; }
        var _this = _super.call(this) || this;
        _this.m_pCallFuncO = null;
        _this.m_pObject = null;
        _this.m_pObject = pObject;
        _this.m_pCallFuncO = selector;
        return _this;
    }
    CCCallFunc.prototype.GetCallback = function () {
        return this.m_pCallFuncO;
    };
    CCCallFunc.prototype.SetCallback = function (call) {
        this.m_pCallFuncO = call;
    };
    CCCallFunc.prototype.Update = function (time) {
        this.Execute();
    };
    CCCallFunc.prototype.Execute = function () {
        if (null != this.m_pCallFuncO) {
            this.m_pCallFuncO(this.m_pObject);
        }
    };
    return CCCallFunc;
}(CCActionInstant));
var CCCustom = (function (_super) {
    __extends(CCCustom, _super);
    function CCCustom(duration, onCallback) {
        var _this = _super.call(this) || this;
        _this.m_onCallback = null;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_onCallback = onCallback;
        return _this;
    }
    CCCustom.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
    };
    CCCustom.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            if (this.m_onCallback != null)
                this.m_onCallback(time);
        }
    };
    return CCCustom;
}(CCActionInterval));
var CCDelayTime = (function (_super) {
    __extends(CCDelayTime, _super);
    function CCDelayTime(d) {
        var _this = _super.call(this) || this;
        _this.InitWithDuration(d);
        return _this;
    }
    CCDelayTime.prototype.Update = function (time) {
    };
    return CCDelayTime;
}(CCActionInterval));
var CCEaseBackIn = (function (_super) {
    __extends(CCEaseBackIn, _super);
    function CCEaseBackIn() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseBackIn.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.BackIn(time));
    };
    return CCEaseBackIn;
}(CCActionEase));
var CCEaseBackInOut = (function (_super) {
    __extends(CCEaseBackInOut, _super);
    function CCEaseBackInOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseBackInOut.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.BackInOut(time));
    };
    return CCEaseBackInOut;
}(CCActionEase));
var CCEaseBackOut = (function (_super) {
    __extends(CCEaseBackOut, _super);
    function CCEaseBackOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseBackOut.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.BackOut(time));
    };
    return CCEaseBackOut;
}(CCActionEase));
var CCEaseBounceIn = (function (_super) {
    __extends(CCEaseBounceIn, _super);
    function CCEaseBounceIn() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseBounceIn.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.BounceIn(time));
    };
    return CCEaseBounceIn;
}(CCActionEase));
var CCEaseBounceInOut = (function (_super) {
    __extends(CCEaseBounceInOut, _super);
    function CCEaseBounceInOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseBounceInOut.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.BounceInOut(time));
    };
    return CCEaseBounceInOut;
}(CCActionEase));
var CCEaseBounceOut = (function (_super) {
    __extends(CCEaseBounceOut, _super);
    function CCEaseBounceOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseBounceOut.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.BounceOut(time));
    };
    return CCEaseBounceOut;
}(CCActionEase));
var CCEaseCustom = (function (_super) {
    __extends(CCEaseCustom, _super);
    function CCEaseCustom(pAction, easeFunc) {
        var _this = _super.call(this, pAction) || this;
        _super.prototype.InitWithAction.call(_this, pAction);
        _this.m_EaseFunc = easeFunc;
        return _this;
    }
    Object.defineProperty(CCEaseCustom.prototype, "EaseFunc", {
        get: function () {
            return this.m_EaseFunc;
        },
        set: function (value) {
            this.m_EaseFunc = value;
        },
        enumerable: false,
        configurable: true
    });
    CCEaseCustom.prototype.SetEaseFun = function (value) {
        this.m_EaseFunc = value;
        return this;
    };
    CCEaseCustom.prototype.Update = function (time) {
        this.m_pInner.Update(this.m_EaseFunc(time));
    };
    return CCEaseCustom;
}(CCActionEase));
var CCEaseElastic = (function (_super) {
    __extends(CCEaseElastic, _super);
    function CCEaseElastic(pAction, fPeriod) {
        if (fPeriod === void 0) { fPeriod = 0.3; }
        var _this = _super.call(this, pAction) || this;
        _this.m_fPeriod = 0;
        _super.prototype.InitWithAction.call(_this, pAction);
        _this.m_fPeriod = fPeriod;
        return _this;
    }
    Object.defineProperty(CCEaseElastic.prototype, "Period", {
        get: function () {
            return this.m_fPeriod;
        },
        set: function (value) {
            this.m_fPeriod = value;
        },
        enumerable: false,
        configurable: true
    });
    CCEaseElastic.prototype.InitWithAction = function (pAction) {
        _super.prototype.InitWithAction.call(this, pAction);
        this.m_fPeriod = 0.3;
    };
    return CCEaseElastic;
}(CCActionEase));
var CCEaseElasticIn = (function (_super) {
    __extends(CCEaseElasticIn, _super);
    function CCEaseElasticIn() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseElasticIn.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.ElasticIn(time, this.m_fPeriod));
    };
    return CCEaseElasticIn;
}(CCEaseElastic));
var CCEaseElasticInOut = (function (_super) {
    __extends(CCEaseElasticInOut, _super);
    function CCEaseElasticInOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseElasticInOut.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.ElasticInOut(time, this.m_fPeriod));
    };
    return CCEaseElasticInOut;
}(CCEaseElastic));
var CCEaseElasticOut = (function (_super) {
    __extends(CCEaseElasticOut, _super);
    function CCEaseElasticOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseElasticOut.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.ElasticOut(time, this.m_fPeriod));
    };
    return CCEaseElasticOut;
}(CCEaseElastic));
var CCEaseExponentialIn = (function (_super) {
    __extends(CCEaseExponentialIn, _super);
    function CCEaseExponentialIn() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseExponentialIn.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.ExponentialIn(time));
    };
    return CCEaseExponentialIn;
}(CCActionEase));
var CCEaseExponentialInOut = (function (_super) {
    __extends(CCEaseExponentialInOut, _super);
    function CCEaseExponentialInOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseExponentialInOut.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.ExponentialInOut(time));
    };
    return CCEaseExponentialInOut;
}(CCActionEase));
var CCEaseExponentialOut = (function (_super) {
    __extends(CCEaseExponentialOut, _super);
    function CCEaseExponentialOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseExponentialOut.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.ExponentialOut(time));
    };
    return CCEaseExponentialOut;
}(CCActionEase));
var CCEaseRateAction = (function (_super) {
    __extends(CCEaseRateAction, _super);
    function CCEaseRateAction(pAction, fRate) {
        var _this = _super.call(this, pAction) || this;
        _this.m_fRate = fRate;
        return _this;
    }
    Object.defineProperty(CCEaseRateAction.prototype, "Rate", {
        get: function () {
            return this.m_fRate;
        },
        set: function (value) {
            this.m_fRate = value;
        },
        enumerable: false,
        configurable: true
    });
    return CCEaseRateAction;
}(CCActionEase));
var CCEaseIn = (function (_super) {
    __extends(CCEaseIn, _super);
    function CCEaseIn() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseIn.prototype.Update = function (time) {
        this.m_pInner.Update(dMath.Pow(time, this.m_fRate));
    };
    return CCEaseIn;
}(CCEaseRateAction));
var CCEaseInOut = (function (_super) {
    __extends(CCEaseInOut, _super);
    function CCEaseInOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseInOut.prototype.Update = function (time) {
        time *= 2;
        if (time < 1) {
            this.m_pInner.Update(0.5 * dMath.Pow(time, this.m_fRate));
        }
        else {
            this.m_pInner.Update(1.0 - 0.5 * dMath.Pow(2 - time, this.m_fRate));
        }
    };
    return CCEaseInOut;
}(CCEaseRateAction));
var CCEaseMath = (function () {
    function CCEaseMath() {
    }
    CCEaseMath.BackIn = function (time) {
        var overshoot = 1.70158;
        return time * time * ((overshoot + 1) * time - overshoot);
    };
    CCEaseMath.BackOut = function (time) {
        var overshoot = 1.70158;
        time = time - 1;
        return time * time * ((overshoot + 1) * time + overshoot) + 1;
    };
    CCEaseMath.BackInOut = function (time) {
        var overshoot = 1.70158 * 1.525;
        time = time * 2;
        if (time < 1) {
            return (time * time * ((overshoot + 1) * time - overshoot)) / 2;
        }
        else {
            time = time - 2;
            return (time * time * ((overshoot + 1) * time + overshoot)) / 2 + 1;
        }
    };
    CCEaseMath.BounceOut = function (time) {
        if (time < 1 / 2.75) {
            return 7.5625 * time * time;
        }
        else if (time < 2 / 2.75) {
            time -= 1.5 / 2.75;
            return 7.5625 * time * time + 0.75;
        }
        else if (time < 2.5 / 2.75) {
            time -= 2.25 / 2.75;
            return 7.5625 * time * time + 0.9375;
        }
        time -= 2.625 / 2.75;
        return 7.5625 * time * time + 0.984375;
    };
    CCEaseMath.BounceIn = function (time) {
        return 1 - CCEaseMath.BounceOut(1 - time);
    };
    CCEaseMath.BounceInOut = function (time) {
        if (time < 0.5) {
            time = time * 2;
            return (1 - CCEaseMath.BounceOut(1 - time)) * 0.5;
        }
        return CCEaseMath.BounceOut(time * 2 - 1) * 0.5 + 0.5;
    };
    CCEaseMath.SineOut = function (time) {
        return dMath.Sin(time * (dMath.dPI * 2));
    };
    CCEaseMath.SineIn = function (time) {
        return -1 * dMath.Cos(time * (dMath.dPI * 2)) + 1;
    };
    CCEaseMath.SineInOut = function (time) {
        return -0.5 * (dMath.Cos(dMath.dPI * time) - 1);
    };
    CCEaseMath.ExponentialOut = function (time) {
        return time == 1 ? 1 : (-dMath.Pow(2, -10 * time / 1) + 1);
    };
    CCEaseMath.ExponentialIn = function (time) {
        return time == 0 ? 0 : dMath.Pow(2, 10 * (time / 1 - 1)) - 1 * 0.001;
    };
    CCEaseMath.ExponentialInOut = function (time) {
        time /= 0.5;
        if (time < 1) {
            return 0.5 * dMath.Pow(2, 10 * (time - 1));
        }
        else {
            return 0.5 * (-dMath.Pow(2, -10 * (time - 1)) + 2);
        }
    };
    CCEaseMath.ElasticIn = function (time, period) {
        if (time == 0 || time == 1) {
            return time;
        }
        else {
            var s = period / 4;
            time = time - 1;
            return -(dMath.Pow(2, 10 * time) * dMath.Sin((time - s) * dMath.dPI * 2.0 / period));
        }
    };
    CCEaseMath.ElasticOut = function (time, period) {
        if (time == 0 || time == 1) {
            return time;
        }
        else {
            var s = period / 4;
            return (dMath.Pow(2, -10 * time) * dMath.Sin((time - s) * dMath.dPI * 2 / period) + 1);
        }
    };
    CCEaseMath.ElasticInOut = function (time, period) {
        if (time == 0 || time == 1) {
            return time;
        }
        else {
            time = time * 2;
            if (period == 0) {
                period = 0.3 * 1.5;
            }
            var s = period / 4;
            time = time - 1;
            if (time < 0) {
                return (-0.5 * dMath.Pow(2, 10 * time) * dMath.Sin((time - s) * (dMath.dPI * 2) / period));
            }
            else {
                return (dMath.Pow(2, -10 * time) * dMath.Sin((time - s) * (dMath.dPI * 2) / period) * 0.5 + 1);
            }
        }
    };
    return CCEaseMath;
}());
var CCEaseOut = (function (_super) {
    __extends(CCEaseOut, _super);
    function CCEaseOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseOut.prototype.Update = function (time) {
        this.m_pInner.Update(dMath.Pow(time, 1 / this.m_fRate));
    };
    return CCEaseOut;
}(CCEaseRateAction));
var CCEaseSineIn = (function (_super) {
    __extends(CCEaseSineIn, _super);
    function CCEaseSineIn() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseSineIn.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.SineIn(time));
    };
    return CCEaseSineIn;
}(CCActionEase));
var CCEaseSineInOut = (function (_super) {
    __extends(CCEaseSineInOut, _super);
    function CCEaseSineInOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseSineInOut.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.SineInOut(time));
    };
    return CCEaseSineInOut;
}(CCActionEase));
var CCEaseSineOut = (function (_super) {
    __extends(CCEaseSineOut, _super);
    function CCEaseSineOut() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCEaseSineOut.prototype.Update = function (time) {
        this.m_pInner.Update(CCEaseMath.SineOut(time));
    };
    return CCEaseSineOut;
}(CCActionEase));
var CCExtraAction = (function (_super) {
    __extends(CCExtraAction, _super);
    function CCExtraAction() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCExtraAction.prototype.Step = function (dt) {
    };
    CCExtraAction.prototype.Update = function (time) {
    };
    return CCExtraAction;
}(CCFiniteTimeAction));
var CCFadeIn = (function (_super) {
    __extends(CCFadeIn, _super);
    function CCFadeIn(d) {
        var _this = _super.call(this) || this;
        _this.InitWithDuration(d);
        return _this;
    }
    CCFadeIn.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            this.m_pTarget.SetAlpha(time, true);
        }
    };
    return CCFadeIn;
}(CCActionInterval));
var CCFadeOut = (function (_super) {
    __extends(CCFadeOut, _super);
    function CCFadeOut(d) {
        var _this = _super.call(this) || this;
        _this.InitWithDuration(d);
        return _this;
    }
    CCFadeOut.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            this.m_pTarget.SetAlpha(1 - time, true);
        }
    };
    return CCFadeOut;
}(CCActionInterval));
var CCFadeTo = (function (_super) {
    __extends(CCFadeTo, _super);
    function CCFadeTo(duration, opacity, bSetToChild) {
        if (bSetToChild === void 0) { bSetToChild = false; }
        var _this = _super.call(this) || this;
        _this.m_fromOpacity = 0;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_toOpacity = opacity;
        _this.m_bSetToChild = bSetToChild;
        return _this;
    }
    CCFadeTo.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        if (target != null) {
            this.m_fromOpacity = target.GetAlpha();
        }
    };
    CCFadeTo.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            this.m_pTarget.SetAlpha((this.m_fromOpacity + (this.m_toOpacity - this.m_fromOpacity) * time), this.m_bSetToChild);
        }
    };
    return CCFadeTo;
}(CCActionInterval));
var CCFlipX = (function (_super) {
    __extends(CCFlipX, _super);
    function CCFlipX(x) {
        var _this = _super.call(this) || this;
        _this.m_bFlipX = x;
        return _this;
    }
    CCFlipX.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        if (this.m_bFlipX)
            target.scaleX = -dMath.Abs(target.scaleX);
        else
            target.scaleX = dMath.Abs(target.scaleX);
    };
    return CCFlipX;
}(CCActionInstant));
var CCFlipY = (function (_super) {
    __extends(CCFlipY, _super);
    function CCFlipY(y) {
        var _this = _super.call(this) || this;
        _this.m_bFlipY = y;
        return _this;
    }
    CCFlipY.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        if (this.m_bFlipY)
            target.scaleY = -dMath.Abs(target.scaleY);
        else
            target.scaleY = dMath.Abs(target.scaleY);
    };
    return CCFlipY;
}(CCActionInstant));
var CCFollow = (function (_super) {
    __extends(CCFollow, _super);
    function CCFollow(followedNode, rect) {
        var _this = _super.call(this) || this;
        _this.m_bBoundaryFullyCovered = false;
        _this.m_bBoundarySet = false;
        _this.m_fBottomBoundary = 0;
        _this.m_fLeftBoundary = 0;
        _this.m_fRightBoundary = 0;
        _this.m_fTopBoundary = 0;
        _this.m_obFullScreenSize = null;
        _this.m_obHalfScreenSize = null;
        _this.m_pobFollowedNode = null;
        _this.InitWithTarget(followedNode, rect);
        return _this;
    }
    Object.defineProperty(CCFollow.prototype, "BoundarySet", {
        get: function () {
            return this.m_bBoundarySet;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(CCFollow.prototype, "BounderySet", {
        set: function (value) {
            this.m_bBoundarySet = value;
        },
        enumerable: false,
        configurable: true
    });
    CCFollow.prototype.InitWithTarget = function (pFollowedNode, rect) {
        if (pFollowedNode == null)
            throw "pFollowedNode == null";
        this.m_pobFollowedNode = pFollowedNode;
        if (rect.isZero()) {
            this.m_bBoundarySet = false;
        }
        else {
            this.m_bBoundarySet = true;
        }
        this.m_bBoundaryFullyCovered = false;
        var winSize = new dVector2(dThread.GetWindowWidth(), dThread.GetWindowHeight());
        this.m_obFullScreenSize = winSize;
        this.m_obHalfScreenSize = this.m_obFullScreenSize.MulF(0.5);
        if (this.m_bBoundarySet) {
            this.m_fLeftBoundary = -((rect.OriginX() + rect.Width()) - this.m_obFullScreenSize.x);
            this.m_fRightBoundary = -rect.OriginX();
            this.m_fTopBoundary = -rect.OriginY();
            this.m_fBottomBoundary = -((rect.OriginY() + rect.Height()) - this.m_obFullScreenSize.y);
            if (this.m_fRightBoundary < this.m_fLeftBoundary) {
                this.m_fRightBoundary = this.m_fLeftBoundary = (this.m_fLeftBoundary + this.m_fRightBoundary) / 2;
            }
            if (this.m_fTopBoundary < this.m_fBottomBoundary) {
                this.m_fTopBoundary = this.m_fBottomBoundary = (this.m_fTopBoundary + this.m_fBottomBoundary) / 2;
            }
            if ((this.m_fTopBoundary == this.m_fBottomBoundary) && (this.m_fLeftBoundary == this.m_fRightBoundary)) {
                this.m_bBoundaryFullyCovered = true;
            }
        }
    };
    CCFollow.prototype.Step = function (dt) {
        if (this.m_bBoundarySet) {
            if (this.m_bBoundaryFullyCovered) {
                return;
            }
            var tempPos = this.m_obHalfScreenSize.Sub(new dVector2(this.m_pobFollowedNode.GetPosX(), this.m_pobFollowedNode.GetPosY()));
            this.m_pTarget.SetPos(dMath.Clamp(tempPos.x, this.m_fLeftBoundary, this.m_fRightBoundary), dMath.Clamp(tempPos.y, this.m_fBottomBoundary, this.m_fTopBoundary));
        }
        else {
            this.m_pTarget.SetPos(this.m_obHalfScreenSize.x - this.m_pobFollowedNode.GetPosX(), this.m_obHalfScreenSize.y - this.m_pobFollowedNode.GetPosY());
        }
    };
    CCFollow.prototype.Stop = function () {
        this.m_pTarget = null;
        _super.prototype.Stop.call(this);
    };
    return CCFollow;
}(CCAction));
var CCFrameTo = (function (_super) {
    __extends(CCFrameTo, _super);
    function CCFrameTo(frame) {
        var _this = _super.call(this) || this;
        _this.m_nFrame = frame;
        return _this;
    }
    CCFrameTo.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        target.SetFrame(this.m_nFrame);
    };
    return CCFrameTo;
}(CCActionInstant));
var CCHide = (function (_super) {
    __extends(CCHide, _super);
    function CCHide() {
        return _super.call(this) || this;
    }
    CCHide.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        target.SetShow(false);
    };
    return CCHide;
}(CCActionInstant));
var CCJumpBy = (function (_super) {
    __extends(CCJumpBy, _super);
    function CCJumpBy(duration, position, height, jumps) {
        if (jumps === void 0) { jumps = 1; }
        var _this = _super.call(this) || this;
        _this.m_delta = null;
        _this.m_height = 0;
        _this.m_nJumps = 0;
        _this.m_startPosition = null;
        _this.m_previousPos = null;
        _this.InitWithDuration(duration);
        _this.m_delta = position;
        _this.m_height = height;
        _this.m_nJumps = jumps;
        return _this;
    }
    CCJumpBy.prototype.GetPosition = function () {
        return this.m_delta;
    };
    CCJumpBy.prototype.GetHeight = function () {
        return this.m_height;
    };
    CCJumpBy.prototype.GetJumps = function () {
        return this.m_nJumps;
    };
    CCJumpBy.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_startPosition = new dVector3(target.GetPosX(), target.GetPosY(), target.GetPosZ());
        this.m_previousPos = new dVector3().Copy(this.m_startPosition);
    };
    CCJumpBy.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            var frac = (time * this.m_nJumps) % 1;
            var y = -this.m_height * 4 * frac * (1 - frac);
            y += this.m_delta.y * time;
            var x = this.m_delta.x * time;
            var z = this.m_delta.z * time;
            var currentPosX = this.m_pTarget.GetPosX();
            var currentPosY = this.m_pTarget.GetPosY();
            var currentPosZ = this.m_pTarget.GetPosZ();
            var diffX = currentPosX - this.m_previousPos.x;
            var diffY = currentPosY - this.m_previousPos.y;
            var diffZ = currentPosZ - this.m_previousPos.z;
            this.m_startPosition.x = diffX + this.m_startPosition.x;
            this.m_startPosition.y = diffY + this.m_startPosition.y;
            this.m_startPosition.z = diffZ + this.m_startPosition.z;
            var newPosX = this.m_startPosition.x + x;
            var newPosY = this.m_startPosition.y + y;
            var newPosZ = this.m_startPosition.z + z;
            this.m_pTarget.SetPos3D(newPosX, newPosY, newPosZ);
            this.m_previousPos.x = newPosX;
            this.m_previousPos.y = newPosY;
            this.m_previousPos.z = newPosZ;
        }
    };
    return CCJumpBy;
}(CCActionInterval));
var CCJumpTo = (function (_super) {
    __extends(CCJumpTo, _super);
    function CCJumpTo(duration, position, height, jumps) {
        if (jumps === void 0) { jumps = 1; }
        return _super.call(this, duration, position, height, jumps) || this;
    }
    CCJumpTo.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_delta = new dVector3(this.m_delta.x - this.m_startPosition.x, this.m_delta.y - this.m_startPosition.y, this.m_delta.z - this.m_startPosition.z);
    };
    return CCJumpTo;
}(CCJumpBy));
var CCMoveBy = (function (_super) {
    __extends(CCMoveBy, _super);
    function CCMoveBy(duration, x, y, z, bSetDir, randomRangeX, randomRangeY, randomRangeZ, bMirrorWithTarget) {
        if (z === void 0) { z = 0; }
        if (bSetDir === void 0) { bSetDir = false; }
        if (randomRangeX === void 0) { randomRangeX = 0; }
        if (randomRangeY === void 0) { randomRangeY = 0; }
        if (randomRangeZ === void 0) { randomRangeZ = 0; }
        if (bMirrorWithTarget === void 0) { bMirrorWithTarget = false; }
        var _this = _super.call(this) || this;
        _this.m_positionDelta = null;
        _this.m_positionDelta2 = null;
        _this.m_randomRangeDelta = null;
        _this.m_randomRangeDelta2 = new dVector3();
        _this.m_endPosition = null;
        _this.m_startPosition = null;
        _this.m_previousPosition = null;
        _this.m_bSetDir = false;
        _this.m_bMirrorWithTarget = false;
        _this.m_vTrans = new dVector3();
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_positionDelta = new dVector3(x, y, z);
        _this.m_randomRangeDelta = new dVector3(randomRangeX, randomRangeY, randomRangeZ);
        _this.m_bSetDir = bSetDir;
        _this.m_bMirrorWithTarget = bMirrorWithTarget;
        return _this;
    }
    CCMoveBy.prototype.GetPositionDelta = function () {
        return this.m_positionDelta;
    };
    CCMoveBy.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_positionDelta2 = new dVector3().Copy(this.m_positionDelta);
        if (this.m_bMirrorWithTarget) {
            var mat = target.GetMatrixWorld();
            if (mat._11 < 0)
                this.m_positionDelta2.x = -this.m_positionDelta2.x;
            if (mat._22 < 0)
                this.m_positionDelta2.y = -this.m_positionDelta2.y;
            if (mat._33 < 0)
                this.m_positionDelta2.z = -this.m_positionDelta2.z;
        }
        this.m_startPosition = new dVector3(target.GetPosX(), target.GetPosY(), target.GetPosZ());
        this.m_previousPosition = new dVector3().Copy(this.m_startPosition);
        this.m_randomRangeDelta2.SetValue(dMath.RandomRange(-this.m_randomRangeDelta.x, this.m_randomRangeDelta.x), dMath.RandomRange(-this.m_randomRangeDelta.y, this.m_randomRangeDelta.y), dMath.RandomRange(-this.m_randomRangeDelta.z, this.m_randomRangeDelta.z));
    };
    CCMoveBy.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            var currentPosX = this.m_pTarget.GetPosX();
            var currentPosY = this.m_pTarget.GetPosY();
            var currentPosZ = this.m_pTarget.GetPosZ();
            var diffX = currentPosX - this.m_previousPosition.x;
            var diffY = currentPosY - this.m_previousPosition.y;
            var diffZ = currentPosZ - this.m_previousPosition.z;
            this.m_startPosition.x = this.m_startPosition.x + diffX;
            this.m_startPosition.y = this.m_startPosition.y + diffY;
            this.m_startPosition.z = this.m_startPosition.z + diffZ;
            this.m_vTrans.SetValue((this.m_positionDelta2.x + this.m_randomRangeDelta2.x), (this.m_positionDelta2.y + this.m_randomRangeDelta2.y), (this.m_positionDelta2.z + this.m_randomRangeDelta2.z));
            var newPosX = this.m_startPosition.x + this.m_vTrans.x * time;
            var newPosY = this.m_startPosition.y + this.m_vTrans.y * time;
            var newPosZ = this.m_startPosition.z + this.m_vTrans.z * time;
            this.m_pTarget.SetPos3D(newPosX, newPosY, newPosZ);
            if (this.m_bSetDir) {
                if (!dMath.FloatEquals(newPosX, this.m_previousPosition.x) || !dMath.FloatEquals(newPosY, this.m_previousPosition.y) || !dMath.FloatEquals(newPosZ, this.m_previousPosition.z)) {
                    this.m_previousPosition.SetValue(newPosX - this.m_previousPosition.x, newPosY - this.m_previousPosition.y, newPosZ - this.m_previousPosition.z);
                    this.m_previousPosition.Normalize();
                    this.m_pTarget.SetRotation(new dVector2(this.m_previousPosition.x, this.m_previousPosition.y).ToAngle());
                }
            }
            this.m_previousPosition.SetValue(newPosX, newPosY, newPosZ);
        }
    };
    return CCMoveBy;
}(CCActionInterval));
var CCMoveTo = (function (_super) {
    __extends(CCMoveTo, _super);
    function CCMoveTo(duration, x, y, z, bSetDir, randomRangeX, randomRangeY, randomRangeZ, bMirrorWithTarget) {
        if (z === void 0) { z = 0; }
        if (bSetDir === void 0) { bSetDir = false; }
        if (randomRangeX === void 0) { randomRangeX = 0; }
        if (randomRangeY === void 0) { randomRangeY = 0; }
        if (randomRangeZ === void 0) { randomRangeZ = 0; }
        if (bMirrorWithTarget === void 0) { bMirrorWithTarget = false; }
        var _this = _super.call(this, duration, x, y, z, bSetDir, randomRangeX, randomRangeY, randomRangeZ, bMirrorWithTarget) || this;
        _this.m_pMoveToTarget = null;
        _this.m_pMoveToTargetRoot = null;
        _this.m_vMoveToTargetOffset = null;
        _this.m_endPosition = new dVector3(x, y, z);
        _this.m_randomRangeDelta = new dVector3(randomRangeX, randomRangeY, randomRangeZ);
        _this.m_bSetDir = bSetDir;
        return _this;
    }
    CCMoveTo.prototype.SetMoveToTarget = function (pMoveToTarget, vMoveToTargetOffset, root) {
        if (vMoveToTargetOffset === void 0) { vMoveToTargetOffset = null; }
        if (root === void 0) { root = null; }
        this.m_pMoveToTarget = pMoveToTarget;
        this.m_pMoveToTargetRoot = root;
        if (vMoveToTargetOffset != null)
            this.m_vMoveToTargetOffset = vMoveToTargetOffset;
        else
            this.m_vMoveToTargetOffset = new dVector3();
        return this;
    };
    CCMoveTo.prototype.GetMoveToTarget = function () {
        return this.m_pMoveToTarget;
    };
    CCMoveTo.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            var currentPosX = this.m_pTarget.GetPosX();
            var currentPosY = this.m_pTarget.GetPosY();
            var currentPosZ = this.m_pTarget.GetPosZ();
            var diffX = currentPosX - this.m_previousPosition.x;
            var diffY = currentPosY - this.m_previousPosition.y;
            var diffZ = currentPosZ - this.m_previousPosition.z;
            var newPosX = this.m_startPosition.x + this.m_positionDelta.x * time;
            var newPosY = this.m_startPosition.y + this.m_positionDelta.y * time;
            var newPosZ = this.m_startPosition.z + this.m_positionDelta.z * time;
            if (this.m_pMoveToTarget != null) {
                var x = this.m_pMoveToTarget.positionX;
                var y = this.m_pMoveToTarget.positionY;
                var z = this.m_pMoveToTarget.positionZ;
                if (this.m_pMoveToTargetRoot) {
                    var v3 = this.m_pMoveToTarget.GetPos_World3D(this.m_pMoveToTargetRoot, false);
                    x = v3.x;
                    y = v3.y;
                    z = v3.z;
                }
                newPosX = dMath.Lerp(this.m_startPosition.x, x + this.m_vMoveToTargetOffset.x, time);
                newPosY = dMath.Lerp(this.m_startPosition.y, y + this.m_vMoveToTargetOffset.y, time);
                newPosZ = dMath.Lerp(this.m_startPosition.z, z + this.m_vMoveToTargetOffset.z, time);
            }
            this.m_pTarget.SetPos3D(newPosX, newPosY, newPosZ);
            if (this.m_bSetDir) {
                if (!dMath.FloatEquals(newPosX, this.m_previousPosition.x) || !dMath.FloatEquals(newPosY, this.m_previousPosition.y) || !dMath.FloatEquals(newPosZ, this.m_previousPosition.z)) {
                    this.m_previousPosition.SetValue(newPosX - this.m_previousPosition.x, newPosY - this.m_previousPosition.y, newPosZ - this.m_previousPosition.z);
                    this.m_previousPosition.Normalize();
                    this.m_pTarget.SetRotation(new dVector2(this.m_previousPosition.x, this.m_previousPosition.y).ToAngle());
                }
            }
            this.m_previousPosition.SetValue(newPosX, newPosY, newPosZ);
        }
    };
    CCMoveTo.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_startPosition = new dVector3(target.GetPosX(), target.GetPosY(), target.GetPosZ());
        this.m_randomRangeDelta2.SetValue(dMath.RandomRange(-this.m_randomRangeDelta.x, this.m_randomRangeDelta.x), dMath.RandomRange(-this.m_randomRangeDelta.y, this.m_randomRangeDelta.y), dMath.RandomRange(-this.m_randomRangeDelta.z, this.m_randomRangeDelta.z));
        this.m_positionDelta = this.m_endPosition.Add(this.m_randomRangeDelta2).Sub(this.m_startPosition);
    };
    return CCMoveTo;
}(CCMoveBy));
var CCMoveToPath = (function (_super) {
    __extends(CCMoveToPath, _super);
    function CCMoveToPath(duration, pathList, setDir) {
        if (setDir === void 0) { setDir = false; }
        var _this = _super.call(this) || this;
        _this.m_pathList = null;
        _this.m_pathLength = null;
        _this.m_pathDirs = null;
        _this.m_fTotalLength = 0;
        _this.m_previousPosition = new dVector3();
        _this.m_offPosition = new dVector3();
        _this.m_startPosition = new dVector3();
        _this.m_bSetDir = false;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_pathList = pathList;
        _this.m_bSetDir = setDir;
        return _this;
    }
    CCMoveToPath.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_pathLength = new Array(this.m_pathList.length);
        this.m_pathDirs = new Array(this.m_pathList.length);
        this.m_fTotalLength = 0;
        for (var i = 0, n = this.m_pathLength.length; i < n; i++) {
            var dir;
            if (i == 0)
                dir = this.m_pathList[i].Sub(target.GetPosVector3());
            else {
                dir = this.m_pathList[i].Sub(this.m_pathList[i - 1]);
            }
            var length = dir.Length();
            this.m_pathLength[i] = length;
            this.m_fTotalLength += length;
            dir.Normalize();
            this.m_pathDirs[i] = dir;
        }
        this.m_offPosition.SetValue();
        this.m_startPosition = new dVector3(target.GetPosX(), target.GetPosY(), target.GetPosZ());
        this.m_previousPosition = new dVector3(target.GetPosX(), target.GetPosY(), target.GetPosZ());
    };
    CCMoveToPath.prototype.Update = function (time) {
        if (this.m_pTarget != null && this.m_fTotalLength != 0) {
            var currentPosX = this.m_pTarget.GetPosX();
            var currentPosY = this.m_pTarget.GetPosY();
            var currentPosZ = this.m_pTarget.GetPosZ();
            var diffX = currentPosX - this.m_previousPosition.x;
            var diffY = currentPosY - this.m_previousPosition.y;
            var diffZ = currentPosZ - this.m_previousPosition.z;
            this.m_offPosition.x += diffX;
            this.m_offPosition.y += diffY;
            this.m_offPosition.z += diffZ;
            var newPosX = 0;
            var newPosY = 0;
            var newPosZ = 0;
            if (time == 0) {
                newPosX = this.m_startPosition.x;
                newPosY = this.m_startPosition.y;
                newPosZ = this.m_startPosition.z;
            }
            else if (time == 1) {
                var v = this.m_pathList.last();
                newPosX = v.x;
                newPosY = v.y;
                newPosZ = v.z;
            }
            else {
                var curLength = time * this.m_fTotalLength;
                var i = 0;
                for (; i < this.m_pathLength.length; i++) {
                    if (curLength < this.m_pathLength[i])
                        break;
                    curLength -= this.m_pathLength[i];
                }
                var v;
                if (i == 0)
                    v = this.m_startPosition;
                else
                    v = this.m_pathList[i - 1];
                var dir = this.m_pathDirs[i];
                newPosX = v.x + dir.x * curLength;
                newPosY = v.y + dir.y * curLength;
                newPosZ = v.z + dir.z * curLength;
            }
            newPosX += this.m_offPosition.x;
            newPosY += this.m_offPosition.y;
            newPosZ += this.m_offPosition.z;
            this.m_pTarget.SetPos3D(newPosX, newPosY, newPosZ);
            if (this.m_bSetDir) {
                if (!dMath.FloatEquals(newPosX, this.m_previousPosition.x) || !dMath.FloatEquals(newPosY, this.m_previousPosition.y) || !dMath.FloatEquals(newPosZ, this.m_previousPosition.z)) {
                    this.m_previousPosition.SetValue(newPosX - this.m_previousPosition.x, newPosY - this.m_previousPosition.y, newPosZ - this.m_previousPosition.z);
                    this.m_previousPosition.Normalize();
                    this.m_pTarget.SetRotation(new dVector2(this.m_previousPosition.x, this.m_previousPosition.y).ToAngle());
                }
            }
            this.m_previousPosition.SetValue(newPosX, newPosY, newPosZ);
        }
    };
    return CCMoveToPath;
}(CCActionInterval));
var CCOpacity = (function (_super) {
    __extends(CCOpacity, _super);
    function CCOpacity(opacity) {
        var _this = _super.call(this) || this;
        _this.m_fOpacity = opacity;
        return _this;
    }
    CCOpacity.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        target.SetAlpha(this.m_fOpacity);
    };
    return CCOpacity;
}(CCActionInstant));
var CCParallel = (function (_super) {
    __extends(CCParallel, _super);
    function CCParallel(actions) {
        var _this = _super.call(this) || this;
        _this.m_pActions = null;
        if (actions != null) {
            _this.m_pActions = actions;
            var duration = 0;
            for (var i = 0; i < _this.m_pActions.length; i++) {
                var actionDuration = _this.m_pActions[i].Duration;
                if (duration < actionDuration) {
                    duration = actionDuration;
                }
            }
            for (var i = 0; i < _this.m_pActions.length; i++) {
                var actionDuration = _this.m_pActions[i].Duration;
                if (actionDuration < duration) {
                    _this.m_pActions[i] = new CCSequence([_this.m_pActions[i], new CCDelayTime(duration - actionDuration)]);
                }
            }
            _super.prototype.InitWithDuration.call(_this, duration);
        }
        return _this;
    }
    CCParallel.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        for (var i = 0; i < this.m_pActions.length; i++) {
            this.m_pActions[i].StartWithTarget(target);
        }
    };
    CCParallel.prototype.Stop = function () {
        for (var i = 0; i < this.m_pActions.length; i++) {
            this.m_pActions[i].Stop();
        }
        _super.prototype.Stop.call(this);
    };
    CCParallel.prototype.Update = function (time) {
        for (var i = 0; i < this.m_pActions.length; i++) {
            this.m_pActions[i].Update(time);
        }
    };
    return CCParallel;
}(CCActionInterval));
var CCPlace = (function (_super) {
    __extends(CCPlace, _super);
    function CCPlace(pos) {
        var _this = _super.call(this) || this;
        _this.m_tPosition = pos;
        return _this;
    }
    CCPlace.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_pTarget.SetPos3D(this.m_tPosition.x, this.m_tPosition.y, this.m_tPosition.z);
    };
    return CCPlace;
}(CCActionInstant));
var CCPlaySound = (function (_super) {
    __extends(CCPlaySound, _super);
    function CCPlaySound(strSoundFileName, volume, loop, bWav, bPlayNextFrame) {
        if (volume === void 0) { volume = 1; }
        if (loop === void 0) { loop = false; }
        if (bWav === void 0) { bWav = true; }
        if (bPlayNextFrame === void 0) { bPlayNextFrame = false; }
        var _this = _super.call(this) || this;
        _this.m_strSoundFileName = strSoundFileName;
        _this.m_fVolume = volume;
        _this.m_bWav = bWav;
        _this.m_nLoop = loop;
        _this.m_bPlayNextFrame = bPlayNextFrame;
        return _this;
    }
    CCPlaySound.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        if (this.m_strSoundFileName) {
            if (this.m_bWav)
                dSound.PlaySound(this.m_strSoundFileName);
            else
                dSound.PlayMusic(this.m_strSoundFileName, this.m_nLoop, 0, this.m_fVolume);
        }
    };
    return CCPlaySound;
}(CCActionInstant));
var CCRandomChoice = (function (_super) {
    __extends(CCRandomChoice, _super);
    function CCRandomChoice(actions) {
        var _this = _super.call(this) || this;
        _this.m_pActions = actions;
        _this.m_nChoice = -1;
        if (_this.m_pActions.length == 0)
            return _this;
        _this.m_nChoice = dMath.RandomI() % _this.m_pActions.length;
        _super.prototype.InitWithDuration.call(_this, _this.m_pActions[_this.m_nChoice].Duration);
        return _this;
    }
    CCRandomChoice.prototype.Clear = function () {
        _super.prototype.Clear.call(this);
    };
    CCRandomChoice.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        if (this.m_nChoice != -1)
            this.m_pActions[this.m_nChoice].StartWithTarget(target);
    };
    CCRandomChoice.prototype.Stop = function () {
        if (this.m_nChoice != -1) {
            this.m_pActions[this.m_nChoice].Stop();
        }
        _super.prototype.Stop.call(this);
    };
    CCRandomChoice.prototype.Step = function (dt) {
        if (this.m_nChoice > -1 && (this.m_pActions[this.m_nChoice] instanceof CCRepeatForever)) {
            this.m_pActions[this.m_nChoice].Step(dt);
        }
        else {
            _super.prototype.Step.call(this, dt);
        }
    };
    CCRandomChoice.prototype.Update = function (t) {
        this.m_pActions[this.m_nChoice].Update(t);
    };
    CCRandomChoice.prototype.GetActionList = function (outData) {
        _super.prototype.GetActionList.call(this, outData);
        for (var i = 0; i < this.m_pActions.length; i++)
            outData.push(this.m_pActions[i]);
    };
    return CCRandomChoice;
}(CCActionInterval));
var CCRemoveSelf = (function (_super) {
    __extends(CCRemoveSelf, _super);
    function CCRemoveSelf() {
        return _super.call(this) || this;
    }
    CCRemoveSelf.prototype.Update = function (time) {
        this.m_pTarget.Destroy();
        this.m_pTarget.RemoveParent();
    };
    return CCRemoveSelf;
}(CCActionInstant));
var CCRemoveTarget = (function (_super) {
    __extends(CCRemoveTarget, _super);
    function CCRemoveTarget(pTarget) {
        var _this = _super.call(this) || this;
        _this.m_pRemoveTarget = pTarget;
        return _this;
    }
    CCRemoveTarget.prototype.Update = function (time) {
        this.m_pRemoveTarget.Destroy();
        this.m_pRemoveTarget.RemoveParent();
    };
    return CCRemoveTarget;
}(CCActionInstant));
var CCRepeat = (function (_super) {
    __extends(CCRepeat, _super);
    function CCRepeat(action, times) {
        var _this = _super.call(this) || this;
        _this.m_bActionInstant = false;
        _this.m_fNextDt = 0;
        _this.m_pInnerAction = null;
        _this.m_uTimes = 0;
        _this.m_uTotal = 0;
        var d = action.Duration * times;
        _super.prototype.InitWithDuration.call(_this, d);
        _this.m_uTimes = times;
        _this.m_pInnerAction = action;
        _this.m_bActionInstant = action instanceof CCActionInstant;
        if (_this.m_bActionInstant) {
            _this.m_uTimes -= 1;
        }
        _this.m_uTotal = 0;
        return _this;
    }
    Object.defineProperty(CCRepeat.prototype, "InnerAction", {
        get: function () {
            return this.m_pInnerAction;
        },
        set: function (value) {
            this.m_pInnerAction = value;
        },
        enumerable: false,
        configurable: true
    });
    CCRepeat.prototype.StartWithTarget = function (target) {
        this.m_uTotal = 0;
        this.m_fNextDt = this.m_pInnerAction.Duration / this.m_fDuration;
        _super.prototype.StartWithTarget.call(this, target);
        this.m_pInnerAction.StartWithTarget(target);
    };
    CCRepeat.prototype.Stop = function () {
        this.m_pInnerAction.Stop();
        _super.prototype.Stop.call(this);
    };
    CCRepeat.prototype.Update = function (dt) {
        if (dt >= this.m_fNextDt) {
            while (dt >= this.m_fNextDt && this.m_uTotal < this.m_uTimes) {
                this.m_pInnerAction.Update(1.0);
                this.m_uTotal++;
                if (this.m_pInnerAction instanceof CCRepeatForever)
                    break;
                this.m_pInnerAction.Stop();
                this.m_pInnerAction.StartWithTarget(this.m_pTarget);
                this.m_fNextDt += this.m_pInnerAction.Duration / this.m_fDuration;
            }
            if (dt >= 1.0 && this.m_uTotal < this.m_uTimes) {
                this.m_uTotal++;
            }
            if (!this.m_bActionInstant) {
                if (this.m_uTotal == this.m_uTimes) {
                    this.m_pInnerAction.Update(1);
                    this.m_pInnerAction.Stop();
                }
                else {
                    var time = dt - (this.m_fNextDt - this.m_pInnerAction.Duration / this.m_fDuration);
                    this.m_pInnerAction.Update(time);
                }
            }
        }
        else {
            var time = (dt * this.m_uTimes) % 1.0;
            this.m_pInnerAction.Update(time);
        }
    };
    CCRepeat.prototype.IsDone = function () {
        return this.m_uTotal == this.m_uTimes;
    };
    CCRepeat.prototype.GetActionList = function (outData) {
        _super.prototype.GetActionList.call(this, outData);
        outData.push(this.m_pInnerAction);
    };
    return CCRepeat;
}(CCActionInterval));
var CCRepeatForever = (function (_super) {
    __extends(CCRepeatForever, _super);
    function CCRepeatForever(action) {
        return _super.call(this, action, dMath.dINT_MAX) || this;
    }
    return CCRepeatForever;
}(CCRepeat));
var CCReverseTime = (function (_super) {
    __extends(CCReverseTime, _super);
    function CCReverseTime(action) {
        var _this = _super.call(this) || this;
        _this.InitWithDuration(action.Duration);
        _this.m_pOther = action;
        return _this;
    }
    CCReverseTime.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_pOther.StartWithTarget(target);
    };
    CCReverseTime.prototype.Stop = function () {
        this.m_pOther.Stop();
        _super.prototype.Stop.call(this);
    };
    CCReverseTime.prototype.Update = function (time) {
        if (this.m_pOther != null) {
            this.m_pOther.Update(1 - time);
        }
    };
    return CCReverseTime;
}(CCActionInterval));
var CCRotateBy = (function (_super) {
    __extends(CCRotateBy, _super);
    function CCRotateBy(duration, fDeltaAngle, axis) {
        if (axis === void 0) { axis = null; }
        var _this = _super.call(this) || this;
        _this.m_fAngleX = 0;
        _this.m_fAngleY = 0;
        _this.m_fStartAngleX = 0;
        _this.m_fStartAngleY = 0;
        _this.m_axis = null;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_fAngleX = _this.m_fAngleY = fDeltaAngle;
        _this.m_axis = axis;
        return _this;
    }
    CCRotateBy.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_fStartAngleX = target.GetRotation();
        this.m_fStartAngleY = target.GetRotation();
    };
    CCRotateBy.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            if (this.m_axis != null) {
                var mat = new dMatrix();
                mat.RotationAxis(dMath.AngleToRadian(this.m_fStartAngleX + this.m_fAngleX * time), this.m_axis);
                this.m_pTarget.SetRotationMatrix(mat);
            }
            else
                this.m_pTarget.SetRotation(this.m_fStartAngleX + this.m_fAngleX * time);
        }
    };
    return CCRotateBy;
}(CCActionInterval));
var CCRotateTo = (function (_super) {
    __extends(CCRotateTo, _super);
    function CCRotateTo(duration, fDeltaAngle, axis) {
        if (axis === void 0) { axis = null; }
        var _this = _super.call(this) || this;
        _this.m_fDiffAngleY = 0;
        _this.m_fDiffAngleX = 0;
        _this.m_fDstAngleX = 0;
        _this.m_fDstAngleY = 0;
        _this.m_fStartAngleX = 0;
        _this.m_fStartAngleY = 0;
        _this.m_axis = null;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_fDstAngleX = _this.m_fDstAngleY = fDeltaAngle;
        _this.m_axis = axis;
        return _this;
    }
    CCRotateTo.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_fStartAngleX = this.m_pTarget.GetRotation();
        this.m_fDiffAngleX = this.m_fDstAngleX - this.m_fStartAngleX;
        if (this.m_fDiffAngleX > 180) {
            this.m_fDiffAngleX -= 360;
        }
        if (this.m_fDiffAngleX < -180) {
            this.m_fDiffAngleX += 360;
        }
        this.m_fStartAngleY = this.m_pTarget.GetRotation();
        this.m_fDiffAngleY = this.m_fDstAngleY - this.m_fStartAngleY;
        if (this.m_fDiffAngleY > 180) {
            this.m_fDiffAngleY -= 360;
        }
        if (this.m_fDiffAngleY < -180) {
            this.m_fDiffAngleY += 360;
        }
    };
    CCRotateTo.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            if (this.m_axis != null) {
                var mat = new dMatrix();
                mat.RotationAxis(dMath.AngleToRadian((this.m_fStartAngleX + this.m_fDiffAngleX * time)), this.m_axis);
                this.m_pTarget.SetRotationMatrix(mat);
            }
            else
                this.m_pTarget.SetRotation((this.m_fStartAngleX + this.m_fDiffAngleX * time));
        }
    };
    return CCRotateTo;
}(CCActionInterval));
var CCScaleTo = (function (_super) {
    __extends(CCScaleTo, _super);
    function CCScaleTo(duration, sx, sy, sz) {
        if (sz === void 0) { sz = 1; }
        var _this = _super.call(this) || this;
        _this.m_fDeltaX = 0;
        _this.m_fDeltaY = 0;
        _this.m_fDeltaZ = 0;
        _this.m_fEndScaleX = 0;
        _this.m_fEndScaleY = 0;
        _this.m_fEndScaleZ = 0;
        _this.m_fScaleX = 0;
        _this.m_fScaleY = 0;
        _this.m_fScaleZ = 0;
        _this.m_fStartScaleX = 0;
        _this.m_fStartScaleY = 0;
        _this.m_fStartScaleZ = 0;
        _this.InitWithDuration(duration);
        _this.m_fEndScaleX = sx;
        _this.m_fEndScaleY = sy;
        _this.m_fEndScaleZ = sz;
        return _this;
    }
    CCScaleTo.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_fStartScaleX = target.GetScaleX();
        this.m_fStartScaleY = target.GetScaleY();
        this.m_fStartScaleZ = target.GetScaleZ();
        this.m_fDeltaX = this.m_fEndScaleX - this.m_fStartScaleX;
        this.m_fDeltaY = this.m_fEndScaleY - this.m_fStartScaleY;
        this.m_fDeltaZ = this.m_fEndScaleZ - this.m_fStartScaleZ;
    };
    CCScaleTo.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            this.m_pTarget.SetScale3D(this.m_fStartScaleX + this.m_fDeltaX * time, this.m_fStartScaleY + this.m_fDeltaY * time, this.m_fStartScaleZ + this.m_fDeltaZ * time);
        }
    };
    return CCScaleTo;
}(CCActionInterval));
var CCScaleBy = (function (_super) {
    __extends(CCScaleBy, _super);
    function CCScaleBy(duration, sx, sy, sz) {
        if (sz === void 0) { sz = 1; }
        return _super.call(this, duration, sx, sy, sz) || this;
    }
    CCScaleBy.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_fDeltaX = this.m_fStartScaleX * this.m_fEndScaleX - this.m_fStartScaleX;
        this.m_fDeltaY = this.m_fStartScaleY * this.m_fEndScaleY - this.m_fStartScaleY;
        this.m_fDeltaZ = this.m_fStartScaleZ * this.m_fEndScaleZ - this.m_fStartScaleZ;
    };
    return CCScaleBy;
}(CCScaleTo));
var CCSequence = (function (_super) {
    __extends(CCSequence, _super);
    function CCSequence(actions) {
        var _this = _super.call(this) || this;
        _this.m_last = 0;
        _this.m_pActions = new Array(2);
        _this.m_split = 0;
        _this._HasInfiniteAction = false;
        if (actions.length > 0) {
            var prev = actions[0];
            if (actions.length == 1) {
                _this.InitOneTwo(prev, new CCExtraAction());
            }
            else {
                for (var i = 1; i < actions.length - 1; i++) {
                    prev = new CCSequence([prev, actions[i]]);
                }
                _this.InitOneTwo(prev, actions[actions.length - 1]);
            }
        }
        return _this;
    }
    CCSequence.prototype.InitOneTwo = function (actionOne, actionTwo) {
        var d = actionOne.Duration + actionTwo.Duration;
        _super.prototype.InitWithDuration.call(this, d);
        this.m_pActions[0] = actionOne;
        this.m_pActions[1] = actionTwo;
        this._HasInfiniteAction = (actionOne instanceof CCRepeatForever) || (actionTwo instanceof CCRepeatForever);
        return true;
    };
    CCSequence.prototype.IsDone = function () {
        if (this._HasInfiniteAction && this.m_pActions[this.m_last] instanceof CCRepeatForever) {
            return false;
        }
        return _super.prototype.IsDone.call(this);
    };
    CCSequence.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_split = this.m_pActions[0].Duration / this.m_fDuration;
        this.m_last = -1;
    };
    CCSequence.prototype.Stop = function () {
        if (this.m_last != -1) {
            this.m_pActions[this.m_last].Stop();
        }
        _super.prototype.Stop.call(this);
    };
    CCSequence.prototype.Step = function (dt) {
        if (this.m_last > -1 && (this.m_pActions[this.m_last] instanceof CCRepeatForever)) {
            this.m_pActions[this.m_last].Step(dt);
        }
        else {
            _super.prototype.Step.call(this, dt);
        }
    };
    CCSequence.prototype.Update = function (t) {
        var bRestart = false;
        var found;
        var new_t;
        if (t < this.m_split) {
            found = 0;
            if (this.m_split != 0)
                new_t = t / this.m_split;
            else
                new_t = 1;
        }
        else {
            found = 1;
            if (this.m_split == 1)
                new_t = 1;
            else
                new_t = (t - this.m_split) / (1 - this.m_split);
        }
        if (found == 1) {
            if (this.m_last == -1) {
                this.m_pActions[0].StartWithTarget(this.m_pTarget);
                this.m_pActions[0].Update(1.0);
                this.m_pActions[0].Stop();
            }
            else if (this.m_last == 0) {
                this.m_pActions[0].Update(1.0);
                this.m_pActions[0].Stop();
            }
        }
        else if (found == 0 && this.m_last == 1) {
            this.m_pActions[1].Update(0);
            this.m_pActions[1].Stop();
        }
        if (found == this.m_last && this.m_pActions[found].IsDone()) {
            return;
        }
        if (found != this.m_last || bRestart) {
            this.m_pActions[found].StartWithTarget(this.m_pTarget);
        }
        this.m_pActions[found].Update(new_t);
        this.m_last = found;
    };
    CCSequence.prototype.GetActionList = function (outData) {
        _super.prototype.GetActionList.call(this, outData);
        for (var i = 0; i < this.m_pActions.length; i++)
            outData.push(this.m_pActions[i]);
    };
    return CCSequence;
}(CCActionInterval));
var CCShake = (function (_super) {
    __extends(CCShake, _super);
    function CCShake(duration, maxRadius, minRadius) {
        var _this = _super.call(this) || this;
        _this.m_maxRadius = 0;
        _this.m_minRadius = 0;
        _this.m_endMaxRadius = 0;
        _this.m_endMinRadius = 0;
        _this.m_fLastMoveOffsetX = 0;
        _this.m_fLastMoveOffsetY = 0;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_maxRadius = maxRadius;
        _this.m_minRadius = minRadius;
        _this.m_endMaxRadius = maxRadius;
        _this.m_endMinRadius = minRadius;
        return _this;
    }
    CCShake.prototype.Update = function (t) {
        this.m_pTarget.SetPos(this.m_pTarget.GetPosX() - this.m_fLastMoveOffsetX, this.m_pTarget.GetPosY() - this.m_fLastMoveOffsetY);
        if (t >= 1) {
            this.m_fLastMoveOffsetX = 0;
            this.m_fLastMoveOffsetY = 0;
        }
        else {
            var radian = dMath.Random() * dMath.dPI * 2;
            var maxR = this.m_maxRadius + (this.m_endMinRadius - this.m_maxRadius) * t;
            var minR = this.m_minRadius + (this.m_endMinRadius - this.m_minRadius) * t;
            var r = dMath.Random() * (maxR - minR) + minR;
            var x = dMath.Cos(radian) * r;
            var y = dMath.Sin(radian) * r;
            this.m_pTarget.SetPos(this.m_pTarget.GetPosX() + x, this.m_pTarget.GetPosY() + y);
            this.m_fLastMoveOffsetX = x;
            this.m_fLastMoveOffsetY = y;
        }
    };
    CCShake.prototype.StartWithTarget = function (pTarget) {
        _super.prototype.StartWithTarget.call(this, pTarget);
        this.m_fLastMoveOffsetX = 0;
        this.m_fLastMoveOffsetY = 0;
    };
    return CCShake;
}(CCActionInterval));
var CCShakeRect = (function (_super) {
    __extends(CCShakeRect, _super);
    function CCShakeRect(duration, rc) {
        var _this = _super.call(this) || this;
        _this.m_rcRect = null;
        _this.m_fLastMoveOffsetX = 0;
        _this.m_fLastMoveOffsetY = 0;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_rcRect = rc;
        return _this;
    }
    CCShakeRect.prototype.Update = function (t) {
        this.m_pTarget.SetPos(this.m_pTarget.GetPosX() - this.m_fLastMoveOffsetX, this.m_pTarget.GetPosY() - this.m_fLastMoveOffsetY);
        if (t >= 1) {
            this.m_fLastMoveOffsetX = 0;
            this.m_fLastMoveOffsetY = 0;
        }
        else {
            var x = dMath.RandomRange(this.m_rcRect.left, this.m_rcRect.right);
            var y = dMath.RandomRange(this.m_rcRect.top, this.m_rcRect.bottom);
            this.m_pTarget.SetPos(this.m_pTarget.GetPosX() + x, this.m_pTarget.GetPosY() + y);
            this.m_fLastMoveOffsetX = x;
            this.m_fLastMoveOffsetY = y;
        }
    };
    CCShakeRect.prototype.StartWithTarget = function (pTarget) {
        _super.prototype.StartWithTarget.call(this, pTarget);
        this.m_fLastMoveOffsetX = 0;
        this.m_fLastMoveOffsetY = 0;
    };
    return CCShakeRect;
}(CCActionInterval));
var CCShow = (function (_super) {
    __extends(CCShow, _super);
    function CCShow() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCShow.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        target.SetShow(true);
    };
    return CCShow;
}(CCActionInstant));
var CCSizeTo = (function (_super) {
    __extends(CCSizeTo, _super);
    function CCSizeTo(duration, sx, sy) {
        var _this = _super.call(this) || this;
        _this.m_fDeltaX = 0;
        _this.m_fDeltaY = 0;
        _this.m_fSizeX = 0;
        _this.m_fSizeY = 0;
        _this.m_fStartSizeX = 0;
        _this.m_fStartSizeY = 0;
        _this.InitWithDuration(duration);
        _this.m_fEndSizeX = sx;
        _this.m_fEndSizeY = sy;
        return _this;
    }
    CCSizeTo.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_fStartSizeX = target.GetWidth();
        this.m_fStartSizeY = target.GetHeight();
        this.m_fDeltaX = this.m_fEndSizeX - this.m_fStartSizeX;
        this.m_fDeltaY = this.m_fEndSizeY - this.m_fStartSizeY;
    };
    CCSizeTo.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            this.m_pTarget.SetSize(this.m_fStartSizeX + this.m_fDeltaX * time, this.m_fStartSizeY + this.m_fDeltaY * time);
        }
    };
    return CCSizeTo;
}(CCActionInterval));
var CCSizeBy = (function (_super) {
    __extends(CCSizeBy, _super);
    function CCSizeBy() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCSizeBy.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_fDeltaX = this.m_fStartSizeX * this.m_fEndSizeX - this.m_fStartSizeX;
        this.m_fDeltaY = this.m_fStartSizeY * this.m_fEndSizeY - this.m_fStartSizeY;
    };
    return CCSizeBy;
}(CCSizeTo));
var CCSpawn = (function (_super) {
    __extends(CCSpawn, _super);
    function CCSpawn(actions) {
        var _this = _super.call(this) || this;
        _this.m_pOne = null;
        _this.m_pTwo = null;
        if (actions != null) {
            var prev = actions[0];
            if (actions.length == 1) {
                _this.InitOneTwo(prev, new CCExtraAction());
            }
            else {
                for (var i = 1; i < actions.length - 1; i++) {
                    prev = new CCSpawn([prev, actions[i]]);
                }
                _this.InitOneTwo(prev, actions[actions.length - 1]);
            }
        }
        return _this;
    }
    CCSpawn.prototype.InitOneTwo = function (action1, action2) {
        var bRet = false;
        var d1 = action1.Duration;
        var d2 = action2.Duration;
        _super.prototype.InitWithDuration.call(this, dMath.Max(d1, d2));
        this.m_pOne = action1;
        this.m_pTwo = action2;
        if (d1 > d2) {
            this.m_pTwo = new CCSequence([action2, new CCDelayTime(d1 - d2)]);
        }
        else if (d1 < d2) {
            this.m_pOne = new CCSequence([action1, new CCDelayTime(d2 - d1)]);
        }
    };
    CCSpawn.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_pOne.StartWithTarget(target);
        this.m_pTwo.StartWithTarget(target);
    };
    CCSpawn.prototype.Stop = function () {
        this.m_pOne.Stop();
        this.m_pTwo.Stop();
        _super.prototype.Stop.call(this);
    };
    CCSpawn.prototype.Update = function (time) {
        if (this.m_pOne != null) {
            this.m_pOne.Update(time);
        }
        if (this.m_pTwo != null) {
            this.m_pTwo.Update(time);
        }
    };
    CCSpawn.prototype.GetActionList = function (outData) {
        _super.prototype.GetActionList.call(this, outData);
        outData.push(this.m_pOne);
        outData.push(this.m_pTwo);
    };
    return CCSpawn;
}(CCActionInterval));
var CCSpeed = (function (_super) {
    __extends(CCSpeed, _super);
    function CCSpeed(action, fRate) {
        var _this = _super.call(this) || this;
        _this.m_fSpeed = 0;
        _this.m_pInnerAction = action;
        _this.m_fSpeed = fRate;
        return _this;
    }
    Object.defineProperty(CCSpeed.prototype, "Speed", {
        get: function () {
            return this.m_fSpeed;
        },
        set: function (value) {
            this.m_fSpeed = value;
        },
        enumerable: false,
        configurable: true
    });
    CCSpeed.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_pInnerAction.StartWithTarget(target);
    };
    CCSpeed.prototype.Stop = function () {
        this.m_pInnerAction.Stop();
        _super.prototype.Stop.call(this);
    };
    CCSpeed.prototype.Step = function (dt) {
        this.m_pInnerAction.Step(dt * this.m_fSpeed);
    };
    CCSpeed.prototype.IsDone = function () {
        return this.m_pInnerAction.IsDone();
    };
    return CCSpeed;
}(CCAction));
var CCSplineMath = (function () {
    function CCSplineMath() {
    }
    CCSplineMath.CCCardinalSplineAt = function (p0, p1, p2, p3, tension, t) {
        if (tension < 0) {
            tension = 0;
        }
        if (tension > 1) {
            tension = 1;
        }
        var t2 = t * t;
        var t3 = t2 * t;
        var s = (1 - tension) / 2;
        var b1 = s * ((-t3 + (2 * t2)) - t);
        var b2 = s * (-t3 + t2) + (2 * t3 - 3 * t2 + 1);
        var b3 = s * (t3 - 2 * t2 + t) + (-2 * t3 + 3 * t2);
        var b4 = s * (t3 - t2);
        var x = (p0.x * b1 + p1.x * b2 + p2.x * b3 + p3.x * b4);
        var y = (p0.y * b1 + p1.y * b2 + p2.y * b3 + p3.y * b4);
        return new dVector2(x, y);
    };
    CCSplineMath.CubicBezier = function (a, b, c, d, t) {
        var t1 = 1 - t;
        return ((t1 * t1 * t1) * a + 3 * t * (t1 * t1) * b + 3 * (t * t) * (t1) * c + (t * t * t) * d);
    };
    CCSplineMath.QuadBezier = function (a, b, c, t) {
        var t1 = 1 - t;
        return (t1 * t1) * a + 2.0 * (t1) * t * b + (t * t) * c;
    };
    return CCSplineMath;
}());
var CCTargetedAction = (function (_super) {
    __extends(CCTargetedAction, _super);
    function CCTargetedAction(target, pAction) {
        var _this = _super.call(this) || this;
        _this.m_pForcedTarget = null;
        _super.prototype.InitWithDuration.call(_this, pAction.Duration);
        _this.m_pForcedTarget = target;
        _this.m_pAction = pAction;
        return _this;
    }
    Object.defineProperty(CCTargetedAction.prototype, "ForcedTarget", {
        get: function () {
            return this.m_pForcedTarget;
        },
        enumerable: false,
        configurable: true
    });
    CCTargetedAction.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        this.m_pAction.StartWithTarget(this.m_pForcedTarget);
    };
    CCTargetedAction.prototype.Stop = function () {
        this.m_pAction.Stop();
    };
    CCTargetedAction.prototype.Update = function (time) {
        this.m_pAction.Update(time);
    };
    return CCTargetedAction;
}(CCActionInterval));
var CCTintBy = (function (_super) {
    __extends(CCTintBy, _super);
    function CCTintBy(duration, deltaRed, deltaGreen, deltaBlue, deltaAlpha, bSetToChild, bLerp) {
        if (bLerp === void 0) { bLerp = true; }
        var _this = _super.call(this) || this;
        _this.m_deltaB = 0;
        _this.m_deltaG = 0;
        _this.m_deltaR = 0;
        _this.m_deltaA = 0;
        _this.m_fromB = 0;
        _this.m_fromG = 0;
        _this.m_fromR = 0;
        _this.m_fromA = 0;
        _this.m_bSetToChild = false;
        _this.m_bLerp = false;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_deltaR = deltaRed * 255;
        _this.m_deltaG = deltaGreen * 255;
        _this.m_deltaB = deltaBlue * 255;
        _this.m_deltaA = deltaAlpha * 255;
        _this.m_bSetToChild = bSetToChild;
        _this.m_bLerp = bLerp;
        return _this;
    }
    CCTintBy.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        if (target != null) {
            var color = target.GetColor();
            this.m_fromR = (color & 0x00FF0000) >> 16;
            this.m_fromG = (color & 0x0000FF00) >> 8;
            this.m_fromB = color & 0x000000FF;
            this.m_fromA = (color & 0xFF000000) >>> 24;
        }
    };
    CCTintBy.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            var r, g, b, a;
            if (this.m_bLerp) {
                r = dMath.ToInt(this.m_fromR + this.m_deltaR * time);
                g = dMath.ToInt(this.m_fromG + this.m_deltaG * time);
                b = dMath.ToInt(this.m_fromB + this.m_deltaB * time);
                a = dMath.ToInt(this.m_fromA + this.m_deltaA * time);
            }
            else {
                r = this.m_deltaR;
                g = this.m_deltaG;
                b = this.m_deltaB;
                a = this.m_deltaA;
            }
            this.m_pTarget.SetColor(a << 24 | r << 16 | g << 8 | b, this.m_bSetToChild);
        }
    };
    return CCTintBy;
}(CCActionInterval));
var CCTintTo = (function (_super) {
    __extends(CCTintTo, _super);
    function CCTintTo(duration, red, green, blue, alpha, bSetToChild, bLerp) {
        if (bLerp === void 0) { bLerp = true; }
        var _this = _super.call(this) || this;
        _this.m_fromR = 0;
        _this.m_fromG = 0;
        _this.m_fromB = 0;
        _this.m_fromA = 0;
        _this.m_toR = 0;
        _this.m_toG = 0;
        _this.m_toB = 0;
        _this.m_toA = 0;
        _this.m_bSetToChild = false;
        _this.m_bLerp = false;
        _super.prototype.InitWithDuration.call(_this, duration);
        _this.m_toR = red * 255;
        _this.m_toG = green * 255;
        _this.m_toB = blue * 255;
        _this.m_toA = alpha * 255;
        _this.m_bSetToChild = bSetToChild;
        _this.m_bLerp = bLerp;
        return _this;
    }
    CCTintTo.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        if (this.m_pTarget != null) {
            var color = this.m_pTarget.GetColor();
            this.m_fromR = (color & 0x00FF0000) >> 16;
            this.m_fromG = (color & 0x0000FF00) >> 8;
            this.m_fromB = color & 0x000000FF;
            this.m_fromA = (color & 0xFF000000) >>> 24;
        }
    };
    CCTintTo.prototype.Update = function (time) {
        if (this.m_pTarget != null) {
            var r, g, b, a;
            if (this.m_bLerp) {
                r = dMath.ToInt(this.m_fromR + (this.m_toR - this.m_fromR) * time);
                g = dMath.ToInt(this.m_fromG + (this.m_toG - this.m_fromG) * time);
                b = dMath.ToInt(this.m_fromB + (this.m_toB - this.m_fromB) * time);
                a = dMath.ToInt(this.m_fromA + (this.m_toA - this.m_fromA) * time);
            }
            else {
                r = this.m_toR;
                g = this.m_toG;
                b = this.m_toB;
                a = this.m_toA;
            }
            this.m_pTarget.SetColor(a << 24 | r << 16 | g << 8 | b, this.m_bSetToChild);
        }
    };
    return CCTintTo;
}(CCActionInterval));
var CCToggleVisibility = (function (_super) {
    __extends(CCToggleVisibility, _super);
    function CCToggleVisibility() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CCToggleVisibility.prototype.StartWithTarget = function (target) {
        _super.prototype.StartWithTarget.call(this, target);
        target.SetShow(!target.isShow());
    };
    return CCToggleVisibility;
}(CCActionInstant));
var MoreGamePanel = (function (_super) {
    __extends(MoreGamePanel, _super);
    function MoreGamePanel(moreGame2) {
        var _this = _super.call(this) || this;
        dControlLoader.CreateUIByJson(_this, _this._dscData());
        var moreGame = new Array();
        moreGame.copy(moreGame2);
        while (moreGame.length > 9 * 3) {
            var rnd = dMath.RandomI() % (moreGame.length / 3);
            for (var i = 0; i < 3; i++)
                moreGame.erase(rnd * 3);
        }
        for (var j = 0; j < moreGame.length; j += 3) {
            if (moreGame[j] == dInterface.ptr.GetPackageAppId()) {
                for (var i = 0; i < 3; i++)
                    moreGame.erase(j);
            }
        }
        _this.SetHandleMouse(true);
        _this.Panel_CloseButton.SetEvent(new dEvent().SetOnButtonDown(function () {
            _this.RemoveParent();
        }));
        var icons = [_this.Panel_GameIcon1, _this.Panel_GameIcon2, _this.Panel_GameIcon3,
            _this.Panel_GameIcon4, _this.Panel_GameIcon5, _this.Panel_GameIcon6,
            _this.Panel_GameIcon7, _this.Panel_GameIcon8, _this.Panel_GameIcon9];
        _this.Panel.LoadFromFile("data/common/commonround.png", null, false);
        _this.Panel.SetHandleMouse(true);
        for (var i = 0; i < moreGame.length / 3; i++) {
            var appId = moreGame[i * 3];
            var iconPath = moreGame[i * 3 + 1];
            var appName = moreGame[i * 3 + 2];
            icons[i].FindChild("Image").LoadFromFile(iconPath, null, false);
            icons[i].FindChild("Image1").LoadFromFile("data/common/commonroundmask.png", null, false);
            icons[i].FindChild("Text").SetText(appName);
            var fun = function (appId, appName) {
                icons[i].SetEvent(new dEvent().SetOnButtonDown(function () {
                    dInterface.ptr.OpenMiniProgram(appId);
                    var url = MyAd.s_httpUrl + "/" + "@uploadsave4?" + MyAd.commonUrlParam() + "&type=Box" + "&placement=" + appName;
                    dSocket.RequestHttp(url);
                }));
            };
            fun(appId, appName);
        }
        for (var i = moreGame.length / 3; i < icons.length; i++)
            icons[i].visible = false;
        new dTimer(_this).Create(0, 0, function () {
            _this.LayoutToSize(dThread.GetWindowWidth(), dThread.GetWindowHeight());
        }).Apply();
        return _this;
    }
    MoreGamePanel.prototype._dscData = function () { return { "_child": [{ "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Title", "classType": "dLabel", "fontSize": 42, "height": 42, "spriteColor": -16777216, "text": "", "width": 258, "x": 0, "y": -398 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "dImage1", "classType": "dImage", "height": 10, "pureColor": 1, "rotation": -45, "spriteColor": -10461088, "width": 60, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "dImage2", "classType": "dImage", "height": 10, "pureColor": 1, "rotation": 45, "spriteColor": -10461088, "width": 60, "x": 0, "y": 0 }], "anchorU": 0.5, "anchorV": 0.5, "className": "CloseButton", "classType": "dButton", "height": 100, "resourceFileName": "", "width": 100, "x": 337.511108, "y": -404.495056, "z": -6.258518 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 153, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Image1", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -16777216, "text": "", "width": 132, "x": 0, "y": 96 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameIcon1", "classType": "dButton", "height": 154, "resourceFileName": "", "width": 154, "x": -240, "y": -223 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Image1", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -16777216, "text": "", "width": 132, "x": 0, "y": 96 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameIcon2", "classType": "dButton", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": -223 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Image1", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -16777216, "text": "", "width": 132, "x": 0, "y": 96 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameIcon3", "classType": "dButton", "height": 154, "resourceFileName": "", "width": 154, "x": 240, "y": -223 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Image1", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -16777216, "text": "", "width": 132, "x": 0, "y": 96 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameIcon4", "classType": "dButton", "height": 154, "resourceFileName": "", "width": 154, "x": -240, "y": 24 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Image1", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -16777216, "text": "", "width": 132, "x": 0, "y": 96 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameIcon5", "classType": "dButton", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 24 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Image1", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -16777216, "text": "", "width": 132, "x": 0, "y": 96 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameIcon6", "classType": "dButton", "height": 154, "resourceFileName": "", "width": 154, "x": 240, "y": 24 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Image1", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -16777216, "text": "", "width": 132, "x": 0, "y": 96 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameIcon7", "classType": "dButton", "height": 154, "resourceFileName": "", "width": 154, "x": -240, "y": 271 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Image1", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -16777216, "text": "", "width": 132, "x": 0, "y": 96 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameIcon8", "classType": "dButton", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 271 }, { "_child": [{ "anchorU": 0.5, "anchorV": 0.5, "className": "Image", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Image1", "classType": "dImage", "height": 154, "resourceFileName": "", "width": 154, "x": 0, "y": 0 }, { "anchorU": 0.5, "anchorV": 0.5, "className": "Text", "classType": "dLabel", "fontSize": 32, "height": 32, "spriteColor": -16777216, "text": "", "width": 132, "x": 0, "y": 96 }], "anchorU": 0.5, "anchorV": 0.5, "className": "GameIcon9", "classType": "dButton", "height": 154, "resourceFileName": "", "width": 154, "x": 240, "y": 271 }], "anchorU": 0.5, "anchorV": 0.5, "className": "Panel", "classType": "dScale9", "height": 960, "resourceFileName": "", "width": 800, "x": 540, "y": 937.5 }], "anchorU": 0, "anchorV": 0, "className": "MessageBoxPanel", "classType": "dImage", "height": 1920, "layoutAlignH": 5, "layoutAlignV": 5, "pureColor": 1, "spriteColor": 1124073472, "width": 1080, "x": 0, "y": 0 }; };
    MoreGamePanel.prototype.OnTouchDown = function (x, y, delta) {
        this.RemoveParent();
    };
    MoreGamePanel.ShowAdMoreGame = function () {
        var moreGame = dInterface.ptr.GetMoreGameList();
        if (moreGame) {
            dThread.GetRootSprite().AddChild(new MoreGamePanel(moreGame));
        }
        else
            MyAd.ShowAdMoreGame();
    };
    return MoreGamePanel;
}(dImage));
var MyAd = (function () {
    function MyAd() {
    }
    MyAd.InitMyAd = function (appName) {
        MyAd.s_strAppName = appName;
        MyAd.SendPlayingTime(0);
        MyAd.SendAppList();
        if (dThread.GetSdkName() == "web" && dThread.GetChannelName() == "mi") {
        }
        else
            MyAd.CheckSign();
        if (dThread.GetSdkName() == "web" && dThread.GetChannelName() == "windows") {
        }
        else {
            dInterface.ptr.m_onErrCallback = function (err) {
                console.log(err.message);
                console.log(err.stack);
                MyAd.SendCrash(err.message, err.stack);
            };
        }
        if (dThread.GetSdkName() == "web" && dThread.GetChannelName() == "ios" && !dStringUtils.isNullOrEmpty(MyAd.s_httpCdn)) {
            new dTimer().Create(3000, 10, function (sender) {
                if (!dInterface.ptr.GetMoreGameList())
                    MyAd.LoadAppConfig(MyAd.s_httpCdn + "/appconfigios.json?" + dDateTime.NowTime().ToStringBuffer());
                else
                    sender.Stop();
            }).Apply();
        }
    };
    MyAd.isNeedShowPrivacyDialog = function () {
        if (dThread.GetSdkName() == "oppo" || dThread.GetSdkName() == "qq" || dThread.GetSdkName() == "mi" || dThread.GetSdkName() == "hw")
            return true;
        return false;
    };
    MyAd.isNeedShowPrivacyLink = function () {
        if (dThread.GetChannelName() == "gp" || dThread.GetChannelName() == "ios")
            return false;
        if (MyAd.isNeedShowPrivacyDialog() || dThread.GetSdkName() == "web" && dThread.GetChannelName() != "7k7kh5" || dThread.GetSdkName() == "mg")
            return true;
        return false;
    };
    MyAd.isNeedShowZhuZuo = function () {
        if (dThread.GetSdkName() == "mg" || dThread.GetSdkName() == "hw" || dThread.GetSdkName() == "oppo")
            return true;
        if (dThread.GetSdkName() == "web" && dThread.GetChannelName() == "oppo")
            return true;
        return false;
    };
    MyAd.isNeedShowShiLing = function () {
        if (dThread.GetSdkName() == "web" && dThread.GetChannelName() == "7k7kh5")
            return false;
        return true;
    };
    MyAd.GetZhuZuoName = function (appName) {
        if (dThread.GetSdkName() == "web" && dThread.GetChannelName() == "oppo" || dThread.GetSdkName() == "hw")
            return "";
        return "";
    };
    MyAd.LoadAppConfig = function (url) {
        dSocket.RequestHttp(url, function (res) {
            if (res) {
                var data = JSON.parse(res.ToStringBuffer());
                if (data.moregames) {
                    window.moreGameList = data.moregames;
                }
            }
        });
    };
    MyAd.LoadAdConfig = function (url, sdkName) {
        if (dThread.GetSdkName() == sdkName) {
            dSocket.RequestHttp(url, function (res) {
                if (res) {
                    var data = JSON.parse(res.ToStringBuffer());
                    console.log(data);
                    if (data.adid_rewarded && window && data.adid_rewarded.length)
                        window.adid_rewarded = data.adid_rewarded;
                    if (data.adid_box && window && data.adid_box.length)
                        window.adid_box = data.adid_box;
                }
            });
        }
    };
    MyAd.GetBannerStepTime = function () {
        if (dThread.GetChannelName() == "mo")
            return 300000;
        if (dThread.GetChannelName() == "mi")
            return 60000;
        return 0;
    };
    MyAd.CheckSign = function () {
        var sha1 = dInterface.ptr.GetPackageSha1();
        if (!dStringUtils.isNullOrEmpty(sha1) && !dStringUtils.isNullOrEmpty(MyAd.s_httpUrl)) {
            sha1 = dStringUtils.ReplaceAll(sha1, ":", "");
            var url = MyAd.s_httpUrl + "/getSign?" + MyAd.commonUrlParam() + "&s1=" + sha1;
            dSocket.RequestHttp(url, function (res) {
                if (res) {
                    var str = res.ToStringBuffer();
                    if (str == "signerror") {
                        dInterface.ptr.ExitApp(true);
                    }
                }
            });
        }
    };
    MyAd.SendPassStage = function (stage, index) {
        if (index === void 0) { index = 1; }
        var obj = { passStage: stage, index: index };
        this.SendUserDataKeyValue(null, null, false, obj);
    };
    MyAd.SendPlayingTime = function (step) {
        if (dStringUtils.isNullOrEmpty(MyAd.s_httpUrl))
            return;
        var seconds = [0, 3, 7, 20, 30, 60, 60, 3 * 60, 4 * 60, 10 * 60];
        new dTimer().Create(1000, 0, function (sender, iTimer, fTimer) {
            if (dThread.isWindowActive())
                MyAd.m_fCurTimeAdd += fTimer;
            if (MyAd.m_fCurTimeAdd >= seconds[step]) {
                var url = MyAd.s_httpUrl + "/@playingtime?" + MyAd.commonUrlParam() + "&t=" + seconds[step];
                dSocket.RequestHttp(url);
                MyAd.m_fCurTimeAdd = 0;
                step++;
                if (step > seconds.length - 1)
                    step = seconds.length - 1;
            }
        });
    };
    MyAd.SendCrash = function (message, stack) {
        if (dStringUtils.isNullOrEmpty(MyAd.s_httpUrl))
            return;
        if (!MyAd.s_crashSended) {
            MyAd.s_crashSended = true;
            if (!message)
                message = "unknown";
            if (!stack)
                stack = "unknown";
            var url = MyAd.s_httpUrl + "/@crash?" + MyAd.commonUrlParam();
            var data = new dByteArray();
            data.WriteString(message);
            data.WriteString(stack);
            data.SetPosition(0);
            dSocket.RequestHttp(url, null, "POST", data);
        }
    };
    MyAd.SendAppList = function () {
        var appList = dInterface.ptr.GetAppList();
        if (!dStringUtils.isNullOrEmpty(appList)) {
            this.SendUserDataKeyValue("packList", appList, false);
        }
    };
    MyAd.SendUserDataKeyValue = function (key, value, isDaily, obj) {
        if (isDaily === void 0) { isDaily = true; }
        if (obj === void 0) { obj = null; }
        if (dStringUtils.isNullOrEmpty(MyAd.s_httpUrl))
            return;
        var url = MyAd.s_httpUrl + "/" + "@uploadsave5?" + MyAd.commonUrlParam() + "&daily=" + Number(isDaily);
        if (obj == null)
            obj = {};
        if (key)
            obj[key] = value;
        var arr = new dByteArray();
        arr.WriteStringEx(JSON.stringify(obj), false);
        arr.SetPosition(0);
        dSocket.RequestHttp(url, null, "POST", arr);
    };
    MyAd.commonUrlParam = function () {
        var n = MyAd.s_strAppName;
        var id = dThread.GetUserDeviceId();
        var sdkName = dThread.GetSdkName();
        var ver = dThread.GetPackageVersionCode();
        var packName = dThread.GetPackageName();
        var channelName = dThread.GetChannelName();
        return "n=" + n + "&d=" + id + "&sdk=" + channelName + "&os=" + sdkName + "&v=" + ver + "&packName=" + packName + "&chn=";
    };
    MyAd.ShowAdRewardedVideoTrace = function (name, onComplete) {
        var curTime = dTimer.GetTickCount();
        dInterface.ptr.ShowAdRewardedVideo(function () {
            if (!dStringUtils.isNullOrEmpty(MyAd.s_httpUrl)) {
                var url = MyAd.s_httpUrl + "/" + "@uploadsave4?" + MyAd.commonUrlParam() + "&type=rewarded" + "&placement=" + name + "&useTime=" + (dTimer.GetTickCount() - curTime);
                dSocket.RequestHttp(url);
            }
            if (onComplete)
                onComplete();
        });
    };
    MyAd.ShowAdInterstitialImageTrace = function (name) {
        dInterface.ptr.ShowAdInterstitialImage(function () {
            if (!dStringUtils.isNullOrEmpty(MyAd.s_httpUrl)) {
                var url = MyAd.s_httpUrl + "/" + "@uploadsave4?" + MyAd.commonUrlParam() + "&type=InterstitialImage" + "&placement=" + name;
                dSocket.RequestHttp(url);
            }
        });
    };
    MyAd.ShowAdInterstitialVideoTrace = function (name) {
        dInterface.ptr.ShowAdInterstitialVideo(function () {
        });
    };
    MyAd.isShowAdBanner = function () {
        return MyAd.m_bShowBanner;
    };
    MyAd.isAdInterstitialVideoReady = function () {
        return dInterface.ptr.isAdInterstitialVideoReady();
    };
    MyAd.isAdRewardedReady = function () {
        return dInterface.ptr.isAdRewardedReady();
    };
    MyAd.ShowAdBanner = function (bShow, flag) {
        if (flag === void 0) { flag = 0; }
        if (MyAd.isShowAdBanner() != bShow) {
            console.log("ShowBanner " + bShow);
            MyAd.m_bShowBanner = bShow;
            dInterface.ptr.ShowAdBanner(bShow, flag);
        }
    };
    MyAd.isAdRewardedShowing = function () {
        return dInterface.ptr.isAdRewardedShowing();
    };
    MyAd.GetMoreGameText = function (split) {
        if (split === void 0) { split = null; }
        var str = "";
        if (dThread.GetSdkName() == "web" && dThread.GetChannelName() == "oppo")
            str = "";
        else
            str = "";
        if (!split)
            return str;
        var ret = "";
        for (var i = 0; i < str.length; i++) {
            if (i > 0)
                ret += split;
            ret += str.charAt(i);
        }
        return ret;
    };
    MyAd.hasMoreGame = function () {
        if (dInterface.ptr.GetMoreGameList())
            return true;
        return dInterface.ptr.hasMoreGame();
    };
    MyAd.ShowAdMoreGame = function () {
        dInterface.ptr.ShowAdBox(function () {
            if (!dStringUtils.isNullOrEmpty(MyAd.s_httpUrl)) {
                var url = MyAd.s_httpUrl + "/" + "@uploadsave4?" + MyAd.commonUrlParam() + "&type=Box" + "&placement=show";
                dSocket.RequestHttp(url);
            }
        });
    };
    MyAd.ShowAdMoreGameIcon = function (icon, y, flag, onShow) {
        if (flag === void 0) { flag = 0; }
        if (onShow === void 0) { onShow = null; }
        if (MyAd.s_lastShowMoreGameIconY != y) {
            MyAd.s_lastShowMoreGameIconY = y;
            dInterface.ptr.ShowAdMoreGameIcon(icon, y, flag, function () {
                if (!dStringUtils.isNullOrEmpty(MyAd.s_httpUrl)) {
                    var url = MyAd.s_httpUrl + "/" + "@uploadsave4?" + MyAd.commonUrlParam() + "&type=Box" + "&placement=show";
                    dSocket.RequestHttp(url);
                }
            });
        }
    };
    MyAd.HideAdMoreGameIcon = function () {
        if (MyAd.s_lastShowMoreGameIconY != -1) {
            MyAd.s_lastShowMoreGameIconY = -1;
            dInterface.ptr.HideAdMoreGameIcon();
        }
    };
    MyAd.s_nLastShowFullscreenTime = -30000;
    MyAd.s_nLastShowInterTime = -150000;
    MyAd.s_strAppName = "";
    MyAd.m_fCurTimeAdd = 0;
    MyAd.s_httpUrl = "";
    MyAd.s_httpCdn = "";
    MyAd.m_bShowBanner = false;
    MyAd.yinSiUrl = "privacy.html";
    MyAd.yongHuUrl = "yonghu.html";
    MyAd.s_crashSended = false;
    MyAd.s_lastShowMoreGameIconY = -1;
    return MyAd;
}());
var MyShareRecording = (function () {
    function MyShareRecording() {
        this.m_bRecording = false;
        this.m_nRecordingStartTime = 0;
        this.m_endRecordTimer = null;
    }
    MyShareRecording.Instance = function () {
        if (MyShareRecording.s_pInstance == null)
            MyShareRecording.s_pInstance = new MyShareRecording();
        return MyShareRecording.s_pInstance;
    };
    MyShareRecording.prototype.StartRecord = function () {
        if (dThread.GetSdkName() == "tt") {
            this.m_bRecording = dInterface.ptr.StartShareRecord();
            this.m_nRecordingStartTime = dTimer.GetTickCount();
            if (this.m_endRecordTimer) {
                this.m_endRecordTimer.Stop();
                this.m_endRecordTimer = null;
            }
        }
    };
    MyShareRecording.prototype.StopRecord = function (onComplete) {
        if (onComplete === void 0) { onComplete = null; }
        if (this.m_bRecording) {
            this.m_bRecording = false;
            dInterface.ptr.StopShareRecord(onComplete);
        }
        if (this.m_endRecordTimer) {
            this.m_endRecordTimer.Stop();
            this.m_endRecordTimer = null;
        }
    };
    MyShareRecording.prototype.isRecording = function () {
        return this.m_bRecording;
    };
    MyShareRecording.prototype.EndRecord = function (ShareButton) {
        ShareButton.visible = this.m_bRecording;
        if (this.m_bRecording) {
            this.StopRecord();
        }
        ShareButton.SetEvent(new dEvent().SetOnButtonUp(function () {
            dSound.PlaySound("data/sound/button.mp3");
            dInterface.ptr.ShareRecord();
        }));
    };
    MyShareRecording.s_pInstance = null;
    return MyShareRecording;
}());
//# sourceMappingURL=MainGame.js.map